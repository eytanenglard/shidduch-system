generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
}

model User {
  id                String     @id @default(cuid())
  email             String     @unique
  password          String?
  firstName         String
  lastName          String
    appleId  String?  @unique  // Apple user ID for Sign in with Apple

  phone             String?    @unique
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  lastLogin         DateTime?
  status            UserStatus @default(PENDING_PHONE_VERIFICATION)
  role              UserRole   @default(CANDIDATE)
  isVerified        Boolean    @default(false)
  isPhoneVerified   Boolean    @default(false)
  isProfileComplete Boolean    @default(false)
  deviceTokens      DeviceToken[]

  source                    UserSource @default(REGISTRATION)
  addedByMatchmakerId       String?
  matchmakerWhoAdded        User?      @relation("ManuallyAddedBy", fields: [addedByMatchmakerId], references: [id])
  termsAndPrivacyAcceptedAt DateTime?
  engagementEmailsConsent   Boolean    @default(false)
  promotionalEmailsConsent  Boolean    @default(false)
  language                  Language   @default(he)

  // === Assigned Matchmaker (NEW) ===
  assignedMatchmakerId   String?
  assignedMatchmaker     User?   @relation("AssignedMatchmaker", fields: [assignedMatchmakerId], references: [id])
  assignedUsers          User[]  @relation("AssignedMatchmaker")

  // === Direct Messages (NEW) ===
  sentDirectMessages     DirectMessage[] @relation("SentDirectMessages")
  receivedDirectMessages DirectMessage[] @relation("ReceivedDirectMessages")

  // === Availability Inquiries ===
  firstPartyInquiries             AvailabilityInquiry[]   @relation("FirstPartyInquiries")
  matchmakerAvailabilityInquiries AvailabilityInquiry[]   @relation("MatchmakerInquiries")
  secondPartyInquiries            AvailabilityInquiry[]   @relation("SecondPartyInquiries")

  // === Date Feedback ===
  givenFeedback                   DateFeedback[]          @relation("UserFeedback")

  // === Invitations ===
  sentInvitations                 Invitation[]            @relation("MatchmakerInvitations")
  receivedInvitation              Invitation?             @relation("ReceivedInvitation")

  // === Match Suggestions ===
  firstPartySuggestions           MatchSuggestion[]       @relation("FirstPartySuggestions")
  createdSuggestions              MatchSuggestion[]       @relation("MatchmakerSuggestions")
  secondPartySuggestions          MatchSuggestion[]       @relation("SecondPartySuggestions")
  approvedSuggestions             MatchSuggestion[]       @relation("ApprovedSuggestions")
  reviewedSuggestions             MatchSuggestion[]       @relation("ReviewedSuggestions")

  // === Auth ===
  accounts                        Account[]
  sessions                        Session[]
  oneTimeAuthTokens               OneTimeAuthToken[]

  // === Profile & Questionnaire ===
  profile                         Profile?
  verifiedUsers                   Profile[]               @relation("VerifiedByMatchmaker")
  questionnaireResponses          QuestionnaireResponse[]

  // === Suggestion Inquiries ===
  sentSuggestionInquiries         SuggestionInquiry[]     @relation("SentSuggestionInquiries")
  receivedSuggestionInquiries     SuggestionInquiry[]     @relation("ReceivedSuggestionInquiries")

  // === Media ===
  images                          UserImage[]
  videos                          Video[]

  // === Verification ===
  verifications                   Verification[]

  // === Manually Added Candidates ===
  manuallyAddedCandidates         User[]                  @relation("ManuallyAddedBy")

  // === Feedback ===
  feedbacks                       Feedback[]

  // === Drip Campaign & Onboarding ===
  dripCampaign                    UserDripCampaign?
  lastOnboardingEmailSent         DateTime?
  onboardingCompleted             Boolean   @default(false)

  // === Neshama Insight ===
  neshamaInsightLastGeneratedAt   DateTime?
  neshamaInsightGeneratedCount    Int       @default(0)

  // === Referral ===
  referral                        Referral?  @relation("ReferredUser")

  // === Saved Searches ===
  targetUserSearches              SavedMatchSearch[]       @relation("TargetUserSearches")
  matchmakerSearches              SavedMatchSearch[]       @relation("MatchmakerSearches")
  targetUserVectorSearches        SavedVectorMatchSearch[] @relation("TargetUserVectorSearches")
  matchmakerVectorSearches        SavedVectorMatchSearch[] @relation("MatchmakerVectorSearches")

  // === Virtual Profiles ===
  virtualProfiles                 VirtualProfile[]         @relation("MatchmakerVirtualProfiles")

  // === Potential Matches ===
  maleMatches                     PotentialMatch[]         @relation("MaleMatches")
  femaleMatches                   PotentialMatch[]         @relation("FemaleMatches")

  // === Scanned Pairs ===
  maleScannedPairs                ScannedPair[]            @relation("MaleScannedPairs")
  femaleScannedPairs              ScannedPair[]            @relation("FemaleScannedPairs")

  // === Hidden Candidates ===
  hiddenByMatchmakers             HiddenCandidate[]        @relation("HiddenCandidates")
  hiddenCandidates                HiddenCandidate[]        @relation("HiddenByMatchmaker")

  // === Alerts ===
  alerts                          UserAlert[]

  // === Scan Sessions ===
  scanSessions                    ScanSession[]

  // === Suggestion Messages ===
  suggestionMessages              SuggestionMessage[]      @relation("UserSuggestionMessages")

  @@index([email])
  @@index([role])
  @@index([status])
  @@index([source])
  @@index([addedByMatchmakerId])
  @@index([assignedMatchmakerId])
}
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade) // ‚úÖ ◊î◊ô◊î ◊ß◊ô◊ô◊ù

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model OneTimeAuthToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade) // ‚úÖ ◊î◊ô◊î ◊ß◊ô◊ô◊ù
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade) // ‚úÖ ◊î◊ô◊î ◊ß◊ô◊ô◊ù

  @@index([userId])
}

model Verification {
  id          String             @id @default(cuid())
  userId      String?
  type        VerificationType
  token       String
  target      String?
  expiresAt   DateTime
  status      VerificationStatus @default(PENDING)
  attempts    Int                @default(0)
  metadata    Json?
  createdAt   DateTime           @default(now())
  completedAt DateTime?
  user        User?              @relation(fields: [userId], references: [id], onDelete: Cascade) // ‚ùóÔ∏è ◊î◊ï◊°◊§◊™◊ô/◊©◊ô◊†◊ô◊™◊ô

  @@index([userId, type, status])
  @@index([target, type, status])
  @@index([token, type, status])
}

// model Profile in your schema.prisma

model Profile {
  id                     String   @id @default(cuid())
  userId                 String   @unique
  gender                 Gender
  birthDate              DateTime
  birthDateIsApproximate Boolean? @default(false) // <--- ◊î◊ï◊°◊£ ◊©◊ì◊î ◊ñ◊î

  nativeLanguage          String?
  additionalLanguages     String[]
  height                  Int?
  maritalStatus           String? // Marital status of the user
  occupation              String?
  education               String?
  educationLevel          String?
  city                    String?
  origin                  String? // Origin of the user
  religiousLevel          String? // Religious level of the user
  religiousJourney        ReligiousJourney? // <--- ◊î◊ï◊°◊§◊™ ◊î◊©◊ì◊î ◊î◊ó◊ì◊©
  testimonialRequests     TestimonialRequest[] // <-- ADD THIS LINE
  shomerNegiah            Boolean?
  serviceType             ServiceType? // Service type of the user
  serviceDetails          String?
  manualEntryText         String?
  headCovering            HeadCoveringType?
  kippahType              KippahType?
  hasChildrenFromPrevious Boolean?          @default(false)
  profileCharacterTraits  String[]          @default([]) // User's own traits
  profileHobbies          String[]          @default([]) // User's own hobbies
  aliyaCountry            String?
  aliyaYear               Int?
  about                   String?
  isAboutVisible Boolean? @default(true)
  testimonials          FriendTestimonial[]
isFriendsSectionVisible Boolean? @default(true)
isNeshamaTechSummaryVisible Boolean? @default(true)
    profileHeadline       String? // ◊õ◊ï◊™◊®◊™ ◊ê◊ô◊©◊ô◊™ ◊ú◊§◊®◊ï◊§◊ô◊ú
  inspiringCoupleStory  String? // ◊°◊ô◊§◊ï◊® ◊¢◊ú ◊ñ◊ï◊í ◊û◊¢◊ï◊®◊® ◊î◊©◊®◊ê◊î
  influentialRabbi      String? // ◊ì◊û◊ï◊™ ◊®◊ë◊†◊ô◊™/◊®◊ï◊ó◊†◊ô◊™ ◊û◊©◊§◊ô◊¢◊î
  parentStatus            String?
  fatherOccupation        String? // ◊û◊ß◊¶◊ï◊¢ ◊î◊ê◊ë
  motherOccupation        String? // ◊û◊ß◊¶◊ï◊¢ ◊î◊ê◊ù
  siblings                Int?
  position                Int?
 hasMedicalInfo              Boolean?
  medicalInfoDetails          String?
  medicalInfoDisclosureTiming String? // ◊ú◊ì◊ï◊í◊û◊î: 'FROM_THE_START', 'WHEN_SERIOUS'
  // ◊©◊ì◊î ◊ñ◊î ◊ß◊ï◊ë◊¢ ◊î◊ê◊ù ◊î◊û◊ô◊ì◊¢ ◊î◊®◊§◊ï◊ê◊ô ◊ô◊ï◊¶◊í ◊ë◊õ◊®◊ò◊ô◊° ◊î◊§◊®◊ï◊§◊ô◊ú ◊î◊†◊©◊ú◊ó ◊ú◊¶◊ì ◊î◊©◊†◊ô
  isMedicalInfoVisible        Boolean  @default(false)
  // --- Existing Preference Fields ---
  preferredAgeMin                  Int?
  preferredAgeMax                  Int?
  preferredHeightMin               Int?
  preferredHeightMax               Int?
  preferredReligiousLevels         String[] @default([])
  preferredLocations               String[] @default([])
  preferredEducation               String[] @default([]) // Corresponds to educationPreferenceOptions
  preferredOccupations             String[] @default([]) // Corresponds to occupationPreferenceOptions
  contactPreference                String?

  // --- New Preference Fields ---
  preferredMaritalStatuses    String[]           @default([]) // Preferred marital status(es) of the partner
  preferredShomerNegiah       String? // e.g., "yes", "no", "flexible"
  preferredPartnerHasChildren String? // e.g., "yes_ok", "no_preferred", "does_not_matter"
  preferredOrigins            String[]           @default([]) // Preferred origin(s) of the partner
  preferredServiceTypes       ServiceType[]      @default([]) // Preferred service type(s) of the partner
  preferredHeadCoverings      HeadCoveringType[] @default([]) // Preferred head covering(s) if partner is female
  preferredKippahTypes        KippahType[]       @default([]) // Preferred kippah type(s) if partner is male
  preferredCharacterTraits    String[]           @default([]) // Preferred character trait(s) of the partner
  preferredHobbies            String[]           @default([]) // Preferred hobbies of the partner
  preferredAliyaStatus        String? // e.g., "oleh", "tzabar", "no_preference"
preferredReligiousJourneys  ReligiousJourney[] @default([]) 
metrics  ProfileMetrics?
  isProfileVisible          Boolean            @default(true)
  preferredMatchmakerGender Gender?
  matchingNotes             String? // General notes about the desired match
  internalMatchmakerNotes String?
  verifiedBy                String?
  availabilityStatus        AvailabilityStatus @default(AVAILABLE)
  wantsToBeFirstParty  Boolean  @default(true)

  availabilityNote          String?
  availabilityUpdatedAt     DateTime?
  createdAt                 DateTime           @default(now())
  updatedAt                 DateTime           @updatedAt
    contentUpdatedAt        DateTime?   @default(now())

  lastActive                DateTime?

  user                    User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  verifiedByMatchmaker    User?          @relation("VerifiedByMatchmaker", fields: [verifiedBy], references: [id], onDelete: SetNull)
  vector                  ProfileVector? // ◊î◊ï◊°◊§◊™ ◊ß◊©◊® ◊î◊§◊ï◊ö
  hasViewedProfilePreview Boolean        @default(false)
    needsAiProfileUpdate    Boolean    @default(true)
    aiProfileSummary        Json?      
    cvUrl                   String? // URL to the CV file stored in Cloudinary
  cvSummary               String? @db.Text // AI-generated summary of the CV
conversationSummary     String? @db.Text 

referredBy              String?   // ◊ì◊®◊ö ◊û◊ô ◊î◊í◊ô◊¢ - ◊ê◊ô◊© ◊ß◊©◊® ◊ú◊î◊™◊ß◊©◊®◊ï◊™

  // ==========================================================================
  // üÜï Priority System
  // ==========================================================================
  priorityScore           Float?    @default(50)      // ◊¶◊ô◊ï◊ü ◊¢◊ì◊ô◊§◊ï◊™ 0-100
  priorityCategory        String?   @default("MEDIUM") // CRITICAL/HIGH/MEDIUM/LOW
  priorityUpdatedAt       DateTime?                    // ◊û◊™◊ô ◊¢◊ï◊ì◊õ◊ü ◊î◊¶◊ô◊ï◊ü
  
  // ==========================================================================
  // üÜï Scanning & Suggestions Tracking
  // ==========================================================================
  lastScannedAt           DateTime?                    // ◊û◊™◊ô ◊†◊°◊®◊ß ◊ú◊ê◊ó◊®◊ï◊†◊î
  lastSuggestedAt         DateTime?                    // ◊û◊™◊ô ◊ß◊ô◊ë◊ú ◊î◊¶◊¢◊î ◊ê◊ó◊®◊ï◊†◊î
  pendingMatchesCount     Int       @default(0)        // ◊õ◊û◊î PotentialMatches ◊û◊û◊™◊ô◊†◊ô◊ù
  
  // ==========================================================================
  // üÜï Engagement Metrics
  // ==========================================================================
  lastActiveAt            DateTime?                    // ◊§◊¢◊ô◊ú◊ï◊™ ◊ê◊ó◊®◊ï◊†◊î
  suggestionsReceived     Int       @default(0)        // ◊õ◊û◊î ◊î◊¶◊¢◊ï◊™ ◊ß◊ô◊ë◊ú
  suggestionsAccepted     Int       @default(0)        // ◊õ◊û◊î ◊î◊¶◊¢◊ï◊™ ◊ß◊ô◊ë◊ú (◊ê◊ô◊©◊®)
  suggestionsDeclined     Int       @default(0)        // ◊õ◊û◊î ◊î◊¶◊¢◊ï◊™ ◊ì◊ó◊î
  averageResponseTimeHours Float?                      // ◊ñ◊û◊ü ◊™◊í◊ï◊ë◊î ◊û◊û◊ï◊¶◊¢ ◊ë◊©◊¢◊ï◊™
  
  // ==========================================================================
  // üÜï Matchmaker Impressions (◊î◊¢◊®◊õ◊î ◊°◊ï◊ë◊ô◊ô◊ß◊ò◊ô◊ë◊ô◊™)
  // ==========================================================================
  matchmakerImpression    String?   @db.Text           // ◊î◊™◊®◊©◊û◊ï◊™ ◊õ◊ú◊ú◊ô◊™
  impressionScore         Int?                         // ◊¶◊ô◊ï◊ü ◊î◊™◊®◊©◊û◊ï◊™ 1-10
  redFlags                String[]  @default([])       // ◊ì◊í◊ú◊ô◊ù ◊ê◊ì◊ï◊û◊ô◊ù
  greenFlags              String[]  @default([])       // ◊†◊ß◊ï◊ì◊ï◊™ ◊ó◊ô◊ï◊ë◊ô◊ï◊™
  difficultyScore         Int?      @default(5)        // ◊ß◊ï◊©◊ô ◊ë◊©◊ô◊ì◊ï◊ö 1-10
  readinessLevel          ReadinessLevel? @default(READY)
  
  // ==========================================================================
  // üÜï Profile Completeness
  // ==========================================================================
  profileCompletenessScore Float?   @default(0)        // ◊ê◊ó◊ï◊ñ ◊û◊ô◊ú◊ï◊ô 0-100
  missingFields           String[]  @default([])       // ◊©◊ì◊ï◊™ ◊ó◊°◊®◊ô◊ù
  
  // ==========================================================================
  // üÜï Derived Stats (◊û◊ó◊ï◊©◊ë ◊û◊î◊ì◊ê◊ò◊î)
  // ==========================================================================
  acceptanceRate          Float?                       // ◊©◊ô◊¢◊ï◊® ◊ß◊ë◊ú◊™ ◊î◊¶◊¢◊ï◊™
  avgMatchScore           Float?                       // ◊¶◊ô◊ï◊ü ◊î◊™◊ê◊û◊î ◊û◊û◊ï◊¶◊¢
  
  // Relations
  rejectionFeedbacks      RejectionFeedback[] @relation("RejectedUser")
  givenRejectionFeedbacks RejectionFeedback[] @relation("RejectingUser")


}


model Meeting {
  id            String          @id @default(cuid())
  suggestionId  String
  scheduledDate DateTime
  status        MeetingStatus
  location      String?
  notes         String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  feedback      DateFeedback[]  @relation("MeetingFeedback")
  suggestion    MatchSuggestion @relation(fields: [suggestionId], references: [id], onDelete: Cascade) // ‚ùóÔ∏è ◊î◊ï◊°◊§◊™◊ô/◊©◊ô◊†◊ô◊™◊ô

  @@index([suggestionId])
  @@index([status])
}

model MatchSuggestion {
  id                    String                    @id @default(cuid())
 isAutoSuggestion  Boolean   @default(false)
  matchmakerId          String
  firstPartyId          String
  secondPartyId         String
  status                MatchSuggestionStatus     @default(DRAFT)
  priority              Priority                  @default(MEDIUM)
  internalNotes         String?
  firstPartyNotes       String?
  secondPartyNotes      String?
  matchingReason        String?
  followUpNotes         String?
  responseDeadline      DateTime?
  decisionDeadline      DateTime?
  lastStatusChange      DateTime?
  previousStatus        MatchSuggestionStatus?
  lastActivity          DateTime                  @default(now())
  firstPartySent        DateTime?
  firstPartyResponded   DateTime?
  secondPartySent       DateTime?
  secondPartyResponded  DateTime?
  firstMeetingScheduled DateTime?
  closedAt              DateTime?
  category              SuggestionCategory        @default(ACTIVE)
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt
  feedback              DateFeedback[]            @relation("SuggestionFeedback")
  firstParty            User                      @relation("FirstPartySuggestions", fields: [firstPartyId], references: [id], onDelete: Cascade) // ‚úÖ ◊î◊ô◊î ◊ß◊ô◊ô◊ù
  matchmaker            User                      @relation("MatchmakerSuggestions", fields: [matchmakerId], references: [id], onDelete: Cascade) // ‚úÖ ◊î◊ô◊î ◊ß◊ô◊ô◊ù
  secondParty           User                      @relation("SecondPartySuggestions", fields: [secondPartyId], references: [id], onDelete: Cascade) // ‚úÖ ◊î◊ô◊î ◊ß◊ô◊ô◊ù
  meetings              Meeting[]
  inquiries             SuggestionInquiry[]
  statusHistory         SuggestionStatusHistory[]
  approvedBy            User[]                    @relation("ApprovedSuggestions")
  reviewedBy            User[]                    @relation("ReviewedSuggestions")
  firstPartyLastViewedAt  DateTime?  // ◊û◊™◊ô ◊¶◊ì ◊ê' ◊¶◊§◊î ◊ë◊î◊¶◊¢◊î ◊ú◊ê◊ó◊®◊ï◊†◊î
  secondPartyLastViewedAt DateTime?  // ◊û◊™◊ô ◊¶◊ì ◊ë' ◊¶◊§◊î ◊ë◊î◊¶◊¢◊î ◊ú◊ê◊ó◊®◊ï◊†◊î
 potentialMatch  PotentialMatch?
 messages    SuggestionMessage[]

  @@index([category])
  @@index([matchmakerId])
  @@index([firstPartyId])
  @@index([secondPartyId])
  @@index([status])
  @@index([priority])
  @@index([lastActivity])
}

model SuggestionStatusHistory {
  id           String                @id @default(cuid())
  suggestionId String
  status       MatchSuggestionStatus
  reason       String?
  notes        String?
  createdAt    DateTime              @default(now())
  suggestion   MatchSuggestion       @relation(fields: [suggestionId], references: [id], onDelete: Cascade) // ‚úÖ ◊î◊ô◊î ◊ß◊ô◊ô◊ù

  @@index([suggestionId])
}

model Invitation {
  id           String           @id @default(cuid())
  matchmakerId String
  email        String
  token        String           @unique
  expires      DateTime
  status       InvitationStatus @default(PENDING)
  metadata     Json?
  userId       String?          @unique
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  matchmaker   User             @relation("MatchmakerInvitations", fields: [matchmakerId], references: [id], onDelete: Cascade) // ‚ùóÔ∏è ◊î◊ï◊°◊§◊™◊ô/◊©◊ô◊†◊ô◊™◊ô
  user         User?            @relation("ReceivedInvitation", fields: [userId], references: [id], onDelete: Cascade) // ‚ùóÔ∏è ◊î◊ï◊°◊§◊™◊ô/◊©◊ô◊†◊ô◊™◊ô

  @@index([matchmakerId])
  @@index([email])
  @@index([status])
}

model Video {
  id        String      @id @default(cuid())
  userId    String
  url       String
  type      VideoType
  status    VideoStatus @default(PENDING)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade) // ‚ùóÔ∏è ◊î◊ï◊°◊§◊™◊ô/◊©◊ô◊†◊ô◊™◊ô
}

model AvailabilityInquiry {
  id                  String   @id @default(cuid())
  matchmakerId        String
  firstPartyId        String
  secondPartyId       String
  firstPartyResponse  Boolean?
  secondPartyResponse Boolean?
  note                String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  expiresAt           DateTime
  firstParty          User     @relation("FirstPartyInquiries", fields: [firstPartyId], references: [id], onDelete: Cascade) // ‚ùóÔ∏è ◊î◊ï◊°◊§◊™◊ô/◊©◊ô◊†◊ô◊™◊ô
  matchmaker          User     @relation("MatchmakerInquiries", fields: [matchmakerId], references: [id], onDelete: Cascade) // ‚ùóÔ∏è ◊î◊ï◊°◊§◊™◊ô/◊©◊ô◊†◊ô◊™◊ô
  secondParty         User     @relation("SecondPartyInquiries", fields: [secondPartyId], references: [id], onDelete: Cascade) // ‚ùóÔ∏è ◊î◊ï◊°◊§◊™◊ô/◊©◊ô◊†◊ô◊™◊ô

  @@index([matchmakerId])
  @@index([firstPartyId])
  @@index([secondPartyId])
}

model QuestionnaireResponse {
  id                    String    @id @default(cuid())
  userId                String
  valuesAnswers         Json?
  personalityAnswers    Json?
  relationshipAnswers   Json?
  partnerAnswers        Json?
  religionAnswers       Json?
  valuesCompleted       Boolean   @default(false)
  personalityCompleted  Boolean   @default(false)
  relationshipCompleted Boolean   @default(false)
  partnerCompleted      Boolean   @default(false)
  religionCompleted     Boolean   @default(false)
  worldsCompleted       String[]
  completed             Boolean   @default(false)
  startedAt             DateTime
  completedAt           DateTime?
  lastSaved             DateTime  @default(now())
    currentQuestionIndices Json?

  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade) // ‚ùóÔ∏è ◊î◊ï◊°◊§◊™◊ô/◊©◊ô◊†◊ô◊™◊ô

  @@index([userId])
  @@index([completed])
  @@index([valuesCompleted])
  @@index([personalityCompleted])
  @@index([relationshipCompleted])
  @@index([partnerCompleted])
  @@index([religionCompleted])
}

model UserImage {
  id                 String   @id @default(cuid())
  url                String
  isMain             Boolean  @default(false)
  cloudinaryPublicId String?
  userId             String
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade) // ‚úÖ ◊î◊ô◊î ◊ß◊ô◊ô◊ù

  @@index([userId])
}

model DateFeedback {
  id            String          @id @default(cuid())
  suggestionId  String
  partyId       String
  meetingId     String
  meetingNumber Int
  feedback      String
  status        String
  nextSteps     String?
  createdAt     DateTime        @default(now())
  meeting       Meeting         @relation("MeetingFeedback", fields: [meetingId], references: [id], onDelete: Cascade) // ‚ùóÔ∏è ◊î◊ï◊°◊§◊™◊ô/◊©◊ô◊†◊ô◊™◊ô
  party         User            @relation("UserFeedback", fields: [partyId], references: [id], onDelete: Cascade) // ‚ùóÔ∏è ◊î◊ï◊°◊§◊™◊ô/◊©◊ô◊†◊ô◊™◊ô
  suggestion    MatchSuggestion @relation("SuggestionFeedback", fields: [suggestionId], references: [id], onDelete: Cascade) // ‚ùóÔ∏è ◊î◊ï◊°◊§◊™◊ô/◊©◊ô◊†◊ô◊™◊ô

  @@index([suggestionId])
  @@index([partyId])
  @@index([meetingId])
}

model SuggestionInquiry {
  id           String          @id @default(cuid())
  suggestionId String
  fromUserId   String
  toUserId     String
  question     String
  answer       String?
  status       InquiryStatus   @default(PENDING)
  createdAt    DateTime        @default(now())
  answeredAt   DateTime?
  fromUser     User            @relation("SentSuggestionInquiries", fields: [fromUserId], references: [id], onDelete: Cascade) // ‚ùóÔ∏è ◊î◊ï◊°◊§◊™◊ô/◊©◊ô◊†◊ô◊™◊ô
  suggestion   MatchSuggestion @relation(fields: [suggestionId], references: [id], onDelete: Cascade) // ‚úÖ ◊î◊ô◊î ◊ß◊ô◊ô◊ù
  toUser       User            @relation("ReceivedSuggestionInquiries", fields: [toUserId], references: [id], onDelete: Cascade) // ‚ùóÔ∏è ◊î◊ï◊°◊§◊™◊ô/◊©◊ô◊†◊ô◊™◊ô
recipientReadAt DateTime?

  @@index([suggestionId])
  @@index([fromUserId])
  @@index([toUserId])
}

// --- Enums ---
enum ServiceType {
  MILITARY_COMBATANT
  MILITARY_SUPPORT
  MILITARY_OFFICER
  MILITARY_INTELLIGENCE_CYBER_TECH
  NATIONAL_SERVICE_ONE_YEAR
  NATIONAL_SERVICE_TWO_YEARS
  HESDER_YESHIVA
  YESHIVA_ONLY_POST_HS
  PRE_MILITARY_ACADEMY_AND_SERVICE
  EXEMPTED
  CIVILIAN_SERVICE
  OTHER
}

enum HeadCoveringType {
  FULL_COVERAGE
  PARTIAL_COVERAGE
  HAT_BERET
  SCARF_ONLY_SOMETIMES
  NONE
  WIG
  UNDECIDED  // ‚úÖ ◊î◊ï◊°◊£
}


enum KippahType {
  BLACK_VELVET
  KNITTED_SMALL
  KNITTED_LARGE
  CLOTH
  BRESLEV
  NONE_AT_WORK_OR_CASUAL
  NONE_USUALLY
  OTHER
}

enum MeetingStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum Gender {
  MALE
  FEMALE
}

enum UserRole {
  CANDIDATE
  MATCHMAKER
  ADMIN
}

enum UserStatus {
  PENDING_EMAIL_VERIFICATION
  PENDING_PHONE_VERIFICATION
  ACTIVE
  INACTIVE
  BLOCKED
}

enum VideoType {
  INTRODUCTION
  PERSONAL_STORY
  OTHER
}

enum VideoStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ContactMethod {
  EMAIL
  WHATSAPP
  PHONE
}

enum MatchSuggestionStatus {
  DRAFT
  PENDING_FIRST_PARTY
  FIRST_PARTY_APPROVED
  FIRST_PARTY_DECLINED
  PENDING_SECOND_PARTY
  SECOND_PARTY_APPROVED
  SECOND_PARTY_DECLINED
  AWAITING_MATCHMAKER_APPROVAL
  CONTACT_DETAILS_SHARED
  AWAITING_FIRST_DATE_FEEDBACK
  THINKING_AFTER_DATE
  PROCEEDING_TO_SECOND_DATE
  ENDED_AFTER_FIRST_DATE
  MEETING_PENDING
  MEETING_SCHEDULED
  MATCH_APPROVED
  MATCH_DECLINED
  DATING
  ENGAGED
  MARRIED
  EXPIRED
  CLOSED
  CANCELLED
}

enum SuggestionCategory {
  ACTIVE
  PENDING
  HISTORY
}

enum UserSource {
  REGISTRATION // User registered themselves
  MANUAL_ENTRY // User added manually by a matchmaker
  IMPORTED // Future: User imported from another system
}

enum AvailabilityStatus {
  AVAILABLE
  UNAVAILABLE
  DATING
  PAUSED
  ENGAGED
  MARRIED
}

enum ReligiousJourney {
  BORN_INTO_CURRENT_LIFESTYLE // ◊í◊ì◊ú◊™◊ô ◊ë◊°◊ë◊ô◊ë◊î ◊ì◊ï◊û◊î
  BORN_SECULAR
  BAAL_TESHUVA                // ◊ó◊ñ◊®◊™◊ô ◊ë◊™◊©◊ï◊ë◊î
  DATLASH                     // ◊ô◊¶◊ê◊™◊ô ◊ë◊©◊ê◊ú◊î
  CONVERT                     // ◊í◊®/◊í◊ô◊ï◊®◊™
  IN_PROCESS                  // ◊ë◊™◊î◊ú◊ô◊ö ◊©◊ú ◊©◊ô◊†◊ï◊ô
  OTHER                       // ◊ê◊ó◊®
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

enum VerificationType {
  EMAIL
  PHONE_WHATSAPP
  DOCUMENT
  REFERENCE
  PASSWORD_RESET
  ACCOUNT_SETUP
}

enum VerificationStatus {
  PENDING
  COMPLETED
  EXPIRED
  FAILED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum InquiryStatus {
  PENDING
  ANSWERED
  CLOSED
}

model Feedback {
  id            String         @id @default(cuid())
  createdAt     DateTime       @default(now())
  userId        String?
  user          User?          @relation(fields: [userId], references: [id], onDelete: Cascade)
  pageUrl       String
  feedbackType  FeedbackType
  content       String         @db.Text
  status        FeedbackStatus @default(NEW)
  userAgent     String?
  screenshotUrl String?      // Field for the screenshot URL

  @@index([userId])
}

enum FeedbackType {
  SUGGESTION
  BUG
  POSITIVE
}

enum FeedbackStatus {
  NEW
  IN_PROGRESS
  RESOLVED
  WONT_FIX
}

model FriendTestimonial {
  id           String   @id @default(cuid())
  profileId    String
  profile      Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  authorName   String   // ◊©◊ù ◊î◊ó◊ë◊®/◊î ◊î◊û◊û◊ú◊ô◊¶/◊î
  relationship String   // ◊î◊ß◊©◊® ◊ú◊û◊ï◊¢◊û◊ì/◊™ (◊ú◊û◊©◊ú: "◊ó◊ë◊® ◊ô◊ú◊ì◊ï◊™")
  content      String   @db.Text
  authorPhone  String?  // ◊û◊°◊§◊® ◊î◊ò◊ú◊§◊ï◊ü ◊©◊ú ◊î◊û◊û◊ú◊ô◊¶/◊î (◊ê◊ï◊§◊¶◊ô◊ï◊†◊ú◊ô)
  
  // --- ◊©◊ì◊ï◊™ ◊ë◊ß◊®◊î ◊ï◊§◊®◊ò◊ô◊ï◊™ ---
  isPhoneVisibleToMatch Boolean   @default(false) // ◊î◊°◊õ◊û◊î ◊û◊§◊ï◊®◊©◊™ ◊ú◊î◊¶◊í◊™ ◊î◊û◊°◊§◊®
  status                TestimonialStatus @default(PENDING) // ◊°◊ò◊ò◊ï◊° ◊î◊î◊û◊ú◊¶◊î
  submittedBy           SubmissionSource  @default(USER)   // ◊ê◊ô◊ö ◊î◊î◊û◊ú◊¶◊î ◊î◊ï◊í◊©◊î
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([profileId])
}

// --- ◊î◊ï◊°◊§◊™ Enums ◊ó◊ì◊©◊ô◊ù ---
enum TestimonialStatus {
  PENDING   // ◊û◊û◊™◊ô◊ü ◊ú◊ê◊ô◊©◊ï◊® ◊î◊û◊ï◊¢◊û◊ì/◊™
  APPROVED  // ◊û◊ê◊ï◊©◊® ◊ï◊û◊ï◊¶◊í ◊ë◊§◊®◊ï◊§◊ô◊ú
  HIDDEN    // ◊û◊ê◊ï◊©◊® ◊ê◊ö ◊û◊ï◊°◊™◊® ◊ñ◊û◊†◊ô◊™ ◊¢◊ú ◊ô◊ì◊ô ◊î◊û◊ï◊¢◊û◊ì/◊™
}


enum SubmissionSource {
  USER   // ◊î◊ï◊ñ◊ü ◊ô◊ì◊†◊ô◊™ ◊¢◊ú ◊ô◊ì◊ô ◊î◊û◊ï◊¢◊û◊ì/◊™
  FRIEND // ◊î◊ï◊í◊© ◊¢◊ú ◊ô◊ì◊ô ◊ó◊ë◊® ◊ì◊®◊ö ◊ß◊ô◊©◊ï◊® ◊û◊ê◊ï◊ë◊ò◊ó
}

enum TestimonialRequestStatus {
  PENDING
  COMPLETED
}

model TestimonialRequest {
  id        String    @id @default(cuid())
  token     String    @unique // The secure, random token for the URL
  expiresAt DateTime  // The date when the link will expire
  status    TestimonialRequestStatus @default(PENDING) // Tracks if the token has been used
  
  profileId String
  profile   Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([profileId])
}

model UserDripCampaign {
  id            String         @id @default(cuid())
  userId        String         @unique
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  currentStep   Int            @default(1)
  nextSendDate  DateTime
  status        CampaignStatus @default(ACTIVE)
  lastSentType  String?        // To track which type of message was last sent
  sentEmailTypes String[] @default([])
    lastEveningEmailSent   DateTime?  // ◊û◊™◊ô ◊©◊ú◊ó◊†◊ï ◊û◊ô◊ô◊ú ◊¢◊®◊ë ◊ê◊ó◊®◊ï◊ü
  eveningEmailsCount     Int        @default(0)  // ◊õ◊û◊î ◊û◊ô◊ô◊ú◊ô ◊¢◊®◊ë ◊©◊ú◊ó◊†◊ï
  lastAiSummarySent      DateTime?  // ◊û◊™◊ô ◊©◊ú◊ó◊†◊ï AI Summary ◊ê◊ó◊®◊ï◊ü
  aiSummaryCount         Int        @default(0)  // ◊õ◊û◊î ◊§◊¢◊û◊ô◊ù ◊©◊ú◊ó◊†◊ï AI Summary
  

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@index([nextSendDate, status])
   @@index([lastEveningEmailSent])
}

enum CampaignStatus {
  ACTIVE
  PAUSED
  UNSUBSCRIBED
  PROCESSING 
  COMPLETED
}

enum Language {
  en
  he
}

model ReferralCampaign {
  id          String   @id @default(cuid())
  name        String   // "◊ß◊û◊§◊ô◊ô◊ü ◊ß◊ô◊• 2025"
  slug        String   @unique // "summer-2025" - ◊ú◊ñ◊ô◊î◊ï◊ô ◊ë◊ß◊ú◊ï◊™
  description String?  @db.Text
  
  // ◊™◊ê◊®◊ô◊õ◊ô◊ù
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean  @default(true)
  
  // ◊§◊®◊°◊ô◊ù
  prizeTiers  Json?    // [{ threshold: 3, prize: "◊ß◊§◊î", prizeValue: 50 }, ...]
  grandPrize  String?  // "◊ê◊®◊ï◊ó◊î ◊ñ◊ï◊í◊ô◊™ ◊§◊®◊ô◊û◊ô◊ï◊ù"
  
  // ◊î◊í◊ì◊®◊ï◊™
  settings    Json?    // { requireVerification: true, minAgeForReferral: 0 }
  
  referrers   Referrer[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([isActive])
  @@index([slug])
  @@index([startDate, endDate])
}

model Referrer {
  id           String   @id @default(cuid())
  campaignId   String
  campaign     ReferralCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  
  // ◊§◊®◊ò◊ô ◊î◊û◊§◊†◊î
  name         String
  email        String?
  phone        String?
  code         String   @unique  // "DAVID", "SARA123" - ◊ß◊ï◊ì ◊ß◊¶◊® ◊ï◊ô◊ô◊ó◊ï◊ì◊ô
  
  // ◊°◊ï◊í ◊î◊û◊§◊†◊î
  tier         ReferrerTier @default(COMMUNITY)
  
  // ◊î◊¢◊®◊ï◊™ ◊§◊†◊ô◊û◊ô◊ï◊™
  notes        String?  @db.Text
  
  // ◊°◊ò◊ò◊ô◊°◊ò◊ô◊ß◊ï◊™ ◊û◊ò◊û◊ï◊ü (◊ú◊ë◊ô◊¶◊ï◊¢◊ô◊ù - ◊û◊™◊¢◊ì◊õ◊ü ◊ë◊õ◊ú ◊ê◊ô◊®◊ï◊¢)
  clickCount       Int @default(0)
  registrationCount Int @default(0)
  verifiedCount    Int @default(0)
  completedCount   Int @default(0)
  
  // ◊§◊®◊°◊ô◊ù ◊©◊î◊™◊ß◊ë◊ú◊ï
  prizesAwarded    Json?  // [{ prize: "◊ß◊§◊î", awardedAt: "2025-06-15" }]
  
  referrals    Referral[]
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@index([campaignId])
  @@index([code])
  @@index([tier])
  @@index([verifiedCount])
}

model Referral {
  id          String   @id @default(cuid())
  referrerId  String
  referrer    Referrer @relation(fields: [referrerId], references: [id], onDelete: Cascade)
  
  // ◊î◊û◊©◊™◊û◊© ◊©◊†◊®◊©◊ù (null ◊¢◊ì ◊©◊û◊©◊ú◊ô◊ù ◊®◊ô◊©◊ï◊ù)
  userId      String?  @unique
  user        User?    @relation("ReferredUser", fields: [userId], references: [id], onDelete: SetNull)
  
  // ◊û◊¢◊ß◊ë ◊î◊™◊ß◊ì◊û◊ï◊™
  status      ReferralStatus @default(CLICKED)
  
  // ◊û◊ô◊ì◊¢ ◊ò◊õ◊†◊ô ◊ú◊û◊†◊ô◊¢◊™ ◊î◊ï◊†◊ê◊ï◊™
  ipAddress   String?
  userAgent   String?
  sessionId   String?  // ◊ú◊ñ◊ô◊î◊ï◊ô ◊°◊©◊ü ◊ô◊ô◊ó◊ï◊ì◊ô
  
  // ◊™◊ê◊®◊ô◊õ◊ô◊ù ◊ú◊õ◊ú ◊©◊ú◊ë
  clickedAt    DateTime @default(now())
  startedAt    DateTime?  // ◊î◊™◊ó◊ô◊ú ◊ú◊û◊ú◊ê ◊ò◊ï◊§◊°
  registeredAt DateTime?  // ◊°◊ô◊ô◊ù ◊®◊ô◊©◊ï◊ù ◊ë◊°◊ô◊°◊ô
  verifiedAt   DateTime?  // ◊ê◊ô◊û◊™ ◊ò◊ú◊§◊ï◊ü
  completedAt  DateTime?  // ◊î◊©◊ú◊ô◊ù ◊§◊®◊ï◊§◊ô◊ú
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@index([referrerId])
  @@index([userId])
  @@index([status])
  @@index([ipAddress])
  @@index([clickedAt])
}

// --- Enums ◊ó◊ì◊©◊ô◊ù ---

enum ReferrerTier {
  AMBASSADOR  // ◊©◊í◊®◊ô◊® - ◊ó◊ë◊® ◊ß◊®◊ï◊ë ◊©◊ß◊ô◊ë◊ú ◊¢◊®◊õ◊î ◊û◊ú◊ê◊î
  COMMUNITY   // ◊ß◊î◊ô◊ú◊î - ◊†◊®◊©◊ù ◊ì◊®◊ö ◊î◊ì◊£ ◊î◊¶◊ô◊ë◊ï◊®◊ô
}

enum ReferralStatus {
  CLICKED      // ◊ú◊ó◊• ◊¢◊ú ◊î◊ß◊ô◊©◊ï◊®
  STARTED      // ◊î◊™◊ó◊ô◊ú ◊î◊®◊©◊û◊î (◊†◊õ◊†◊° ◊ú◊ò◊ï◊§◊°)
  REGISTERED   // ◊°◊ô◊ô◊ù ◊î◊®◊©◊û◊î ◊ë◊°◊ô◊°◊ô◊™
  VERIFIED     // ◊ê◊ô◊û◊™ ◊ò◊ú◊§◊ï◊ü
  COMPLETED    // ◊î◊©◊ú◊ô◊ù ◊§◊®◊ï◊§◊ô◊ú + ◊™◊û◊ï◊†◊î
}
model SavedMatchSearch {
  id               String   @id @default(cuid())
  
  // ◊î◊û◊ï◊¢◊û◊ì ◊©◊ó◊ô◊§◊©◊†◊ï ◊¢◊ë◊ï◊®◊ï ◊î◊™◊ê◊û◊ï◊™
  targetUserId     String   @unique  // @unique = ◊®◊ß ◊ó◊ô◊§◊ï◊© ◊ê◊ó◊ì ◊©◊û◊ï◊® ◊ú◊õ◊ú ◊û◊ï◊¢◊û◊ì
  targetUser       User     @relation("TargetUserSearches", fields: [targetUserId], references: [id], onDelete: Cascade)
  
  // ◊î◊©◊ì◊õ◊ü ◊©◊î◊§◊¢◊ô◊ú ◊ê◊™ ◊î◊ó◊ô◊§◊ï◊©
  matchmakerId     String
  matchmaker       User     @relation("MatchmakerSearches", fields: [matchmakerId], references: [id], onDelete: Cascade)
  
  // ◊™◊ï◊¶◊ê◊ï◊™ ◊î◊ó◊ô◊§◊ï◊© (JSON)
  // ◊û◊ë◊†◊î: [{ userId, score, reasoning, firstName, lastName }]
  results          Json
  
  // ◊û◊ò◊ê-◊ì◊ê◊ò◊î
  algorithmVersion String   @default("v2.0")
  candidatesCount  Int      @default(0)  // ◊õ◊û◊î ◊û◊ï◊¢◊û◊ì◊ô◊ù ◊†◊ï◊™◊ó◊ï
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  @@index([targetUserId])
  @@index([matchmakerId])
  @@index([createdAt])
}

model SavedVectorMatchSearch {
  id               String   @id @default(cuid())
  targetUserId     String   @unique
  targetUser       User     @relation("TargetUserVectorSearches", fields: [targetUserId], references: [id], onDelete: Cascade)
  matchmakerId     String
  matchmaker       User     @relation("MatchmakerVectorSearches", fields: [matchmakerId], references: [id], onDelete: Cascade)
  results          Json
  algorithmVersion String   @default("vector-v1.0")
  candidatesCount  Int      @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  @@index([targetUserId])
  @@index([matchmakerId])
}

model MatchingJob {
  id              String    @id @default(cuid())
  targetUserId    String
  matchmakerId    String
  method          String
  status          String    @default("pending")
  progress        Int       @default(0)
  progressMessage String?
  result          Json?
  error           String?
  totalCandidates Int?
  matchesFound    Int?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  completedAt     DateTime?

  @@index([targetUserId])
  @@index([matchmakerId])
  @@index([status])
  @@index([createdAt])
}
  
model VirtualProfile {
  id                  String   @id @default(cuid())
  
  // ◊û◊ô ◊ô◊¶◊® ◊ê◊™ ◊î◊§◊®◊ï◊§◊ô◊ú ◊î◊ï◊ô◊®◊ò◊ï◊ê◊ú◊ô
  matchmakerId        String
  matchmaker          User     @relation("MatchmakerVirtualProfiles", fields: [matchmakerId], references: [id], onDelete: Cascade)
  
  // ◊ß◊ú◊ò ◊î◊©◊ì◊õ◊ü
  name                String?              // ◊©◊ù ◊ú◊ñ◊ô◊î◊ï◊ô (◊ê◊ï◊§◊¶◊ô◊ï◊†◊ú◊ô)
  sourceText          String   @db.Text    // ◊î◊ò◊ß◊°◊ò ◊î◊ó◊ï◊§◊©◊ô ◊©◊î◊©◊ì◊õ◊ü ◊î◊ñ◊ô◊ü
  
  // ◊§◊®◊û◊ò◊®◊ô◊ù ◊©◊î◊©◊ì◊õ◊ü ◊ë◊ï◊ó◊® (◊ó◊ï◊ë◊î)
  gender              Gender               // ◊û◊í◊ì◊® ◊î◊ô◊ï◊ñ◊® ◊î◊ï◊ô◊®◊ò◊ï◊ê◊ú◊ô
  religiousLevel      String               // ◊®◊û◊î ◊ì◊™◊ô◊™
  
  // ◊î◊§◊®◊ï◊§◊ô◊ú ◊©◊î-AI ◊ô◊¶◊®
  generatedProfile    Json?                // { personalitySummary, lookingForSummary, inferredAge, ... }
  
  // ◊°◊ô◊õ◊ï◊ù ◊¢◊®◊ï◊ö (◊ê◊ù ◊î◊©◊ì◊õ◊ü ◊¢◊®◊ö ◊ê◊™ ◊î◊°◊ô◊õ◊ï◊ù)
  editedSummary       String?  @db.Text    // ◊°◊ô◊õ◊ï◊ù ◊©◊î◊©◊ì◊õ◊ü ◊¢◊®◊ö ◊ô◊ì◊†◊ô◊™
  wasEdited           Boolean  @default(false)
  
  // ◊ï◊ß◊ò◊ï◊® ◊ú◊î◊™◊ê◊û◊î (◊†◊ï◊¶◊® ◊û◊î◊§◊®◊ï◊§◊ô◊ú)
  vector              Unsupported("vector(768)")?
  
  // ◊û◊ò◊ê-◊ì◊ê◊ò◊î
  isStarred           Boolean  @default(false)
  lastUsedAt          DateTime?
  usageCount          Int      @default(0)
  
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  @@index([matchmakerId])
  @@index([isStarred])
  @@index([lastUsedAt])
}



// ◊ò◊ë◊ú◊î ◊ó◊ì◊©◊î: ◊î◊™◊ê◊û◊ï◊™ ◊§◊ï◊ò◊†◊¶◊ô◊ê◊ú◊ô◊ï◊™ ◊©◊†◊û◊¶◊ê◊ï ◊ë◊°◊®◊ô◊ß◊î ◊î◊ú◊ô◊ú◊ô◊™
model PotentialMatch {
  id              String   @id @default(cuid())
   scanMethod    String?   // 'hybrid' | 'algorithmic' | 'vector'
  // ◊î◊ñ◊ï◊í
  maleUserId      String
  femaleUserId    String
  
  // ◊¶◊ô◊ï◊†◊ô◊ù
  aiScore         Float    // ◊î◊¶◊ô◊ï◊ü ◊î◊°◊ï◊§◊ô (finalScore)
  firstPassScore  Float?   // ◊¶◊ô◊ï◊ü ◊î◊û◊¢◊ë◊® ◊î◊®◊ê◊©◊ï◊ü
  
  // ◊§◊ô◊®◊ï◊ò ◊î◊¶◊ô◊ï◊ü
  scoreBreakdown  Json?    // ScoreBreakdown object
  
  // ◊†◊ô◊û◊ï◊ß◊ô◊ù
  shortReasoning  String?  @db.Text
  detailedReasoning String? @db.Text
  
  // ◊û◊ô◊ì◊¢ ◊®◊ß◊¢
  backgroundCompatibility String? // excellent/good/possible/problematic/not_recommended
  backgroundMultiplier    Float?
  
  // ◊°◊ò◊ò◊ï◊° ◊û◊¢◊ß◊ë
  status          PotentialMatchStatus @default(PENDING)
  
  // ◊™◊ê◊®◊ô◊õ◊ô◊ù
  scannedAt       DateTime @default(now())
  reviewedAt      DateTime?
  dismissedAt     DateTime?
  sentAt          DateTime? // ◊û◊™◊ô ◊†◊©◊ú◊ó◊î ◊î◊¶◊¢◊î
  
  // ◊û◊ô ◊°◊ß◊®/◊ì◊ó◊î
  reviewedBy      String?
  dismissReason   String?
  
  // ◊ß◊ô◊©◊ï◊® ◊ú◊î◊¶◊¢◊î ◊ê◊ù ◊†◊ï◊¶◊®◊î
  suggestionId    String?  @unique
  
  // Relations
  male            User     @relation("MaleMatches", fields: [maleUserId], references: [id], onDelete: Cascade)
  female          User     @relation("FemaleMatches", fields: [femaleUserId], references: [id], onDelete: Cascade)
  suggestion      MatchSuggestion? @relation(fields: [suggestionId], references: [id])
  

    // ==========================================================================
  // üÜï Asymmetric Scoring - ◊¶◊ô◊ï◊†◊ô◊ù ◊†◊§◊®◊ì◊ô◊ù ◊ú◊õ◊ú ◊¶◊ì
  // ==========================================================================
  scoreForMale          Float?                        // ◊õ◊û◊î ◊î◊ô◊ê ◊û◊™◊ê◊ô◊û◊î ◊ú◊ï
  scoreForFemale        Float?                        // ◊õ◊û◊î ◊î◊ï◊ê ◊û◊™◊ê◊ô◊ù ◊ú◊î
  asymmetryGap          Float?                        // ◊§◊¢◊® ◊ë◊ô◊ü ◊î◊¶◊ô◊ï◊†◊ô◊ù
  
  // ==========================================================================
  // üÜï Multi-Dimensional Scores
  // ==========================================================================
  surfaceMatchScore     Float?                        // ◊î◊™◊ê◊û◊î "◊¢◊ú ◊î◊†◊ô◊ô◊®"
  valuesAlignmentScore  Float?                        // ◊î◊™◊ê◊û◊™ ◊¢◊®◊õ◊ô◊ù
  personalityScore      Float?                        // ◊ì◊ô◊†◊û◊ô◊ß◊™ ◊ê◊ô◊©◊ô◊ï◊™
  practicalFitScore     Float?                        // ◊î◊™◊ê◊û◊î ◊û◊¢◊©◊ô◊™
  
  // ==========================================================================
  // üÜï Confidence & Quality
  // ==========================================================================
  confidenceLevel       Float?    @default(0.5)       // ◊®◊û◊™ ◊ë◊ô◊ò◊ó◊ï◊ü ◊ë◊¶◊ô◊ï◊ü 0-1
  dataQuality           String?   @default("medium")  // low/medium/high
  
  // ==========================================================================
  // üÜï Exploration Flag
  // ==========================================================================
  isExploratoryMatch    Boolean   @default(false)     // ◊î◊ê◊ù ◊ñ◊ï ◊î◊¶◊¢◊î "◊†◊ô◊°◊ï◊ô◊ô◊™"
  explorationReason     String?                       // ◊ú◊û◊î ◊†◊ë◊ó◊®◊î ◊õ◊†◊ô◊°◊ï◊ô

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // üÜï ◊¶◊ô◊ï◊†◊ô◊ù ◊ú◊§◊ô ◊©◊ô◊ò◊™ ◊°◊®◊ô◊ß◊î (◊õ◊ú ◊©◊ô◊ò◊î ◊©◊ï◊û◊®◊™ ◊ë◊†◊§◊®◊ì)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  // Hybrid Method (4-tier)
  hybridScore           Float?
  hybridReasoning       String?
  hybridScannedAt       DateTime?
  hybridScoreBreakdown  Json?
  
  // Algorithmic Method (AI Deep)
  algorithmicScore      Float?
  algorithmicReasoning  String?
  algorithmicScannedAt  DateTime?
  algorithmicScoreBreakdown  Json?

  // Vector Method (Fast similarity)
  vectorScore           Float?
  vectorReasoning       String?
  vectorScannedAt       DateTime?
  
  // Metrics V2 Method
  metricsV2Score        Float?
  metricsV2Reasoning    String?
  metricsV2ScannedAt    DateTime?
metricsV2ScoreBreakdown    Json?

    lastScanMethod        String?   // 'hybrid' | 'algorithmic' | 'vector' | 'metrics_v2'

  // Indexes
  @@unique([maleUserId, femaleUserId])
  @@index([aiScore(sort: Desc)])
  @@index([status])
  @@index([scannedAt])
  @@index([maleUserId])
  @@index([femaleUserId])
}

// Enum ◊ú◊°◊ò◊ò◊ï◊° ◊î◊î◊™◊ê◊û◊î ◊î◊§◊ï◊ò◊†◊¶◊ô◊ê◊ú◊ô◊™
enum PotentialMatchStatus {
  PENDING      // ◊ò◊®◊ù ◊†◊ë◊ì◊ß
  REVIEWED     // ◊†◊ë◊ì◊ß ◊ê◊ö ◊ú◊ê ◊î◊ï◊ó◊ú◊ò
  SENT         // ◊†◊©◊ú◊ó◊î ◊î◊¶◊¢◊î
  DISMISSED    // ◊†◊ì◊ó◊î ◊¢"◊ô ◊î◊©◊ì◊õ◊ü
  EXPIRED      // ◊§◊í ◊™◊ï◊ß◊£ (◊°◊®◊ô◊ß◊î ◊ô◊©◊†◊î ◊û◊ì◊ô)
  SHORTLISTED 
}

// ◊ò◊ë◊ú◊î ◊ó◊ì◊©◊î: ◊ú◊ï◊í ◊°◊®◊ô◊ß◊ï◊™ ◊ú◊ô◊ú◊î
model NightlyScanLog {
  id                  String   @id @default(cuid())
  
  // ◊°◊ò◊ò◊ô◊°◊ò◊ô◊ß◊ï◊™
  totalCandidates     Int
  candidatesScanned   Int
  matchesFound        Int
  newMatches          Int      // ◊î◊™◊ê◊û◊ï◊™ ◊©◊ú◊ê ◊î◊ô◊ï ◊ß◊ô◊ô◊û◊ï◊™ ◊ß◊ï◊ì◊ù
  updatedMatches      Int      // ◊î◊™◊ê◊û◊ï◊™ ◊©◊¢◊ï◊ì◊õ◊†◊ï
  
  // ◊ñ◊û◊†◊ô◊ù
  startedAt           DateTime
  completedAt         DateTime?
  durationMs          Int?
  
  // ◊°◊ò◊ò◊ï◊°
  status              String   // running/completed/failed/partial
  error               String?  @db.Text
  
  // ◊§◊®◊ò◊ô◊ù ◊†◊ï◊°◊§◊ô◊ù
  method              String   @default("algorithmic") // algorithmic/vector/hybrid
  minScoreThreshold   Float    @default(70)
  
  @@index([startedAt])
  @@index([status])
}

model ScannedPair {
  id              String   @id @default(cuid())
  
  maleUserId      String
  femaleUserId    String
  
  // ◊™◊ï◊¶◊ê◊™ ◊î◊°◊®◊ô◊ß◊î
  aiScore         Float?   // ◊î◊¶◊ô◊ï◊ü ◊©◊ß◊ô◊ë◊ú (null ◊ê◊ù ◊ú◊ê ◊î◊í◊ô◊¢ ◊ú-AI)
  passedThreshold Boolean  @default(false) // ◊î◊ê◊ù ◊¢◊ë◊® ◊°◊£ 70
  
  // ◊°◊ô◊ë◊™ ◊§◊°◊ô◊ú◊î (◊ê◊ù ◊ú◊ê ◊¢◊ë◊®)
  rejectionReason String?  // "age_gap", "religious_mismatch", "background_incompatible", "low_ai_score"
  
  // ◊™◊ê◊®◊ô◊õ◊ô◊ù
  firstScannedAt  DateTime @default(now())
  lastScannedAt   DateTime @default(now())
  
  // ◊ï◊ï◊®◊°◊ô◊î ◊©◊ú ◊î◊§◊®◊ï◊§◊ô◊ú◊ô◊ù ◊ë◊ñ◊û◊ü ◊î◊°◊®◊ô◊ß◊î
  maleProfileUpdatedAt   DateTime? // profile.updatedAt ◊©◊ú ◊î◊í◊ë◊® ◊ë◊ñ◊û◊ü ◊î◊°◊®◊ô◊ß◊î
  femaleProfileUpdatedAt DateTime? // profile.updatedAt ◊©◊ú ◊î◊ë◊ó◊ï◊®◊î ◊ë◊ñ◊û◊ü ◊î◊°◊®◊ô◊ß◊î
  
  // Relations
  male            User     @relation("MaleScannedPairs", fields: [maleUserId], references: [id], onDelete: Cascade)
  female          User     @relation("FemaleScannedPairs", fields: [femaleUserId], references: [id], onDelete: Cascade)
  
  @@unique([maleUserId, femaleUserId])
  @@index([maleUserId])
  @@index([femaleUserId])
  @@index([passedThreshold])
  @@index([lastScannedAt])
}

model HiddenCandidate {
  id           String   @id @default(cuid())
  matchmakerId String
  candidateId  String
  reason       String?
  hiddenAt     DateTime @default(now())
  
  matchmaker   User @relation("HiddenByMatchmaker", fields: [matchmakerId], references: [id], onDelete: Cascade)
  candidate    User @relation("HiddenCandidates", fields: [candidateId], references: [id], onDelete: Cascade)
  
  @@unique([matchmakerId, candidateId])
  @@index([matchmakerId])
  @@index([candidateId])
}

enum AlertType {
  NEW_USER_NO_SUGGESTION      // ◊û◊©◊™◊û◊© ◊ó◊ì◊© 48+ ◊©◊¢◊ï◊™ ◊ë◊ú◊ô ◊î◊¶◊¢◊î
  LONG_WAIT                   // ◊û◊ó◊õ◊î 10+ ◊ô◊û◊ô◊ù ◊ú◊î◊¶◊¢◊î
  HIGH_DIFFICULTY             // ◊ß◊ï◊©◊ô ◊í◊ë◊ï◊î ◊ë◊©◊ô◊ì◊ï◊ö (◊î◊®◊ë◊î ◊ì◊ó◊ô◊ï◊™)
  INACTIVE_WITH_MATCHES       // ◊ô◊© ◊ú◊ï ◊î◊™◊ê◊û◊ï◊™ ◊ê◊ë◊ú ◊ú◊ê ◊§◊¢◊ô◊ú
  PROFILE_INCOMPLETE          // ◊§◊®◊ï◊§◊ô◊ú ◊§◊ó◊ï◊™ ◊û-50% ◊û◊ú◊ê
  NO_POTENTIAL_MATCHES        // ◊ê◊ô◊ü ◊ú◊ï ◊î◊™◊ê◊û◊ï◊™ ◊ë◊û◊¢◊®◊õ◊™
  STALE_MATCHES               // ◊î◊î◊™◊ê◊û◊ï◊™ ◊©◊ú◊ï ◊ô◊©◊†◊ï◊™ ◊û◊ì◊ô
  HIGH_REJECTION_RATE         // ◊©◊ô◊¢◊ï◊® ◊ì◊ó◊ô◊ï◊™ ◊í◊ë◊ï◊î
  NEW_HIGH_QUALITY_MATCH      // ◊†◊û◊¶◊ê◊î ◊î◊™◊ê◊û◊î ◊ê◊ô◊õ◊ï◊™◊ô◊™ ◊ó◊ì◊©◊î
}

enum AlertSeverity {
  CRITICAL    // üî¥ ◊ì◊ó◊ï◊£ - ◊ú◊ò◊§◊ú ◊¢◊õ◊©◊ô◊ï
  HIGH        // üü† ◊í◊ë◊ï◊î - ◊ú◊ò◊§◊ú ◊î◊ô◊ï◊ù
  MEDIUM      // üü° ◊ë◊ô◊†◊ï◊†◊ô - ◊ú◊ò◊§◊ú ◊î◊©◊ë◊ï◊¢
  LOW         // üü¢ ◊†◊û◊ï◊ö - ◊ú◊ô◊ì◊ô◊¢◊î
  INFO        // üîµ ◊û◊ô◊ì◊¢
}

enum RejectionCategory {
  // ◊°◊ô◊ë◊ï◊™ ◊ê◊ï◊ë◊ô◊ô◊ß◊ò◊ô◊ë◊ô◊ï◊™
  AGE_GAP                     // ◊§◊¢◊® ◊í◊ô◊ú ◊í◊ì◊ï◊ú ◊û◊ì◊ô
  RELIGIOUS_GAP               // ◊§◊¢◊® ◊®◊û◊î ◊ì◊™◊ô◊™
  BACKGROUND_GAP              // ◊§◊¢◊® ◊®◊ß◊¢/◊¢◊ì◊î
  EDUCATION_GAP               // ◊§◊¢◊® ◊î◊©◊õ◊ú◊î/◊ß◊®◊ô◊ô◊®◊î
  GEOGRAPHIC_GAP              // ◊§◊¢◊® ◊í◊ô◊ê◊ï◊í◊®◊§◊ô
  KNOWS_PERSONALLY            // ◊û◊õ◊ô◊®/◊î ◊ê◊ô◊©◊ô◊™
  
  // ◊°◊ô◊ë◊ï◊™ ◊°◊ï◊ë◊ô◊ô◊ß◊ò◊ô◊ë◊ô◊ï◊™
  NOT_ATTRACTED               // ◊ú◊ê ◊û◊ï◊©◊ö/◊™
  NOT_INTERESTING             // ◊ú◊ê ◊û◊¢◊†◊ô◊ô◊ü/◊™
  NO_CONNECTION               // ◊ú◊ê ◊î◊®◊í◊©◊™◊ô ◊ó◊ô◊ë◊ï◊®
  GUT_FEELING                 // ◊™◊ó◊ï◊©◊™ ◊ë◊ò◊ü ◊©◊ú◊ô◊ú◊ô◊™
  SOMETHING_OFF               // ◊û◊©◊î◊ï ◊ú◊ê ◊î◊°◊™◊ì◊®
  
  // ◊°◊ô◊ë◊ï◊™ ◊™◊ñ◊û◊ï◊ü
  NOT_AVAILABLE_NOW           // ◊ú◊ê ◊ñ◊û◊ô◊ü/◊î ◊õ◊®◊í◊¢
  IN_PROCESS_WITH_OTHER       // ◊ë◊™◊î◊ú◊ô◊ö ◊¢◊ù ◊û◊ô◊©◊î◊ï ◊ê◊ó◊®
  NEEDS_TIME                  // ◊¶◊®◊ô◊ö/◊î ◊ñ◊û◊ü ◊ú◊ó◊©◊ï◊ë
  EXTERNAL_PRESSURE           // ◊ú◊ó◊• ◊ó◊ô◊¶◊ï◊†◊ô
  
  // Red Flags
  INCONSISTENT_STORY          // ◊ó◊ï◊°◊® ◊¢◊ß◊ë◊ô◊ï◊™ ◊ë◊°◊ô◊§◊ï◊®
  PROBLEMATIC_BEHAVIOR        // ◊î◊™◊†◊î◊í◊ï◊™ ◊ë◊¢◊ô◊ô◊™◊ô◊™
  UNREALISTIC_EXPECTATIONS    // ◊¶◊ô◊§◊ô◊ï◊™ ◊ú◊ê ◊®◊ô◊ê◊ú◊ô◊°◊ò◊ô◊ï◊™
  CONCERNING_HISTORY          // ◊î◊ô◊°◊ò◊ï◊®◊ô◊î ◊û◊ì◊ê◊ô◊í◊î
  
  // ◊ê◊ó◊®
  OTHER                       // ◊°◊ô◊ë◊î ◊ê◊ó◊®◊™
}

enum ReadinessLevel {
  NOT_READY           // 1 - ◊ú◊ê ◊û◊ï◊õ◊ü ◊õ◊ú◊ú
  UNCERTAIN           // 2 - ◊ú◊ê ◊ë◊ò◊ï◊ó
  SOMEWHAT_READY      // 3 - ◊û◊ï◊õ◊ü ◊ó◊ú◊ß◊ô◊™
  READY               // 4 - ◊û◊ï◊õ◊ü
  VERY_READY          // 5 - ◊û◊ï◊õ◊ü ◊û◊ê◊ï◊ì ◊ï◊§◊¢◊ô◊ú
}



model UserAlert {
  id            String         @id @default(cuid())
  
  // ◊î◊ß◊©◊® ◊ú◊û◊©◊™◊û◊©
  userId        String
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // ◊§◊®◊ò◊ô ◊î◊î◊™◊®◊ê◊î
  type          AlertType
  severity      AlertSeverity
  title         String                              // ◊õ◊ï◊™◊®◊™ ◊ß◊¶◊®◊î
  message       String         @db.Text             // ◊î◊ï◊ì◊¢◊î ◊û◊§◊ï◊®◊ò◊™
  data          Json?                               // ◊û◊ô◊ì◊¢ ◊†◊ï◊°◊£ (JSON)
  
  // ◊§◊¢◊ï◊ú◊î ◊û◊ï◊û◊ú◊¶◊™
  actionType    String?                             // ◊°◊ï◊í ◊î◊§◊¢◊ï◊ú◊î ◊î◊û◊ï◊û◊ú◊¶◊™
  actionUrl     String?                             // ◊ß◊ô◊©◊ï◊® ◊ú◊§◊¢◊ï◊ú◊î
  
  // ◊°◊ò◊ò◊ï◊°
  isRead        Boolean        @default(false)
  isDismissed   Boolean        @default(false)
  dismissedAt   DateTime?
  dismissedBy   String?                             // ID ◊©◊ú ◊û◊ô ◊©◊ì◊ó◊î
  dismissReason String?                             // ◊°◊ô◊ë◊™ ◊î◊ì◊ó◊ô◊ô◊î
  
  // ◊û◊™◊ô ◊î◊î◊™◊®◊ê◊î ◊®◊ú◊ï◊ï◊†◊ò◊ô◊™
  expiresAt     DateTime?                           // ◊™◊§◊ï◊í◊î ◊ê◊ï◊ò◊ï◊û◊ò◊ô◊™
  
  // Timestamps
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  
  @@index([userId])
  @@index([severity])
  @@index([type])
  @@index([isDismissed, isRead])
  @@index([createdAt])
}

// =============================================================================
// üÜï Model RejectionFeedback - ◊ú◊û◊ô◊ì◊î ◊û◊ì◊ó◊ô◊ï◊™
// =============================================================================

model RejectionFeedback {
  id                  String            @id @default(cuid())
  
  // ◊î◊ñ◊ï◊í
  rejectedUserId      String                          // ◊û◊ô ◊†◊ì◊ó◊î
  rejectingUserId     String                          // ◊û◊ô ◊ì◊ó◊î (◊ê◊ù ◊ô◊ì◊ï◊¢)
  
  // ◊î◊ß◊©◊® ◊ú◊î◊¶◊¢◊î
  suggestionId        String?                         // MatchSuggestion ◊ê◊ù ◊®◊ú◊ï◊ï◊†◊ò◊ô
  potentialMatchId    String?                         // PotentialMatch ◊ê◊ù ◊®◊ú◊ï◊ï◊†◊ò◊ô
  
  // ◊§◊®◊ò◊ô ◊î◊ì◊ó◊ô◊ô◊î
  category            RejectionCategory               // ◊ß◊ò◊í◊ï◊®◊ô◊î ◊®◊ê◊©◊ô◊™
  subcategory         String?                         // ◊™◊™-◊ß◊ò◊í◊ï◊®◊ô◊î
  freeText            String?           @db.Text      // ◊î◊°◊ë◊® ◊ó◊ï◊§◊©◊ô
  
  // ◊û◊ô ◊™◊ô◊¢◊ì
  recordedBy          String                          // ID ◊©◊ú ◊î◊©◊ì◊õ◊ü
  
  // ◊î◊ê◊ù ◊î◊ì◊ó◊ô◊ô◊î ◊î◊ô◊ô◊™◊î ◊¶◊§◊ï◊ô◊î
  wasExpected         Boolean?                        // ◊î◊ê◊ù ◊î◊©◊ì◊õ◊ü ◊¶◊ô◊§◊î ◊ú◊ñ◊î
  
  // Timestamps
  createdAt           DateTime          @default(now())
  
  // Relations
  rejectedUser        Profile           @relation("RejectedUser", fields: [rejectedUserId], references: [id], onDelete: Cascade)
  rejectingUser       Profile           @relation("RejectingUser", fields: [rejectingUserId], references: [id], onDelete: Cascade)
  
  @@index([rejectedUserId])
  @@index([rejectingUserId])
  @@index([category])
  @@index([createdAt])
}

enum ScanSessionStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
}
model ScanSession {
  id                    String    @id @default(cuid())
  matchmakerId         String?     
  // ◊°◊ï◊í ◊î◊°◊®◊ô◊ß◊î
  scanType              String                        // nightly/hourly/manual/user_triggered
    progressData         Json?             // ◊ú◊©◊û◊ô◊®◊™ ◊û◊¶◊ë ◊î◊°◊®◊ô◊ß◊î

  // ◊°◊ò◊ò◊ô◊°◊ò◊ô◊ß◊ï◊™
  totalUsersScanned     Int       @default(0)
  malesScanned          Int       @default(0)
  femalesScanned        Int       @default(0)
  pairsEvaluated        Int       @default(0)
  matchesFound          Int       @default(0)
  newMatches            Int       @default(0)
  updatedMatches        Int       @default(0)
    matchmaker           User?              @relation(fields: [matchmakerId], references: [id])

  // ◊§◊ô◊ú◊ò◊®◊ô◊ù ◊©◊î◊ï◊§◊¢◊ú◊ï
  pairsSkippedByAge     Int       @default(0)
  pairsSkippedByReligion Int      @default(0)
  pairsSkippedByHistory Int       @default(0)
  pairsSkippedByVector  Int       @default(0)
  
  // ◊ë◊ô◊¶◊ï◊¢◊ô◊ù
  durationMs            Int?
  aiCallsCount          Int       @default(0)
  aiTokensUsed          Int       @default(0)
  

   currentPhase          String?   // ◊î◊§◊ê◊ñ◊î ◊î◊†◊ï◊õ◊ó◊ô◊™ ◊©◊ú ◊î◊°◊®◊ô◊ß◊î
   currentUserIndex      Int       @default(0)     // ◊ê◊ô◊†◊ì◊ß◊° ◊î◊û◊©◊™◊û◊© ◊î◊†◊ï◊õ◊ó◊ô
  totalUsersToProcess   Int       @default(0)     // ◊°◊î"◊õ ◊û◊©◊™◊û◊©◊ô◊ù ◊ú◊¢◊ô◊ë◊ï◊ì
  progressPercent       Int       @default(0)     // ◊ê◊ó◊ï◊ñ ◊î◊™◊ß◊ì◊û◊ï◊™
   currentUserName       String?   // ◊©◊ù ◊î◊û◊©◊™◊û◊© ◊î◊†◊ï◊õ◊ó◊ô (◊ú◊™◊¶◊ï◊í◊î)

  // ◊°◊ò◊ò◊ï◊°
  status                ScanSessionStatus   @default(PENDING)  // ‚Üê ◊©◊ô◊†◊ï◊ô ◊û-String
  error                 String?   @db.Text
  
  // Timestamps
  startedAt             DateTime  @default(now())
  completedAt           DateTime?
  
  @@index([scanType])
  @@index([status])
  @@index([startedAt])
    @@index([matchmakerId, status])

}

model VectorSimilarityCache {
  id            String   @id @default(cuid())
  profileId1    String
  profileId2    String
  similarity    Float
  calculatedAt  DateTime @default(now())
  
  @@unique([profileId1, profileId2])
  @@index([profileId1])
  @@index([profileId2])
  @@index([calculatedAt])
}

// ============================================================
// NeshamaTech - Profile Metrics & Dual Vector System
// ◊ú◊î◊ï◊°◊§◊î ◊ú-schema.prisma ◊î◊ß◊ô◊ô◊ù
// ============================================================

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ENUMS - ◊°◊ï◊í◊ô◊ù ◊ß◊ë◊ï◊¢◊ô◊ù
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

enum CalculatedBy {
  AI_AUTO           // ◊ó◊ï◊©◊ë ◊ê◊ï◊ò◊ï◊û◊ò◊ô◊™ ◊¢◊ú ◊ô◊ì◊ô AI
  MATCHMAKER_EDIT   // ◊†◊¢◊®◊ö ◊ô◊ì◊†◊ô◊™ ◊¢◊ú ◊ô◊ì◊ô ◊©◊ì◊õ◊ü
  USER_QUESTIONNAIRE // ◊û◊í◊ô◊¢ ◊ô◊©◊ô◊®◊ï◊™ ◊û◊™◊©◊ï◊ë◊™ ◊î◊©◊ê◊ú◊ï◊ü
}

enum HumorStyle {
  CYNICAL           // ◊¶◊ô◊†◊ô/◊°◊®◊ß◊°◊ò◊ô
  LIGHT             // ◊ß◊ú◊ô◊ú ◊ï◊û◊©◊¢◊©◊¢
  WORDPLAY          // ◊û◊©◊ó◊ß◊ô ◊û◊ô◊ú◊ô◊ù
  SELF_DEPRECATING  // ◊î◊ï◊û◊ï◊® ◊¢◊¶◊û◊ô
  PHYSICAL          // ◊ß◊ï◊û◊ì◊ô◊î ◊§◊ô◊ñ◊ô◊™
  DRY               // ◊ô◊ë◊©
}

enum EthnicBackground {
  ASHKENAZI         // ◊ê◊©◊õ◊†◊ñ◊ô
  SEPHARDI          // ◊°◊§◊®◊ì◊ô/◊û◊ñ◊®◊ó◊ô
  MIXED             // ◊û◊¢◊ï◊®◊ë
  ETHIOPIAN         // ◊ê◊™◊ô◊ï◊§◊ô
  YEMENITE          // ◊™◊ô◊û◊†◊ô
  OTHER             // ◊ê◊ó◊®
}

enum BackgroundCategory {
  SABRA             // ◊¶◊ë◊® ◊ô◊©◊®◊ê◊ú◊ô
  SABRA_INTERNATIONAL // ◊¶◊ë◊® ◊¢◊ù ◊®◊ß◊¢ ◊ë◊ô◊†◊ú◊ê◊ï◊û◊ô
  OLEH_VETERAN      // ◊¢◊ï◊ú◊î ◊ï◊™◊ô◊ß (10+ ◊©◊†◊ô◊ù)
  OLEH_MID          // ◊¢◊ï◊ú◊î ◊ë◊ô◊†◊ï◊†◊ô (3-10 ◊©◊†◊ô◊ù)
  OLEH_NEW          // ◊¢◊ï◊ú◊î ◊ó◊ì◊© (◊§◊ó◊ï◊™ ◊û-3 ◊©◊†◊ô◊ù)
}

enum CommunicationStyle {
  DIRECT            // ◊ô◊©◊ô◊® ◊ï◊ë◊®◊ï◊®
  EMPATHETIC        // ◊ê◊û◊§◊™◊ô ◊ï◊®◊í◊ô◊©
  ANALYTICAL        // ◊ê◊†◊ú◊ô◊ò◊ô ◊ï◊ú◊ï◊í◊ô
  HUMOROUS          // ◊î◊ï◊û◊ï◊®◊ô◊°◊ò◊ô
  EMOTIONAL         // ◊®◊í◊©◊ô ◊ï◊§◊™◊ï◊ó
}

enum ConflictStyle {
  CONFRONTING       // ◊û◊™◊û◊ï◊ì◊ì ◊ô◊©◊ô◊®◊ï◊™
  AVOIDING          // ◊†◊û◊†◊¢ ◊û◊¢◊ô◊û◊ï◊™◊ô◊ù
  COMPROMISING      // ◊û◊ó◊§◊© ◊§◊©◊®◊ï◊™
  NEEDS_TIME        // ◊¶◊®◊ô◊ö ◊ñ◊û◊ü ◊ú◊¢◊ë◊ì
  COLLABORATIVE     // ◊©◊ô◊™◊ï◊§◊ô - ◊û◊ó◊§◊© ◊§◊™◊®◊ï◊†◊ï◊™ ◊ô◊ó◊ì
}

enum SupportStyle {
  LISTENING         // ◊û◊ß◊©◊ô◊ë ◊ï◊™◊ï◊û◊ö ◊®◊í◊©◊ô◊™
  SOLVING           // ◊û◊¶◊ô◊¢ ◊§◊™◊®◊ï◊†◊ï◊™ ◊û◊¢◊©◊ô◊ô◊ù
  DISTRACTING       // ◊û◊°◊ô◊ó ◊ì◊¢◊™ ◊ï◊û◊©◊û◊ó
  SPACE             // ◊†◊ï◊™◊ü ◊û◊®◊ó◊ë ◊ï◊©◊ß◊ò
  PHYSICAL          // ◊û◊ë◊ô◊¢ ◊™◊û◊ô◊õ◊î ◊§◊ô◊ñ◊ô◊™ (◊ó◊ô◊ë◊ï◊ß ◊ï◊õ◊ï')
}

enum PetsAttitude {
  LOVE              // ◊ê◊ï◊î◊ë ◊ó◊ô◊ï◊™ ◊û◊ó◊û◊ì
  NEUTRAL           // ◊†◊ô◊ò◊®◊ú◊ô
  DISLIKE           // ◊ú◊ê ◊ê◊ï◊î◊ë
  ALLERGIC          // ◊ê◊ú◊®◊í◊ô
}

enum PersonalityType {
  LEADER            // ◊û◊ï◊ë◊ô◊ú/◊ô◊ï◊ñ◊ù
  SUPPORTER         // ◊™◊ï◊û◊ö/◊¢◊ï◊ñ◊®
  ANALYTICAL        // ◊ê◊†◊ú◊ô◊ò◊ô/◊ó◊ï◊©◊ë
  CREATIVE          // ◊ô◊¶◊ô◊®◊™◊ô/◊ê◊û◊ü
  CAREGIVER         // ◊û◊ò◊§◊ú/◊ì◊ï◊ê◊í
  ADVENTURER        // ◊î◊®◊§◊™◊ß◊ü
  HARMONIZER        // ◊û◊ê◊ñ◊ü/◊û◊§◊©◊®
}

enum AttachmentStyle {
  SECURE            // ◊ë◊ò◊ï◊ó
  ANXIOUS           // ◊ó◊®◊ì
  AVOIDANT          // ◊†◊û◊†◊¢
  DISORGANIZED      // ◊ú◊ê ◊û◊ê◊ï◊®◊í◊ü (◊û◊¢◊ï◊®◊ë)
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ProfileMetrics - ◊û◊ì◊ì◊ô◊ù ◊û◊°◊§◊®◊ô◊ô◊ù ◊ú◊õ◊ú ◊§◊®◊ï◊§◊ô◊ú
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ============================================================
// NeshamaTech - Profile Metrics Model (UPDATED)
// ◊¢◊ì◊õ◊ï◊ü: ◊õ◊ï◊ú◊ú ◊©◊ì◊ï◊™ ◊ó◊ì◊©◊ô◊ù, ◊î◊¢◊ì◊§◊ï◊™ ◊û◊ï◊®◊ó◊ë◊ï◊™, ◊ï◊°◊ô◊õ◊ï◊û◊ô AI
// ============================================================

model ProfileMetrics {
  id                    String   @id @default(cuid())
  profileId             String   @unique
  profile               Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // META - ◊û◊ò◊ê-◊ì◊ê◊ò◊î ◊¢◊ú ◊î◊ó◊ô◊©◊ï◊ë
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  
  calculatedBy          CalculatedBy @default(AI_AUTO)
  confidenceScore       Int      @default(50)  // 0-100: ◊õ◊û◊î ◊ë◊ò◊ï◊ó◊ô◊ù ◊ë◊ì◊ô◊ï◊ß ◊î◊û◊ì◊ì◊ô◊ù
  dataCompleteness      Int      @default(0)   // 0-100: ◊õ◊û◊î ◊û◊ô◊ì◊¢ ◊î◊ô◊î ◊ñ◊û◊ô◊ü
  lastAiAnalysisAt      DateTime?
  
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // SECTION A: SELF METRICS - ◊û◊ô ◊ê◊†◊ô (◊¶◊ô◊ï◊†◊ô◊ù 0-100)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  
  // üß† ◊ê◊ô◊©◊ô◊ï◊™ ◊ï◊ê◊ï◊§◊ô
  socialEnergy              Int?     // 0=◊û◊ï◊§◊†◊ù ◊û◊ê◊ï◊ì, 100=◊ó◊ë◊®◊ï◊™◊ô ◊û◊ê◊ï◊ì
  emotionalExpression       Int?     // 0=◊©◊û◊ï◊® ◊®◊í◊©◊ô◊™, 100=◊§◊™◊ï◊ó ◊ï◊û◊ë◊ò◊ê
  stabilityVsSpontaneity    Int?     // 0=◊û◊ê◊ï◊®◊í◊ü ◊ï◊ô◊¶◊ô◊ë, 100=◊°◊§◊ï◊†◊ò◊†◊ô ◊ï◊í◊û◊ô◊©
  independenceLevel         Int?     // 0=◊ê◊ï◊î◊ë ◊™◊û◊ô◊õ◊î, 100=◊¢◊¶◊û◊ê◊ô ◊û◊ê◊ï◊ì
  optimismLevel             Int?     // 0=◊®◊ô◊ê◊ú◊ô◊°◊ò/◊§◊°◊ô◊û◊ô, 100=◊ê◊ï◊§◊ò◊ô◊û◊ô ◊û◊ê◊ï◊ì
  humorStyle                HumorStyle?
  
  // üéØ ◊ß◊®◊ô◊ô◊®◊î ◊ï◊õ◊°◊£
  careerOrientation         Int?     // 0=◊ê◊ô◊ñ◊ï◊ü/◊û◊©◊§◊ó◊î, 100=◊ß◊®◊ô◊ô◊®◊î ◊û◊®◊õ◊ñ◊ô◊™
  intellectualOrientation   Int?     // 0=◊î◊ï◊û◊†◊ô/◊ó◊ô◊†◊ï◊ö, 100=◊®◊ô◊ê◊ú◊ô/◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô
  financialApproach         Int?     // 0=◊ó◊°◊õ◊ü ◊ï◊©◊û◊®◊†◊ô, 100=◊†◊ì◊ô◊ë/◊†◊î◊†◊™◊ü
  ambitionLevel             Int?     // 0=◊©◊ë◊ô◊¢◊ï◊™ ◊®◊¶◊ï◊ü, 100=◊©◊ê◊§◊™◊†◊ï◊™ ◊í◊ë◊ï◊î◊î
  
  // ‚ú°Ô∏è ◊ì◊™ ◊ï◊û◊°◊ï◊®◊™
  religiousStrictness       Int?     // 0=◊í◊û◊ô◊© ◊ë◊î◊ú◊õ◊î, 100=◊û◊ß◊§◊ô◊ì ◊û◊ê◊ï◊ì
  spiritualDepth            Int?     // 0=◊§◊®◊ß◊ò◊ô/◊ò◊õ◊†◊ô, 100=◊®◊ï◊ó◊†◊ô ◊ï◊¢◊û◊ï◊ß
  cultureConsumption        Int?     // 0=◊†◊û◊†◊¢ ◊û◊™◊®◊ë◊ï◊™ ◊õ◊ú◊ú◊ô◊™, 100=◊¶◊ï◊®◊ö ◊ë◊ó◊ï◊§◊©◊ô◊ï◊™
  
  // üåç ◊®◊ß◊¢ ◊ï◊ñ◊î◊ï◊™
  urbanScore                Int?     // 0=◊õ◊§◊®◊ô/◊ô◊©◊ï◊ë◊ô, 100=◊¢◊ô◊®◊ï◊†◊ô ◊û◊ï◊ë◊î◊ß
  englishFluency            Int?     // 0=◊ú◊ê ◊ì◊ï◊ë◊®, 100=◊©◊§◊™ ◊ê◊ù
  americanCompatibility     Int?     // 0=◊ô◊©◊®◊ê◊ú◊ô ◊û◊ï◊ë◊î◊ß, 100=◊û◊™◊ê◊ô◊ù ◊ú◊ê◊û◊®◊ô◊ß◊ê◊ô◊ù
  ethnicBackground          EthnicBackground?
  backgroundCategory        BackgroundCategory?
  
  // üíë ◊ñ◊ï◊í◊ô◊ï◊™ ◊ï◊û◊©◊§◊ó◊î
  togetherVsAutonomy        Int?     // 0=◊¶◊®◊ô◊ö ◊¢◊¶◊û◊ê◊ï◊™, 100=◊®◊ï◊¶◊î ◊î◊õ◊ú ◊ë◊ô◊ó◊ì
  familyInvolvement         Int?     // 0=◊¢◊¶◊û◊ê◊ô ◊û◊î◊ï◊®◊ô◊ù, 100=◊û◊©◊§◊ó◊î ◊û◊¢◊ï◊®◊ë◊™
  parenthoodPriority        Int?     // 0=◊ú◊ê ◊û◊®◊õ◊ñ◊ô, 100=◊ô◊ú◊ì◊ô◊ù ◊ë◊û◊®◊õ◊ñ
  growthVsAcceptance        Int?     // 0=◊ß◊ë◊ú◊î ◊û◊ú◊ê◊î, 100=◊ê◊™◊í◊ï◊® ◊ï◊¶◊û◊ô◊ó◊î
  
  // üïê ◊°◊í◊†◊ï◊ü ◊ó◊ô◊ô◊ù
  nightOwlScore             Int?     // 0=◊ë◊ï◊ß◊®, 100=◊ú◊ô◊ú◊î
  adventureScore            Int?     // 0=◊©◊í◊®◊î ◊ï◊ô◊¶◊ô◊ë◊ï◊™, 100=◊î◊®◊§◊™◊ß◊†◊ï◊™
  petsAttitude              PetsAttitude?
  
  // üí¨ ◊™◊ß◊©◊ï◊®◊™ ◊ï◊î◊™◊û◊ï◊ì◊ì◊ï◊™
  communicationStyle        CommunicationStyle?
  conflictStyle             ConflictStyle?
  supportStyle              SupportStyle?
  
  // üëÄ ◊ë◊®◊®◊†◊ï◊™
  appearancePickiness       Int?     // 0=◊ú◊ê ◊û◊ß◊§◊ô◊ì ◊¢◊ú ◊û◊®◊ê◊î, 100=◊û◊ê◊ï◊ì ◊û◊ß◊§◊ô◊ì
  
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // üÜï SECTION A.2: NEW SELF METRICS - ◊û◊ì◊ì◊ô◊ù ◊ó◊ì◊©◊ô◊ù
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  
  // üí∞ ◊®◊û◊î ◊°◊ï◊¶◊ô◊ï-◊ê◊ß◊ï◊†◊ï◊û◊ô◊™
  socioEconomicLevel        Int?     // 0=◊†◊û◊ï◊ö, 50=◊ë◊ô◊†◊ï◊†◊ô, 100=◊í◊ë◊ï◊î
  
  // üíº ◊®◊û◊™ ◊ë◊õ◊ô◊®◊ï◊™ ◊ë◊¢◊ë◊ï◊ì◊î
  jobSeniorityLevel         Int?     // 0=◊ñ◊ï◊ò◊®/◊°◊ò◊ï◊ì◊†◊ò, 50=◊ë◊ô◊†◊ï◊†◊ô, 100=◊ë◊õ◊ô◊®/◊†◊ô◊î◊ï◊ú◊ô
  
  // üéì ◊®◊û◊™ ◊î◊©◊õ◊ú◊î (◊¶◊ô◊ï◊ü ◊û◊°◊§◊®◊ô)
  educationLevelScore       Int?     // 0=◊™◊ô◊õ◊ï◊†◊ô◊™, 25=◊ú◊ô◊û◊ï◊ì◊ô◊ù, 50=◊™◊ï◊ê◊® ◊®◊ê◊©◊ï◊ü, 75=◊™◊ï◊ê◊® ◊©◊†◊ô, 100=◊ì◊ï◊ß◊ò◊ï◊®◊ò
  
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // SECTION B: PREFERENCE METRICS - ◊û◊î ◊ê◊†◊ô ◊û◊ó◊§◊©/◊™
  // ◊ú◊õ◊ú ◊û◊ì◊ì: Min, Max, Weight (0-10)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  
  // ◊ê◊ô◊©◊ô◊ï◊™ ◊û◊ë◊ï◊ß◊©◊™
  prefSocialEnergyMin            Int?  @default(0)
  prefSocialEnergyMax            Int?  @default(100)
  prefSocialEnergyWeight         Int?  @default(5)
  
  prefEmotionalExpressionMin     Int?  @default(0)
  prefEmotionalExpressionMax     Int?  @default(100)
  prefEmotionalExpressionWeight  Int?  @default(5)
  
  prefStabilityMin               Int?  @default(0)
  prefStabilityMax               Int?  @default(100)
  prefStabilityWeight            Int?  @default(5)
  
  // ◊ì◊™
  prefReligiousStrictnessMin     Int?  @default(0)
  prefReligiousStrictnessMax     Int?  @default(100)
  prefReligiousStrictnessWeight  Int?  @default(8)
  
  prefSpiritualDepthMin          Int?  @default(0)
  prefSpiritualDepthMax          Int?  @default(100)
  prefSpiritualDepthWeight       Int?  @default(5)
  
  // ◊ß◊®◊ô◊ô◊®◊î ◊ï◊õ◊ú◊õ◊ú◊î
  prefCareerOrientationMin       Int?  @default(0)
  prefCareerOrientationMax       Int?  @default(100)
  prefCareerOrientationWeight    Int?  @default(5)
  
  prefAmbitionMin                Int?  @default(0)
  prefAmbitionMax                Int?  @default(100)
  prefAmbitionWeight             Int?  @default(4)
  
  prefFinancialMin               Int?  @default(0)
  prefFinancialMax               Int?  @default(100)
  prefFinancialWeight            Int?  @default(4)
  
  // ◊°◊í◊†◊ï◊ü ◊ó◊ô◊ô◊ù
  prefUrbanScoreMin              Int?  @default(0)
  prefUrbanScoreMax              Int?  @default(100)
  prefUrbanScoreWeight           Int?  @default(4)
  
  prefAdventureScoreMin          Int?  @default(0)
  prefAdventureScoreMax          Int?  @default(100)
  prefAdventureScoreWeight       Int?  @default(3)
  
  prefNightOwlMin                Int?  @default(0)
  prefNightOwlMax                Int?  @default(100)
  prefNightOwlWeight             Int?  @default(2)
  
  // ◊ñ◊ï◊í◊ô◊ï◊™
  prefTogetherVsAutonomyMin      Int?  @default(0)
  prefTogetherVsAutonomyMax      Int?  @default(100)
  prefTogetherVsAutonomyWeight   Int?  @default(5)
  
  prefFamilyInvolvementMin       Int?  @default(0)
  prefFamilyInvolvementMax       Int?  @default(100)
  prefFamilyInvolvementWeight    Int?  @default(4)
  
  prefGrowthVsAcceptanceMin      Int?  @default(0)
  prefGrowthVsAcceptanceMax      Int?  @default(100)
  prefGrowthVsAcceptanceWeight   Int?  @default(3)
  
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // üÜï SECTION B.2: NEW PREFERENCE METRICS - ◊î◊¢◊ì◊§◊ï◊™ ◊ó◊ì◊©◊ï◊™
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  
  // ◊®◊û◊î ◊°◊ï◊¶◊ô◊ï-◊ê◊ß◊ï◊†◊ï◊û◊ô◊™ ◊û◊ë◊ï◊ß◊©◊™
  prefSocioEconomicMin           Int?  @default(0)
  prefSocioEconomicMax           Int?  @default(100)
  prefSocioEconomicWeight        Int?  @default(5)
  
  // ◊®◊û◊™ ◊ë◊õ◊ô◊®◊ï◊™ ◊û◊ë◊ï◊ß◊©◊™
  prefJobSeniorityMin            Int?  @default(0)
  prefJobSeniorityMax            Int?  @default(100)
  prefJobSeniorityWeight         Int?  @default(4)
  
  // ◊®◊û◊™ ◊î◊©◊õ◊ú◊î ◊û◊ë◊ï◊ß◊©◊™
  prefEducationLevelMin          Int?  @default(0)
  prefEducationLevelMax          Int?  @default(100)
  prefEducationLevelWeight       Int?  @default(5)
  
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // SECTION C: DEAL BREAKERS - ◊ß◊ï◊ï◊ô◊ù ◊ê◊ì◊ï◊û◊ô◊ù
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  
  // Deal Breakers ◊ß◊©◊ô◊ó◊ô◊ù - ◊§◊ï◊°◊ú◊ô◊ù ◊û◊ô◊ô◊ì◊ô◊™
  dealBreakersHard               Json?    @default("[]")
  
  // Deal Breakers ◊®◊õ◊ô◊ù - ◊û◊ï◊®◊ô◊ì◊ô◊ù ◊¶◊ô◊ï◊ü
  dealBreakersSoft               Json?    @default("[]")
  
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // SECTION D: INFERRED TRAITS - ◊™◊õ◊ï◊†◊ï◊™ ◊©◊†◊í◊ñ◊®◊ï
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  
  inferredPersonalityType        PersonalityType?
  inferredAttachmentStyle        AttachmentStyle?
  inferredLoveLanguages          Json?    @default("[]")
  inferredRelationshipGoals      Json?    @default("{}")
  
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // üÜï SECTION E: INFERRED HARD DATA - ◊¢◊®◊õ◊ô◊ù ◊ß◊©◊ô◊ù ◊©◊î-AI ◊û◊©◊ú◊ô◊ù
  // ◊õ◊©◊î◊†◊™◊ï◊ü ◊ó◊°◊® ◊ë-Profile, ◊î-AI ◊û◊†◊ó◊©
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  
  inferredAge                    Int?              // ◊ê◊ù birthDate ◊ó◊°◊®
  inferredCity                   String?           // ◊ê◊ù city ◊ó◊°◊®
  inferredReligiousLevel         String?           // ◊ê◊ù religiousLevel ◊ó◊°◊®
  inferredPreferredAgeMin        Int?              // ◊ê◊ù preferredAgeMin ◊ó◊°◊®
  inferredPreferredAgeMax        Int?              // ◊ê◊ù preferredAgeMax ◊ó◊°◊®
  inferredPreferredReligiousLevels Json? @default("[]")  // ◊ê◊ù preferredReligiousLevels ◊ó◊°◊®
  inferredParentStatus           String?           // ◊ê◊ù parentStatus ◊ó◊°◊®
  inferredEducationLevel         String?           // ◊ê◊ù educationLevel ◊ó◊°◊®
  
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // SECTION F: AI ANALYSIS - ◊°◊ô◊õ◊ï◊û◊ô AI
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  
  // ◊î◊°◊ë◊® ◊û◊§◊ï◊®◊ò ◊ú◊õ◊ú ◊û◊ì◊ì
  metricsExplanations            Json?    @default("{}")
  
  // ◊°◊ô◊õ◊ï◊ù AI ◊©◊ú ◊î◊ê◊ô◊©◊ô◊ï◊™ (3 ◊û◊©◊§◊ò◊ô◊ù)
  aiPersonalitySummary           String?  @db.Text
  
  // ◊°◊ô◊õ◊ï◊ù AI ◊©◊ú ◊û◊î ◊û◊ó◊§◊© (3 ◊û◊©◊§◊ò◊ô◊ù)
  aiSeekingSummary               String?  @db.Text
  
  // üÜï ◊°◊ô◊õ◊ï◊ù AI ◊©◊ú ◊î◊®◊ß◊¢ (3 ◊û◊©◊§◊ò◊ô◊ù)
  aiBackgroundSummary            String?  @db.Text
  
  // üÜï ◊î◊†◊ó◊ô◊ï◊™ AI ◊ú◊©◊ì◊õ◊ü (3 ◊û◊©◊§◊ò◊ô◊ù)
  aiMatchmakerGuidelines         String?  @db.Text
  
  // üÜï ◊ß◊ï◊ï◊ô ◊ê◊ì◊ï◊ù ◊©◊î-AI ◊î◊°◊ô◊ß
  aiInferredDealBreakers         Json?    @default("[]")
  
  // üÜï ◊ó◊ï◊ë◊ï◊™ ◊©◊î-AI ◊î◊°◊ô◊ß
  aiInferredMustHaves            Json?    @default("[]")
  
  // ◊ì◊í◊ú◊ô ◊ß◊ï◊©◊ô
  difficultyFlags                Json?    @default("[]")
  
  @@index([profileId])
  @@index([calculatedBy])
  @@index([confidenceScore])
  @@map("profile_metrics")
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ProfileVector - ◊¢◊ì◊õ◊ï◊ü ◊ú◊™◊û◊ô◊õ◊î ◊ë◊©◊†◊ô ◊ï◊ß◊ò◊ï◊®◊ô◊ù
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ◊î◊¢◊®◊î: ◊ô◊© ◊ú◊¢◊ì◊õ◊ü ◊ê◊™ ◊î◊ò◊ë◊ú◊î ◊î◊ß◊ô◊ô◊û◊™ profile_vectors
// ◊ú◊î◊ï◊°◊ô◊£ ◊ê◊™ ◊î◊©◊ì◊ï◊™ ◊î◊ó◊ì◊©◊ô◊ù

// ALTER TABLE "profile_vectors" 
// ADD COLUMN "selfVector" vector(768),
// ADD COLUMN "seekingVector" vector(768),
// ADD COLUMN "selfVectorUpdatedAt" TIMESTAMP,
// ADD COLUMN "seekingVectorUpdatedAt" TIMESTAMP;

// -- ◊î◊¢◊™◊ß◊™ ◊î◊ï◊ß◊ò◊ï◊® ◊î◊ß◊ô◊ô◊ù ◊ú◊©◊ì◊î selfVector (◊õ◊†◊ß◊ï◊ì◊™ ◊î◊™◊ó◊ú◊î)
// UPDATE "profile_vectors" 
// SET "selfVector" = vector,
//     "selfVectorUpdatedAt" = "updatedAt"
// WHERE vector IS NOT NULL;


model ProfileVector {
  id                    String   @id @default(cuid())
  profileId             String   @unique
  profile               Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
 
  // ◊ï◊ß◊ò◊ï◊® ◊û◊ï◊®◊©◊™ (◊ú◊™◊ê◊ô◊û◊ï◊™ ◊ú◊ê◊ó◊ï◊®)
  vector                Unsupported("vector(3072)")?    // ‚Üê ◊©◊†◊î ◊û-768
 
  // ◊ï◊ß◊ò◊ï◊®◊ô◊ù ◊ó◊ì◊©◊ô◊ù
  selfVector            Unsupported("vector(3072)")?    // ‚Üê ◊©◊†◊î ◊û-768
  seekingVector         Unsupported("vector(3072)")?    // ‚Üê ◊©◊†◊î ◊û-768

  selfVectorUpdatedAt   DateTime?
  seekingVectorUpdatedAt DateTime?

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("profile_vectors")
}

// ============================================
// Device Tokens for Mobile Push Notifications
// ============================================
model DeviceToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  platform  String   // 'ios' or 'android'
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
}
enum MessageSenderType {
  USER
  MATCHMAKER
  SYSTEM
}
model SuggestionMessage {
  id           String            @id @default(cuid())
  suggestionId String
  senderId     String
  senderType   MessageSenderType
  targetUserId String?           // ◊ú◊û◊ô ◊î◊î◊ï◊ì◊¢◊î ◊û◊ô◊ï◊¢◊ì◊™ (null = ◊î◊ï◊ì◊¢◊™ ◊û◊¢◊®◊õ◊™ ◊ú◊õ◊ï◊ú◊ù)
  content      String            @db.Text
  isRead       Boolean           @default(false)
  createdAt    DateTime          @default(now())

  suggestion   MatchSuggestion   @relation(fields: [suggestionId], references: [id], onDelete: Cascade)
  sender       User              @relation("UserSuggestionMessages", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([suggestionId, createdAt])
  @@index([suggestionId, isRead])
  @@index([senderId])
  @@index([targetUserId])
}

model DirectMessage {
  id         String   @id @default(cuid())
  senderId   String
  receiverId String
  content    String   @db.Text
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  sender   User @relation("SentDirectMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation("ReceivedDirectMessages", fields: [receiverId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
  @@index([senderId, receiverId, createdAt])
  @@index([receiverId, isRead])
}

