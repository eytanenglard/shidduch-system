generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
}

model User {
  id                String     @id @default(cuid())
  email             String     @unique
  password          String?
  firstName         String
  lastName          String
  phone             String?    @unique
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  lastLogin         DateTime?
  status            UserStatus @default(PENDING_PHONE_VERIFICATION)
  role              UserRole   @default(CANDIDATE)
  isVerified        Boolean    @default(false)
  isPhoneVerified   Boolean    @default(false)
  isProfileComplete Boolean    @default(false)
  deviceTokens          DeviceToken[]

  source                    UserSource @default(REGISTRATION) // New field
  addedByMatchmakerId       String? // Optional: ID of matchmaker who added this manual user
  matchmakerWhoAdded        User?      @relation("ManuallyAddedBy", fields: [addedByMatchmakerId], references: [id]) // New relation
  termsAndPrivacyAcceptedAt DateTime? // ××ª×™ ×”××©×ª××© ××™×©×¨ ××ª ×”×ª× ××™× ×•××“×™× ×™×•×ª ×”×¤×¨×˜×™×•×ª
  engagementEmailsConsent     Boolean    @default(false) // ×”×¡×›××” ×œ××™×™×œ×™ ××¢×•×¨×‘×•×ª (×˜×™×¤×™×, ×¤×™×“×‘×§, ×ª×–×›×•×¨×•×ª)
  promotionalEmailsConsent    Boolean    @default(false) // ×”×¡×›××” ×œ××™×™×œ×™× ×©×™×•×•×§×™×™× (××‘×¦×¢×™×, ××™×¨×•×¢×™×)
  language                  Language   @default(he) 
  firstPartyInquiries             AvailabilityInquiry[]   @relation("FirstPartyInquiries")
  matchmakerAvailabilityInquiries AvailabilityInquiry[]   @relation("MatchmakerInquiries")
  secondPartyInquiries            AvailabilityInquiry[]   @relation("SecondPartyInquiries")
  givenFeedback                   DateFeedback[]          @relation("UserFeedback")
  sentInvitations                 Invitation[]            @relation("MatchmakerInvitations")
  receivedInvitation              Invitation?             @relation("ReceivedInvitation")
  firstPartySuggestions           MatchSuggestion[]       @relation("FirstPartySuggestions")
  createdSuggestions              MatchSuggestion[]       @relation("MatchmakerSuggestions")
  accounts                        Account[]
  sessions                        Session[]
  secondPartySuggestions          MatchSuggestion[]       @relation("SecondPartySuggestions")
  profile                         Profile?
  verifiedUsers                   Profile[]               @relation("VerifiedByMatchmaker")
  questionnaireResponses          QuestionnaireResponse[]
  sentSuggestionInquiries         SuggestionInquiry[]     @relation("SentSuggestionInquiries")
  receivedSuggestionInquiries     SuggestionInquiry[]     @relation("ReceivedSuggestionInquiries")
  images                          UserImage[]
  verifications                   Verification[]
  videos                          Video[]
  approvedSuggestions             MatchSuggestion[]       @relation("ApprovedSuggestions")
  reviewedSuggestions             MatchSuggestion[]       @relation("ReviewedSuggestions")
  oneTimeAuthTokens               OneTimeAuthToken[]
  manuallyAddedCandidates         User[]                  @relation("ManuallyAddedBy") // New relation back to matchmaker
  feedbacks                       Feedback[]
  dripCampaign              UserDripCampaign?
lastOnboardingEmailSent DateTime? // ××ª×™ ×©×œ×—× ×• ××™×™×œ onboarding ××—×¨×•×Ÿ
  onboardingCompleted     Boolean   @default(false) // ×¡×™×™× ××ª ×”-onboarding?
neshamaInsightLastGeneratedAt   DateTime?     
  neshamaInsightGeneratedCount    Int       @default(0)  // ğŸ‘ˆ ×”×•×¡×£ ×©×“×” ×–×”
referral    Referral?  @relation("ReferredUser")
  targetUserSearches    SavedMatchSearch[]  @relation("TargetUserSearches")
  matchmakerSearches    SavedMatchSearch[]  @relation("MatchmakerSearches")
targetUserVectorSearches    SavedVectorMatchSearch[]  @relation("TargetUserVectorSearches")
matchmakerVectorSearches    SavedVectorMatchSearch[]  @relation("MatchmakerVectorSearches")
virtualProfiles       VirtualProfile[]    @relation("MatchmakerVirtualProfiles")
  maleMatches     PotentialMatch[] @relation("MaleMatches")
  femaleMatches   PotentialMatch[] @relation("FemaleMatches")
  maleScannedPairs    ScannedPair[] @relation("MaleScannedPairs")
  femaleScannedPairs  ScannedPair[] @relation("FemaleScannedPairs")
 hiddenByMatchmakers   HiddenCandidate[] @relation("HiddenCandidates")
  hiddenCandidates      HiddenCandidate[] @relation("HiddenByMatchmaker")
  alerts      UserAlert[]

  @@index([email])
  @@index([role])
  @@index([status])
  @@index([source]) // Index the new field
  @@index([addedByMatchmakerId])
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade) // âœ… ×”×™×” ×§×™×™×

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model OneTimeAuthToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade) // âœ… ×”×™×” ×§×™×™×
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade) // âœ… ×”×™×” ×§×™×™×

  @@index([userId])
}

model Verification {
  id          String             @id @default(cuid())
  userId      String?
  type        VerificationType
  token       String
  target      String?
  expiresAt   DateTime
  status      VerificationStatus @default(PENDING)
  attempts    Int                @default(0)
  metadata    Json?
  createdAt   DateTime           @default(now())
  completedAt DateTime?
  user        User?              @relation(fields: [userId], references: [id], onDelete: Cascade) // â—ï¸ ×”×•×¡×¤×ª×™/×©×™× ×™×ª×™

  @@index([userId, type, status])
  @@index([target, type, status])
  @@index([token, type, status])
}

// model Profile in your schema.prisma

model Profile {
  id                     String   @id @default(cuid())
  userId                 String   @unique
  gender                 Gender
  birthDate              DateTime
  birthDateIsApproximate Boolean? @default(false) // <--- ×”×•×¡×£ ×©×“×” ×–×”

  nativeLanguage          String?
  additionalLanguages     String[]
  height                  Int?
  maritalStatus           String? // Marital status of the user
  occupation              String?
  education               String?
  educationLevel          String?
  city                    String?
  origin                  String? // Origin of the user
  religiousLevel          String? // Religious level of the user
  religiousJourney        ReligiousJourney? // <--- ×”×•×¡×¤×ª ×”×©×“×” ×”×—×“×©
  testimonialRequests     TestimonialRequest[] // <-- ADD THIS LINE
  shomerNegiah            Boolean?
  serviceType             ServiceType? // Service type of the user
  serviceDetails          String?
  manualEntryText         String?
  headCovering            HeadCoveringType?
  kippahType              KippahType?
  hasChildrenFromPrevious Boolean?          @default(false)
  profileCharacterTraits  String[]          @default([]) // User's own traits
  profileHobbies          String[]          @default([]) // User's own hobbies
  aliyaCountry            String?
  aliyaYear               Int?
  about                   String?
  isAboutVisible Boolean? @default(true)
  testimonials          FriendTestimonial[]
isFriendsSectionVisible Boolean? @default(true)
isNeshamaTechSummaryVisible Boolean? @default(true)
    profileHeadline       String? // ×›×•×ª×¨×ª ××™×©×™×ª ×œ×¤×¨×•×¤×™×œ
  inspiringCoupleStory  String? // ×¡×™×¤×•×¨ ×¢×œ ×–×•×’ ××¢×•×¨×¨ ×”×©×¨××”
  influentialRabbi      String? // ×“××•×ª ×¨×‘× ×™×ª/×¨×•×—× ×™×ª ××©×¤×™×¢×”
  parentStatus            String?
  fatherOccupation        String? // ××§×¦×•×¢ ×”××‘
  motherOccupation        String? // ××§×¦×•×¢ ×”××
  siblings                Int?
  position                Int?
 hasMedicalInfo              Boolean?
  medicalInfoDetails          String?
  medicalInfoDisclosureTiming String? // ×œ×“×•×’××”: 'FROM_THE_START', 'WHEN_SERIOUS'
  // ×©×“×” ×–×” ×§×•×‘×¢ ×”×× ×”××™×“×¢ ×”×¨×¤×•××™ ×™×•×¦×’ ×‘×›×¨×˜×™×¡ ×”×¤×¨×•×¤×™×œ ×”× ×©×œ×— ×œ×¦×“ ×”×©× ×™
  isMedicalInfoVisible        Boolean  @default(false)
  // --- Existing Preference Fields ---
  preferredAgeMin                  Int?
  preferredAgeMax                  Int?
  preferredHeightMin               Int?
  preferredHeightMax               Int?
  preferredReligiousLevels         String[] @default([])
  preferredLocations               String[] @default([])
  preferredEducation               String[] @default([]) // Corresponds to educationPreferenceOptions
  preferredOccupations             String[] @default([]) // Corresponds to occupationPreferenceOptions
  contactPreference                String?

  // --- New Preference Fields ---
  preferredMaritalStatuses    String[]           @default([]) // Preferred marital status(es) of the partner
  preferredShomerNegiah       String? // e.g., "yes", "no", "flexible"
  preferredPartnerHasChildren String? // e.g., "yes_ok", "no_preferred", "does_not_matter"
  preferredOrigins            String[]           @default([]) // Preferred origin(s) of the partner
  preferredServiceTypes       ServiceType[]      @default([]) // Preferred service type(s) of the partner
  preferredHeadCoverings      HeadCoveringType[] @default([]) // Preferred head covering(s) if partner is female
  preferredKippahTypes        KippahType[]       @default([]) // Preferred kippah type(s) if partner is male
  preferredCharacterTraits    String[]           @default([]) // Preferred character trait(s) of the partner
  preferredHobbies            String[]           @default([]) // Preferred hobbies of the partner
  preferredAliyaStatus        String? // e.g., "oleh", "tzabar", "no_preference"
preferredReligiousJourneys  ReligiousJourney[] @default([]) 
metrics  ProfileMetrics?
  isProfileVisible          Boolean            @default(true)
  preferredMatchmakerGender Gender?
  matchingNotes             String? // General notes about the desired match
  internalMatchmakerNotes String?
  verifiedBy                String?
  availabilityStatus        AvailabilityStatus @default(AVAILABLE)
  availabilityNote          String?
  availabilityUpdatedAt     DateTime?
  createdAt                 DateTime           @default(now())
  updatedAt                 DateTime           @updatedAt
  lastActive                DateTime?

  user                    User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  verifiedByMatchmaker    User?          @relation("VerifiedByMatchmaker", fields: [verifiedBy], references: [id], onDelete: SetNull)
  vector                  ProfileVector? // ×”×•×¡×¤×ª ×§×©×¨ ×”×¤×•×š
  hasViewedProfilePreview Boolean        @default(false)
    needsAiProfileUpdate    Boolean    @default(true)
    aiProfileSummary        Json?      
    cvUrl                   String? // URL to the CV file stored in Cloudinary
  cvSummary               String? @db.Text // AI-generated summary of the CV
conversationSummary     String? @db.Text 

referredBy              String?   // ×“×¨×š ××™ ×”×’×™×¢ - ××™×© ×§×©×¨ ×œ×”×ª×§×©×¨×•×ª

  // ==========================================================================
  // ğŸ†• Priority System
  // ==========================================================================
  priorityScore           Float?    @default(50)      // ×¦×™×•×Ÿ ×¢×“×™×¤×•×ª 0-100
  priorityCategory        String?   @default("MEDIUM") // CRITICAL/HIGH/MEDIUM/LOW
  priorityUpdatedAt       DateTime?                    // ××ª×™ ×¢×•×“×›×Ÿ ×”×¦×™×•×Ÿ
  
  // ==========================================================================
  // ğŸ†• Scanning & Suggestions Tracking
  // ==========================================================================
  lastScannedAt           DateTime?                    // ××ª×™ × ×¡×¨×§ ×œ××—×¨×•× ×”
  lastSuggestedAt         DateTime?                    // ××ª×™ ×§×™×‘×œ ×”×¦×¢×” ××—×¨×•× ×”
  pendingMatchesCount     Int       @default(0)        // ×›××” PotentialMatches ×××ª×™× ×™×
  
  // ==========================================================================
  // ğŸ†• Engagement Metrics
  // ==========================================================================
  lastActiveAt            DateTime?                    // ×¤×¢×™×œ×•×ª ××—×¨×•× ×”
  suggestionsReceived     Int       @default(0)        // ×›××” ×”×¦×¢×•×ª ×§×™×‘×œ
  suggestionsAccepted     Int       @default(0)        // ×›××” ×”×¦×¢×•×ª ×§×™×‘×œ (××™×©×¨)
  suggestionsDeclined     Int       @default(0)        // ×›××” ×”×¦×¢×•×ª ×“×—×”
  averageResponseTimeHours Float?                      // ×–××Ÿ ×ª×’×•×‘×” ×××•×¦×¢ ×‘×©×¢×•×ª
  
  // ==========================================================================
  // ğŸ†• Matchmaker Impressions (×”×¢×¨×›×” ×¡×•×‘×™×™×§×˜×™×‘×™×ª)
  // ==========================================================================
  matchmakerImpression    String?   @db.Text           // ×”×ª×¨×©××•×ª ×›×œ×œ×™×ª
  impressionScore         Int?                         // ×¦×™×•×Ÿ ×”×ª×¨×©××•×ª 1-10
  redFlags                String[]  @default([])       // ×“×’×œ×™× ××“×•××™×
  greenFlags              String[]  @default([])       // × ×§×•×“×•×ª ×—×™×•×‘×™×•×ª
  difficultyScore         Int?      @default(5)        // ×§×•×©×™ ×‘×©×™×“×•×š 1-10
  readinessLevel          ReadinessLevel? @default(READY)
  
  // ==========================================================================
  // ğŸ†• Profile Completeness
  // ==========================================================================
  profileCompletenessScore Float?   @default(0)        // ××—×•×– ××™×œ×•×™ 0-100
  missingFields           String[]  @default([])       // ×©×“×•×ª ×—×¡×¨×™×
  
  // ==========================================================================
  // ğŸ†• Derived Stats (××—×•×©×‘ ××”×“××˜×”)
  // ==========================================================================
  acceptanceRate          Float?                       // ×©×™×¢×•×¨ ×§×‘×œ×ª ×”×¦×¢×•×ª
  avgMatchScore           Float?                       // ×¦×™×•×Ÿ ×”×ª×××” ×××•×¦×¢
  
  // Relations
  rejectionFeedbacks      RejectionFeedback[] @relation("RejectedUser")
  givenRejectionFeedbacks RejectionFeedback[] @relation("RejectingUser")


}


model Meeting {
  id            String          @id @default(cuid())
  suggestionId  String
  scheduledDate DateTime
  status        MeetingStatus
  location      String?
  notes         String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  feedback      DateFeedback[]  @relation("MeetingFeedback")
  suggestion    MatchSuggestion @relation(fields: [suggestionId], references: [id], onDelete: Cascade) // â—ï¸ ×”×•×¡×¤×ª×™/×©×™× ×™×ª×™

  @@index([suggestionId])
  @@index([status])
}

model MatchSuggestion {
  id                    String                    @id @default(cuid())
  matchmakerId          String
  firstPartyId          String
  secondPartyId         String
  status                MatchSuggestionStatus     @default(DRAFT)
  priority              Priority                  @default(MEDIUM)
  internalNotes         String?
  firstPartyNotes       String?
  secondPartyNotes      String?
  matchingReason        String?
  followUpNotes         String?
  responseDeadline      DateTime?
  decisionDeadline      DateTime?
  lastStatusChange      DateTime?
  previousStatus        MatchSuggestionStatus?
  lastActivity          DateTime                  @default(now())
  firstPartySent        DateTime?
  firstPartyResponded   DateTime?
  secondPartySent       DateTime?
  secondPartyResponded  DateTime?
  firstMeetingScheduled DateTime?
  closedAt              DateTime?
  category              SuggestionCategory        @default(ACTIVE)
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt
  feedback              DateFeedback[]            @relation("SuggestionFeedback")
  firstParty            User                      @relation("FirstPartySuggestions", fields: [firstPartyId], references: [id], onDelete: Cascade) // âœ… ×”×™×” ×§×™×™×
  matchmaker            User                      @relation("MatchmakerSuggestions", fields: [matchmakerId], references: [id], onDelete: Cascade) // âœ… ×”×™×” ×§×™×™×
  secondParty           User                      @relation("SecondPartySuggestions", fields: [secondPartyId], references: [id], onDelete: Cascade) // âœ… ×”×™×” ×§×™×™×
  meetings              Meeting[]
  inquiries             SuggestionInquiry[]
  statusHistory         SuggestionStatusHistory[]
  approvedBy            User[]                    @relation("ApprovedSuggestions")
  reviewedBy            User[]                    @relation("ReviewedSuggestions")
  firstPartyLastViewedAt  DateTime?  // ××ª×™ ×¦×“ ×' ×¦×¤×” ×‘×”×¦×¢×” ×œ××—×¨×•× ×”
  secondPartyLastViewedAt DateTime?  // ××ª×™ ×¦×“ ×‘' ×¦×¤×” ×‘×”×¦×¢×” ×œ××—×¨×•× ×”
 potentialMatch  PotentialMatch?

  @@index([category])
  @@index([matchmakerId])
  @@index([firstPartyId])
  @@index([secondPartyId])
  @@index([status])
  @@index([priority])
  @@index([lastActivity])
}

model SuggestionStatusHistory {
  id           String                @id @default(cuid())
  suggestionId String
  status       MatchSuggestionStatus
  reason       String?
  notes        String?
  createdAt    DateTime              @default(now())
  suggestion   MatchSuggestion       @relation(fields: [suggestionId], references: [id], onDelete: Cascade) // âœ… ×”×™×” ×§×™×™×

  @@index([suggestionId])
}

model Invitation {
  id           String           @id @default(cuid())
  matchmakerId String
  email        String
  token        String           @unique
  expires      DateTime
  status       InvitationStatus @default(PENDING)
  metadata     Json?
  userId       String?          @unique
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  matchmaker   User             @relation("MatchmakerInvitations", fields: [matchmakerId], references: [id], onDelete: Cascade) // â—ï¸ ×”×•×¡×¤×ª×™/×©×™× ×™×ª×™
  user         User?            @relation("ReceivedInvitation", fields: [userId], references: [id], onDelete: Cascade) // â—ï¸ ×”×•×¡×¤×ª×™/×©×™× ×™×ª×™

  @@index([matchmakerId])
  @@index([email])
  @@index([status])
}

model Video {
  id        String      @id @default(cuid())
  userId    String
  url       String
  type      VideoType
  status    VideoStatus @default(PENDING)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade) // â—ï¸ ×”×•×¡×¤×ª×™/×©×™× ×™×ª×™
}

model AvailabilityInquiry {
  id                  String   @id @default(cuid())
  matchmakerId        String
  firstPartyId        String
  secondPartyId       String
  firstPartyResponse  Boolean?
  secondPartyResponse Boolean?
  note                String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  expiresAt           DateTime
  firstParty          User     @relation("FirstPartyInquiries", fields: [firstPartyId], references: [id], onDelete: Cascade) // â—ï¸ ×”×•×¡×¤×ª×™/×©×™× ×™×ª×™
  matchmaker          User     @relation("MatchmakerInquiries", fields: [matchmakerId], references: [id], onDelete: Cascade) // â—ï¸ ×”×•×¡×¤×ª×™/×©×™× ×™×ª×™
  secondParty         User     @relation("SecondPartyInquiries", fields: [secondPartyId], references: [id], onDelete: Cascade) // â—ï¸ ×”×•×¡×¤×ª×™/×©×™× ×™×ª×™

  @@index([matchmakerId])
  @@index([firstPartyId])
  @@index([secondPartyId])
}

model QuestionnaireResponse {
  id                    String    @id @default(cuid())
  userId                String
  valuesAnswers         Json?
  personalityAnswers    Json?
  relationshipAnswers   Json?
  partnerAnswers        Json?
  religionAnswers       Json?
  valuesCompleted       Boolean   @default(false)
  personalityCompleted  Boolean   @default(false)
  relationshipCompleted Boolean   @default(false)
  partnerCompleted      Boolean   @default(false)
  religionCompleted     Boolean   @default(false)
  worldsCompleted       String[]
  completed             Boolean   @default(false)
  startedAt             DateTime
  completedAt           DateTime?
  lastSaved             DateTime  @default(now())
    currentQuestionIndices Json?

  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade) // â—ï¸ ×”×•×¡×¤×ª×™/×©×™× ×™×ª×™

  @@index([userId])
  @@index([completed])
  @@index([valuesCompleted])
  @@index([personalityCompleted])
  @@index([relationshipCompleted])
  @@index([partnerCompleted])
  @@index([religionCompleted])
}

model UserImage {
  id                 String   @id @default(cuid())
  url                String
  isMain             Boolean  @default(false)
  cloudinaryPublicId String?
  userId             String
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade) // âœ… ×”×™×” ×§×™×™×

  @@index([userId])
}

model DateFeedback {
  id            String          @id @default(cuid())
  suggestionId  String
  partyId       String
  meetingId     String
  meetingNumber Int
  feedback      String
  status        String
  nextSteps     String?
  createdAt     DateTime        @default(now())
  meeting       Meeting         @relation("MeetingFeedback", fields: [meetingId], references: [id], onDelete: Cascade) // â—ï¸ ×”×•×¡×¤×ª×™/×©×™× ×™×ª×™
  party         User            @relation("UserFeedback", fields: [partyId], references: [id], onDelete: Cascade) // â—ï¸ ×”×•×¡×¤×ª×™/×©×™× ×™×ª×™
  suggestion    MatchSuggestion @relation("SuggestionFeedback", fields: [suggestionId], references: [id], onDelete: Cascade) // â—ï¸ ×”×•×¡×¤×ª×™/×©×™× ×™×ª×™

  @@index([suggestionId])
  @@index([partyId])
  @@index([meetingId])
}

model SuggestionInquiry {
  id           String          @id @default(cuid())
  suggestionId String
  fromUserId   String
  toUserId     String
  question     String
  answer       String?
  status       InquiryStatus   @default(PENDING)
  createdAt    DateTime        @default(now())
  answeredAt   DateTime?
  fromUser     User            @relation("SentSuggestionInquiries", fields: [fromUserId], references: [id], onDelete: Cascade) // â—ï¸ ×”×•×¡×¤×ª×™/×©×™× ×™×ª×™
  suggestion   MatchSuggestion @relation(fields: [suggestionId], references: [id], onDelete: Cascade) // âœ… ×”×™×” ×§×™×™×
  toUser       User            @relation("ReceivedSuggestionInquiries", fields: [toUserId], references: [id], onDelete: Cascade) // â—ï¸ ×”×•×¡×¤×ª×™/×©×™× ×™×ª×™
recipientReadAt DateTime?

  @@index([suggestionId])
  @@index([fromUserId])
  @@index([toUserId])
}

// --- Enums ---
enum ServiceType {
  MILITARY_COMBATANT
  MILITARY_SUPPORT
  MILITARY_OFFICER
  MILITARY_INTELLIGENCE_CYBER_TECH
  NATIONAL_SERVICE_ONE_YEAR
  NATIONAL_SERVICE_TWO_YEARS
  HESDER_YESHIVA
  YESHIVA_ONLY_POST_HS
  PRE_MILITARY_ACADEMY_AND_SERVICE
  EXEMPTED
  CIVILIAN_SERVICE
  OTHER
}

enum HeadCoveringType {
  FULL_COVERAGE
  PARTIAL_COVERAGE
  HAT_BERET
  SCARF_ONLY_SOMETIMES
  NONE
  UNDECIDED  // âœ… ×”×•×¡×£
}


enum KippahType {
  BLACK_VELVET
  KNITTED_SMALL
  KNITTED_LARGE
  CLOTH
  BRESLEV
  NONE_AT_WORK_OR_CASUAL
  NONE_USUALLY
  OTHER
}

enum MeetingStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum Gender {
  MALE
  FEMALE
}

enum UserRole {
  CANDIDATE
  MATCHMAKER
  ADMIN
}

enum UserStatus {
  PENDING_EMAIL_VERIFICATION
  PENDING_PHONE_VERIFICATION
  ACTIVE
  INACTIVE
  BLOCKED
}

enum VideoType {
  INTRODUCTION
  PERSONAL_STORY
  OTHER
}

enum VideoStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ContactMethod {
  EMAIL
  WHATSAPP
  PHONE
}

enum MatchSuggestionStatus {
  DRAFT
  PENDING_FIRST_PARTY
  FIRST_PARTY_APPROVED
  FIRST_PARTY_DECLINED
  PENDING_SECOND_PARTY
  SECOND_PARTY_APPROVED
  SECOND_PARTY_DECLINED
  AWAITING_MATCHMAKER_APPROVAL
  CONTACT_DETAILS_SHARED
  AWAITING_FIRST_DATE_FEEDBACK
  THINKING_AFTER_DATE
  PROCEEDING_TO_SECOND_DATE
  ENDED_AFTER_FIRST_DATE
  MEETING_PENDING
  MEETING_SCHEDULED
  MATCH_APPROVED
  MATCH_DECLINED
  DATING
  ENGAGED
  MARRIED
  EXPIRED
  CLOSED
  CANCELLED
}

enum SuggestionCategory {
  ACTIVE
  PENDING
  HISTORY
}

enum UserSource {
  REGISTRATION // User registered themselves
  MANUAL_ENTRY // User added manually by a matchmaker
  IMPORTED // Future: User imported from another system
}

enum AvailabilityStatus {
  AVAILABLE
  UNAVAILABLE
  DATING
  PAUSED
  ENGAGED
  MARRIED
}

enum ReligiousJourney {
  BORN_INTO_CURRENT_LIFESTYLE // ×’×“×œ×ª×™ ×‘×¡×‘×™×‘×” ×“×•××”
  BORN_SECULAR
  BAAL_TESHUVA                // ×—×–×¨×ª×™ ×‘×ª×©×•×‘×”
  DATLASH                     // ×™×¦××ª×™ ×‘×©××œ×”
  CONVERT                     // ×’×¨/×’×™×•×¨×ª
  IN_PROCESS                  // ×‘×ª×”×œ×™×š ×©×œ ×©×™× ×•×™
  OTHER                       // ××—×¨
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

enum VerificationType {
  EMAIL
  PHONE_WHATSAPP
  DOCUMENT
  REFERENCE
  PASSWORD_RESET
  ACCOUNT_SETUP
}

enum VerificationStatus {
  PENDING
  COMPLETED
  EXPIRED
  FAILED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum InquiryStatus {
  PENDING
  ANSWERED
  CLOSED
}

model Feedback {
  id            String         @id @default(cuid())
  createdAt     DateTime       @default(now())
  userId        String?
  user          User?          @relation(fields: [userId], references: [id], onDelete: Cascade)
  pageUrl       String
  feedbackType  FeedbackType
  content       String         @db.Text
  status        FeedbackStatus @default(NEW)
  userAgent     String?
  screenshotUrl String?      // Field for the screenshot URL

  @@index([userId])
}

enum FeedbackType {
  SUGGESTION
  BUG
  POSITIVE
}

enum FeedbackStatus {
  NEW
  IN_PROGRESS
  RESOLVED
  WONT_FIX
}

model FriendTestimonial {
  id           String   @id @default(cuid())
  profileId    String
  profile      Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  authorName   String   // ×©× ×”×—×‘×¨/×” ×”×××œ×™×¦/×”
  relationship String   // ×”×§×©×¨ ×œ××•×¢××“/×ª (×œ××©×œ: "×—×‘×¨ ×™×œ×“×•×ª")
  content      String   @db.Text
  authorPhone  String?  // ××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ ×©×œ ×”×××œ×™×¦/×” (××•×¤×¦×™×•× ×œ×™)
  
  // --- ×©×“×•×ª ×‘×§×¨×” ×•×¤×¨×˜×™×•×ª ---
  isPhoneVisibleToMatch Boolean   @default(false) // ×”×¡×›××” ××¤×•×¨×©×ª ×œ×”×¦×’×ª ×”××¡×¤×¨
  status                TestimonialStatus @default(PENDING) // ×¡×˜×˜×•×¡ ×”×”××œ×¦×”
  submittedBy           SubmissionSource  @default(USER)   // ××™×š ×”×”××œ×¦×” ×”×•×’×©×”
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([profileId])
}

// --- ×”×•×¡×¤×ª Enums ×—×“×©×™× ---
enum TestimonialStatus {
  PENDING   // ×××ª×™×Ÿ ×œ××™×©×•×¨ ×”××•×¢××“/×ª
  APPROVED  // ×××•×©×¨ ×•××•×¦×’ ×‘×¤×¨×•×¤×™×œ
  HIDDEN    // ×××•×©×¨ ××š ××•×¡×ª×¨ ×–×× ×™×ª ×¢×œ ×™×“×™ ×”××•×¢××“/×ª
}


enum SubmissionSource {
  USER   // ×”×•×–×Ÿ ×™×“× ×™×ª ×¢×œ ×™×“×™ ×”××•×¢××“/×ª
  FRIEND // ×”×•×’×© ×¢×œ ×™×“×™ ×—×‘×¨ ×“×¨×š ×§×™×©×•×¨ ×××•×‘×˜×—
}

enum TestimonialRequestStatus {
  PENDING
  COMPLETED
}

model TestimonialRequest {
  id        String    @id @default(cuid())
  token     String    @unique // The secure, random token for the URL
  expiresAt DateTime  // The date when the link will expire
  status    TestimonialRequestStatus @default(PENDING) // Tracks if the token has been used
  
  profileId String
  profile   Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([profileId])
}

model UserDripCampaign {
  id            String         @id @default(cuid())
  userId        String         @unique
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  currentStep   Int            @default(1)
  nextSendDate  DateTime
  status        CampaignStatus @default(ACTIVE)
  lastSentType  String?        // To track which type of message was last sent
  sentEmailTypes String[] @default([])
    lastEveningEmailSent   DateTime?  // ××ª×™ ×©×œ×—× ×• ××™×™×œ ×¢×¨×‘ ××—×¨×•×Ÿ
  eveningEmailsCount     Int        @default(0)  // ×›××” ××™×™×œ×™ ×¢×¨×‘ ×©×œ×—× ×•
  lastAiSummarySent      DateTime?  // ××ª×™ ×©×œ×—× ×• AI Summary ××—×¨×•×Ÿ
  aiSummaryCount         Int        @default(0)  // ×›××” ×¤×¢××™× ×©×œ×—× ×• AI Summary
  

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@index([nextSendDate, status])
   @@index([lastEveningEmailSent])
}

enum CampaignStatus {
  ACTIVE
  PAUSED
  UNSUBSCRIBED
  PROCESSING 
  COMPLETED
}

enum Language {
  en
  he
}

model ReferralCampaign {
  id          String   @id @default(cuid())
  name        String   // "×§××¤×™×™×Ÿ ×§×™×¥ 2025"
  slug        String   @unique // "summer-2025" - ×œ×–×™×”×•×™ ×‘×§×œ×•×ª
  description String?  @db.Text
  
  // ×ª××¨×™×›×™×
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean  @default(true)
  
  // ×¤×¨×¡×™×
  prizeTiers  Json?    // [{ threshold: 3, prize: "×§×¤×”", prizeValue: 50 }, ...]
  grandPrize  String?  // "××¨×•×—×” ×–×•×’×™×ª ×¤×¨×™××™×•×"
  
  // ×”×’×“×¨×•×ª
  settings    Json?    // { requireVerification: true, minAgeForReferral: 0 }
  
  referrers   Referrer[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([isActive])
  @@index([slug])
  @@index([startDate, endDate])
}

model Referrer {
  id           String   @id @default(cuid())
  campaignId   String
  campaign     ReferralCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  
  // ×¤×¨×˜×™ ×”××¤× ×”
  name         String
  email        String?
  phone        String?
  code         String   @unique  // "DAVID", "SARA123" - ×§×•×“ ×§×¦×¨ ×•×™×™×—×•×“×™
  
  // ×¡×•×’ ×”××¤× ×”
  tier         ReferrerTier @default(COMMUNITY)
  
  // ×”×¢×¨×•×ª ×¤× ×™××™×•×ª
  notes        String?  @db.Text
  
  // ×¡×˜×˜×™×¡×˜×™×§×•×ª ××˜××•×Ÿ (×œ×‘×™×¦×•×¢×™× - ××ª×¢×“×›×Ÿ ×‘×›×œ ××™×¨×•×¢)
  clickCount       Int @default(0)
  registrationCount Int @default(0)
  verifiedCount    Int @default(0)
  completedCount   Int @default(0)
  
  // ×¤×¨×¡×™× ×©×”×ª×§×‘×œ×•
  prizesAwarded    Json?  // [{ prize: "×§×¤×”", awardedAt: "2025-06-15" }]
  
  referrals    Referral[]
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@index([campaignId])
  @@index([code])
  @@index([tier])
  @@index([verifiedCount])
}

model Referral {
  id          String   @id @default(cuid())
  referrerId  String
  referrer    Referrer @relation(fields: [referrerId], references: [id], onDelete: Cascade)
  
  // ×”××©×ª××© ×©× ×¨×©× (null ×¢×“ ×©××©×œ×™× ×¨×™×©×•×)
  userId      String?  @unique
  user        User?    @relation("ReferredUser", fields: [userId], references: [id], onDelete: SetNull)
  
  // ××¢×§×‘ ×”×ª×§×“××•×ª
  status      ReferralStatus @default(CLICKED)
  
  // ××™×“×¢ ×˜×›× ×™ ×œ×× ×™×¢×ª ×”×•× ××•×ª
  ipAddress   String?
  userAgent   String?
  sessionId   String?  // ×œ×–×™×”×•×™ ×¡×©×Ÿ ×™×™×—×•×“×™
  
  // ×ª××¨×™×›×™× ×œ×›×œ ×©×œ×‘
  clickedAt    DateTime @default(now())
  startedAt    DateTime?  // ×”×ª×—×™×œ ×œ××œ× ×˜×•×¤×¡
  registeredAt DateTime?  // ×¡×™×™× ×¨×™×©×•× ×‘×¡×™×¡×™
  verifiedAt   DateTime?  // ××™××ª ×˜×œ×¤×•×Ÿ
  completedAt  DateTime?  // ×”×©×œ×™× ×¤×¨×•×¤×™×œ
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@index([referrerId])
  @@index([userId])
  @@index([status])
  @@index([ipAddress])
  @@index([clickedAt])
}

// --- Enums ×—×“×©×™× ---

enum ReferrerTier {
  AMBASSADOR  // ×©×’×¨×™×¨ - ×—×‘×¨ ×§×¨×•×‘ ×©×§×™×‘×œ ×¢×¨×›×” ××œ××”
  COMMUNITY   // ×§×”×™×œ×” - × ×¨×©× ×“×¨×š ×”×“×£ ×”×¦×™×‘×•×¨×™
}

enum ReferralStatus {
  CLICKED      // ×œ×—×¥ ×¢×œ ×”×§×™×©×•×¨
  STARTED      // ×”×ª×—×™×œ ×”×¨×©××” (× ×›× ×¡ ×œ×˜×•×¤×¡)
  REGISTERED   // ×¡×™×™× ×”×¨×©××” ×‘×¡×™×¡×™×ª
  VERIFIED     // ××™××ª ×˜×œ×¤×•×Ÿ
  COMPLETED    // ×”×©×œ×™× ×¤×¨×•×¤×™×œ + ×ª××•× ×”
}
model SavedMatchSearch {
  id               String   @id @default(cuid())
  
  // ×”××•×¢××“ ×©×—×™×¤×©× ×• ×¢×‘×•×¨×• ×”×ª×××•×ª
  targetUserId     String   @unique  // @unique = ×¨×§ ×—×™×¤×•×© ××—×“ ×©××•×¨ ×œ×›×œ ××•×¢××“
  targetUser       User     @relation("TargetUserSearches", fields: [targetUserId], references: [id], onDelete: Cascade)
  
  // ×”×©×“×›×Ÿ ×©×”×¤×¢×™×œ ××ª ×”×—×™×¤×•×©
  matchmakerId     String
  matchmaker       User     @relation("MatchmakerSearches", fields: [matchmakerId], references: [id], onDelete: Cascade)
  
  // ×ª×•×¦××•×ª ×”×—×™×¤×•×© (JSON)
  // ××‘× ×”: [{ userId, score, reasoning, firstName, lastName }]
  results          Json
  
  // ××˜×-×“××˜×”
  algorithmVersion String   @default("v2.0")
  candidatesCount  Int      @default(0)  // ×›××” ××•×¢××“×™× × ×•×ª×—×•
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  @@index([targetUserId])
  @@index([matchmakerId])
  @@index([createdAt])
}

model SavedVectorMatchSearch {
  id               String   @id @default(cuid())
  targetUserId     String   @unique
  targetUser       User     @relation("TargetUserVectorSearches", fields: [targetUserId], references: [id], onDelete: Cascade)
  matchmakerId     String
  matchmaker       User     @relation("MatchmakerVectorSearches", fields: [matchmakerId], references: [id], onDelete: Cascade)
  results          Json
  algorithmVersion String   @default("vector-v1.0")
  candidatesCount  Int      @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  @@index([targetUserId])
  @@index([matchmakerId])
}

model MatchingJob {
  id              String    @id @default(cuid())
  targetUserId    String
  matchmakerId    String
  method          String
  status          String    @default("pending")
  progress        Int       @default(0)
  progressMessage String?
  result          Json?
  error           String?
  totalCandidates Int?
  matchesFound    Int?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  completedAt     DateTime?

  @@index([targetUserId])
  @@index([matchmakerId])
  @@index([status])
  @@index([createdAt])
}
  
model VirtualProfile {
  id                  String   @id @default(cuid())
  
  // ××™ ×™×¦×¨ ××ª ×”×¤×¨×•×¤×™×œ ×”×•×™×¨×˜×•××œ×™
  matchmakerId        String
  matchmaker          User     @relation("MatchmakerVirtualProfiles", fields: [matchmakerId], references: [id], onDelete: Cascade)
  
  // ×§×œ×˜ ×”×©×“×›×Ÿ
  name                String?              // ×©× ×œ×–×™×”×•×™ (××•×¤×¦×™×•× ×œ×™)
  sourceText          String   @db.Text    // ×”×˜×§×¡×˜ ×”×—×•×¤×©×™ ×©×”×©×“×›×Ÿ ×”×–×™×Ÿ
  
  // ×¤×¨××˜×¨×™× ×©×”×©×“×›×Ÿ ×‘×•×—×¨ (×—×•×‘×”)
  gender              Gender               // ××’×“×¨ ×”×™×•×–×¨ ×”×•×™×¨×˜×•××œ×™
  religiousLevel      String               // ×¨××” ×“×ª×™×ª
  
  // ×”×¤×¨×•×¤×™×œ ×©×”-AI ×™×¦×¨
  generatedProfile    Json?                // { personalitySummary, lookingForSummary, inferredAge, ... }
  
  // ×¡×™×›×•× ×¢×¨×•×š (×× ×”×©×“×›×Ÿ ×¢×¨×š ××ª ×”×¡×™×›×•×)
  editedSummary       String?  @db.Text    // ×¡×™×›×•× ×©×”×©×“×›×Ÿ ×¢×¨×š ×™×“× ×™×ª
  wasEdited           Boolean  @default(false)
  
  // ×•×§×˜×•×¨ ×œ×”×ª×××” (× ×•×¦×¨ ××”×¤×¨×•×¤×™×œ)
  vector              Unsupported("vector(768)")?
  
  // ××˜×-×“××˜×”
  isStarred           Boolean  @default(false)
  lastUsedAt          DateTime?
  usageCount          Int      @default(0)
  
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  @@index([matchmakerId])
  @@index([isStarred])
  @@index([lastUsedAt])
}



// ×˜×‘×œ×” ×—×“×©×”: ×”×ª×××•×ª ×¤×•×˜× ×¦×™××œ×™×•×ª ×©× ××¦××• ×‘×¡×¨×™×§×” ×”×œ×™×œ×™×ª
model PotentialMatch {
  id              String   @id @default(cuid())
   scanMethod    String?   // 'hybrid' | 'algorithmic' | 'vector'
  // ×”×–×•×’
  maleUserId      String
  femaleUserId    String
  
  // ×¦×™×•× ×™×
  aiScore         Float    // ×”×¦×™×•×Ÿ ×”×¡×•×¤×™ (finalScore)
  firstPassScore  Float?   // ×¦×™×•×Ÿ ×”××¢×‘×¨ ×”×¨××©×•×Ÿ
  
  // ×¤×™×¨×•×˜ ×”×¦×™×•×Ÿ
  scoreBreakdown  Json?    // ScoreBreakdown object
  
  // × ×™××•×§×™×
  shortReasoning  String?  @db.Text
  detailedReasoning String? @db.Text
  
  // ××™×“×¢ ×¨×§×¢
  backgroundCompatibility String? // excellent/good/possible/problematic/not_recommended
  backgroundMultiplier    Float?
  
  // ×¡×˜×˜×•×¡ ××¢×§×‘
  status          PotentialMatchStatus @default(PENDING)
  
  // ×ª××¨×™×›×™×
  scannedAt       DateTime @default(now())
  reviewedAt      DateTime?
  dismissedAt     DateTime?
  sentAt          DateTime? // ××ª×™ × ×©×œ×—×” ×”×¦×¢×”
  
  // ××™ ×¡×§×¨/×“×—×”
  reviewedBy      String?
  dismissReason   String?
  
  // ×§×™×©×•×¨ ×œ×”×¦×¢×” ×× × ×•×¦×¨×”
  suggestionId    String?  @unique
  
  // Relations
  male            User     @relation("MaleMatches", fields: [maleUserId], references: [id], onDelete: Cascade)
  female          User     @relation("FemaleMatches", fields: [femaleUserId], references: [id], onDelete: Cascade)
  suggestion      MatchSuggestion? @relation(fields: [suggestionId], references: [id])
  

    // ==========================================================================
  // ğŸ†• Asymmetric Scoring - ×¦×™×•× ×™× × ×¤×¨×“×™× ×œ×›×œ ×¦×“
  // ==========================================================================
  scoreForMale          Float?                        // ×›××” ×”×™× ××ª××™××” ×œ×•
  scoreForFemale        Float?                        // ×›××” ×”×•× ××ª××™× ×œ×”
  asymmetryGap          Float?                        // ×¤×¢×¨ ×‘×™×Ÿ ×”×¦×™×•× ×™×
  
  // ==========================================================================
  // ğŸ†• Multi-Dimensional Scores
  // ==========================================================================
  surfaceMatchScore     Float?                        // ×”×ª×××” "×¢×œ ×”× ×™×™×¨"
  valuesAlignmentScore  Float?                        // ×”×ª×××ª ×¢×¨×›×™×
  personalityScore      Float?                        // ×“×™× ××™×§×ª ××™×©×™×•×ª
  practicalFitScore     Float?                        // ×”×ª×××” ××¢×©×™×ª
  
  // ==========================================================================
  // ğŸ†• Confidence & Quality
  // ==========================================================================
  confidenceLevel       Float?    @default(0.5)       // ×¨××ª ×‘×™×˜×—×•×Ÿ ×‘×¦×™×•×Ÿ 0-1
  dataQuality           String?   @default("medium")  // low/medium/high
  
  // ==========================================================================
  // ğŸ†• Exploration Flag
  // ==========================================================================
  isExploratoryMatch    Boolean   @default(false)     // ×”×× ×–×• ×”×¦×¢×” "× ×™×¡×•×™×™×ª"
  explorationReason     String?                       // ×œ××” × ×‘×—×¨×” ×›× ×™×¡×•×™

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ†• ×¦×™×•× ×™× ×œ×¤×™ ×©×™×˜×ª ×¡×¨×™×§×” (×›×œ ×©×™×˜×” ×©×•××¨×ª ×‘× ×¤×¨×“)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  // Hybrid Method (4-tier)
  hybridScore           Float?
  hybridReasoning       String?
  hybridScannedAt       DateTime?
  hybridScoreBreakdown  Json?
  
  // Algorithmic Method (AI Deep)
  algorithmicScore      Float?
  algorithmicReasoning  String?
  algorithmicScannedAt  DateTime?
  algorithmicScoreBreakdown  Json?

  // Vector Method (Fast similarity)
  vectorScore           Float?
  vectorReasoning       String?
  vectorScannedAt       DateTime?
  
  // Metrics V2 Method
  metricsV2Score        Float?
  metricsV2Reasoning    String?
  metricsV2ScannedAt    DateTime?
metricsV2ScoreBreakdown    Json?

    lastScanMethod        String?   // 'hybrid' | 'algorithmic' | 'vector' | 'metrics_v2'

  // Indexes
  @@unique([maleUserId, femaleUserId])
  @@index([aiScore(sort: Desc)])
  @@index([status])
  @@index([scannedAt])
  @@index([maleUserId])
  @@index([femaleUserId])
}

// Enum ×œ×¡×˜×˜×•×¡ ×”×”×ª×××” ×”×¤×•×˜× ×¦×™××œ×™×ª
enum PotentialMatchStatus {
  PENDING      // ×˜×¨× × ×‘×“×§
  REVIEWED     // × ×‘×“×§ ××š ×œ× ×”×•×—×œ×˜
  SENT         // × ×©×œ×—×” ×”×¦×¢×”
  DISMISSED    // × ×“×—×” ×¢"×™ ×”×©×“×›×Ÿ
  EXPIRED      // ×¤×’ ×ª×•×§×£ (×¡×¨×™×§×” ×™×©× ×” ××“×™)
  SHORTLISTED 
}

// ×˜×‘×œ×” ×—×“×©×”: ×œ×•×’ ×¡×¨×™×§×•×ª ×œ×™×œ×”
model NightlyScanLog {
  id                  String   @id @default(cuid())
  
  // ×¡×˜×˜×™×¡×˜×™×§×•×ª
  totalCandidates     Int
  candidatesScanned   Int
  matchesFound        Int
  newMatches          Int      // ×”×ª×××•×ª ×©×œ× ×”×™×• ×§×™×™××•×ª ×§×•×“×
  updatedMatches      Int      // ×”×ª×××•×ª ×©×¢×•×“×›× ×•
  
  // ×–×× ×™×
  startedAt           DateTime
  completedAt         DateTime?
  durationMs          Int?
  
  // ×¡×˜×˜×•×¡
  status              String   // running/completed/failed/partial
  error               String?  @db.Text
  
  // ×¤×¨×˜×™× × ×•×¡×¤×™×
  method              String   @default("algorithmic") // algorithmic/vector/hybrid
  minScoreThreshold   Float    @default(70)
  
  @@index([startedAt])
  @@index([status])
}

model ScannedPair {
  id              String   @id @default(cuid())
  
  maleUserId      String
  femaleUserId    String
  
  // ×ª×•×¦××ª ×”×¡×¨×™×§×”
  aiScore         Float?   // ×”×¦×™×•×Ÿ ×©×§×™×‘×œ (null ×× ×œ× ×”×’×™×¢ ×œ-AI)
  passedThreshold Boolean  @default(false) // ×”×× ×¢×‘×¨ ×¡×£ 70
  
  // ×¡×™×‘×ª ×¤×¡×™×œ×” (×× ×œ× ×¢×‘×¨)
  rejectionReason String?  // "age_gap", "religious_mismatch", "background_incompatible", "low_ai_score"
  
  // ×ª××¨×™×›×™×
  firstScannedAt  DateTime @default(now())
  lastScannedAt   DateTime @default(now())
  
  // ×•×•×¨×¡×™×” ×©×œ ×”×¤×¨×•×¤×™×œ×™× ×‘×–××Ÿ ×”×¡×¨×™×§×”
  maleProfileUpdatedAt   DateTime? // profile.updatedAt ×©×œ ×”×’×‘×¨ ×‘×–××Ÿ ×”×¡×¨×™×§×”
  femaleProfileUpdatedAt DateTime? // profile.updatedAt ×©×œ ×”×‘×—×•×¨×” ×‘×–××Ÿ ×”×¡×¨×™×§×”
  
  // Relations
  male            User     @relation("MaleScannedPairs", fields: [maleUserId], references: [id], onDelete: Cascade)
  female          User     @relation("FemaleScannedPairs", fields: [femaleUserId], references: [id], onDelete: Cascade)
  
  @@unique([maleUserId, femaleUserId])
  @@index([maleUserId])
  @@index([femaleUserId])
  @@index([passedThreshold])
  @@index([lastScannedAt])
}

model HiddenCandidate {
  id           String   @id @default(cuid())
  matchmakerId String
  candidateId  String
  reason       String?
  hiddenAt     DateTime @default(now())
  
  matchmaker   User @relation("HiddenByMatchmaker", fields: [matchmakerId], references: [id], onDelete: Cascade)
  candidate    User @relation("HiddenCandidates", fields: [candidateId], references: [id], onDelete: Cascade)
  
  @@unique([matchmakerId, candidateId])
  @@index([matchmakerId])
  @@index([candidateId])
}

enum AlertType {
  NEW_USER_NO_SUGGESTION      // ××©×ª××© ×—×“×© 48+ ×©×¢×•×ª ×‘×œ×™ ×”×¦×¢×”
  LONG_WAIT                   // ××—×›×” 10+ ×™××™× ×œ×”×¦×¢×”
  HIGH_DIFFICULTY             // ×§×•×©×™ ×’×‘×•×” ×‘×©×™×“×•×š (×”×¨×‘×” ×“×—×™×•×ª)
  INACTIVE_WITH_MATCHES       // ×™×© ×œ×• ×”×ª×××•×ª ××‘×œ ×œ× ×¤×¢×™×œ
  PROFILE_INCOMPLETE          // ×¤×¨×•×¤×™×œ ×¤×—×•×ª ×-50% ××œ×
  NO_POTENTIAL_MATCHES        // ××™×Ÿ ×œ×• ×”×ª×××•×ª ×‘××¢×¨×›×ª
  STALE_MATCHES               // ×”×”×ª×××•×ª ×©×œ×• ×™×©× ×•×ª ××“×™
  HIGH_REJECTION_RATE         // ×©×™×¢×•×¨ ×“×—×™×•×ª ×’×‘×•×”
  NEW_HIGH_QUALITY_MATCH      // × ××¦××” ×”×ª×××” ××™×›×•×ª×™×ª ×—×“×©×”
}

enum AlertSeverity {
  CRITICAL    // ğŸ”´ ×“×—×•×£ - ×œ×˜×¤×œ ×¢×›×©×™×•
  HIGH        // ğŸŸ  ×’×‘×•×” - ×œ×˜×¤×œ ×”×™×•×
  MEDIUM      // ğŸŸ¡ ×‘×™× ×•× ×™ - ×œ×˜×¤×œ ×”×©×‘×•×¢
  LOW         // ğŸŸ¢ × ××•×š - ×œ×™×“×™×¢×”
  INFO        // ğŸ”µ ××™×“×¢
}

enum RejectionCategory {
  // ×¡×™×‘×•×ª ××•×‘×™×™×§×˜×™×‘×™×•×ª
  AGE_GAP                     // ×¤×¢×¨ ×’×™×œ ×’×“×•×œ ××“×™
  RELIGIOUS_GAP               // ×¤×¢×¨ ×¨××” ×“×ª×™×ª
  BACKGROUND_GAP              // ×¤×¢×¨ ×¨×§×¢/×¢×“×”
  EDUCATION_GAP               // ×¤×¢×¨ ×”×©×›×œ×”/×§×¨×™×™×¨×”
  GEOGRAPHIC_GAP              // ×¤×¢×¨ ×’×™××•×’×¨×¤×™
  KNOWS_PERSONALLY            // ××›×™×¨/×” ××™×©×™×ª
  
  // ×¡×™×‘×•×ª ×¡×•×‘×™×™×§×˜×™×‘×™×•×ª
  NOT_ATTRACTED               // ×œ× ××•×©×š/×ª
  NOT_INTERESTING             // ×œ× ××¢× ×™×™×Ÿ/×ª
  NO_CONNECTION               // ×œ× ×”×¨×’×©×ª×™ ×—×™×‘×•×¨
  GUT_FEELING                 // ×ª×—×•×©×ª ×‘×˜×Ÿ ×©×œ×™×œ×™×ª
  SOMETHING_OFF               // ××©×”×• ×œ× ×”×¡×ª×“×¨
  
  // ×¡×™×‘×•×ª ×ª×–××•×Ÿ
  NOT_AVAILABLE_NOW           // ×œ× ×–××™×Ÿ/×” ×›×¨×’×¢
  IN_PROCESS_WITH_OTHER       // ×‘×ª×”×œ×™×š ×¢× ××™×©×”×• ××—×¨
  NEEDS_TIME                  // ×¦×¨×™×š/×” ×–××Ÿ ×œ×—×©×•×‘
  EXTERNAL_PRESSURE           // ×œ×—×¥ ×—×™×¦×•× ×™
  
  // Red Flags
  INCONSISTENT_STORY          // ×—×•×¡×¨ ×¢×§×‘×™×•×ª ×‘×¡×™×¤×•×¨
  PROBLEMATIC_BEHAVIOR        // ×”×ª× ×”×’×•×ª ×‘×¢×™×™×ª×™×ª
  UNREALISTIC_EXPECTATIONS    // ×¦×™×¤×™×•×ª ×œ× ×¨×™××œ×™×¡×˜×™×•×ª
  CONCERNING_HISTORY          // ×”×™×¡×˜×•×¨×™×” ××“××™×’×”
  
  // ××—×¨
  OTHER                       // ×¡×™×‘×” ××—×¨×ª
}

enum ReadinessLevel {
  NOT_READY           // 1 - ×œ× ××•×›×Ÿ ×›×œ×œ
  UNCERTAIN           // 2 - ×œ× ×‘×˜×•×—
  SOMEWHAT_READY      // 3 - ××•×›×Ÿ ×—×œ×§×™×ª
  READY               // 4 - ××•×›×Ÿ
  VERY_READY          // 5 - ××•×›×Ÿ ×××•×“ ×•×¤×¢×™×œ
}



model UserAlert {
  id            String         @id @default(cuid())
  
  // ×”×§×©×¨ ×œ××©×ª××©
  userId        String
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // ×¤×¨×˜×™ ×”×”×ª×¨××”
  type          AlertType
  severity      AlertSeverity
  title         String                              // ×›×•×ª×¨×ª ×§×¦×¨×”
  message       String         @db.Text             // ×”×•×“×¢×” ××¤×•×¨×˜×ª
  data          Json?                               // ××™×“×¢ × ×•×¡×£ (JSON)
  
  // ×¤×¢×•×œ×” ××•××œ×¦×ª
  actionType    String?                             // ×¡×•×’ ×”×¤×¢×•×œ×” ×”××•××œ×¦×ª
  actionUrl     String?                             // ×§×™×©×•×¨ ×œ×¤×¢×•×œ×”
  
  // ×¡×˜×˜×•×¡
  isRead        Boolean        @default(false)
  isDismissed   Boolean        @default(false)
  dismissedAt   DateTime?
  dismissedBy   String?                             // ID ×©×œ ××™ ×©×“×—×”
  dismissReason String?                             // ×¡×™×‘×ª ×”×“×—×™×™×”
  
  // ××ª×™ ×”×”×ª×¨××” ×¨×œ×•×•× ×˜×™×ª
  expiresAt     DateTime?                           // ×ª×¤×•×’×” ××•×˜×•××˜×™×ª
  
  // Timestamps
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  
  @@index([userId])
  @@index([severity])
  @@index([type])
  @@index([isDismissed, isRead])
  @@index([createdAt])
}

// =============================================================================
// ğŸ†• Model RejectionFeedback - ×œ××™×“×” ××“×—×™×•×ª
// =============================================================================

model RejectionFeedback {
  id                  String            @id @default(cuid())
  
  // ×”×–×•×’
  rejectedUserId      String                          // ××™ × ×“×—×”
  rejectingUserId     String                          // ××™ ×“×—×” (×× ×™×“×•×¢)
  
  // ×”×§×©×¨ ×œ×”×¦×¢×”
  suggestionId        String?                         // MatchSuggestion ×× ×¨×œ×•×•× ×˜×™
  potentialMatchId    String?                         // PotentialMatch ×× ×¨×œ×•×•× ×˜×™
  
  // ×¤×¨×˜×™ ×”×“×—×™×™×”
  category            RejectionCategory               // ×§×˜×’×•×¨×™×” ×¨××©×™×ª
  subcategory         String?                         // ×ª×ª-×§×˜×’×•×¨×™×”
  freeText            String?           @db.Text      // ×”×¡×‘×¨ ×—×•×¤×©×™
  
  // ××™ ×ª×™×¢×“
  recordedBy          String                          // ID ×©×œ ×”×©×“×›×Ÿ
  
  // ×”×× ×”×“×—×™×™×” ×”×™×™×ª×” ×¦×¤×•×™×”
  wasExpected         Boolean?                        // ×”×× ×”×©×“×›×Ÿ ×¦×™×¤×” ×œ×–×”
  
  // Timestamps
  createdAt           DateTime          @default(now())
  
  // Relations
  rejectedUser        Profile           @relation("RejectedUser", fields: [rejectedUserId], references: [id], onDelete: Cascade)
  rejectingUser       Profile           @relation("RejectingUser", fields: [rejectingUserId], references: [id], onDelete: Cascade)
  
  @@index([rejectedUserId])
  @@index([rejectingUserId])
  @@index([category])
  @@index([createdAt])
}


model ScanSession {
  id                    String    @id @default(cuid())
  matchmakerId         String     
  // ×¡×•×’ ×”×¡×¨×™×§×”
  scanType              String                        // nightly/hourly/manual/user_triggered
    progressData         Json?             // ×œ×©××™×¨×ª ××¦×‘ ×”×¡×¨×™×§×”

  // ×¡×˜×˜×™×¡×˜×™×§×•×ª
  totalUsersScanned     Int       @default(0)
  malesScanned          Int       @default(0)
  femalesScanned        Int       @default(0)
  pairsEvaluated        Int       @default(0)
  matchesFound          Int       @default(0)
  newMatches            Int       @default(0)
  updatedMatches        Int       @default(0)
    matchmaker           User              @relation(fields: [matchmakerId], references: [id])

  // ×¤×™×œ×˜×¨×™× ×©×”×•×¤×¢×œ×•
  pairsSkippedByAge     Int       @default(0)
  pairsSkippedByReligion Int      @default(0)
  pairsSkippedByHistory Int       @default(0)
  pairsSkippedByVector  Int       @default(0)
  
  // ×‘×™×¦×•×¢×™×
  durationMs            Int?
  aiCallsCount          Int       @default(0)
  aiTokensUsed          Int       @default(0)
  

   currentPhase          String?   // ×”×¤××–×” ×”× ×•×›×—×™×ª ×©×œ ×”×¡×¨×™×§×”
   currentUserIndex      Int       @default(0)     // ××™× ×“×§×¡ ×”××©×ª××© ×”× ×•×›×—×™
  totalUsersToProcess   Int       @default(0)     // ×¡×”"×› ××©×ª××©×™× ×œ×¢×™×‘×•×“
  progressPercent       Int       @default(0)     // ××—×•×– ×”×ª×§×“××•×ª
   currentUserName       String?   // ×©× ×”××©×ª××© ×”× ×•×›×—×™ (×œ×ª×¦×•×’×”)

  // ×¡×˜×˜×•×¡
  status                String    @default("running") // running/completed/failed/partial
  error                 String?   @db.Text
  
  // Timestamps
  startedAt             DateTime  @default(now())
  completedAt           DateTime?
  
  @@index([scanType])
  @@index([status])
  @@index([startedAt])
    @@index([matchmakerId, status])

}

model VectorSimilarityCache {
  id            String   @id @default(cuid())
  profileId1    String
  profileId2    String
  similarity    Float
  calculatedAt  DateTime @default(now())
  
  @@unique([profileId1, profileId2])
  @@index([profileId1])
  @@index([profileId2])
  @@index([calculatedAt])
}

// ============================================================
// NeshamaTech - Profile Metrics & Dual Vector System
// ×œ×”×•×¡×¤×” ×œ-schema.prisma ×”×§×™×™×
// ============================================================

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENUMS - ×¡×•×’×™× ×§×‘×•×¢×™×
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

enum CalculatedBy {
  AI_AUTO           // ×—×•×©×‘ ××•×˜×•××˜×™×ª ×¢×œ ×™×“×™ AI
  MATCHMAKER_EDIT   // × ×¢×¨×š ×™×“× ×™×ª ×¢×œ ×™×“×™ ×©×“×›×Ÿ
  USER_QUESTIONNAIRE // ××’×™×¢ ×™×©×™×¨×•×ª ××ª×©×•×‘×ª ×”×©××œ×•×Ÿ
}

enum HumorStyle {
  CYNICAL           // ×¦×™× ×™/×¡×¨×§×¡×˜×™
  LIGHT             // ×§×œ×™×œ ×•××©×¢×©×¢
  WORDPLAY          // ××©×—×§×™ ××™×œ×™×
  SELF_DEPRECATING  // ×”×•××•×¨ ×¢×¦××™
  PHYSICAL          // ×§×•××“×™×” ×¤×™×–×™×ª
  DRY               // ×™×‘×©
}

enum EthnicBackground {
  ASHKENAZI         // ××©×›× ×–×™
  SEPHARDI          // ×¡×¤×¨×“×™/××–×¨×—×™
  MIXED             // ××¢×•×¨×‘
  ETHIOPIAN         // ××ª×™×•×¤×™
  YEMENITE          // ×ª×™×× ×™
  OTHER             // ××—×¨
}

enum BackgroundCategory {
  SABRA             // ×¦×‘×¨ ×™×©×¨××œ×™
  SABRA_INTERNATIONAL // ×¦×‘×¨ ×¢× ×¨×§×¢ ×‘×™× ×œ××•××™
  OLEH_VETERAN      // ×¢×•×œ×” ×•×ª×™×§ (10+ ×©× ×™×)
  OLEH_MID          // ×¢×•×œ×” ×‘×™× ×•× ×™ (3-10 ×©× ×™×)
  OLEH_NEW          // ×¢×•×œ×” ×—×“×© (×¤×—×•×ª ×-3 ×©× ×™×)
}

enum CommunicationStyle {
  DIRECT            // ×™×©×™×¨ ×•×‘×¨×•×¨
  EMPATHETIC        // ×××¤×ª×™ ×•×¨×’×™×©
  ANALYTICAL        // ×× ×œ×™×˜×™ ×•×œ×•×’×™
  HUMOROUS          // ×”×•××•×¨×™×¡×˜×™
  EMOTIONAL         // ×¨×’×©×™ ×•×¤×ª×•×—
}

enum ConflictStyle {
  CONFRONTING       // ××ª××•×“×“ ×™×©×™×¨×•×ª
  AVOIDING          // × ×× ×¢ ××¢×™××•×ª×™×
  COMPROMISING      // ××—×¤×© ×¤×©×¨×•×ª
  NEEDS_TIME        // ×¦×¨×™×š ×–××Ÿ ×œ×¢×‘×“
  COLLABORATIVE     // ×©×™×ª×•×¤×™ - ××—×¤×© ×¤×ª×¨×•× ×•×ª ×™×—×“
}

enum SupportStyle {
  LISTENING         // ××§×©×™×‘ ×•×ª×•××š ×¨×’×©×™×ª
  SOLVING           // ××¦×™×¢ ×¤×ª×¨×•× ×•×ª ××¢×©×™×™×
  DISTRACTING       // ××¡×™×— ×“×¢×ª ×•××©××—
  SPACE             // × ×•×ª×Ÿ ××¨×—×‘ ×•×©×§×˜
  PHYSICAL          // ××‘×™×¢ ×ª××™×›×” ×¤×™×–×™×ª (×—×™×‘×•×§ ×•×›×•')
}

enum PetsAttitude {
  LOVE              // ××•×”×‘ ×—×™×•×ª ××—××“
  NEUTRAL           // × ×™×˜×¨×œ×™
  DISLIKE           // ×œ× ××•×”×‘
  ALLERGIC          // ××œ×¨×’×™
}

enum PersonalityType {
  LEADER            // ××•×‘×™×œ/×™×•×–×
  SUPPORTER         // ×ª×•××š/×¢×•×–×¨
  ANALYTICAL        // ×× ×œ×™×˜×™/×—×•×©×‘
  CREATIVE          // ×™×¦×™×¨×ª×™/×××Ÿ
  CAREGIVER         // ××˜×¤×œ/×“×•××’
  ADVENTURER        // ×”×¨×¤×ª×§×Ÿ
  HARMONIZER        // ×××–×Ÿ/××¤×©×¨
}

enum AttachmentStyle {
  SECURE            // ×‘×˜×•×—
  ANXIOUS           // ×—×¨×“
  AVOIDANT          // × ×× ×¢
  DISORGANIZED      // ×œ× ×××•×¨×’×Ÿ (××¢×•×¨×‘)
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ProfileMetrics - ××“×“×™× ××¡×¤×¨×™×™× ×œ×›×œ ×¤×¨×•×¤×™×œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ============================================================
// NeshamaTech - Profile Metrics Model (UPDATED)
// ×¢×“×›×•×Ÿ: ×›×•×œ×œ ×©×“×•×ª ×—×“×©×™×, ×”×¢×“×¤×•×ª ××•×¨×—×‘×•×ª, ×•×¡×™×›×•××™ AI
// ============================================================

model ProfileMetrics {
  id                    String   @id @default(cuid())
  profileId             String   @unique
  profile               Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // META - ××˜×-×“××˜×” ×¢×œ ×”×—×™×©×•×‘
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  calculatedBy          CalculatedBy @default(AI_AUTO)
  confidenceScore       Int      @default(50)  // 0-100: ×›××” ×‘×˜×•×—×™× ×‘×“×™×•×§ ×”××“×“×™×
  dataCompleteness      Int      @default(0)   // 0-100: ×›××” ××™×“×¢ ×”×™×” ×–××™×Ÿ
  lastAiAnalysisAt      DateTime?
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION A: SELF METRICS - ××™ ×× ×™ (×¦×™×•× ×™× 0-100)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  // ğŸ§  ××™×©×™×•×ª ×•××•×¤×™
  socialEnergy              Int?     // 0=××•×¤× × ×××•×“, 100=×—×‘×¨×•×ª×™ ×××•×“
  emotionalExpression       Int?     // 0=×©××•×¨ ×¨×’×©×™×ª, 100=×¤×ª×•×— ×•××‘×˜×
  stabilityVsSpontaneity    Int?     // 0=×××•×¨×’×Ÿ ×•×™×¦×™×‘, 100=×¡×¤×•× ×˜× ×™ ×•×’××™×©
  independenceLevel         Int?     // 0=××•×”×‘ ×ª××™×›×”, 100=×¢×¦×××™ ×××•×“
  optimismLevel             Int?     // 0=×¨×™××œ×™×¡×˜/×¤×¡×™××™, 100=××•×¤×˜×™××™ ×××•×“
  humorStyle                HumorStyle?
  
  // ğŸ¯ ×§×¨×™×™×¨×” ×•×›×¡×£
  careerOrientation         Int?     // 0=××™×–×•×Ÿ/××©×¤×—×”, 100=×§×¨×™×™×¨×” ××¨×›×–×™×ª
  intellectualOrientation   Int?     // 0=×”×•×× ×™/×—×™× ×•×š, 100=×¨×™××œ×™/×˜×›× ×•×œ×•×’×™
  financialApproach         Int?     // 0=×—×¡×›×Ÿ ×•×©××¨× ×™, 100=× ×“×™×‘/× ×”× ×ª×Ÿ
  ambitionLevel             Int?     // 0=×©×‘×™×¢×•×ª ×¨×¦×•×Ÿ, 100=×©××¤×ª× ×•×ª ×’×‘×•×”×”
  
  // âœ¡ï¸ ×“×ª ×•××¡×•×¨×ª
  religiousStrictness       Int?     // 0=×’××™×© ×‘×”×œ×›×”, 100=××§×¤×™×“ ×××•×“
  spiritualDepth            Int?     // 0=×¤×¨×§×˜×™/×˜×›× ×™, 100=×¨×•×—× ×™ ×•×¢××•×§
  cultureConsumption        Int?     // 0=× ×× ×¢ ××ª×¨×‘×•×ª ×›×œ×œ×™×ª, 100=×¦×•×¨×š ×‘×—×•×¤×©×™×•×ª
  
  // ğŸŒ ×¨×§×¢ ×•×–×”×•×ª
  urbanScore                Int?     // 0=×›×¤×¨×™/×™×©×•×‘×™, 100=×¢×™×¨×•× ×™ ××•×‘×”×§
  englishFluency            Int?     // 0=×œ× ×“×•×‘×¨, 100=×©×¤×ª ××
  americanCompatibility     Int?     // 0=×™×©×¨××œ×™ ××•×‘×”×§, 100=××ª××™× ×œ×××¨×™×§××™×
  ethnicBackground          EthnicBackground?
  backgroundCategory        BackgroundCategory?
  
  // ğŸ’‘ ×–×•×’×™×•×ª ×•××©×¤×—×”
  togetherVsAutonomy        Int?     // 0=×¦×¨×™×š ×¢×¦×××•×ª, 100=×¨×•×¦×” ×”×›×œ ×‘×™×—×“
  familyInvolvement         Int?     // 0=×¢×¦×××™ ××”×•×¨×™×, 100=××©×¤×—×” ××¢×•×¨×‘×ª
  parenthoodPriority        Int?     // 0=×œ× ××¨×›×–×™, 100=×™×œ×“×™× ×‘××¨×›×–
  growthVsAcceptance        Int?     // 0=×§×‘×œ×” ××œ××”, 100=××ª×’×•×¨ ×•×¦××™×—×”
  
  // ğŸ• ×¡×’× ×•×Ÿ ×—×™×™×
  nightOwlScore             Int?     // 0=×‘×•×§×¨, 100=×œ×™×œ×”
  adventureScore            Int?     // 0=×©×’×¨×” ×•×™×¦×™×‘×•×ª, 100=×”×¨×¤×ª×§× ×•×ª
  petsAttitude              PetsAttitude?
  
  // ğŸ’¬ ×ª×§×©×•×¨×ª ×•×”×ª××•×“×“×•×ª
  communicationStyle        CommunicationStyle?
  conflictStyle             ConflictStyle?
  supportStyle              SupportStyle?
  
  // ğŸ‘€ ×‘×¨×¨× ×•×ª
  appearancePickiness       Int?     // 0=×œ× ××§×¤×™×“ ×¢×œ ××¨××”, 100=×××•×“ ××§×¤×™×“
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ†• SECTION A.2: NEW SELF METRICS - ××“×“×™× ×—×“×©×™×
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  // ğŸ’° ×¨××” ×¡×•×¦×™×•-××§×•× ×•××™×ª
  socioEconomicLevel        Int?     // 0=× ××•×š, 50=×‘×™× ×•× ×™, 100=×’×‘×•×”
  
  // ğŸ’¼ ×¨××ª ×‘×›×™×¨×•×ª ×‘×¢×‘×•×“×”
  jobSeniorityLevel         Int?     // 0=×–×•×˜×¨/×¡×˜×•×“× ×˜, 50=×‘×™× ×•× ×™, 100=×‘×›×™×¨/× ×™×”×•×œ×™
  
  // ğŸ“ ×¨××ª ×”×©×›×œ×” (×¦×™×•×Ÿ ××¡×¤×¨×™)
  educationLevelScore       Int?     // 0=×ª×™×›×•× ×™×ª, 25=×œ×™××•×“×™×, 50=×ª×•××¨ ×¨××©×•×Ÿ, 75=×ª×•××¨ ×©× ×™, 100=×“×•×§×˜×•×¨×˜
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION B: PREFERENCE METRICS - ××” ×× ×™ ××—×¤×©/×ª
  // ×œ×›×œ ××“×“: Min, Max, Weight (0-10)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  // ××™×©×™×•×ª ××‘×•×§×©×ª
  prefSocialEnergyMin            Int?  @default(0)
  prefSocialEnergyMax            Int?  @default(100)
  prefSocialEnergyWeight         Int?  @default(5)
  
  prefEmotionalExpressionMin     Int?  @default(0)
  prefEmotionalExpressionMax     Int?  @default(100)
  prefEmotionalExpressionWeight  Int?  @default(5)
  
  prefStabilityMin               Int?  @default(0)
  prefStabilityMax               Int?  @default(100)
  prefStabilityWeight            Int?  @default(5)
  
  // ×“×ª
  prefReligiousStrictnessMin     Int?  @default(0)
  prefReligiousStrictnessMax     Int?  @default(100)
  prefReligiousStrictnessWeight  Int?  @default(8)
  
  prefSpiritualDepthMin          Int?  @default(0)
  prefSpiritualDepthMax          Int?  @default(100)
  prefSpiritualDepthWeight       Int?  @default(5)
  
  // ×§×¨×™×™×¨×” ×•×›×œ×›×œ×”
  prefCareerOrientationMin       Int?  @default(0)
  prefCareerOrientationMax       Int?  @default(100)
  prefCareerOrientationWeight    Int?  @default(5)
  
  prefAmbitionMin                Int?  @default(0)
  prefAmbitionMax                Int?  @default(100)
  prefAmbitionWeight             Int?  @default(4)
  
  prefFinancialMin               Int?  @default(0)
  prefFinancialMax               Int?  @default(100)
  prefFinancialWeight            Int?  @default(4)
  
  // ×¡×’× ×•×Ÿ ×—×™×™×
  prefUrbanScoreMin              Int?  @default(0)
  prefUrbanScoreMax              Int?  @default(100)
  prefUrbanScoreWeight           Int?  @default(4)
  
  prefAdventureScoreMin          Int?  @default(0)
  prefAdventureScoreMax          Int?  @default(100)
  prefAdventureScoreWeight       Int?  @default(3)
  
  prefNightOwlMin                Int?  @default(0)
  prefNightOwlMax                Int?  @default(100)
  prefNightOwlWeight             Int?  @default(2)
  
  // ×–×•×’×™×•×ª
  prefTogetherVsAutonomyMin      Int?  @default(0)
  prefTogetherVsAutonomyMax      Int?  @default(100)
  prefTogetherVsAutonomyWeight   Int?  @default(5)
  
  prefFamilyInvolvementMin       Int?  @default(0)
  prefFamilyInvolvementMax       Int?  @default(100)
  prefFamilyInvolvementWeight    Int?  @default(4)
  
  prefGrowthVsAcceptanceMin      Int?  @default(0)
  prefGrowthVsAcceptanceMax      Int?  @default(100)
  prefGrowthVsAcceptanceWeight   Int?  @default(3)
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ†• SECTION B.2: NEW PREFERENCE METRICS - ×”×¢×“×¤×•×ª ×—×“×©×•×ª
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  // ×¨××” ×¡×•×¦×™×•-××§×•× ×•××™×ª ××‘×•×§×©×ª
  prefSocioEconomicMin           Int?  @default(0)
  prefSocioEconomicMax           Int?  @default(100)
  prefSocioEconomicWeight        Int?  @default(5)
  
  // ×¨××ª ×‘×›×™×¨×•×ª ××‘×•×§×©×ª
  prefJobSeniorityMin            Int?  @default(0)
  prefJobSeniorityMax            Int?  @default(100)
  prefJobSeniorityWeight         Int?  @default(4)
  
  // ×¨××ª ×”×©×›×œ×” ××‘×•×§×©×ª
  prefEducationLevelMin          Int?  @default(0)
  prefEducationLevelMax          Int?  @default(100)
  prefEducationLevelWeight       Int?  @default(5)
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION C: DEAL BREAKERS - ×§×•×•×™× ××“×•××™×
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  // Deal Breakers ×§×©×™×—×™× - ×¤×•×¡×œ×™× ××™×™×“×™×ª
  dealBreakersHard               Json?    @default("[]")
  
  // Deal Breakers ×¨×›×™× - ××•×¨×™×“×™× ×¦×™×•×Ÿ
  dealBreakersSoft               Json?    @default("[]")
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION D: INFERRED TRAITS - ×ª×›×•× ×•×ª ×©× ×’×–×¨×•
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  inferredPersonalityType        PersonalityType?
  inferredAttachmentStyle        AttachmentStyle?
  inferredLoveLanguages          Json?    @default("[]")
  inferredRelationshipGoals      Json?    @default("{}")
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ†• SECTION E: INFERRED HARD DATA - ×¢×¨×›×™× ×§×©×™× ×©×”-AI ××©×œ×™×
  // ×›×©×”× ×ª×•×Ÿ ×—×¡×¨ ×‘-Profile, ×”-AI ×× ×—×©
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  inferredAge                    Int?              // ×× birthDate ×—×¡×¨
  inferredCity                   String?           // ×× city ×—×¡×¨
  inferredReligiousLevel         String?           // ×× religiousLevel ×—×¡×¨
  inferredPreferredAgeMin        Int?              // ×× preferredAgeMin ×—×¡×¨
  inferredPreferredAgeMax        Int?              // ×× preferredAgeMax ×—×¡×¨
  inferredPreferredReligiousLevels Json? @default("[]")  // ×× preferredReligiousLevels ×—×¡×¨
  inferredParentStatus           String?           // ×× parentStatus ×—×¡×¨
  inferredEducationLevel         String?           // ×× educationLevel ×—×¡×¨
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION F: AI ANALYSIS - ×¡×™×›×•××™ AI
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  // ×”×¡×‘×¨ ××¤×•×¨×˜ ×œ×›×œ ××“×“
  metricsExplanations            Json?    @default("{}")
  
  // ×¡×™×›×•× AI ×©×œ ×”××™×©×™×•×ª (3 ××©×¤×˜×™×)
  aiPersonalitySummary           String?  @db.Text
  
  // ×¡×™×›×•× AI ×©×œ ××” ××—×¤×© (3 ××©×¤×˜×™×)
  aiSeekingSummary               String?  @db.Text
  
  // ğŸ†• ×¡×™×›×•× AI ×©×œ ×”×¨×§×¢ (3 ××©×¤×˜×™×)
  aiBackgroundSummary            String?  @db.Text
  
  // ğŸ†• ×”× ×—×™×•×ª AI ×œ×©×“×›×Ÿ (3 ××©×¤×˜×™×)
  aiMatchmakerGuidelines         String?  @db.Text
  
  // ğŸ†• ×§×•×•×™ ××“×•× ×©×”-AI ×”×¡×™×§
  aiInferredDealBreakers         Json?    @default("[]")
  
  // ğŸ†• ×—×•×‘×•×ª ×©×”-AI ×”×¡×™×§
  aiInferredMustHaves            Json?    @default("[]")
  
  // ×“×’×œ×™ ×§×•×©×™
  difficultyFlags                Json?    @default("[]")
  
  @@index([profileId])
  @@index([calculatedBy])
  @@index([confidenceScore])
  @@map("profile_metrics")
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ProfileVector - ×¢×“×›×•×Ÿ ×œ×ª××™×›×” ×‘×©× ×™ ×•×§×˜×•×¨×™×
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ×”×¢×¨×”: ×™×© ×œ×¢×“×›×Ÿ ××ª ×”×˜×‘×œ×” ×”×§×™×™××ª profile_vectors
// ×œ×”×•×¡×™×£ ××ª ×”×©×“×•×ª ×”×—×“×©×™×

// ALTER TABLE "profile_vectors" 
// ADD COLUMN "selfVector" vector(768),
// ADD COLUMN "seekingVector" vector(768),
// ADD COLUMN "selfVectorUpdatedAt" TIMESTAMP,
// ADD COLUMN "seekingVectorUpdatedAt" TIMESTAMP;

// -- ×”×¢×ª×§×ª ×”×•×§×˜×•×¨ ×”×§×™×™× ×œ×©×“×” selfVector (×›× ×§×•×“×ª ×”×ª×—×œ×”)
// UPDATE "profile_vectors" 
// SET "selfVector" = vector,
//     "selfVectorUpdatedAt" = "updatedAt"
// WHERE vector IS NOT NULL;


model ProfileVector {
  id                    String   @id @default(cuid())
  profileId             String   @unique
  profile               Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
 
  // ×•×§×˜×•×¨ ××•×¨×©×ª (×œ×ª××™××•×ª ×œ××—×•×¨)
  vector                Unsupported("vector(3072)")?    // â† ×©× ×” ×-768
 
  // ×•×§×˜×•×¨×™× ×—×“×©×™×
  selfVector            Unsupported("vector(3072)")?    // â† ×©× ×” ×-768
  seekingVector         Unsupported("vector(3072)")?    // â† ×©× ×” ×-768

  selfVectorUpdatedAt   DateTime?
  seekingVectorUpdatedAt DateTime?

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("profile_vectors")
}

// ============================================
// Device Tokens for Mobile Push Notifications
// ============================================
model DeviceToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  platform  String   // 'ios' or 'android'
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
}