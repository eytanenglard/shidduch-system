################################################################################
# Directory Content Map For: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches
# Generated on: 2026-01-25 20:18:35
# Filter: Only content of code files (.bat, .c, .cfg, .conf, .cpp, .cs, .css, .go, .h, .html, .ini, .java, .js, .json, .jsx, .kt, .less, .md, .php, .py, .rb, .rs, .scss, .sh, .sql, .swift, .ts, .tsx, .txt, .xml, .yaml, .yml) is included.
################################################################################

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches\HiddenCandidatesDrawer.tsx
--------------------------------------------------------------------------------
Content:
// src/components/matchmaker/new/PotentialMatches/HiddenCandidatesDrawer.tsx

'use client';

import React, { useState } from 'react';
import Image from 'next/image';
import { motion, AnimatePresence } from 'framer-motion';
import {
  Sheet,
  SheetContent,
  SheetHeader,
  SheetTitle,
  SheetTrigger,
  SheetDescription,
} from '@/components/ui/sheet';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Input } from '@/components/ui/input';
import { ScrollArea } from '@/components/ui/scroll-area';
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from '@/components/ui/tooltip';
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog';
import {
  EyeOff,
  Undo2,
  Calendar,
  MapPin,
  User,
  Edit2,
  Check,
  X,
  Loader2,
  Users,
} from 'lucide-react';
import { cn, getRelativeCloudinaryPath } from '@/lib/utils';
import { formatDistanceToNow } from 'date-fns';
import { he } from 'date-fns/locale';
import type { HiddenCandidateInfo } from './hooks/useHiddenCandidates';

// =============================================================================
// TYPES
// =============================================================================

interface HiddenCandidatesDrawerProps {
  hiddenCandidates: HiddenCandidateInfo[];
  onUnhide: (hiddenRecordId: string) => Promise<boolean>;
  onUpdateReason: (hiddenRecordId: string, reason: string) => Promise<boolean>;
  isLoading?: boolean;
  className?: string;
}

// =============================================================================
// SUB-COMPONENTS
// =============================================================================

// ×›×¨×˜×™×¡ ××•×¢××“ ××•×¡×ª×¨ ×‘×•×“×“
const HiddenCandidateCard: React.FC<{
  candidate: HiddenCandidateInfo;
  onUnhide: () => void;
  onUpdateReason: (reason: string) => void;
  isUnhiding: boolean;
}> = ({ candidate, onUnhide, onUpdateReason, isUnhiding }) => {
  const [isEditingReason, setIsEditingReason] = useState(false);
  const [editedReason, setEditedReason] = useState(candidate.reason || '');
  const [showConfirmDialog, setShowConfirmDialog] = useState(false);

  const handleSaveReason = () => {
    onUpdateReason(editedReason);
    setIsEditingReason(false);
  };

  const genderIcon = candidate.candidate.gender === 'MALE' ? 'ğŸ‘¨' : 'ğŸ‘©';
  const borderColor =
    candidate.candidate.gender === 'MALE'
      ? 'border-blue-200 hover:border-blue-300'
      : 'border-pink-200 hover:border-pink-300';

  return (
    <>
      <motion.div
        layout
        initial={{ opacity: 0, x: 20 }}
        animate={{ opacity: 1, x: 0 }}
        exit={{ opacity: 0, x: -20 }}
        className={cn(
          'relative p-3 rounded-xl border-2 bg-white/80 backdrop-blur-sm transition-all duration-200',
          borderColor
        )}
      >
        <div className="flex items-start gap-3">
          {/* ×ª××•× ×” */}
          <div className="relative w-12 h-12 rounded-full overflow-hidden border-2 border-white shadow-sm flex-shrink-0">
            {candidate.candidate.mainImage ? (
              <Image
                src={getRelativeCloudinaryPath(candidate.candidate.mainImage)}
                alt={`${candidate.candidate.firstName} ${candidate.candidate.lastName}`}
                fill
                className="object-cover"
              />
            ) : (
              <div className="w-full h-full bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center text-lg">
                {genderIcon}
              </div>
            )}
          </div>

          {/* ×¤×¨×˜×™× */}
          <div className="flex-1 min-w-0">
            <h4 className="font-semibold text-gray-800 truncate">
              {candidate.candidate.firstName} {candidate.candidate.lastName}
            </h4>

            <div className="flex items-center gap-2 text-xs text-gray-500 mt-0.5">
              {candidate.candidate.city && (
                <span className="flex items-center gap-0.5">
                  <MapPin className="w-3 h-3" />
                  {candidate.candidate.city}
                </span>
              )}
            </div>

            {/* ×¡×™×‘×ª ×”×¡×ª×¨×” */}
            <div className="mt-2">
              {isEditingReason ? (
                <div className="flex items-center gap-1">
                  <Input
                    value={editedReason}
                    onChange={(e) => setEditedReason(e.target.value)}
                    placeholder="×¡×™×‘×” ×œ×”×¡×ª×¨×”..."
                    className="h-7 text-xs flex-1"
                    autoFocus
                  />
                  <Button
                    variant="ghost"
                    size="icon"
                    className="h-7 w-7 text-green-600 hover:bg-green-50"
                    onClick={handleSaveReason}
                  >
                    <Check className="w-3.5 h-3.5" />
                  </Button>
                  <Button
                    variant="ghost"
                    size="icon"
                    className="h-7 w-7 text-gray-400 hover:bg-gray-100"
                    onClick={() => {
                      setIsEditingReason(false);
                      setEditedReason(candidate.reason || '');
                    }}
                  >
                    <X className="w-3.5 h-3.5" />
                  </Button>
                </div>
              ) : (
                <div className="flex items-center gap-1">
                  {candidate.reason ? (
                    <Badge
                      variant="secondary"
                      className="text-[10px] bg-amber-50 text-amber-700 border border-amber-200"
                    >
                      {candidate.reason}
                    </Badge>
                  ) : (
                    <span className="text-[10px] text-gray-400 italic">
                      ×œ×œ× ×¡×™×‘×”
                    </span>
                  )}
                  <TooltipProvider>
                    <Tooltip>
                      <TooltipTrigger asChild>
                        <Button
                          variant="ghost"
                          size="icon"
                          className="h-5 w-5 text-gray-400 hover:text-gray-600"
                          onClick={() => setIsEditingReason(true)}
                        >
                          <Edit2 className="w-3 h-3" />
                        </Button>
                      </TooltipTrigger>
                      <TooltipContent>
                        <p>×¢×¨×•×š ×¡×™×‘×”</p>
                      </TooltipContent>
                    </Tooltip>
                  </TooltipProvider>
                </div>
              )}
            </div>

            {/* ×ª××¨×™×š ×”×¡×ª×¨×” */}
            <div className="flex items-center gap-1 text-[10px] text-gray-400 mt-1">
              <Calendar className="w-3 h-3" />
              ×”×•×¡×ª×¨{' '}
              {formatDistanceToNow(new Date(candidate.hiddenAt), {
                addSuffix: true,
                locale: he,
              })}
            </div>
          </div>

          {/* ×›×¤×ª×•×¨ ×”×—×–×¨×” */}
          <TooltipProvider>
            <Tooltip>
              <TooltipTrigger asChild>
                <Button
                  variant="outline"
                  size="icon"
                  className="h-9 w-9 rounded-full border-2 border-green-200 text-green-600 hover:bg-green-50 hover:border-green-300 transition-all flex-shrink-0"
                  onClick={() => setShowConfirmDialog(true)}
                  disabled={isUnhiding}
                >
                  {isUnhiding ? (
                    <Loader2 className="w-4 h-4 animate-spin" />
                  ) : (
                    <Undo2 className="w-4 h-4" />
                  )}
                </Button>
              </TooltipTrigger>
              <TooltipContent>
                <p>×”×—×–×¨ ×œ×¨×©×™××ª ×”×”×¦×¢×•×ª</p>
              </TooltipContent>
            </Tooltip>
          </TooltipProvider>
        </div>
      </motion.div>

      {/* ×“×™××œ×•×’ ××™×©×•×¨ */}
      <AlertDialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>
              ×œ×”×—×–×™×¨ ××ª {candidate.candidate.firstName} ×œ×¨×©×™××”?
            </AlertDialogTitle>
            <AlertDialogDescription>
              ×”×”×¦×¢×•×ª ×”×¤×•×˜× ×¦×™××œ×™×•×ª ×¢× {candidate.candidate.firstName}{' '}
              {candidate.candidate.lastName} ×™×—×–×¨×• ×œ×”×•×¤×™×¢ ×‘×¨×©×™××”.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>×‘×™×˜×•×œ</AlertDialogCancel>
            <AlertDialogAction
              onClick={onUnhide}
              className="bg-green-600 hover:bg-green-700"
            >
              ×”×—×–×¨ ×œ×¨×©×™××”
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </>
  );
};

// =============================================================================
// MAIN COMPONENT
// =============================================================================

const HiddenCandidatesDrawer: React.FC<HiddenCandidatesDrawerProps> = ({
  hiddenCandidates,
  onUnhide,
  onUpdateReason,
  isLoading = false,
  className,
}) => {
  const [unhidingId, setUnhidingId] = useState<string | null>(null);
  const [isOpen, setIsOpen] = useState(false);

  const handleUnhide = async (hiddenRecordId: string) => {
    setUnhidingId(hiddenRecordId);
    const success = await onUnhide(hiddenRecordId);
    setUnhidingId(null);

    // ×× ×–×” ×”×™×” ×”××—×¨×•×Ÿ, ×¡×’×•×¨ ××ª ×”-drawer
    if (success && hiddenCandidates.length === 1) {
      setIsOpen(false);
    }
  };

  const count = hiddenCandidates.length;

  return (
    <Sheet open={isOpen} onOpenChange={setIsOpen}>
      <SheetTrigger asChild>
        <Button
          variant="outline"
          className={cn(
            'gap-2 border-2 transition-all',
            count > 0
              ? 'border-amber-200 bg-amber-50 text-amber-700 hover:bg-amber-100 hover:border-amber-300'
              : 'border-gray-200 text-gray-500',
            className
          )}
        >
          <EyeOff className="w-4 h-4" />
          <span className="hidden sm:inline">××•×¡×ª×¨×™×</span>
          {count > 0 && (
            <Badge
              variant="secondary"
              className="bg-amber-200 text-amber-800 h-5 min-w-5 text-xs"
            >
              {count}
            </Badge>
          )}
        </Button>
      </SheetTrigger>

      <SheetContent
        side="left"
        className="w-full sm:max-w-md p-0 flex flex-col"
      >
        <SheetHeader className="p-4 pb-2 border-b bg-gradient-to-br from-amber-50 to-orange-50">
          <SheetTitle className="flex items-center gap-2 text-amber-800">
            <EyeOff className="w-5 h-5" />
            ××•×¢××“×™× ××•×¡×ª×¨×™×
            {count > 0 && (
              <Badge className="bg-amber-600 text-white">{count}</Badge>
            )}
          </SheetTitle>
          <SheetDescription className="text-amber-700/70 text-sm">
            ××•×¢××“×™× ×©×”×¡×ª×¨×ª ×œ× ×™×•×¤×™×¢×• ×‘×”×¦×¢×•×ª ×”×¤×•×˜× ×¦×™××œ×™×•×ª
          </SheetDescription>
        </SheetHeader>

        <ScrollArea className="flex-1 p-4">
          {isLoading ? (
            <div className="flex flex-col items-center justify-center py-12 text-gray-400">
              <Loader2 className="w-8 h-8 animate-spin mb-2" />
              <p className="text-sm">×˜×•×¢×Ÿ...</p>
            </div>
          ) : count === 0 ? (
            <div className="flex flex-col items-center justify-center py-12 text-gray-400">
              <Users className="w-12 h-12 mb-3 opacity-50" />
              <p className="text-sm font-medium">××™×Ÿ ××•×¢××“×™× ××•×¡×ª×¨×™×</p>
              <p className="text-xs mt-1 text-center px-4">
                ×œ×—×¥ ×¢×œ ×›×¤×ª×•×¨ ×”×”×¡×ª×¨×” ×œ×™×“ ×©× ×”××•×¢××“ ×‘×›×¨×˜×™×¡ ×”×”×¦×¢×” ×›×“×™ ×œ×”×¡×ª×™×¨ ××•×ª×•
                ×–×× ×™×ª
              </p>
            </div>
          ) : (
            <div className="space-y-3">
              <AnimatePresence mode="popLayout">
                {hiddenCandidates.map((candidate) => (
                  <HiddenCandidateCard
                    key={candidate.id}
                    candidate={candidate}
                    onUnhide={() => handleUnhide(candidate.id)}
                    onUpdateReason={(reason) =>
                      onUpdateReason(candidate.id, reason)
                    }
                    isUnhiding={unhidingId === candidate.id}
                  />
                ))}
              </AnimatePresence>
            </div>
          )}
        </ScrollArea>

        {/* Footer ×¢× ×˜×™×¤ */}
        {count > 0 && (
          <div className="p-3 border-t bg-gray-50 text-center">
            <p className="text-[10px] text-gray-500">
              ğŸ’¡ ×œ×—×¥ ×¢×œ ×›×¤×ª×•×¨ ×”×”×—×–×¨×” ×›×“×™ ×œ×”×¦×™×’ ×©×•×‘ ××ª ×”×”×¦×¢×•×ª ×¢× ×”××•×¢××“
            </p>
          </div>
        )}
      </SheetContent>
    </Sheet>
  );
};

export default HiddenCandidatesDrawer;
--- End of Content for HiddenCandidatesDrawer.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches\HideCandidateDialog.tsx
--------------------------------------------------------------------------------
Content:
// src/components/matchmaker/new/PotentialMatches/HideCandidateDialog.tsx

'use client';

import React, { useState } from 'react';
import Image from 'next/image';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';
import { EyeOff, Loader2 } from 'lucide-react';
import { cn, getRelativeCloudinaryPath } from '@/lib/utils';

// =============================================================================
// TYPES
// =============================================================================

export interface CandidateToHide {
  id: string;
  firstName: string;
  lastName: string;
  mainImage?: string | null;
  gender?: 'MALE' | 'FEMALE' | null;
}

interface HideCandidateDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  candidate: CandidateToHide | null;
  onConfirm: (candidateId: string, reason?: string) => Promise<boolean>;
}

// =============================================================================
// PRESET REASONS
// =============================================================================

const PRESET_REASONS = [
  { value: 'dating', label: 'ğŸ’‘ ×‘×“×™×™×˜×™× ×›×¨×’×¢' },
  { value: 'waiting', label: 'â³ ×××ª×™×Ÿ ×œ×ª×©×•×‘×”' },
  { value: 'break', label: 'â˜• ×‘×”×¤×¡×§×” ××—×™×¤×•×©×™×' },
  { value: 'not_ready', label: 'ğŸš« ×œ× ××•×›×Ÿ ×œ×”×¦×¢×•×ª' },
  { value: 'custom', label: 'âœï¸ ×¡×™×‘×” ××—×¨×ª...' },
  { value: 'none', label: 'â– ×œ×œ× ×¡×™×‘×”' },
];

// =============================================================================
// MAIN COMPONENT
// =============================================================================

const HideCandidateDialog: React.FC<HideCandidateDialogProps> = ({
  open,
  onOpenChange,
  candidate,
  onConfirm,
}) => {
  const [selectedReason, setSelectedReason] = useState<string>('none');
  const [customReason, setCustomReason] = useState('');
  const [isSubmitting, setIsSubmitting] = useState(false);

  const handleConfirm = async () => {
    if (!candidate) return;

    setIsSubmitting(true);

    // ×§×‘×™×¢×ª ×”×¡×™×‘×” ×”×¡×•×¤×™×ª
    let finalReason: string | undefined;
    if (selectedReason === 'custom' && customReason.trim()) {
      finalReason = customReason.trim();
    } else if (selectedReason !== 'none' && selectedReason !== 'custom') {
      finalReason = PRESET_REASONS.find(r => r.value === selectedReason)?.label.replace(/^[^\s]+ /, '');
    }

    const success = await onConfirm(candidate.id, finalReason);
    
    setIsSubmitting(false);

    if (success) {
      // Reset state
      setSelectedReason('none');
      setCustomReason('');
      onOpenChange(false);
    }
  };

  const handleClose = () => {
    if (!isSubmitting) {
      setSelectedReason('none');
      setCustomReason('');
      onOpenChange(false);
    }
  };

  if (!candidate) return null;

  const genderIcon = candidate.gender === 'MALE' ? 'ğŸ‘¨' : 'ğŸ‘©';

  return (
    <Dialog open={open} onOpenChange={handleClose}>
      <DialogContent className="sm:max-w-md">
        <DialogHeader>
          <DialogTitle className="flex items-center gap-2">
            <EyeOff className="w-5 h-5 text-amber-600" />
            ×”×¡×ª×¨×ª ××•×¢××“/×ª
          </DialogTitle>
          <DialogDescription>
            ×›×œ ×”×”×¦×¢×•×ª ×”×¤×•×˜× ×¦×™××œ×™×•×ª ×¢× ××•×¢××“/×ª ×–×”/×–×• ×œ× ×™×•×¤×™×¢×• ×‘×¨×©×™××”
          </DialogDescription>
        </DialogHeader>

        {/* ×¤×¨×˜×™ ×”××•×¢××“ */}
        <div className="flex items-center gap-3 p-3 rounded-lg bg-gray-50 border">
          <div className="relative w-12 h-12 rounded-full overflow-hidden border-2 border-white shadow-sm">
            {candidate.mainImage ? (
              <Image
                src={getRelativeCloudinaryPath(candidate.mainImage)}
                alt={`${candidate.firstName} ${candidate.lastName}`}
                fill
                className="object-cover"
              />
            ) : (
              <div className="w-full h-full bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center text-lg">
                {genderIcon}
              </div>
            )}
          </div>
          <div>
            <p className="font-semibold text-gray-800">
              {candidate.firstName} {candidate.lastName}
            </p>
            <p className="text-xs text-gray-500">
              ×™×•×¡×ª×¨/×ª×•×¡×ª×¨ ××›×œ ×”×”×¦×¢×•×ª ×”×¤×•×˜× ×¦×™××œ×™×•×ª
            </p>
          </div>
        </div>

        {/* ×‘×—×™×¨×ª ×¡×™×‘×” */}
        <div className="space-y-3">
          <Label className="text-sm font-medium">×¡×™×‘×” ×œ×”×¡×ª×¨×” (××•×¤×¦×™×•× ×œ×™)</Label>
          
          <RadioGroup
            value={selectedReason}
            onValueChange={setSelectedReason}
            className="grid grid-cols-2 gap-2"
          >
            {PRESET_REASONS.map((reason) => (
              <div key={reason.value}>
                <RadioGroupItem
                  value={reason.value}
                  id={reason.value}
                  className="peer sr-only"
                />
                <Label
                  htmlFor={reason.value}
                  className={cn(
                    'flex items-center justify-center rounded-lg border-2 p-2.5 text-xs cursor-pointer transition-all',
                    'hover:bg-amber-50 hover:border-amber-200',
                    'peer-data-[state=checked]:bg-amber-100 peer-data-[state=checked]:border-amber-400 peer-data-[state=checked]:text-amber-800'
                  )}
                >
                  {reason.label}
                </Label>
              </div>
            ))}
          </RadioGroup>

          {/* ×©×“×” ×¡×™×‘×” ××•×ª×××ª ××™×©×™×ª */}
          {selectedReason === 'custom' && (
            <Input
              placeholder="×”×§×œ×“ ×¡×™×‘×”..."
              value={customReason}
              onChange={(e) => setCustomReason(e.target.value)}
              className="mt-2"
              autoFocus
            />
          )}
        </div>

        <DialogFooter className="flex gap-2 sm:gap-2">
          <Button
            variant="outline"
            onClick={handleClose}
            disabled={isSubmitting}
            className="flex-1 sm:flex-none"
          >
            ×‘×™×˜×•×œ
          </Button>
          <Button
            onClick={handleConfirm}
            disabled={isSubmitting}
            className="flex-1 sm:flex-none bg-amber-600 hover:bg-amber-700 text-white gap-2"
          >
            {isSubmitting ? (
              <>
                <Loader2 className="w-4 h-4 animate-spin" />
                ××¡×ª×™×¨...
              </>
            ) : (
              <>
                <EyeOff className="w-4 h-4" />
                ×”×¡×ª×¨
              </>
            )}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
};

export default HideCandidateDialog;
--- End of Content for HideCandidateDialog.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches\MatchmakerDashboard.tsx
--------------------------------------------------------------------------------
Content:
// =============================================================================
// ğŸ“ src/components/matchmaker/new/PotentialMatches/MatchmakerDashboard.tsx
// =============================================================================

'use client';

import React, { useState, useEffect, useCallback } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import {
  Users,
  UserPlus,
  Heart,
  Bell,
  AlertTriangle,
  Clock,
  RefreshCw,
  ChevronRight,
  TrendingUp,
  Calendar,
  CheckCircle,
  XCircle,
  MessageSquare,
  Sparkles,
  BarChart,
  PlayCircle, // ××™×™×§×•×Ÿ ×—×“×© ×œ×›×¤×ª×•×¨ ×”×˜×¢×™× ×”
} from 'lucide-react';

// ... (×›×œ ×”-Interfaces × ×©××¨×™× ××•×ª×• ×“×‘×¨, ××™×Ÿ ×©×™× ×•×™ ×‘-Types)
interface DashboardStats {
  totalActiveUsers: number;
  maleCount: number;
  femaleCount: number;
  newUsersThisWeek: number;
  newUsersToday: number;
  totalPotentialMatches: number;
  pendingMatches: number;
  sentSuggestions: number;
  activeMatches: number;
  matchesThisWeek: number;
  suggestionsThisWeek: number;
  acceptanceRate: number;
  usersWithNoMatches: number;
  usersWaitingLong: number;
  incompleteProfiles: number;
}

interface PriorityUserCard {
  userId: string;
  firstName: string;
  lastName: string;
  gender: 'MALE' | 'FEMALE';
  age: number | null;
  city: string | null;
  mainImage: string | null;
  priorityScore: number;
  category: 'CRITICAL' | 'HIGH' | 'MEDIUM' | 'LOW';
  isNewUser: boolean;
  isNeglected: boolean;
  hasNoPendingMatches: boolean;
  daysSinceRegistration: number;
  daysSinceLastSuggestion: number | null;
  pendingMatchesCount: number;
  profileCompleteness: number;
  tags: string[];
}

interface AlertResult {
  id: string;
  userId: string;
  type: string;
  severity: 'CRITICAL' | 'HIGH' | 'MEDIUM' | 'LOW' | 'INFO';
  title: string;
  message: string;
  createdAt: string;
  isRead: boolean;
  user?: {
    firstName: string;
    lastName: string;
    gender: string;
    mainImage: string | null;
    city: string | null;
  };
}

interface RecentActivity {
  id: string;
  type: string;
  title: string;
  description: string;
  timestamp: string;
  userId?: string;
}

interface DashboardData {
  stats: DashboardStats;
  criticalUsers: PriorityUserCard[];
  highPriorityUsers: PriorityUserCard[];
  alerts: {
    total: number;
    unread: number;
    bySeverity: {
      critical: number;
      high: number;
      medium: number;
      low: number;
      info: number;
    };
    alerts: AlertResult[];
  };
  recentActivity: RecentActivity[];
  quickActions: {
    newUsersToReview: number;
    matchesToReview: number;
    suggestionsToFollow: number;
  };
  lastScan: {
    timestamp: string | null;
    matchesFound: number;
    duration: number | null;
  } | null;
  generatedAt: string;
}

// ... (Sub-Components × ×©××¨×™× ×œ×œ× ×©×™× ×•×™: StatCard, PriorityUserCardComponent, AlertItem, ActivityItem, formatTimeAgo)

const StatCard: React.FC<{
  title: string;
  value: number | string;
  subtitle?: string;
  icon: React.ReactNode;
  color: string;
  trend?: number;
}> = ({ title, value, subtitle, icon, color, trend }) => (
  <motion.div
    initial={{ opacity: 0, y: 20 }}
    animate={{ opacity: 1, y: 0 }}
    className={`bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-shadow`}
  >
    <div className="flex items-start justify-between">
      <div>
        <p className="text-sm text-gray-500">{title}</p>
        <p className="text-2xl font-bold text-gray-800 mt-1">{value}</p>
        {subtitle && <p className="text-xs text-gray-400 mt-1">{subtitle}</p>}
        {trend !== undefined && (
          <div
            className={`flex items-center mt-2 text-xs ${trend >= 0 ? 'text-green-600' : 'text-red-600'}`}
          >
            <TrendingUp size={12} className={trend < 0 ? 'rotate-180' : ''} />
            <span className="mr-1">{Math.abs(trend)}%</span>
            <span className="text-gray-400">××”×©×‘×•×¢ ×©×¢×‘×¨</span>
          </div>
        )}
      </div>
      <div className={`p-3 rounded-xl ${color}`}>{icon}</div>
    </div>
  </motion.div>
);

const PriorityUserCardComponent: React.FC<{
  user: PriorityUserCard;
  onClick: (userId: string) => void;
}> = ({ user, onClick }) => {
  const categoryColors = {
    CRITICAL: 'bg-red-50 border-red-200',
    HIGH: 'bg-orange-50 border-orange-200',
    MEDIUM: 'bg-yellow-50 border-yellow-200',
    LOW: 'bg-green-50 border-green-200',
  };

  const categoryBadge = {
    CRITICAL: 'bg-red-500 text-white',
    HIGH: 'bg-orange-500 text-white',
    MEDIUM: 'bg-yellow-500 text-white',
    LOW: 'bg-green-500 text-white',
  };

  return (
    <motion.div
      initial={{ opacity: 0, x: -20 }}
      animate={{ opacity: 1, x: 0 }}
      whileHover={{ scale: 1.02 }}
      onClick={() => onClick(user.userId)}
      className={`p-3 rounded-lg border cursor-pointer transition-all ${categoryColors[user.category]}`}
    >
      <div className="flex items-center gap-3">
        <div className="relative">
          <div className="w-12 h-12 rounded-full bg-gray-200 overflow-hidden">
            {user.mainImage ? (
              <img
                src={user.mainImage}
                alt=""
                className="w-full h-full object-cover"
              />
            ) : (
              <div className="w-full h-full flex items-center justify-center text-gray-400">
                <Users size={20} />
              </div>
            )}
          </div>
          <div
            className={`absolute -bottom-1 -left-1 w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-bold ${categoryBadge[user.category]}`}
          >
            {user.priorityScore}
          </div>
        </div>

        <div className="flex-1 min-w-0">
          <div className="flex items-center gap-2">
            <p className="font-medium text-gray-800 truncate">
              {user.firstName} {user.lastName}
            </p>
            {user.gender === 'FEMALE' && (
              <span className="text-pink-500">â™€</span>
            )}
            {user.gender === 'MALE' && (
              <span className="text-blue-500">â™‚</span>
            )}
          </div>
          <div className="flex flex-wrap gap-1 mt-1">
            {user.tags.slice(0, 3).map((tag, idx) => (
              <span
                key={idx}
                className="text-[10px] bg-white/50 px-1.5 py-0.5 rounded"
              >
                {tag}
              </span>
            ))}
          </div>
        </div>
        <ChevronRight size={16} className="text-gray-400" />
      </div>
    </motion.div>
  );
};

const AlertItem: React.FC<{
  alert: AlertResult;
  onDismiss: (id: string) => void;
  onMarkRead: (id: string) => void;
}> = ({ alert, onDismiss, onMarkRead }) => {
  const severityColors = {
    CRITICAL: 'border-r-4 border-r-red-500 bg-red-50',
    HIGH: 'border-r-4 border-r-orange-500 bg-orange-50',
    MEDIUM: 'border-r-4 border-r-yellow-500 bg-yellow-50',
    LOW: 'border-r-4 border-r-green-500 bg-green-50',
    INFO: 'border-r-4 border-r-blue-500 bg-blue-50',
  };

  const severityIcons = {
    CRITICAL: <AlertTriangle size={16} className="text-red-500" />,
    HIGH: <AlertTriangle size={16} className="text-orange-500" />,
    MEDIUM: <Clock size={16} className="text-yellow-600" />,
    LOW: <Bell size={16} className="text-green-500" />,
    INFO: <Bell size={16} className="text-blue-500" />,
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      exit={{ opacity: 0, x: 100 }}
      className={`p-3 rounded-lg ${severityColors[alert.severity]} ${!alert.isRead ? 'font-medium' : 'opacity-80'}`}
    >
      <div className="flex items-start gap-2">
        <div className="mt-0.5">{severityIcons[alert.severity]}</div>
        <div className="flex-1 min-w-0">
          <p className="text-sm text-gray-800">{alert.title}</p>
          <p className="text-xs text-gray-600 mt-0.5 truncate">
            {alert.message}
          </p>
        </div>
        <div className="flex items-center gap-1">
          {!alert.isRead && (
            <button
              onClick={() => onMarkRead(alert.id)}
              className="p-1 hover:bg-white/50 rounded"
              title="×¡××Ÿ ×›× ×§×¨×"
            >
              <Users size={14} className="text-gray-400" />
            </button>
          )}
          <button
            onClick={() => onDismiss(alert.id)}
            className="p-1 hover:bg-white/50 rounded"
            title="×“×—×” ×”×ª×¨××”"
          >
            <XCircle size={14} className="text-gray-400" />
          </button>
        </div>
      </div>
    </motion.div>
  );
};

const ActivityItem: React.FC<{ activity: RecentActivity }> = ({ activity }) => {
  const typeConfig: Record<string, { icon: React.ReactNode; color: string }> = {
    new_user: {
      icon: <UserPlus size={14} />,
      color: 'text-green-500 bg-green-50',
    },
    new_match: { icon: <Heart size={14} />, color: 'text-pink-500 bg-pink-50' },
    suggestion_sent: {
      icon: <MessageSquare size={14} />,
      color: 'text-blue-500 bg-blue-50',
    },
    suggestion_accepted: {
      icon: <CheckCircle size={14} />,
      color: 'text-green-500 bg-green-50',
    },
    suggestion_declined: {
      icon: <XCircle size={14} />,
      color: 'text-red-500 bg-red-50',
    },
  };

  const config = typeConfig[activity.type] || typeConfig.new_user;

  return (
    <div className="flex items-center gap-3 py-2">
      <div className={`p-2 rounded-full ${config.color}`}>{config.icon}</div>
      <div className="flex-1 min-w-0">
        <p className="text-sm text-gray-700">{activity.title}</p>
        <p className="text-xs text-gray-500 truncate">{activity.description}</p>
      </div>
      <span className="text-xs text-gray-400">
        {formatTimeAgo(activity.timestamp)}
      </span>
    </div>
  );
};

function formatTimeAgo(timestamp: string): string {
  const date = new Date(timestamp);
  const now = new Date();
  const diffMs = now.getTime() - date.getTime();
  const diffMins = Math.floor(diffMs / 60000);
  const diffHours = Math.floor(diffMins / 60);
  const diffDays = Math.floor(diffHours / 24);

  if (diffMins < 1) return '×¢×›×©×™×•';
  if (diffMins < 60) return `×œ×¤× ×™ ${diffMins} ×“×§'`;
  if (diffHours < 24) return `×œ×¤× ×™ ${diffHours} ×©×¢'`;
  if (diffDays < 7) return `×œ×¤× ×™ ${diffDays} ×™××™×`;
  return date.toLocaleDateString('he-IL');
}

// =============================================================================
// MAIN COMPONENT
// =============================================================================

export default function MatchmakerDashboard() {
  const [data, setData] = useState<DashboardData | null>(null);
  const [loading, setLoading] = useState(false); // ×©×•× ×” ×œ-false ×›×‘×¨×™×¨×ª ××—×“×œ
  const [refreshing, setRefreshing] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [activeTab, setActiveTab] = useState<'priority' | 'alerts'>('priority');

  // Fetch dashboard data
  const fetchData = useCallback(async (showRefresh = false) => {
    try {
      if (showRefresh) setRefreshing(true);
      else setLoading(true);

      const response = await fetch('/api/matchmaker/dashboard');

      if (!response.ok) {
        throw new Error('Failed to fetch dashboard data');
      }

      const dashboardData = await response.json();
      setData(dashboardData);
      setError(null);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Unknown error');
    } finally {
      setLoading(false);
      setRefreshing(false);
    }
  }, []);

  // Removed immediate useEffect call.
  // Now it only runs interval if data is present.
  useEffect(() => {
    if (!data) return; // ×¨×§ ×× ×™×© ×“××˜×”, × ×¤×¢×™×œ ×˜×™×™××¨ ×œ×¨×¢× ×•×Ÿ

    // Auto refresh every 2 minutes
    const interval = setInterval(() => fetchData(true), 120000);
    return () => clearInterval(interval);
  }, [fetchData, data]);

  // Handle alert dismiss
  const handleDismissAlert = async (alertId: string) => {
    try {
      await fetch('/api/matchmaker/alerts', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'dismiss', alertId }),
      });

      // Update local state
      if (data) {
        setData({
          ...data,
          alerts: {
            ...data.alerts,
            alerts: data.alerts.alerts.filter((a) => a.id !== alertId),
            total: data.alerts.total - 1,
          },
        });
      }
    } catch (err) {
      console.error('Failed to dismiss alert:', err);
    }
  };

  // Handle mark as read
  const handleMarkRead = async (alertId: string) => {
    try {
      await fetch('/api/matchmaker/alerts', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'mark_read', alertId }),
      });

      // Update local state
      if (data) {
        setData({
          ...data,
          alerts: {
            ...data.alerts,
            alerts: data.alerts.alerts.map((a) =>
              a.id === alertId ? { ...a, isRead: true } : a
            ),
            unread: Math.max(0, data.alerts.unread - 1),
          },
        });
      }
    } catch (err) {
      console.error('Failed to mark as read:', err);
    }
  };

  // Navigate to user
  const handleUserClick = (userId: string) => {
    window.location.href = `/matchmaker/candidates/${userId}`;
  };

  // --- ××¦×‘ 1: ×¢×“×™×™×Ÿ ×œ× × ×˜×¢×Ÿ ×“××˜×” ×•×œ× ×˜×•×¢×Ÿ ×›×¨×’×¢ (Initial State) ---
  if (!data && !loading && !error) {
    return (
      <div className="flex flex-col items-center justify-center min-h-[400px] p-8 text-center space-y-6">
        <div className="p-6 bg-indigo-50 rounded-full animate-pulse-slow">
          <BarChart className="w-16 h-16 text-indigo-600" />
        </div>
        <div>
          <h2 className="text-2xl font-bold text-gray-800 mb-2">
            ×“×©×‘×•×¨×“ ×•× ×™×ª×•×— × ×ª×•× ×™×
          </h2>
          <p className="text-gray-500 max-w-md mx-auto">
            ×œ×—×¥ ×¢×œ ×”×›×¤×ª×•×¨ ×›×“×™ ×œ×˜×¢×•×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª, ×”×ª×¨××•×ª ×•××©×ª××©×™× ×‘×¢×“×™×¤×•×ª ×’×‘×•×”×”.
            ×¤×¢×•×œ×” ×–×• ××‘×¦×¢×ª × ×™×ª×•×— ××¢××™×§ ×•×œ×›×Ÿ ××™× ×” ××•×¤×¢×œ×ª ××•×˜×•××˜×™×ª.
          </p>
        </div>
        <button
          onClick={() => fetchData()}
          className="flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all text-lg font-medium"
        >
          <PlayCircle size={24} />
          ×˜×¢×Ÿ × ×ª×•× ×™ ×“×©×‘×•×¨×“
        </button>
      </div>
    );
  }

  // --- ××¦×‘ 2: ×˜×•×¢×Ÿ (Loading State) ---
  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-[400px]">
        <div className="flex flex-col items-center gap-3">
          <RefreshCw className="w-8 h-8 text-primary animate-spin" />
          <p className="text-gray-500">×˜×•×¢×Ÿ × ×ª×•× ×™× ×•×× ×ª×— ×”×ª×¨××•×ª...</p>
        </div>
      </div>
    );
  }

  // --- ××¦×‘ 3: ×©×’×™××” (Error State) ---
  if (error) {
    return (
      <div className="flex items-center justify-center min-h-[400px]">
        <div className="text-center">
          <AlertTriangle className="w-12 h-12 text-red-500 mx-auto mb-3" />
          <p className="text-red-600 font-medium">×©×’×™××” ×‘×˜×¢×™× ×ª ×”×“×©×‘×•×¨×“</p>
          <p className="text-gray-500 text-sm mt-1">{error}</p>
          <button
            onClick={() => fetchData()}
            className="mt-4 px-4 py-2 bg-primary text-white rounded-lg"
          >
            × ×¡×” ×©×•×‘
          </button>
        </div>
      </div>
    );
  }

  if (!data) return null;

  // --- ××¦×‘ 4: ×”×¦×’×ª ×”×“×©×‘×•×¨×“ (Dashboard View) ---
  return (
    <div className="space-y-6 p-4 md:p-6" dir="rtl">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
            <Sparkles className="text-primary" />
            ×“×©×‘×•×¨×“ ×©×“×›×Ÿ
          </h1>
          <p className="text-sm text-gray-500 mt-1">
            ×¢×•×“×›×Ÿ {new Date(data.generatedAt).toLocaleTimeString('he-IL')}
          </p>
        </div>
        <button
          onClick={() => fetchData(true)}
          disabled={refreshing}
          className="flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
        >
          <RefreshCw size={16} className={refreshing ? 'animate-spin' : ''} />
          <span>×¨×¢× ×Ÿ × ×ª×•× ×™×</span>
        </button>
      </div>

      {/* Stats Grid */}
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        <StatCard
          title="××©×ª××©×™× ×¤×¢×™×œ×™×"
          value={data.stats.totalActiveUsers}
          subtitle={`${data.stats.maleCount}â™‚ / ${data.stats.femaleCount}â™€`}
          icon={<Users size={20} className="text-white" />}
          color="bg-blue-500"
        />
        <StatCard
          title="×—×“×©×™× ×”×©×‘×•×¢"
          value={data.stats.newUsersThisWeek}
          subtitle={`${data.stats.newUsersToday} ×”×™×•×`}
          icon={<UserPlus size={20} className="text-white" />}
          color="bg-green-500"
        />
        <StatCard
          title="×”×ª×××•×ª ×××ª×™× ×•×ª"
          value={data.stats.pendingMatches}
          icon={<Heart size={20} className="text-white" />}
          color="bg-pink-500"
        />
        <StatCard
          title="××—×•×– ×”×¦×œ×—×”"
          value={`${data.stats.acceptanceRate}%`}
          subtitle={`${data.stats.suggestionsThisWeek} ×”×¦×¢×•×ª ×”×©×‘×•×¢`}
          icon={<TrendingUp size={20} className="text-white" />}
          color="bg-purple-500"
        />
      </div>

      {/* Quick Actions */}
      <div className="grid grid-cols-3 gap-3">
        {data.quickActions.newUsersToReview > 0 && (
          <motion.div
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            className="bg-green-50 border border-green-200 rounded-xl p-4 cursor-pointer hover:bg-green-100 transition-colors"
          >
            <div className="flex items-center gap-3">
              <div className="p-2 bg-green-500 rounded-lg">
                <UserPlus size={20} className="text-white" />
              </div>
              <div>
                <p className="text-2xl font-bold text-green-700">
                  {data.quickActions.newUsersToReview}
                </p>
                <p className="text-sm text-green-600">××©×ª××©×™× ×—×“×©×™× ×œ×‘×“×™×§×”</p>
              </div>
            </div>
          </motion.div>
        )}

        {data.quickActions.matchesToReview > 0 && (
          <motion.div
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ delay: 0.1 }}
            className="bg-pink-50 border border-pink-200 rounded-xl p-4 cursor-pointer hover:bg-pink-100 transition-colors"
          >
            <div className="flex items-center gap-3">
              <div className="p-2 bg-pink-500 rounded-lg">
                <Heart size={20} className="text-white" />
              </div>
              <div>
                <p className="text-2xl font-bold text-pink-700">
                  {data.quickActions.matchesToReview}
                </p>
                <p className="text-sm text-pink-600">×”×ª×××•×ª ×œ×‘×“×™×§×”</p>
              </div>
            </div>
          </motion.div>
        )}

        {data.quickActions.suggestionsToFollow > 0 && (
          <motion.div
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ delay: 0.2 }}
            className="bg-orange-50 border border-orange-200 rounded-xl p-4 cursor-pointer hover:bg-orange-100 transition-colors"
          >
            <div className="flex items-center gap-3">
              <div className="p-2 bg-orange-500 rounded-lg">
                <Clock size={20} className="text-white" />
              </div>
              <div>
                <p className="text-2xl font-bold text-orange-700">
                  {data.quickActions.suggestionsToFollow}
                </p>
                <p className="text-sm text-orange-600">×”×¦×¢×•×ª ×××ª×™× ×•×ª ×œ××¢×§×‘</p>
              </div>
            </div>
          </motion.div>
        )}
      </div>

      {/* Main Content Grid */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Priority Users / Alerts - Left Column */}
        <div className="lg:col-span-2 space-y-4">
          {/* Tab Selector */}
          <div className="flex gap-2 bg-gray-100 p-1 rounded-xl">
            <button
              onClick={() => setActiveTab('priority')}
              className={`flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-colors ${
                activeTab === 'priority'
                  ? 'bg-white text-gray-800 shadow-sm'
                  : 'text-gray-500 hover:text-gray-700'
              }`}
            >
              <span className="flex items-center justify-center gap-2">
                <Users size={16} />
                ××©×ª××©×™× ×œ×˜×™×¤×•×œ (
                {data.criticalUsers.length + data.highPriorityUsers.length})
              </span>
            </button>
            <button
              onClick={() => setActiveTab('alerts')}
              className={`flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-colors ${
                activeTab === 'alerts'
                  ? 'bg-white text-gray-800 shadow-sm'
                  : 'text-gray-500 hover:text-gray-700'
              }`}
            >
              <span className="flex items-center justify-center gap-2">
                <Bell size={16} />
                ×”×ª×¨××•×ª
                {data.alerts.unread > 0 && (
                  <span className="bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full">
                    {data.alerts.unread}
                  </span>
                )}
              </span>
            </button>
          </div>

          <AnimatePresence mode="wait">
            {activeTab === 'priority' ? (
              <motion.div
                key="priority"
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: -10 }}
                className="space-y-4"
              >
                {/* Critical Users */}
                {data.criticalUsers.length > 0 && (
                  <div className="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                    <h3 className="text-lg font-bold text-red-600 mb-3 flex items-center gap-2">
                      <AlertTriangle size={18} />
                      ğŸ”´ ×“×—×•×£ ({data.criticalUsers.length})
                    </h3>
                    <div className="space-y-2">
                      {data.criticalUsers.slice(0, 5).map((user) => (
                        <PriorityUserCardComponent
                          key={user.userId}
                          user={user}
                          onClick={handleUserClick}
                        />
                      ))}
                    </div>
                    {data.criticalUsers.length > 5 && (
                      <button className="w-full mt-3 text-sm text-red-600 hover:text-red-700">
                        ×”×¦×’ ×¢×•×“ {data.criticalUsers.length - 5} â†’
                      </button>
                    )}
                  </div>
                )}

                {/* High Priority Users */}
                {data.highPriorityUsers.length > 0 && (
                  <div className="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                    <h3 className="text-lg font-bold text-orange-600 mb-3 flex items-center gap-2">
                      <Clock size={18} />
                      ğŸŸ  ×¢×“×™×¤×•×ª ×’×‘×•×”×” ({data.highPriorityUsers.length})
                    </h3>
                    <div className="space-y-2">
                      {data.highPriorityUsers.slice(0, 5).map((user) => (
                        <PriorityUserCardComponent
                          key={user.userId}
                          user={user}
                          onClick={handleUserClick}
                        />
                      ))}
                    </div>
                    {data.highPriorityUsers.length > 5 && (
                      <button className="w-full mt-3 text-sm text-orange-600 hover:text-orange-700">
                        ×”×¦×’ ×¢×•×“ {data.highPriorityUsers.length - 5} â†’
                      </button>
                    )}
                  </div>
                )}

                {/* No Priority Users */}
                {data.criticalUsers.length === 0 &&
                  data.highPriorityUsers.length === 0 && (
                    <div className="bg-green-50 rounded-xl p-8 text-center">
                      <CheckCircle
                        size={48}
                        className="text-green-500 mx-auto mb-3"
                      />
                      <p className="text-green-700 font-medium">
                        ×›×œ ×”××©×ª××©×™× ××˜×•×¤×œ×™×! ğŸ‰
                      </p>
                      <p className="text-green-600 text-sm mt-1">
                        ××™×Ÿ ××©×ª××©×™× ×“×—×•×¤×™× ×›×¨×’×¢
                      </p>
                    </div>
                  )}
              </motion.div>
            ) : (
              <motion.div
                key="alerts"
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: -10 }}
                className="bg-white rounded-xl p-4 shadow-sm border border-gray-100"
              >
                {/* Alerts Summary */}
                <div className="flex items-center gap-4 mb-4 pb-4 border-b">
                  <div className="flex items-center gap-2 text-sm">
                    <span className="w-3 h-3 bg-red-500 rounded-full" />
                    <span>{data.alerts.bySeverity.critical} ×§×¨×™×˜×™</span>
                  </div>
                  <div className="flex items-center gap-2 text-sm">
                    <span className="w-3 h-3 bg-orange-500 rounded-full" />
                    <span>{data.alerts.bySeverity.high} ×’×‘×•×”</span>
                  </div>
                  <div className="flex items-center gap-2 text-sm">
                    <span className="w-3 h-3 bg-yellow-500 rounded-full" />
                    <span>{data.alerts.bySeverity.medium} ×‘×™× ×•× ×™</span>
                  </div>
                </div>

                {/* Alerts List */}
                <div className="space-y-2 max-h-[400px] overflow-y-auto">
                  <AnimatePresence>
                    {data.alerts.alerts.slice(0, 10).map((alert) => (
                      <AlertItem
                        key={alert.id}
                        alert={alert}
                        onDismiss={handleDismissAlert}
                        onMarkRead={handleMarkRead}
                      />
                    ))}
                  </AnimatePresence>

                  {data.alerts.alerts.length === 0 && (
                    <div className="text-center py-8 text-gray-500">
                      <Bell size={32} className="mx-auto mb-2 opacity-50" />
                      <p>××™×Ÿ ×”×ª×¨××•×ª ×—×“×©×•×ª</p>
                    </div>
                  )}
                </div>
              </motion.div>
            )}
          </AnimatePresence>
        </div>

        {/* Right Column - Activity & Info */}
        <div className="space-y-4">
          {/* Last Scan Info */}
          {data.lastScan && (
            <div className="bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl p-4 border border-primary/20">
              <h3 className="font-medium text-gray-700 mb-2 flex items-center gap-2">
                <Calendar size={16} />
                ×¡×¨×™×§×” ××—×¨×•× ×”
              </h3>
              <div className="space-y-1 text-sm">
                {data.lastScan.timestamp && (
                  <p className="text-gray-600">
                    {new Date(data.lastScan.timestamp).toLocaleString('he-IL')}
                  </p>
                )}
                <p className="text-gray-600">
                  × ××¦××• {data.lastScan.matchesFound} ×”×ª×××•×ª ×—×“×©×•×ª
                </p>
                {data.lastScan.duration && (
                  <p className="text-gray-500 text-xs">
                    ××©×š: {(data.lastScan.duration / 1000 / 60).toFixed(1)} ×“×§×•×ª
                  </p>
                )}
              </div>
            </div>
          )}

          {/* Recent Activity */}
          <div className="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
            <h3 className="font-medium text-gray-700 mb-3 flex items-center gap-2">
              <Clock size={16} />
              ×¤×¢×™×œ×•×ª ××—×¨×•× ×”
            </h3>
            <div className="divide-y">
              {data.recentActivity.slice(0, 6).map((activity) => (
                <ActivityItem key={activity.id} activity={activity} />
              ))}

              {data.recentActivity.length === 0 && (
                <p className="text-gray-400 text-sm text-center py-4">
                  ××™×Ÿ ×¤×¢×™×œ×•×ª ××—×¨×•× ×”
                </p>
              )}
            </div>
          </div>

          {/* Problems Summary */}
          <div className="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
            <h3 className="font-medium text-gray-700 mb-3 flex items-center gap-2">
              <AlertTriangle size={16} />
              ×‘×¢×™×•×ª ×œ×˜×™×¤×•×œ
            </h3>
            <div className="space-y-2">
              {data.stats.usersWaitingLong > 0 && (
                <div className="flex items-center justify-between p-2 bg-orange-50 rounded-lg">
                  <span className="text-sm text-orange-700">
                    ×××ª×™× ×™× 10+ ×™××™×
                  </span>
                  <span className="font-bold text-orange-600">
                    {data.stats.usersWaitingLong}
                  </span>
                </div>
              )}
              {data.stats.usersWithNoMatches > 0 && (
                <div className="flex items-center justify-between p-2 bg-yellow-50 rounded-lg">
                  <span className="text-sm text-yellow-700">×œ×œ× ×”×ª×××•×ª</span>
                  <span className="font-bold text-yellow-600">
                    {data.stats.usersWithNoMatches}
                  </span>
                </div>
              )}
              {data.stats.incompleteProfiles > 0 && (
                <div className="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                  <span className="text-sm text-gray-700">×¤×¨×•×¤×™×œ×™× ×—×œ×§×™×™×</span>
                  <span className="font-bold text-gray-600">
                    {data.stats.incompleteProfiles}
                  </span>
                </div>
              )}
              {data.stats.usersWaitingLong === 0 &&
                data.stats.usersWithNoMatches === 0 &&
                data.stats.incompleteProfiles === 0 && (
                  <p className="text-green-600 text-sm text-center py-2">
                    âœ… ××™×Ÿ ×‘×¢×™×•×ª ×›×¨×’×¢
                  </p>
                )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
--- End of Content for MatchmakerDashboard.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches\PotentialMatchCard.tsx
--------------------------------------------------------------------------------
Content:
// src/components/matchmaker/new/PotentialMatches/PotentialMatchCard.tsx

'use client';

import React, { useState } from 'react';
import Image from 'next/image';
import { motion } from 'framer-motion';
import { Card } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Checkbox } from '@/components/ui/checkbox';
import type { CandidateToHide } from './HideCandidateDialog';

import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from '@/components/ui/tooltip';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import {
  AlertTriangle,
  Heart,
  HeartHandshake,
  MapPin,
  EyeOff,
  Bookmark,
  Eye,
  MoreHorizontal,
  Send,
  X,
  Brain,
  Calendar,
  Sparkles,
  Clock,
  UserCheck,
  ChevronDown,
  ChevronUp,
  ExternalLink,
  Undo,
  MessageCircle, // WhatsApp
  Mail, // Email/Feedback
} from 'lucide-react';
import { cn, getRelativeCloudinaryPath } from '@/lib/utils';
import { formatDistanceToNow } from 'date-fns';
import { he } from 'date-fns/locale';
import type { PotentialMatch, ScoreBreakdown } from './types/potentialMatches';

// --- New Integration: Rejection Feedback ---
import RejectionFeedbackModal, {
  useRejectionFeedback,
} from './RejectionFeedbackModal';

// =============================================================================
// TYPES
// =============================================================================

interface PotentialMatchCardProps {
  match: PotentialMatch;
  onCreateSuggestion: (matchId: string) => void;
  onDismiss: (matchId: string) => void;
  onReview: (matchId: string) => void;
  onRestore: (matchId: string) => void;
  onSave: (matchId: string) => void;
  onViewProfile: (userId: string) => void;

  // New Action Callbacks
  onAnalyzeCandidate: (candidate: any) => void;
  onProfileFeedback: (candidate: any) => void;

  isSelected?: boolean;
  onToggleSelect?: (matchId: string) => void;
  showSelection?: boolean;
  className?: string;
  onHideCandidate: (candidate: CandidateToHide) => void;
  hiddenCandidateIds?: Set<string>;
}

// =============================================================================
// HELPER FUNCTIONS
// =============================================================================

const getScoreColor = (score: number): string => {
  if (score >= 85) return 'text-emerald-600';
  if (score >= 75) return 'text-blue-600';
  if (score >= 70) return 'text-amber-600';
  return 'text-gray-600';
};

const getScoreBgColor = (score: number): string => {
  if (score >= 85) return 'from-emerald-500 to-green-500';
  if (score >= 75) return 'from-blue-500 to-cyan-500';
  if (score >= 70) return 'from-amber-500 to-yellow-500';
  return 'from-gray-500 to-slate-500';
};

const getStatusBadge = (status: string) => {
  switch (status) {
    case 'PENDING':
      return {
        label: '×××ª×™×Ÿ',
        color: 'bg-yellow-100 text-yellow-700',
        icon: Clock,
      };
    case 'REVIEWED':
      return { label: '× ×‘×“×§', color: 'bg-blue-100 text-blue-700', icon: Eye };
    case 'SENT':
      return {
        label: '× ×©×œ×—×” ×”×¦×¢×”',
        color: 'bg-green-100 text-green-700',
        icon: Send,
      };
    case 'DISMISSED':
      return { label: '× ×“×—×”', color: 'bg-gray-100 text-gray-700', icon: X };
    case 'SHORTLISTED':
      return {
        label: '×©××•×¨ ×‘×¦×“',
        color: 'bg-purple-100 text-purple-700',
        icon: Bookmark,
      };
    default:
      return { label: status, color: 'bg-gray-100 text-gray-700', icon: Clock };
  }
};

const getReligiousLevelLabel = (level: string | null): string => {
  if (!level) return '×œ× ×¦×•×™×Ÿ';
  const labels: Record<string, string> = {
    dati_leumi_torani: '×“×ª×™ ×œ××•××™ ×ª×•×¨× ×™',
    dati_leumi_standard: '×“×ª×™ ×œ××•××™',
    dati_leumi_liberal: '×“×ª×™ ×œ××•××™ ×œ×™×‘×¨×œ×™',
    charedi_modern: '×—×¨×“×™ ××•×“×¨× ×™',
    masorti_strong: '××¡×•×¨×ª×™ ×—×–×§',
    masorti_light: '××¡×•×¨×ª×™',
    secular_traditional_connection: '×—×™×œ×•× ×™ ×¢× ×§×©×¨ ×œ××¡×•×¨×ª',
    secular: '×—×™×œ×•× ×™',
  };
  return labels[level] || level;
};

// =============================================================================
// SUB-COMPONENTS
// =============================================================================

// ×›×¨×˜×™×¡ ××•×¢××“ ×‘×•×“×“ (×‘×ª×•×š ×”×–×•×’)
const CandidatePreview: React.FC<{
  candidate: any;
  gender: 'male' | 'female';
  activeSuggestion: any;
  onViewProfile: () => void;
  onAnalyze: () => void;
  onFeedback: () => void;
  onHide: (candidate: CandidateToHide) => void;
}> = ({
  candidate,
  gender,
  activeSuggestion,
  onViewProfile,
  onAnalyze,
  onFeedback,
  onHide,
}) => {
  const genderIcon = gender === 'male' ? 'ğŸ‘¨' : 'ğŸ‘©';
  const borderColor = gender === 'male' ? 'border-blue-200' : 'border-pink-200';
  const bgGradient =
    gender === 'male' ? 'from-blue-50 to-cyan-50' : 'from-pink-50 to-rose-50';

  const handleWhatsApp = (e: React.MouseEvent) => {
    e.stopPropagation();

    let cleanPhone = candidate.phone?.replace(/\D/g, '') || '';
    if (cleanPhone.startsWith('0')) {
      cleanPhone = '972' + cleanPhone.substring(1);
    }

    if (cleanPhone) {
      const message = `×”×™×™ ${candidate.firstName} ×–×” ××™×ª×Ÿ ×× ×©××”×˜×§. ×× ×™ ×××•×“ ×©××— ×©× ×¨×©××ª ×œ××¢×¨×›×ª ×©×œ× ×• ×•×× ×™ ××§×•×•×” ×××•×“ ×œ×¢×–×•×¨ ×œ×š ×œ××¦×•× ××ª ×”×–×•×’×™×•×ª ×©×ª××™×“ ×—×œ××ª ×¢×œ×™×”`;
      const encodedMessage = encodeURIComponent(message);
      window.open(
        `https://wa.me/${cleanPhone}?text=${encodedMessage}`,
        '_blank'
      );
    }
  };

  return (
    <div
      className={cn(
        'relative flex-1 p-3 rounded-xl border-2 transition-all duration-300 hover:shadow-md flex flex-col',
        borderColor,
        `bg-gradient-to-br ${bgGradient}`
      )}
      onClick={onViewProfile}
    >
      <div className="flex-1 cursor-pointer">
        <div className="relative w-16 h-16 mx-auto mb-2 rounded-full overflow-hidden border-2 border-white shadow-md">
          {candidate.mainImage ? (
            <Image
              src={getRelativeCloudinaryPath(candidate.mainImage)}
              alt={`${candidate.firstName} ${candidate.lastName}`}
              fill
              className="object-cover"
            />
          ) : (
            <div className="w-full h-full bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center text-xl">
              {genderIcon}
            </div>
          )}

          {candidate.isVerified && (
            <div className="absolute -bottom-1 -right-1 w-5 h-5 bg-emerald-500 rounded-full flex items-center justify-center border-2 border-white">
              <UserCheck className="w-3 h-3 text-white" />
            </div>
          )}
        </div>

        <h4 className="text-center font-bold text-gray-800 text-sm mb-1 truncate">
          {candidate.firstName} {candidate.lastName}
        </h4>

        <div className="flex items-center justify-center gap-2 text-xs text-gray-600 mb-1">
          <span>{candidate.age}</span>
          {candidate.city && (
            <>
              <span>â€¢</span>
              <span className="flex items-center gap-0.5 truncate max-w-[80px]">
                <MapPin className="w-3 h-3" />
                {candidate.city}
              </span>
            </>
          )}
        </div>

        <div className="text-center text-[10px] text-gray-500 mb-1 truncate px-1">
          {getReligiousLevelLabel(candidate.religiousLevel)}
        </div>
      </div>

      {/* Actions */}
      <div className="mt-2 pt-2 border-t border-gray-200/50 flex items-center justify-center gap-2">
        {candidate.phone && (
          <TooltipProvider>
            <Tooltip>
              <TooltipTrigger asChild>
                <Button
                  variant="ghost"
                  size="icon"
                  className="h-7 w-7 rounded-full bg-white/60 hover:bg-green-100 hover:text-green-600 shadow-sm border border-transparent hover:border-green-200 transition-all"
                  onClick={handleWhatsApp}
                >
                  <MessageCircle className="w-3.5 h-3.5" />
                </Button>
              </TooltipTrigger>
              <TooltipContent>
                <p>×©×œ×— ×•×•××˜×¡××¤</p>
              </TooltipContent>
            </Tooltip>
          </TooltipProvider>
        )}

        <TooltipProvider>
          <Tooltip>
            <TooltipTrigger asChild>
              <Button
                variant="ghost"
                size="icon"
                className="h-7 w-7 rounded-full bg-white/60 hover:bg-purple-100 hover:text-purple-600 shadow-sm border border-transparent hover:border-purple-200 transition-all"
                onClick={(e) => {
                  e.stopPropagation();
                  onAnalyze();
                }}
              >
                <Sparkles className="w-3.5 h-3.5" />
              </Button>
            </TooltipTrigger>
            <TooltipContent>
              <p>× ×™×ª×•×— ×¤×¨×•×¤×™×œ AI</p>
            </TooltipContent>
          </Tooltip>
        </TooltipProvider>

        <TooltipProvider>
          <Tooltip>
            <TooltipTrigger asChild>
              <Button
                variant="ghost"
                size="icon"
                className="h-7 w-7 rounded-full bg-white/60 hover:bg-blue-100 hover:text-blue-600 shadow-sm border border-transparent hover:border-blue-200 transition-all"
                onClick={(e) => {
                  e.stopPropagation();
                  onFeedback();
                }}
              >
                <Mail className="w-3.5 h-3.5" />
              </Button>
            </TooltipTrigger>
            <TooltipContent>
              <p>×©×œ×— ×“×•×— ×¤×¨×•×¤×™×œ (××™×™×œ)</p>
            </TooltipContent>
          </Tooltip>
        </TooltipProvider>
      </div>

      <TooltipProvider>
        <Tooltip>
          <TooltipTrigger asChild>
            <Button
              variant="ghost"
              size="icon"
              className="h-7 w-7 rounded-full bg-white/60 hover:bg-amber-100 hover:text-amber-600 shadow-sm border border-transparent hover:border-amber-200 transition-all absolute top-2 right-2"
              onClick={(e) => {
                e.stopPropagation();
                onHide({
                  id: candidate.id,
                  firstName: candidate.firstName,
                  lastName: candidate.lastName,
                  mainImage: candidate.mainImage,
                  gender: gender === 'male' ? 'MALE' : 'FEMALE',
                });
              }}
            >
              <EyeOff className="w-3.5 h-3.5" />
            </Button>
          </TooltipTrigger>
          <TooltipContent>
            <p>×”×¡×ª×¨ ×–×× ×™×ª</p>
          </TooltipContent>
        </Tooltip>
      </TooltipProvider>

      {activeSuggestion && (
        <div className="mt-2 text-center">
          <Badge
            variant="outline"
            className="text-[10px] bg-amber-50 text-amber-700 border-amber-200 px-1 py-0 h-5"
          >
            <AlertTriangle className="w-2.5 h-2.5 mr-1" />
            ×‘×”×¦×¢×” ×¤×¢×™×œ×”
          </Badge>
        </div>
      )}
    </div>
  );
};

// Score Breakdown Component
const ScoreBreakdownDisplay: React.FC<{
  breakdown: ScoreBreakdown;
}> = ({ breakdown }) => {
  const categories = [
    { key: 'religious', label: '×”×ª×××” ×“×ª×™×ª', max: 35, color: 'bg-purple-500' },
    {
      key: 'ageCompatibility',
      label: '×”×ª×××ª ×’×™×œ',
      max: 10,
      color: 'bg-blue-500',
    },
    {
      key: 'careerFamily',
      label: '×§×¨×™×™×¨×”-××©×¤×—×”',
      max: 15,
      color: 'bg-cyan-500',
    },
    { key: 'lifestyle', label: '×¡×’× ×•×Ÿ ×—×™×™×', max: 15, color: 'bg-green-500' },
    { key: 'ambition', label: '×©××¤×ª× ×•×ª', max: 12, color: 'bg-orange-500' },
    { key: 'communication', label: '×ª×§×©×•×¨×ª', max: 12, color: 'bg-pink-500' },
    { key: 'values', label: '×¢×¨×›×™×', max: 11, color: 'bg-indigo-500' },
  ];

  return (
    <div className="space-y-2">
      {categories.map((cat) => {
        const value = breakdown[cat.key as keyof ScoreBreakdown] || 0;
        const percentage = (value / cat.max) * 100;

        return (
          <div key={cat.key} className="flex items-center gap-2">
            <span className="text-xs text-gray-600 w-24 truncate">
              {cat.label}
            </span>
            <div className="flex-1 h-2 bg-gray-200 rounded-full overflow-hidden">
              <motion.div
                initial={{ width: 0 }}
                animate={{ width: `${percentage}%` }}
                transition={{ duration: 0.5, delay: 0.1 }}
                className={cn('h-full rounded-full', cat.color)}
              />
            </div>
            <span className="text-xs text-gray-500 w-12 text-left">
              {value}/{cat.max}
            </span>
          </div>
        );
      })}
    </div>
  );
};

// =============================================================================
// MAIN COMPONENT
// =============================================================================

const PotentialMatchCard: React.FC<PotentialMatchCardProps> = ({
  match,
  onCreateSuggestion,
  onDismiss,
  onReview,
  onRestore,
  onViewProfile,
  onAnalyzeCandidate,
  onProfileFeedback,
  onSave,
  isSelected = false,
  onToggleSelect,
  showSelection = false,
  className,
  onHideCandidate,
}) => {
  const [showDetails, setShowDetails] = useState(false);
  const [showReasoningDialog, setShowReasoningDialog] = useState(false);

  // --- Rejection Feedback Hook ---
  const rejectionFeedback = useRejectionFeedback();

  const statusBadge = getStatusBadge(match.status);
  const StatusIcon = statusBadge.icon;

  const isDismissed = match.status === 'DISMISSED';
  const isSent = match.status === 'SENT';

  // --- Handlers ---

  // ×¤×ª×™×—×ª ××•×“×œ ×”×“×—×™×™×”
  const handleDismissWithFeedback = () => {
    rejectionFeedback.open({
      // ×× ×• ××’×“×™×¨×™× ××ª ×”-rejecting/rejected ×œ×¦×•×¨×›×™ ×ª×™×¢×•×“ ×‘-DB.
      // ×‘××§×¨×” ×©×œ ×“×—×™×™×ª ×”×ª×××” ×¢"×™ ×©×“×›×Ÿ, ×–×” ×¤×—×•×ª ×§×¨×™×˜×™ ××™ ×“×•×—×” ××ª ××™,
      // ××š × ×‘×—×¨ ×§×•× ×‘× ×¦×™×”: ×”×–×›×¨ ×“×•×—×” ××ª ×”× ×§×‘×” (××• ×”×”×¤×š) ×¨×§ ×›×“×™ ×œ××œ× ××ª ×”×©×“×•×ª.
      // ××¤×©×¨ ×’× ×œ××¤×©×¨ ×œ×©×“×›×Ÿ ×œ×‘×—×•×¨ ××™ ×œ× ×”×ª××™×, ××š ×œ××¢×Ÿ ×”×¤×©×˜×•×ª ×›×¨×’×¢:
      rejectedUser: {
        id: match.female.id,
        firstName: match.female.firstName,
        lastName: match.female.lastName,
      },
      rejectingUser: {
        id: match.male.id,
        firstName: match.male.firstName,
        lastName: match.male.lastName,
      },
      potentialMatchId: match.id,
    });
  };

  // ×©×œ×™×—×ª ×”×¤×™×“×‘×§ ×•×‘×™×¦×•×¢ ×”×“×—×™×™×” ×‘×¤×•×¢×œ
  const handleFeedbackSubmit = async (data: any) => {
    try {
      await rejectionFeedback.submit(data); // ×©××™×¨×ª ×”×¤×™×“×‘×§ ×‘-DB
      onDismiss(match.id); // ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ×”×”×ª×××” ×œ-DISMISSED ×‘×××©×§
    } catch (error) {
      console.error('Failed to submit feedback', error);
    }
  };

  return (
    <>
      <motion.div
        layout
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        exit={{ opacity: 0, y: -20 }}
        className={className}
      >
        <Card
          className={cn(
            'group relative overflow-hidden transition-all duration-300',
            'hover:shadow-xl border-0',
            isDismissed && 'opacity-60',
            isSelected && 'ring-2 ring-blue-500',
            match.hasActiveWarning && !isDismissed && 'ring-2 ring-amber-400'
          )}
        >
          {/* Gradient Background */}
          <div
            className={cn(
              'absolute inset-0 opacity-30',
              `bg-gradient-to-br ${getScoreBgColor(match.aiScore)}`
            )}
          />

          {/* Content */}
          <div className="relative p-4">
            {/* Header */}
            <div className="flex items-center justify-between mb-4">
              {/* Selection Checkbox */}
              {showSelection && onToggleSelect && (
                <div className="flex items-center gap-2">
                  <Checkbox
                    checked={isSelected}
                    onCheckedChange={() => onToggleSelect(match.id)}
                    className="border-2"
                  />
                </div>
              )}

              {/* Score Badge */}
              <div
                className={cn(
                  'flex items-center gap-2 px-3 py-1.5 rounded-full',
                  'bg-white/90 backdrop-blur-sm shadow-sm'
                )}
              >
                <Sparkles
                  className={cn('w-4 h-4', getScoreColor(match.aiScore))}
                />
                <span
                  className={cn(
                    'text-xl font-bold',
                    getScoreColor(match.aiScore)
                  )}
                >
                  {Math.round(match.aiScore)}
                </span>
              </div>

              {/* Status Badge */}
              <Badge className={cn('gap-1', statusBadge.color)}>
                <StatusIcon className="w-3 h-3" />
                {statusBadge.label}
              </Badge>

              {/* Actions Menu */}
              <DropdownMenu>
                <DropdownMenuTrigger asChild>
                  <Button variant="ghost" size="icon" className="h-8 w-8">
                    <MoreHorizontal className="w-4 h-4" />
                  </Button>
                </DropdownMenuTrigger>
                <DropdownMenuContent align="end">
                  {!isSent && !isDismissed && (
                    <>
                      <DropdownMenuItem
                        onClick={() => onCreateSuggestion(match.id)}
                      >
                        <HeartHandshake className="w-4 h-4 ml-2 text-green-600" />
                        ×¦×•×¨ ×”×¦×¢×”
                      </DropdownMenuItem>

                      <DropdownMenuItem onClick={() => onReview(match.id)}>
                        <Eye className="w-4 h-4 ml-2 text-blue-600" />
                        ×¡××Ÿ ×›× ×‘×“×§
                      </DropdownMenuItem>
                      <DropdownMenuSeparator />
                      <DropdownMenuItem
                        onClick={handleDismissWithFeedback}
                        className="text-red-600"
                      >
                        <X className="w-4 h-4 ml-2" />
                        ×“×—×” ×”×ª×××”
                      </DropdownMenuItem>
                    </>
                  )}
                  {isDismissed && (
                    <DropdownMenuItem onClick={() => onRestore(match.id)}>
                      <Undo className="w-4 h-4 ml-2 text-blue-600" />
                      ×©×—×–×¨ ×”×ª×××”
                    </DropdownMenuItem>
                  )}
                </DropdownMenuContent>
              </DropdownMenu>
            </div>

            {/* Candidates Preview Row */}
            <div className="flex gap-3 mb-4">
              <CandidatePreview
                candidate={match.male}
                gender="male"
                activeSuggestion={match.maleActiveSuggestion}
                onViewProfile={() => onViewProfile(match.male.id)}
                onAnalyze={() => onAnalyzeCandidate(match.male)}
                onFeedback={() => onProfileFeedback(match.male)}
                onHide={onHideCandidate}
              />

              {/* Heart Connector */}
              <div className="flex flex-col justify-center items-center gap-1 z-10">
                <div
                  className={cn(
                    'w-8 h-8 rounded-full flex items-center justify-center',
                    'bg-gradient-to-br from-pink-500 to-red-500 shadow-lg'
                  )}
                >
                  <Heart className="w-4 h-4 text-white fill-white" />
                </div>
              </div>

              <CandidatePreview
                candidate={match.female}
                gender="female"
                activeSuggestion={match.femaleActiveSuggestion}
                onViewProfile={() => onViewProfile(match.female.id)}
                onAnalyze={() => onAnalyzeCandidate(match.female)}
                onFeedback={() => onProfileFeedback(match.female)}
                onHide={onHideCandidate}
              />
            </div>

            {/* Reasoning Preview */}
            {match.shortReasoning && (
              <div
                className="p-3 rounded-lg bg-white/60 backdrop-blur-sm cursor-pointer hover:bg-white/80 transition-colors border border-purple-50"
                onClick={() => setShowReasoningDialog(true)}
              >
                <div className="flex items-start gap-2">
                  <Brain className="w-4 h-4 text-purple-600 mt-0.5 flex-shrink-0" />
                  <p className="text-sm text-gray-700 line-clamp-2 leading-relaxed">
                    {match.shortReasoning}
                  </p>
                </div>
              </div>
            )}

            {/* Footer: Date & Details Toggle */}
            <div className="flex items-center justify-between mt-3 pt-2">
              <span className="text-[10px] text-gray-400 flex items-center gap-1">
                <Calendar className="w-3 h-3" />
                {formatDistanceToNow(new Date(match.scannedAt), {
                  addSuffix: true,
                  locale: he,
                })}
              </span>

              <Button
                variant="ghost"
                size="sm"
                className="h-6 text-xs text-gray-500 hover:text-gray-800"
                onClick={() => setShowDetails(!showDetails)}
              >
                {showDetails ? (
                  <>
                    ×”×¡×ª×¨ ×¤×¨×˜×™× <ChevronUp className="w-3 h-3 ml-1" />
                  </>
                ) : (
                  <>
                    ×”×¦×’ × ×™×§×•×“ ××œ× <ChevronDown className="w-3 h-3 ml-1" />
                  </>
                )}
              </Button>
            </div>

            {/* Score Breakdown */}
            {showDetails && match.scoreBreakdown && (
              <motion.div
                initial={{ opacity: 0, height: 0 }}
                animate={{ opacity: 1, height: 'auto' }}
                exit={{ opacity: 0, height: 0 }}
                className="mt-3 p-3 rounded-lg bg-white/80 backdrop-blur-sm border border-gray-100"
              >
                <ScoreBreakdownDisplay breakdown={match.scoreBreakdown} />
              </motion.div>
            )}

            {/* Main Action Buttons (Bottom) */}
            {!isDismissed && !isSent && (
              <div className="flex gap-2 mt-4 pt-2 border-t border-gray-100">
                <Button
                  className="flex-1 h-9 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white shadow-sm text-sm"
                  onClick={() => onCreateSuggestion(match.id)}
                >
                  <HeartHandshake className="w-4 h-4 ml-2" />
                  ×¦×•×¨ ×”×¦×¢×”
                </Button>
                {match.status !== 'SHORTLISTED' && (
                  <Button
                    variant="outline"
                    className="h-9 px-3 text-purple-600 border-purple-200 hover:bg-purple-50"
                    onClick={() => onSave(match.id)}
                    title="×©××•×¨ ×‘×¦×“"
                  >
                    <Bookmark className="w-4 h-4" />
                  </Button>
                )}

                <Button
                  variant="outline"
                  className="flex-1 h-9 text-sm"
                  onClick={handleDismissWithFeedback} // Updated to use feedback modal
                >
                  <X className="w-4 h-4 ml-2" />
                  ×“×—×”
                </Button>
              </div>
            )}

            {/* Link to Suggestion if sent */}
            {isSent && match.suggestionId && (
              <div className="mt-4 p-2 rounded-lg bg-green-50 border border-green-200 text-center">
                <Button
                  variant="link"
                  size="sm"
                  className="text-green-700 p-0 h-auto font-medium"
                  onClick={() =>
                    (window.location.href = `/matchmaker/suggestions?id=${match.suggestionId}`)
                  }
                >
                  ×¢×‘×•×¨ ×œ×”×¦×¢×” <ExternalLink className="w-3 h-3 mr-1" />
                </Button>
              </div>
            )}
          </div>
        </Card>
      </motion.div>

      {/* Reasoning Dialog */}
      <Dialog open={showReasoningDialog} onOpenChange={setShowReasoningDialog}>
        <DialogContent className="max-w-2xl" dir="rtl">
          <DialogHeader>
            <DialogTitle>× ×™××•×§ AI ×œ×”×ª×××”</DialogTitle>
          </DialogHeader>
          <div className="space-y-4 max-h-[60vh] overflow-y-auto">
            <div className="bg-purple-50 p-4 rounded-lg">
              <p className="whitespace-pre-wrap leading-relaxed text-gray-800">
                {match.detailedReasoning || match.shortReasoning}
              </p>
            </div>
            {match.scoreBreakdown && (
              <ScoreBreakdownDisplay breakdown={match.scoreBreakdown} />
            )}
          </div>
        </DialogContent>
      </Dialog>

      {/* Rejection Feedback Modal Integration */}
      {rejectionFeedback.context && (
        <RejectionFeedbackModal
          isOpen={rejectionFeedback.isOpen}
          onClose={rejectionFeedback.close}
          onSubmit={handleFeedbackSubmit}
          rejectedUser={rejectionFeedback.context.rejectedUser}
          rejectingUser={rejectionFeedback.context.rejectingUser}
          potentialMatchId={match.id}
          suggestionId={undefined} // Potential matches usually don't have suggestionId yet
        />
      )}
    </>
  );
};

export default PotentialMatchCard;
--- End of Content for PotentialMatchCard.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches\PotentialMatchesDashboard.tsx
--------------------------------------------------------------------------------
Content:
// src/components/matchmaker/new/PotentialMatches/PotentialMatchesDashboard.tsx

'use client';
import React, {
  useMemo,
  useState,
  useCallback,
  useEffect,
  useRef,
} from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Card } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { useHiddenCandidates } from './hooks/useHiddenCandidates';
import HiddenCandidatesDrawer from './HiddenCandidatesDrawer';
import HideCandidateDialog, { CandidateToHide } from './HideCandidateDialog';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
} from '@/components/ui/dialog';
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog';
import { Textarea } from '@/components/ui/textarea';
import {
  HeartHandshake,
  Search,
  RefreshCw,
  Moon,
  Check,
  ChevronLeft,
  ChevronRight,
  Loader2,
  AlertTriangle,
  Eye,
  Clock,
  Send,
  X,
  Trash2,
  Bookmark,
  LayoutGrid,
  List,
  CheckCircle,
  Heart,
  Sparkles,
  BarChart2,
} from 'lucide-react';
import { cn } from '@/lib/utils';
import { toast } from 'sonner';

// Components
import PotentialMatchCard from './PotentialMatchCard';
import PotentialMatchesStats from './PotentialMatchesStats';
import { ProfileCard } from '@/components/profile';

// Import New V2 Dashboard
import MatchmakerDashboardV2 from './MatchmakerDashboard';

// Import Dialogs
import { AiMatchmakerProfileAdvisorDialog } from '../dialogs/AiMatchmakerProfileAdvisorDialog';
import { ProfileFeedbackDialog } from '../dialogs/ProfileFeedbackDialog';

// Hooks
import { usePotentialMatches } from './hooks/usePotentialMatches';

// Types
import type {
  PotentialMatchFilterStatus,
  PotentialMatchSortBy,
} from './types/potentialMatches';
import type { ProfilePageDictionary } from '@/types/dictionary';
import type { MatchmakerPageDictionary } from '@/types/dictionaries/matchmaker';

// =============================================================================
// TYPES
// =============================================================================

interface PotentialMatchesDashboardProps {
  locale?: string;
  profileDict: ProfilePageDictionary;
  matchmakerDict: MatchmakerPageDictionary;
}

const STATUS_OPTIONS: {
  value: PotentialMatchFilterStatus;
  label: string;
  icon: React.ElementType;
}[] = [
  { value: 'all', label: '×”×›×œ', icon: Heart },
  { value: 'pending', label: '×××ª×™× ×•×ª', icon: Clock },
  { value: 'reviewed', label: '× ×‘×“×§×•', icon: Eye },
  { value: 'sent', label: '× ×©×œ×—×•', icon: Send },
  { value: 'shortlisted', label: '×©××•×¨×™× ×‘×¦×“', icon: Bookmark },
  { value: 'dismissed', label: '× ×“×—×•', icon: X },
  { value: 'with_warnings', label: '×¢× ××–×”×¨×•×ª', icon: AlertTriangle },
  { value: 'no_warnings', label: '×œ×œ× ××–×”×¨×•×ª', icon: CheckCircle },
];

const SORT_OPTIONS: { value: PotentialMatchSortBy; label: string }[] = [
  { value: 'score_desc', label: '×¦×™×•×Ÿ (×’×‘×•×” ×œ× ××•×š)' },
  { value: 'score_asc', label: '×¦×™×•×Ÿ (× ××•×š ×œ×’×‘×•×”)' },
  { value: 'date_desc', label: '×ª××¨×™×š (×—×“×© ×œ×™×©×Ÿ)' },
  { value: 'date_asc', label: '×ª××¨×™×š (×™×©×Ÿ ×œ×—×“×©)' },
];

// =============================================================================
// MAIN COMPONENT
// =============================================================================

const PotentialMatchesDashboard: React.FC<PotentialMatchesDashboardProps> = ({
  locale = 'he',
  profileDict,
  matchmakerDict,
}) => {
  // --- View Mode (Tabs) ---
  // 'overview' = New V2 Dashboard, 'matches' = Existing List
  const [activeTab, setActiveTab] = useState<'overview' | 'matches'>(
    'overview'
  );

  // State for Matches List
  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');

  // × ×™×”×•×œ ×—×™×¤×•×© ××§×•××™ ×¢×‘×•×¨ Debounce
  const [localSearchTerm, setLocalSearchTerm] = useState('');

  // × ×™×”×•×œ ×“×¤×“×•×£ ×™×“× ×™ (Input)
  const [pageInput, setPageInput] = useState('1');

  // × ×™×”×•×œ ××™×§×•× ×’×œ×™×œ×”
  const scrollPositionRef = useRef(0);

  const [showBulkActions, setShowBulkActions] = useState(false);

  // Dialogs
  const [confirmScanDialog, setConfirmScanDialog] = useState(false);
  const [confirmBulkDismissDialog, setConfirmBulkDismissDialog] =
    useState(false);
  const [createSuggestionDialog, setCreateSuggestionDialog] = useState<
    string | null
  >(null);
  const [dismissDialog, setDismissDialog] = useState<string | null>(null);
  const [dismissReason, setDismissReason] = useState('');

  // --- Profile View State ---
  const [viewProfileId, setViewProfileId] = useState<string | null>(null);
  const [fullProfileData, setFullProfileData] = useState<any | null>(null);
  const [questionnaireData, setQuestionnaireData] = useState<any | null>(null);
  const [isLoadingProfile, setIsLoadingProfile] = useState(false);
  const [isMatchmakerView, setIsMatchmakerView] = useState(true);

  // --- AI Analysis & Feedback State ---
  const [analyzedCandidate, setAnalyzedCandidate] = useState<any | null>(null);
  const [feedbackCandidate, setFeedbackCandidate] = useState<any | null>(null);

  // Suggestion form state
  const [suggestionPriority, setSuggestionPriority] = useState<
    'LOW' | 'MEDIUM' | 'HIGH' | 'URGENT'
  >('MEDIUM');
  const [suggestionNotes, setSuggestionNotes] = useState('');

  // Hook for Matches
  const {
    matches,
    stats,
    lastScanInfo,
    pagination,
    isLoading,
    isRefreshing,
    isActioning,
    filters,
    setFilters,
    resetFilters,
    setPage,
    setPageSize,
    refresh,
    reviewMatch,
    dismissMatch,
    restoreMatch,
    saveMatch,
    createSuggestion,
    bulkDismiss,
    bulkReview,
    startScan,
    scanProgress,
    isScanRunning,
    selectedMatchIds,
    toggleSelection,
    selectAll,
    clearSelection,
    isSelected,
    error,
  } = usePotentialMatches({
    initialFilters: { status: 'pending' },
    autoRefresh: true,
    refreshInterval: 60000,
  });

  // Hook for Hidden Candidates
  const {
    hiddenCandidates,
    hiddenCandidateIds,
    isLoading: isLoadingHidden,
    hideCandidate,
    unhideCandidate,
    updateReason,
  } = useHiddenCandidates();

  const [candidateToHide, setCandidateToHide] =
    useState<CandidateToHide | null>(null);
  const [showHideDialog, setShowHideDialog] = useState(false);

  // ==========================================================================
  // SYNC PAGE INPUT
  // ==========================================================================
  useEffect(() => {
    setPageInput(String(pagination.page));
  }, [pagination.page]);

  // ==========================================================================
  // SERVER SIDE SEARCH EFFECT
  // ==========================================================================

  useEffect(() => {
    const timer = setTimeout(() => {
      // ×× ×™×© ×¢×¨×š ×‘×—×™×¤×•×©, ×× ×—× ×• ×¨×•×¦×™× ×œ×—×¤×© ×‘×›×œ ×”×¡×˜×˜×•×¡×™×
      if (localSearchTerm && localSearchTerm.length > 0) {
        setFilters({
          searchTerm: localSearchTerm,
          status: 'all', // ×©×™× ×•×™ ××•×˜×•××˜×™ ×œ'×”×›×œ' ×‘×¢×ª ×—×™×¤×•×©
        });
      } else {
        setFilters({ searchTerm: localSearchTerm });
      }
    }, 600);

    return () => clearTimeout(timer);
  }, [localSearchTerm, setFilters]);

  // ==========================================================================
  // PROFILE LOADING EFFECT
  // ==========================================================================

  useEffect(() => {
    const loadProfileData = async () => {
      if (!viewProfileId) {
        setFullProfileData(null);
        setQuestionnaireData(null);
        return;
      }

      setIsLoadingProfile(true);
      try {
        const profileResponse = await fetch(
          `/api/matchmaker/candidates/${viewProfileId}`
        );
        const profileJson = await profileResponse.json();

        if (profileJson.success) {
          const formattedData = {
            ...profileJson,
            profile: {
              ...profileJson.profile,
              user: profileJson.user,
            },
          };
          setFullProfileData(formattedData);
        } else {
          toast.error('×œ× × ×™×ª×Ÿ ×”×™×” ×œ×˜×¢×•×Ÿ ××ª ×”×¤×¨×•×¤×™×œ');
        }

        const questionnaireResponse = await fetch(
          `/api/profile/questionnaire?userId=${viewProfileId}&locale=${locale}`
        );
        const questionnaireJson = await questionnaireResponse.json();

        if (
          questionnaireJson.success &&
          questionnaireJson.questionnaireResponse
        ) {
          setQuestionnaireData(questionnaireJson.questionnaireResponse);
        }
      } catch (err) {
        console.error('Failed to load full profile:', err);
        toast.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×¤×¨×•×¤×™×œ ×”××•×¢××“');
      } finally {
        setIsLoadingProfile(false);
      }
    };

    loadProfileData();
  }, [viewProfileId, locale]);

  // ==========================================================================
  // HANDLERS
  // ==========================================================================

  // ×¡× ×Ÿ ××ª ×”×”×¦×¢×•×ª - ×”×¡×ª×¨ ×”×¦×¢×•×ª ×¢× ××•×¢××“×™× ××•×¡×ª×¨×™×
  const filteredMatches = useMemo(() => {
    if (hiddenCandidateIds.size === 0) return matches;

    return matches.filter(
      (match) =>
        !hiddenCandidateIds.has(match.male.id) &&
        !hiddenCandidateIds.has(match.female.id)
    );
  }, [matches, hiddenCandidateIds]);

  const handleStartScan = useCallback(async () => {
    setConfirmScanDialog(false);
    await startScan({ method: 'algorithmic' });
  }, [startScan]);

  const handleHideCandidate = (candidate: CandidateToHide) => {
    setCandidateToHide(candidate);
    setShowHideDialog(true);
  };

  const handleConfirmHide = async (candidateId: string, reason?: string) => {
    return await hideCandidate(candidateId, reason);
  };

  const handleCreateSuggestion = useCallback(async () => {
    if (!createSuggestionDialog) return;

    const suggestionId = await createSuggestion(createSuggestionDialog, {
      priority: suggestionPriority,
      matchingReason: suggestionNotes || undefined,
    });

    if (suggestionId) {
      setCreateSuggestionDialog(null);
      setSuggestionPriority('MEDIUM');
      setSuggestionNotes('');
    }
  }, [
    createSuggestionDialog,
    createSuggestion,
    suggestionPriority,
    suggestionNotes,
  ]);

  const handleDismiss = useCallback(async () => {
    if (!dismissDialog) return;

    await dismissMatch(dismissDialog, dismissReason || undefined);
    setDismissDialog(null);
    setDismissReason('');
  }, [dismissDialog, dismissMatch, dismissReason]);

  const handleBulkDismiss = useCallback(async () => {
    setConfirmBulkDismissDialog(false);
    await bulkDismiss(selectedMatchIds, '×“×—×™×™×” ××¨×•×‘×”');
  }, [bulkDismiss, selectedMatchIds]);

  // ×ª×™×§×•×Ÿ ×’×œ×™×œ×”: ×©××™×¨×ª ×”××™×§×•× ×œ×¤× ×™ ×¤×ª×™×—×ª ×”×¤×¨×•×¤×™×œ
  const handleViewProfile = useCallback((userId: string) => {
    scrollPositionRef.current = window.scrollY; // ×©××•×¨ ××™×§×•× × ×•×›×—×™
    setViewProfileId(userId);
  }, []);

  const handleResetFilters = useCallback(() => {
    setLocalSearchTerm(''); // ××™×¤×•×¡ ×’× ×©×œ ×©×“×” ×”×—×™×¤×•×© ×”×•×™×–×•××œ×™
    resetFilters();
  }, [resetFilters]);

  // ×¤×•× ×§×¦×™×” ×œ×©×™× ×•×™ ×¢××•×“ ×™×“× ×™
  const handlePageInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setPageInput(e.target.value);
  };

  const handlePageInputSubmit = () => {
    const newPage = parseInt(pageInput);
    if (!isNaN(newPage) && newPage >= 1 && newPage <= pagination.totalPages) {
      setPage(newPage);
    } else {
      setPageInput(String(pagination.page));
      toast.error(`× × ×œ×”×–×™×Ÿ ××¡×¤×¨ ×¢××•×“ ×‘×™×Ÿ 1 ×œ-${pagination.totalPages}`);
    }
  };

  const handlePageInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {
    if (e.key === 'Enter') {
      handlePageInputSubmit();
    }
  };

  // ==========================================================================
  // RENDER
  // ==========================================================================

  return (
    <div
      className="min-h-screen bg-gradient-to-br from-gray-50 via-purple-50/30 to-pink-50/30"
      dir="rtl"
    >
      {/* Header */}
      <header className="sticky top-0 z-40 bg-white/90 backdrop-blur-sm border-b shadow-sm">
        <div className="container mx-auto px-6 py-4">
          <div className="flex items-center justify-between">
            {/* Title & Tabs */}
            <div className="flex items-center gap-3">
              <div className="p-2 rounded-xl bg-gradient-to-br from-pink-500 to-rose-500 text-white shadow-lg">
                <HeartHandshake className="w-6 h-6" />
              </div>
              <div>
                <h1 className="text-2xl font-bold text-gray-800">
                  ××¢×¨×›×ª ×”×©×™×“×•×›×™×
                </h1>

                {/* Tabs Navigation */}
                <div className="flex gap-2 mt-1">
                  <button
                    onClick={() => setActiveTab('overview')}
                    className={`flex items-center gap-1 text-sm px-2 py-0.5 rounded transition-all ${activeTab === 'overview' ? 'bg-indigo-50 text-indigo-700 font-bold shadow-sm' : 'text-gray-500 hover:text-gray-700 hover:bg-gray-100'}`}
                  >
                    <BarChart2 className="w-3.5 h-3.5" />
                    ××‘×˜ ×¢×œ
                  </button>
                  <button
                    onClick={() => setActiveTab('matches')}
                    className={`flex items-center gap-1 text-sm px-2 py-0.5 rounded transition-all ${activeTab === 'matches' ? 'bg-indigo-50 text-indigo-700 font-bold shadow-sm' : 'text-gray-500 hover:text-gray-700 hover:bg-gray-100'}`}
                  >
                    <Sparkles className="w-3.5 h-3.5" />
                    × ×™×”×•×œ ×”×ª×××•×ª ({stats ? stats.pending : '...'})
                  </button>
                </div>
              </div>
            </div>

            {/* Actions - Only visible when in Matches tab */}
            {activeTab === 'matches' && (
              <div className="flex items-center gap-3">
                <HiddenCandidatesDrawer
                  hiddenCandidates={hiddenCandidates}
                  onUnhide={unhideCandidate}
                  onUpdateReason={updateReason}
                  isLoading={isLoadingHidden}
                />
                <Button
                  onClick={() => setConfirmScanDialog(true)}
                  disabled={isScanRunning}
                  className="bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white shadow-lg"
                >
                  {isScanRunning ? (
                    <>
                      <Loader2 className="w-4 h-4 ml-2 animate-spin" />
                      ×¡×¨×™×§×”... {scanProgress?.progress || 0}%
                    </>
                  ) : (
                    <>
                      <Moon className="w-4 h-4 ml-2" />
                      ×”×¤×¢×œ ×¡×¨×™×§×”
                    </>
                  )}
                </Button>

                <Button
                  variant="outline"
                  onClick={refresh}
                  disabled={isRefreshing}
                >
                  <RefreshCw
                    className={cn(
                      'w-4 h-4 ml-2',
                      isRefreshing && 'animate-spin'
                    )}
                  />
                  ×¨×¢× ×Ÿ
                </Button>
              </div>
            )}
          </div>
        </div>
      </header>

      <main className="container mx-auto px-6 py-6 space-y-6">
        {/* Conditional Rendering based on Tab */}

        {activeTab === 'overview' ? (
          // --- V2 DASHBOARD VIEW ---
          <MatchmakerDashboardV2 />
        ) : (
          // --- MATCHES LIST VIEW ---
          <>
            {/* Stats */}
            <PotentialMatchesStats
              stats={stats}
              lastScanInfo={lastScanInfo}
              isScanRunning={isScanRunning}
              scanProgress={scanProgress?.progress || 0}
            />

            {/* Filters & Controls */}
            <Card className="p-4 border-0 shadow-lg">
              <div className="flex flex-wrap items-center gap-4">
                {/* Search */}
                <div className="flex-1 min-w-[200px] max-w-md relative">
                  <Search className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" />
                  <Input
                    placeholder="×—×™×¤×•×© ×œ×¤×™ ×©×..."
                    value={localSearchTerm}
                    onChange={(e) => setLocalSearchTerm(e.target.value)}
                    className="pr-10"
                  />
                </div>

                {/* Status Filter */}
                <Select
                  value={filters.status}
                  onValueChange={(value) =>
                    setFilters({ status: value as PotentialMatchFilterStatus })
                  }
                >
                  <SelectTrigger className="w-[180px]">
                    <SelectValue placeholder="×¡×˜×˜×•×¡" />
                  </SelectTrigger>
                  <SelectContent>
                    {STATUS_OPTIONS.map((option) => (
                      <SelectItem key={option.value} value={option.value}>
                        <div className="flex items-center gap-2">
                          <option.icon className="w-4 h-4" />
                          {option.label}
                        </div>
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>

                {/* Sort */}
                <Select
                  value={filters.sortBy}
                  onValueChange={(value) =>
                    setFilters({ sortBy: value as PotentialMatchSortBy })
                  }
                >
                  <SelectTrigger className="w-[180px]">
                    <SelectValue placeholder="××™×•×Ÿ" />
                  </SelectTrigger>
                  <SelectContent>
                    {SORT_OPTIONS.map((option) => (
                      <SelectItem key={option.value} value={option.value}>
                        {option.label}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>

                {/* Score Range */}
                <div className="flex items-center gap-2">
                  <span className="text-sm text-gray-600">×¦×™×•×Ÿ:</span>
                  <Input
                    type="number"
                    min={0}
                    max={100}
                    value={filters.minScore}
                    onChange={(e) =>
                      setFilters({ minScore: parseInt(e.target.value) || 0 })
                    }
                    className="w-16 text-center"
                  />
                  <span>-</span>
                  <Input
                    type="number"
                    min={0}
                    max={100}
                    value={filters.maxScore}
                    onChange={(e) =>
                      setFilters({ maxScore: parseInt(e.target.value) || 100 })
                    }
                    className="w-16 text-center"
                  />
                </div>

                {/* View Mode */}
                <div className="flex items-center gap-1 border rounded-lg p-1">
                  <Button
                    variant={viewMode === 'grid' ? 'default' : 'ghost'}
                    size="sm"
                    onClick={() => setViewMode('grid')}
                  >
                    <LayoutGrid className="w-4 h-4" />
                  </Button>
                  <Button
                    variant={viewMode === 'list' ? 'default' : 'ghost'}
                    size="sm"
                    onClick={() => setViewMode('list')}
                  >
                    <List className="w-4 h-4" />
                  </Button>
                </div>

                {/* Bulk Selection Toggle */}
                <Button
                  variant={showBulkActions ? 'default' : 'outline'}
                  size="sm"
                  onClick={() => {
                    setShowBulkActions(!showBulkActions);
                    if (showBulkActions) clearSelection();
                  }}
                >
                  <Check className="w-4 h-4 ml-1" />
                  ×‘×—×™×¨×” ××¨×•×‘×”
                </Button>

                {/* Reset Filters */}
                <Button variant="ghost" size="sm" onClick={handleResetFilters}>
                  <X className="w-4 h-4 ml-1" />
                  × ×§×” ×¤×™×œ×˜×¨×™×
                </Button>
              </div>

              {/* Bulk Actions Bar */}
              <AnimatePresence>
                {showBulkActions && selectedMatchIds.length > 0 && (
                  <motion.div
                    initial={{ opacity: 0, height: 0 }}
                    animate={{ opacity: 1, height: 'auto' }}
                    exit={{ opacity: 0, height: 0 }}
                    className="mt-4 pt-4 border-t"
                  >
                    <div className="flex items-center gap-4">
                      <span className="text-sm text-gray-600">
                        × ×‘×—×¨×• {selectedMatchIds.length} ×”×ª×××•×ª
                      </span>
                      <Button size="sm" variant="outline" onClick={selectAll}>
                        ×‘×—×¨ ×”×›×œ
                      </Button>
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={clearSelection}
                      >
                        ×‘×˜×œ ×‘×—×™×¨×”
                      </Button>
                      <div className="flex-1" />
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() => bulkReview(selectedMatchIds)}
                        disabled={isActioning}
                      >
                        <Eye className="w-4 h-4 ml-1" />
                        ×¡××Ÿ ×›× ×‘×“×§×•
                      </Button>
                      <Button
                        size="sm"
                        variant="destructive"
                        onClick={() => setConfirmBulkDismissDialog(true)}
                        disabled={isActioning}
                      >
                        <Trash2 className="w-4 h-4 ml-1" />
                        ×“×—×” ×”×›×œ
                      </Button>
                    </div>
                  </motion.div>
                )}
              </AnimatePresence>
            </Card>

            {/* Error State */}
            {error && (
              <Card className="p-6 bg-red-50 border-red-200">
                <div className="flex items-center gap-3 text-red-700">
                  <AlertTriangle className="w-5 h-5" />
                  <span>{error}</span>
                  <Button variant="outline" size="sm" onClick={refresh}>
                    × ×¡×” ×©×•×‘
                  </Button>
                </div>
              </Card>
            )}

            {/* Loading State */}
            {isLoading && (
              <div className="flex items-center justify-center py-20">
                <Loader2 className="w-8 h-8 animate-spin text-purple-500" />
              </div>
            )}

            {/* Empty State */}
            {!isLoading && matches.length === 0 && (
              <Card className="p-12 text-center border-0 shadow-lg">
                <Heart className="w-16 h-16 mx-auto mb-4 text-gray-300" />
                <h3 className="text-xl font-bold text-gray-700 mb-2">
                  ×œ× × ××¦××• ×”×ª×××•×ª
                </h3>
                <p className="text-gray-500 mb-6">
                  {localSearchTerm
                    ? '×œ× × ××¦××• ×ª×•×¦××•×ª ×”×ª×•×××•×ª ××ª ×”×—×™×¤×•×© ×©×œ×š.'
                    : filters.status !== 'all'
                      ? '× ×¡×” ×œ×©× ×•×ª ××ª ×”×¤×™×œ×˜×¨×™× ××• ×œ×—×¤×© ×‘×›×œ ×”×”×ª×××•×ª.'
                      : '×”×¤×¢×œ ×¡×¨×™×§×” ×œ×™×œ×™×ª ×œ××¦×™××ª ×”×ª×××•×ª ×—×“×©×•×ª.'}
                </p>
                {localSearchTerm || filters.status !== 'all' ? (
                  <Button variant="outline" onClick={handleResetFilters}>
                    × ×§×” ×—×™×¤×•×© ×•×¤×™×œ×˜×¨×™×
                  </Button>
                ) : (
                  <Button onClick={() => setConfirmScanDialog(true)}>
                    <Moon className="w-4 h-4 ml-2" />
                    ×”×¤×¢×œ ×¡×¨×™×§×”
                  </Button>
                )}
              </Card>
            )}

            {/* Matches Grid */}
            {!isLoading && matches.length > 0 && (
              <>
                <div
                  className={cn(
                    'grid gap-6',
                    viewMode === 'grid'
                      ? 'grid-cols-1 md:grid-cols-2 xl:grid-cols-3'
                      : 'grid-cols-1'
                  )}
                >
                  <AnimatePresence mode="popLayout">
                    {filteredMatches.map((match) => (
                      <PotentialMatchCard
                        key={match.id}
                        match={match}
                        onCreateSuggestion={(id) =>
                          setCreateSuggestionDialog(id)
                        }
                        onDismiss={(id) => setDismissDialog(id)}
                        onReview={reviewMatch}
                        onRestore={restoreMatch}
                        onSave={saveMatch}
                        onViewProfile={handleViewProfile}
                        onAnalyzeCandidate={(candidate) =>
                          setAnalyzedCandidate(candidate)
                        }
                        onProfileFeedback={(candidate) =>
                          setFeedbackCandidate(candidate)
                        }
                        isSelected={isSelected(match.id)}
                        onToggleSelect={
                          showBulkActions ? toggleSelection : undefined
                        }
                        showSelection={showBulkActions}
                        onHideCandidate={handleHideCandidate}
                        hiddenCandidateIds={hiddenCandidateIds}
                      />
                    ))}
                  </AnimatePresence>
                </div>

                {/* Pagination */}
                <Card className="p-4 border-0 shadow-lg">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-2">
                      <span className="text-sm text-gray-600">
                        ××¦×™×’ {(pagination.page - 1) * pagination.pageSize + 1} -{' '}
                        {Math.min(
                          pagination.page * pagination.pageSize,
                          pagination.total
                        )}{' '}
                        ××ª×•×š {pagination.total}
                      </span>
                    </div>

                    <div className="flex items-center gap-2">
                      <Button
                        variant="outline"
                        size="sm"
                        onClick={() => setPage(pagination.page - 1)}
                        disabled={pagination.page <= 1}
                      >
                        <ChevronRight className="w-4 h-4" />
                      </Button>

                      <div className="flex items-center gap-1 mx-2">
                        <span className="text-sm text-gray-600">×¢××•×“</span>
                        <Input
                          className="h-8 w-12 text-center p-0"
                          value={pageInput}
                          onChange={handlePageInputChange}
                          onBlur={handlePageInputSubmit}
                          onKeyDown={handlePageInputKeyDown}
                        />
                        <span className="text-sm text-gray-600">
                          ××ª×•×š {pagination.totalPages}
                        </span>
                      </div>

                      <Button
                        variant="outline"
                        size="sm"
                        onClick={() => setPage(pagination.page + 1)}
                        disabled={pagination.page >= pagination.totalPages}
                      >
                        <ChevronLeft className="w-4 h-4" />
                      </Button>
                    </div>

                    <Select
                      value={String(pagination.pageSize)}
                      onValueChange={(value) => setPageSize(parseInt(value))}
                    >
                      <SelectTrigger className="w-[100px]">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="10">10</SelectItem>
                        <SelectItem value="20">20</SelectItem>
                        <SelectItem value="50">50</SelectItem>
                        <SelectItem value="100">100</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </Card>
              </>
            )}
          </>
        )}
      </main>

      {/* ======================================================================== */}
      {/* DIALOGS */}
      {/* ======================================================================== */}

      {/* Profile Dialog */}
      <Dialog
        open={!!viewProfileId}
        onOpenChange={(open) => {
          if (!open) {
            setViewProfileId(null);
            setFullProfileData(null);
            setQuestionnaireData(null);

            setTimeout(() => {
              window.scrollTo({
                top: scrollPositionRef.current,
                behavior: 'instant',
              });
            }, 100);
          }
        }}
      >
        <DialogContent
          className="max-w-6xl max-h-[90vh] overflow-y-auto p-0"
          dir={locale === 'he' ? 'rtl' : 'ltr'}
          onCloseAutoFocus={(e) => {
            e.preventDefault();
          }}
        >
          {/* Custom Header */}
          <div className="sticky top-0 z-50 flex items-center justify-between px-6 py-4 bg-white/95 backdrop-blur-sm border-b border-gray-100">
            <DialogTitle className="text-xl font-bold text-gray-800">
              {fullProfileData
                ? `${fullProfileData.profile?.user?.firstName || ''} ${fullProfileData.profile?.user?.lastName || ''}`
                : '×˜×•×¢×Ÿ ×¤×¨×•×¤×™×œ...'}
            </DialogTitle>

            <div className="flex items-center gap-2">
              <Select
                value={isMatchmakerView ? 'matchmaker' : 'candidate'}
                onValueChange={(value) =>
                  setIsMatchmakerView(value === 'matchmaker')
                }
              >
                <SelectTrigger className="w-[140px] h-9">
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="candidate">×ª×¦×•×’×ª ××•×¢××“</SelectItem>
                  <SelectItem value="matchmaker">×ª×¦×•×’×ª ×©×“×›×Ÿ</SelectItem>
                </SelectContent>
              </Select>

              <Button
                variant="ghost"
                size="icon"
                onClick={() => setViewProfileId(null)}
                className="h-9 w-9 rounded-full hover:bg-red-50 hover:text-red-600"
              >
                <X className="w-5 h-5" />
              </Button>
            </div>
          </div>

          <div className="p-0">
            {isLoadingProfile ? (
              <div className="flex flex-col items-center justify-center py-20">
                <Loader2 className="w-10 h-10 animate-spin text-purple-500 mb-4" />
                <p className="text-gray-500">×˜×•×¢×Ÿ × ×ª×•× ×™ ×¤×¨×•×¤×™×œ...</p>
              </div>
            ) : fullProfileData ? (
              <ProfileCard
                profile={fullProfileData.profile}
                images={fullProfileData.images}
                questionnaire={questionnaireData}
                viewMode={isMatchmakerView ? 'matchmaker' : 'candidate'}
                isProfileComplete={
                  fullProfileData.profile?.isProfileComplete || false
                }
                locale={locale}
                onClose={() => setViewProfileId(null)}
                dict={profileDict.profileCard}
              />
            ) : (
              <div className="p-10 text-center text-gray-500">
                ×œ× × ×™×ª×Ÿ ×œ×˜×¢×•×Ÿ ××ª ×”×¤×¨×•×¤×™×œ
              </div>
            )}
          </div>
        </DialogContent>
      </Dialog>

      {/* --- AI Analysis Dialog --- */}
      <AiMatchmakerProfileAdvisorDialog
        isOpen={!!analyzedCandidate}
        onClose={() => setAnalyzedCandidate(null)}
        candidate={analyzedCandidate}
        dict={matchmakerDict.candidatesManager.aiProfileAdvisor}
        locale={locale}
      />

      {/* --- Profile Feedback Dialog --- */}
      <ProfileFeedbackDialog
        isOpen={!!feedbackCandidate}
        onClose={() => setFeedbackCandidate(null)}
        candidate={feedbackCandidate}
        locale={locale}
        dict={matchmakerDict.candidatesManager.profileFeedbackDialog}
      />

      {/* Confirm Scan Dialog */}
      <AlertDialog open={confirmScanDialog} onOpenChange={setConfirmScanDialog}>
        <AlertDialogContent dir="rtl">
          <AlertDialogHeader>
            <AlertDialogTitle className="flex items-center gap-2">
              <Moon className="w-5 h-5 text-indigo-600" />
              ×”×¤×¢×œ×ª ×¡×¨×™×§×” ×œ×™×œ×™×ª
            </AlertDialogTitle>
            <AlertDialogDescription>
              ×”×¡×¨×™×§×” ×ª×¢×‘×•×¨ ×¢×œ ×›×œ ×”××•×¢××“×™× ×‘××¢×¨×›×ª ×•×ª××¦× ×”×ª×××•×ª ×¤×•×˜× ×¦×™××œ×™×•×ª ×—×“×©×•×ª.
              ×”×ª×”×œ×™×š ×¢×©×•×™ ×œ×§×—×ª ××¡×¤×¨ ×“×§×•×ª.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter className="gap-2">
            <AlertDialogCancel>×‘×™×˜×•×œ</AlertDialogCancel>
            <AlertDialogAction
              onClick={handleStartScan}
              className="bg-gradient-to-r from-indigo-500 to-purple-500"
            >
              <HeartHandshake className="w-4 h-4 ml-2" />
              ×”×ª×—×œ ×¡×¨×™×§×”
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>

      {/* Confirm Bulk Dismiss Dialog */}
      <AlertDialog
        open={confirmBulkDismissDialog}
        onOpenChange={setConfirmBulkDismissDialog}
      >
        <AlertDialogContent dir="rtl">
          <AlertDialogHeader>
            <AlertDialogTitle className="flex items-center gap-2 text-red-600">
              <Trash2 className="w-5 h-5" />
              ×“×—×™×™×ª {selectedMatchIds.length} ×”×ª×××•×ª
            </AlertDialogTitle>
            <AlertDialogDescription>
              ×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×“×—×•×ª ××ª ×›×œ ×”×”×ª×××•×ª ×©× ×‘×—×¨×•? × ×™×ª×Ÿ ×™×”×™×” ×œ×©×—×–×¨
              ××•×ª×Ÿ ×‘×”××©×š.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter className="gap-2">
            <AlertDialogCancel>×‘×™×˜×•×œ</AlertDialogCancel>
            <AlertDialogAction
              onClick={handleBulkDismiss}
              className="bg-red-600 hover:bg-red-700"
            >
              ×“×—×” ×”×›×œ
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>

      {/* Create Suggestion Dialog */}
      <Dialog
        open={!!createSuggestionDialog}
        onOpenChange={(open) => !open && setCreateSuggestionDialog(null)}
      >
        <DialogContent dir="rtl" className="max-w-md">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <HeartHandshake className="w-5 h-5 text-green-600" />
              ×™×¦×™×¨×ª ×”×¦×¢×”
            </DialogTitle>
            <DialogDescription>
              ×¦×•×¨ ×”×¦×¢×ª ×©×™×“×•×š ××”×”×ª×××” ×”×¤×•×˜× ×¦×™××œ×™×ª
            </DialogDescription>
          </DialogHeader>

          <div className="space-y-4">
            {/* Priority */}
            <div>
              <label className="text-sm font-medium text-gray-700 mb-2 block">
                ×¢×“×™×¤×•×ª
              </label>
              <Select
                value={suggestionPriority}
                onValueChange={(value) => setSuggestionPriority(value as any)}
              >
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="LOW">× ××•×›×”</SelectItem>
                  <SelectItem value="MEDIUM">×‘×™× ×•× ×™×ª</SelectItem>
                  <SelectItem value="HIGH">×’×‘×•×”×”</SelectItem>
                  <SelectItem value="URGENT">×“×—×•×¤×”</SelectItem>
                </SelectContent>
              </Select>
            </div>

            {/* Notes */}
            <div>
              <label className="text-sm font-medium text-gray-700 mb-2 block">
                ×”×¢×¨×•×ª ×œ×”×¦×¢×” (××•×¤×¦×™×•× ×œ×™)
              </label>
              <Textarea
                value={suggestionNotes}
                onChange={(e) => setSuggestionNotes(e.target.value)}
                placeholder="×”×•×¡×£ ×”×¢×¨×•×ª ××• ×¡×™×‘×ª ×”×”×ª×××”..."
                rows={3}
              />
            </div>
          </div>

          <DialogFooter className="gap-2">
            <Button
              variant="outline"
              onClick={() => setCreateSuggestionDialog(null)}
            >
              ×‘×™×˜×•×œ
            </Button>
            <Button
              onClick={handleCreateSuggestion}
              disabled={isActioning}
              className="bg-gradient-to-r from-green-500 to-emerald-500"
            >
              {isActioning ? (
                <Loader2 className="w-4 h-4 ml-2 animate-spin" />
              ) : (
                <HeartHandshake className="w-4 h-4 ml-2" />
              )}
              ×¦×•×¨ ×”×¦×¢×”
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      <HideCandidateDialog
        open={showHideDialog}
        onOpenChange={setShowHideDialog}
        candidate={candidateToHide}
        onConfirm={handleConfirmHide}
      />

      {/* Dismiss Dialog (×œ×œ× ××©×•×‘ - ××©××© ×¢×“×™×™×Ÿ ×›×’×™×‘×•×™ ××• ×¢×‘×•×¨ ×”×ª×××•×ª ×©×›×‘×¨ × ×“×—×•) 
          ×”×”×¢×¨×”: ×œ×¨×•×‘ ×”×©×™××•×© ×›×¢×ª ×¢×•×‘×¨ ×œ-RejectionFeedbackModal ×‘×ª×•×š ×”×§××¨×“,
          ××‘×œ ×–×” × ×©××¨ ×¤×” ×¢×‘×•×¨ Bulk Actions ××• ×§×¨×™××•×ª ×™×©×™×¨×•×ª ×× ×™×©× ×Ÿ. 
      */}
      <Dialog
        open={!!dismissDialog}
        onOpenChange={(open) => !open && setDismissDialog(null)}
      >
        <DialogContent dir="rtl" className="max-w-md">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2 text-red-600">
              <X className="w-5 h-5" />
              ×“×—×™×™×ª ×”×ª×××”
            </DialogTitle>
            <DialogDescription>
              × ×™×ª×Ÿ ×œ×¦×™×™×Ÿ ×¡×™×‘×” ×œ×“×—×™×™×” (××•×¤×¦×™×•× ×œ×™)
            </DialogDescription>
          </DialogHeader>

          <div>
            <Textarea
              value={dismissReason}
              onChange={(e) => setDismissReason(e.target.value)}
              placeholder="×¡×™×‘×ª ×”×“×—×™×™×”..."
              rows={3}
            />
          </div>

          <DialogFooter className="gap-2">
            <Button variant="outline" onClick={() => setDismissDialog(null)}>
              ×‘×™×˜×•×œ
            </Button>
            <Button
              onClick={handleDismiss}
              disabled={isActioning}
              variant="destructive"
            >
              {isActioning ? (
                <Loader2 className="w-4 h-4 ml-2 animate-spin" />
              ) : (
                <X className="w-4 h-4 ml-2" />
              )}
              ×“×—×”
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  );
};

export default PotentialMatchesDashboard;
--- End of Content for PotentialMatchesDashboard.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches\PotentialMatchesStats.tsx
--------------------------------------------------------------------------------
Content:
// =============================================================================
// src/components/matchmaker/PotentialMatches/PotentialMatchesStats.tsx
// ×¡×˜×˜×™×¡×˜×™×§×•×ª ×”×ª×××•×ª ×¤×•×˜× ×¦×™××œ×™×•×ª
// =============================================================================

'use client';

import React from 'react';
import { Card } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import {
  Clock,
  Eye,
  Send,
  X,
  AlertTriangle,
  TrendingUp,
  Star,
  Heart,
  CheckCircle,
  Calendar,
  Timer,
  Sparkles,
} from 'lucide-react';
import { cn } from '@/lib/utils';
import { formatDistanceToNow } from 'date-fns';
import { he } from 'date-fns/locale';
import type { PotentialMatchesStats as StatsType, LastScanInfo } from './types/potentialMatches';

// =============================================================================
// TYPES
// =============================================================================

interface PotentialMatchesStatsProps {
  stats: StatsType | null;
  lastScanInfo: LastScanInfo | null;
  isScanRunning?: boolean;
  scanProgress?: number;
  className?: string;
}

// =============================================================================
// SUB-COMPONENTS
// =============================================================================

interface StatCardProps {
  icon: React.ElementType;
  label: string;
  value: number | string;
  subValue?: string;
  gradient: string;
  iconColor: string;
  onClick?: () => void;
}

const StatCard: React.FC<StatCardProps> = ({
  icon: Icon,
  label,
  value,
  subValue,
  gradient,
  iconColor,
  onClick,
}) => (
  <Card
    className={cn(
      'relative overflow-hidden p-4 border-0 shadow-lg transition-all duration-300',
      'hover:shadow-xl hover:scale-105 cursor-pointer',
      `bg-gradient-to-br ${gradient}`
    )}
    onClick={onClick}
  >
    {/* Background Pattern */}
    <div className="absolute top-0 right-0 w-20 h-20 opacity-10">
      <svg viewBox="0 0 80 80" fill="currentColor">
        <circle cx="60" cy="20" r="40" />
      </svg>
    </div>

    <div className="relative flex items-start justify-between">
      <div>
        <p className="text-sm font-medium text-gray-600 mb-1">{label}</p>
        <p className="text-3xl font-bold text-gray-800">{value}</p>
        {subValue && (
          <p className="text-xs text-gray-500 mt-1">{subValue}</p>
        )}
      </div>
      <div className={cn(
        'p-3 rounded-xl shadow-lg',
        iconColor
      )}>
        <Icon className="w-6 h-6 text-white" />
      </div>
    </div>
  </Card>
);

// =============================================================================
// MAIN COMPONENT
// =============================================================================

const PotentialMatchesStats: React.FC<PotentialMatchesStatsProps> = ({
  stats,
  lastScanInfo,
  isScanRunning = false,
  scanProgress = 0,
  className,
}) => {
  if (!stats) {
    return (
      <div className={cn('grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4', className)}>
        {[...Array(6)].map((_, i) => (
          <Card key={i} className="p-4 animate-pulse">
            <div className="h-4 w-20 bg-gray-200 rounded mb-2" />
            <div className="h-8 w-16 bg-gray-200 rounded" />
          </Card>
        ))}
      </div>
    );
  }

  return (
    <div className={cn('space-y-6', className)}>
      {/* Main Stats Grid */}
      <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
        <StatCard
          icon={Heart}
          label="×¡×”×´×› ×”×ª×××•×ª"
          value={stats.total}
          gradient="from-pink-50 to-rose-100"
          iconColor="bg-gradient-to-br from-pink-500 to-rose-500"
        />
        
        <StatCard
          icon={Clock}
          label="×××ª×™× ×•×ª"
          value={stats.pending}
          subValue="×˜×¨× × ×‘×“×§×•"
          gradient="from-amber-50 to-yellow-100"
          iconColor="bg-gradient-to-br from-amber-500 to-yellow-500"
        />
        
        <StatCard
          icon={Eye}
          label="× ×‘×“×§×•"
          value={stats.reviewed}
          gradient="from-blue-50 to-cyan-100"
          iconColor="bg-gradient-to-br from-blue-500 to-cyan-500"
        />
        
        <StatCard
          icon={Send}
          label="× ×©×œ×—×• ×”×¦×¢×•×ª"
          value={stats.sent}
          gradient="from-green-50 to-emerald-100"
          iconColor="bg-gradient-to-br from-green-500 to-emerald-500"
        />
        
        <StatCard
          icon={X}
          label="× ×“×—×•"
          value={stats.dismissed}
          gradient="from-gray-50 to-slate-100"
          iconColor="bg-gradient-to-br from-gray-500 to-slate-500"
        />
        
        <StatCard
          icon={AlertTriangle}
          label="×¢× ××–×”×¨×•×ª"
          value={stats.withWarnings}
          subValue="×‘×”×¦×¢×” ×¤×¢×™×œ×”"
          gradient="from-orange-50 to-amber-100"
          iconColor="bg-gradient-to-br from-orange-500 to-amber-500"
        />
      </div>

      {/* Score Distribution & Last Scan */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        {/* Score Distribution */}
        <Card className="p-6 border-0 shadow-lg bg-gradient-to-br from-white to-purple-50">
          <div className="flex items-center gap-3 mb-4">
            <div className="p-2 rounded-lg bg-gradient-to-br from-purple-500 to-indigo-500">
              <Star className="w-5 h-5 text-white" />
            </div>
            <div>
              <h3 className="font-bold text-gray-800">×”×ª×¤×œ×’×•×ª ×¦×™×•× ×™×</h3>
              <p className="text-sm text-gray-500">×¦×™×•×Ÿ ×××•×¦×¢: {stats.avgScore}</p>
            </div>
          </div>

          <div className="space-y-4">
            {/* High Score (85+) */}
            <div>
              <div className="flex items-center justify-between mb-1">
                <span className="text-sm font-medium text-emerald-700 flex items-center gap-1">
                  <Sparkles className="w-4 h-4" />
                  ×¦×™×•×Ÿ ×’×‘×•×” (85+)
                </span>
                <span className="text-sm text-gray-600">{stats.highScore}</span>
              </div>
              <Progress 
                value={(stats.highScore / (stats.total || 1)) * 100} 
                className="h-2 bg-gray-200"
              />
            </div>

            {/* Medium Score (70-85) */}
            <div>
              <div className="flex items-center justify-between mb-1">
                <span className="text-sm font-medium text-blue-700 flex items-center gap-1">
                  <TrendingUp className="w-4 h-4" />
                  ×¦×™×•×Ÿ ×‘×™× ×•× ×™ (70-84)
                </span>
                <span className="text-sm text-gray-600">{stats.mediumScore}</span>
              </div>
              <Progress 
                value={(stats.mediumScore / (stats.total || 1)) * 100} 
                className="h-2 bg-gray-200"
              />
            </div>

            {/* Pie visualization */}
            <div className="flex items-center justify-center gap-4 mt-4 pt-4 border-t">
              <div className="flex items-center gap-2">
                <div className="w-3 h-3 rounded-full bg-emerald-500" />
                <span className="text-xs text-gray-600">×’×‘×•×”</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-3 h-3 rounded-full bg-blue-500" />
                <span className="text-xs text-gray-600">×‘×™× ×•× ×™</span>
              </div>
            </div>
          </div>
        </Card>

        {/* Last Scan Info */}
        <Card className="p-6 border-0 shadow-lg bg-gradient-to-br from-white to-cyan-50">
          <div className="flex items-center gap-3 mb-4">
            <div className="p-2 rounded-lg bg-gradient-to-br from-cyan-500 to-blue-500">
              <Calendar className="w-5 h-5 text-white" />
            </div>
            <div>
              <h3 className="font-bold text-gray-800">×¡×¨×™×§×” ××—×¨×•× ×”</h3>
              <p className="text-sm text-gray-500">
                {lastScanInfo ? (
                  formatDistanceToNow(new Date(lastScanInfo.startedAt), { 
                    addSuffix: true, 
                    locale: he 
                  })
                ) : '×œ× ×‘×•×¦×¢×” ×¢×“×™×™×Ÿ'}
              </p>
            </div>
          </div>

          {/* Scan Running Progress */}
          {isScanRunning && (
            <div className="mb-4 p-4 rounded-lg bg-blue-50 border border-blue-200">
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm font-medium text-blue-700 flex items-center gap-2">
                  <Timer className="w-4 h-4 animate-spin" />
                  ×¡×¨×™×§×” ×‘×ª×”×œ×™×š...
                </span>
                <span className="text-sm text-blue-600">{scanProgress}%</span>
              </div>
              <Progress value={scanProgress} className="h-2" />
            </div>
          )}

          {lastScanInfo && !isScanRunning && (
            <div className="space-y-3">
              {/* Status */}
              <div className="flex items-center justify-between p-3 rounded-lg bg-white/60">
                <span className="text-sm text-gray-600">×¡×˜×˜×•×¡</span>
                <Badge className={cn(
                  lastScanInfo.status === 'completed' 
                    ? 'bg-green-100 text-green-700' 
                    : lastScanInfo.status === 'partial'
                    ? 'bg-amber-100 text-amber-700'
                    : 'bg-red-100 text-red-700'
                )}>
                  {lastScanInfo.status === 'completed' ? '×”×•×©×œ×' : 
                   lastScanInfo.status === 'partial' ? '×”×•×©×œ× ×—×œ×§×™×ª' : '× ×›×©×œ'}
                </Badge>
              </div>

              {/* Candidates Scanned */}
              <div className="flex items-center justify-between p-3 rounded-lg bg-white/60">
                <span className="text-sm text-gray-600">××•×¢××“×™× ×©× ×¡×¨×§×•</span>
                <span className="font-medium text-gray-800">
                  {lastScanInfo.candidatesScanned} / {lastScanInfo.totalCandidates}
                </span>
              </div>

              {/* Matches Found */}
              <div className="flex items-center justify-between p-3 rounded-lg bg-white/60">
                <span className="text-sm text-gray-600">×”×ª×××•×ª ×©× ××¦××•</span>
                <span className="font-medium text-gray-800 flex items-center gap-1">
                  <Heart className="w-4 h-4 text-pink-500" />
                  {lastScanInfo.matchesFound}
                </span>
              </div>

              {/* New Matches */}
              <div className="flex items-center justify-between p-3 rounded-lg bg-white/60">
                <span className="text-sm text-gray-600">×”×ª×××•×ª ×—×“×©×•×ª</span>
                <span className="font-medium text-emerald-600 flex items-center gap-1">
                  <CheckCircle className="w-4 h-4" />
                  {lastScanInfo.newMatches}
                </span>
              </div>

              {/* Duration */}
              {lastScanInfo.durationMs && (
                <div className="flex items-center justify-between p-3 rounded-lg bg-white/60">
                  <span className="text-sm text-gray-600">××©×š ×”×¡×¨×™×§×”</span>
                  <span className="font-medium text-gray-800">
                    {Math.round(lastScanInfo.durationMs / 1000 / 60)} ×“×§×•×ª
                  </span>
                </div>
              )}
            </div>
          )}

          {!lastScanInfo && !isScanRunning && (
            <div className="text-center py-8 text-gray-500">
              <Calendar className="w-12 h-12 mx-auto mb-2 opacity-50" />
              <p>×˜×¨× ×‘×•×¦×¢×” ×¡×¨×™×§×”</p>
              <p className="text-sm">×”×¤×¢×œ ×¡×¨×™×§×” ×œ×™×œ×™×ª ×œ××¦×™××ª ×”×ª×××•×ª</p>
            </div>
          )}
        </Card>
      </div>
    </div>
  );
};

export default PotentialMatchesStats;
--- End of Content for PotentialMatchesStats.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches\PotentialMatches_contents.txt
--------------------------------------------------------------------------------
[This is the output log file itself. Content not included.]

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches\RejectionFeedbackModal.tsx
--------------------------------------------------------------------------------
Content:
// =============================================================================
// ğŸ“ src/components/matchmaker/RejectionFeedbackModal.tsx
// =============================================================================
// ğŸ¯ Rejection Feedback Modal V1.0 - NeshamaTech
// 
// ××•×“×œ ×œ×ª×™×¢×•×“ ×¡×™×‘×ª ×“×—×™×™×” ×‘×¦×•×¨×” ××•×‘× ×™×ª
// =============================================================================

"use client";

import React, { useState, useEffect } from "react";
import { motion, AnimatePresence } from "framer-motion";
import {
  X,
  AlertTriangle,
  Clock,
  User,
  Flag,
  HelpCircle,
  Check,
  ChevronDown,
  ChevronUp,
} from "lucide-react";

// =============================================================================
// TYPES
// =============================================================================

type RejectionCategory =
  | 'AGE_GAP'
  | 'RELIGIOUS_GAP'
  | 'BACKGROUND_GAP'
  | 'EDUCATION_GAP'
  | 'GEOGRAPHIC_GAP'
  | 'KNOWS_PERSONALLY'
  | 'NOT_ATTRACTED'
  | 'NOT_INTERESTING'
  | 'NO_CONNECTION'
  | 'GUT_FEELING'
  | 'SOMETHING_OFF'
  | 'NOT_AVAILABLE_NOW'
  | 'IN_PROCESS_WITH_OTHER'
  | 'NEEDS_TIME'
  | 'EXTERNAL_PRESSURE'
  | 'INCONSISTENT_STORY'
  | 'PROBLEMATIC_BEHAVIOR'
  | 'UNREALISTIC_EXPECTATIONS'
  | 'CONCERNING_HISTORY'
  | 'OTHER';

interface CategoryInfo {
  value: RejectionCategory;
  label: string;
  labelEn: string;
  group: 'objective' | 'subjective' | 'timing' | 'red_flag' | 'other';
  description: string;
}

interface RejectionFeedbackModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSubmit: (data: RejectionFeedbackData) => Promise<void>;
  
  // Context
  rejectedUser: {
    id: string;
    firstName: string;
    lastName: string;
  };
  rejectingUser: {
    id: string;
    firstName: string;
    lastName: string;
  };
  suggestionId?: string;
  potentialMatchId?: string;
}

interface RejectionFeedbackData {
  rejectedUserId: string;
  rejectingUserId: string;
  suggestionId?: string;
  potentialMatchId?: string;
  category: RejectionCategory;
  subcategory?: string;
  freeText?: string;
  wasExpected?: boolean;
}

// =============================================================================
// CATEGORY DATA
// =============================================================================

const CATEGORY_GROUPS: Record<string, { title: string; icon: React.ReactNode; color: string }> = {
  objective: {
    title: "×¡×™×‘×•×ª ××•×‘×™×™×§×˜×™×‘×™×•×ª",
    icon: <User size={16} />,
    color: "blue",
  },
  subjective: {
    title: "×¡×™×‘×•×ª ×¡×•×‘×™×™×§×˜×™×‘×™×•×ª",
    icon: <HelpCircle size={16} />,
    color: "purple",
  },
  timing: {
    title: "×¡×™×‘×•×ª ×ª×–××•×Ÿ",
    icon: <Clock size={16} />,
    color: "orange",
  },
  red_flag: {
    title: "Red Flags",
    icon: <Flag size={16} />,
    color: "red",
  },
  other: {
    title: "××—×¨",
    icon: <HelpCircle size={16} />,
    color: "gray",
  },
};

const DEFAULT_CATEGORIES: CategoryInfo[] = [
  // Objective
  { value: 'AGE_GAP', label: '×¤×¢×¨ ×’×™×œ ×’×“×•×œ ××“×™', labelEn: 'Age Gap', group: 'objective', description: '' },
  { value: 'RELIGIOUS_GAP', label: '×¤×¢×¨ ×¨××” ×“×ª×™×ª', labelEn: 'Religious Gap', group: 'objective', description: '' },
  { value: 'BACKGROUND_GAP', label: '×¤×¢×¨ ×¨×§×¢/×¢×“×”', labelEn: 'Background Gap', group: 'objective', description: '' },
  { value: 'EDUCATION_GAP', label: '×¤×¢×¨ ×”×©×›×œ×”/×§×¨×™×™×¨×”', labelEn: 'Education Gap', group: 'objective', description: '' },
  { value: 'GEOGRAPHIC_GAP', label: '×¤×¢×¨ ×’×™××•×’×¨×¤×™', labelEn: 'Geographic Gap', group: 'objective', description: '' },
  { value: 'KNOWS_PERSONALLY', label: '××›×™×¨/×” ××™×©×™×ª', labelEn: 'Knows Personally', group: 'objective', description: '' },
  // Subjective
  { value: 'NOT_ATTRACTED', label: '×œ× ××•×©×š/×ª', labelEn: 'Not Attracted', group: 'subjective', description: '' },
  { value: 'NOT_INTERESTING', label: '×œ× ××¢× ×™×™×Ÿ/×ª', labelEn: 'Not Interesting', group: 'subjective', description: '' },
  { value: 'NO_CONNECTION', label: '×œ× ×”×¨×’×©×ª×™ ×—×™×‘×•×¨', labelEn: 'No Connection', group: 'subjective', description: '' },
  { value: 'GUT_FEELING', label: '×ª×—×•×©×ª ×‘×˜×Ÿ ×©×œ×™×œ×™×ª', labelEn: 'Gut Feeling', group: 'subjective', description: '' },
  { value: 'SOMETHING_OFF', label: '××©×”×• ×œ× ×”×¡×ª×“×¨ ×œ×™', labelEn: 'Something Off', group: 'subjective', description: '' },
  // Timing
  { value: 'NOT_AVAILABLE_NOW', label: '×œ× ×–××™×Ÿ/×” ×›×¨×’×¢', labelEn: 'Not Available Now', group: 'timing', description: '' },
  { value: 'IN_PROCESS_WITH_OTHER', label: '×‘×ª×”×œ×™×š ×¢× ××™×©×”×• ××—×¨', labelEn: 'In Process', group: 'timing', description: '' },
  { value: 'NEEDS_TIME', label: '×¦×¨×™×š/×” ×–××Ÿ ×œ×—×©×•×‘', labelEn: 'Needs Time', group: 'timing', description: '' },
  { value: 'EXTERNAL_PRESSURE', label: '×œ×—×¥ ×—×™×¦×•× ×™', labelEn: 'External Pressure', group: 'timing', description: '' },
  // Red Flags
  { value: 'INCONSISTENT_STORY', label: '×—×•×¡×¨ ×¢×§×‘×™×•×ª ×‘×¡×™×¤×•×¨', labelEn: 'Inconsistent Story', group: 'red_flag', description: '' },
  { value: 'PROBLEMATIC_BEHAVIOR', label: '×”×ª× ×”×’×•×ª ×‘×¢×™×™×ª×™×ª', labelEn: 'Problematic Behavior', group: 'red_flag', description: '' },
  { value: 'UNREALISTIC_EXPECTATIONS', label: '×¦×™×¤×™×•×ª ×œ× ×¨×™××œ×™×¡×˜×™×•×ª', labelEn: 'Unrealistic Expectations', group: 'red_flag', description: '' },
  { value: 'CONCERNING_HISTORY', label: '×”×™×¡×˜×•×¨×™×” ××“××™×’×”', labelEn: 'Concerning History', group: 'red_flag', description: '' },
  // Other
  { value: 'OTHER', label: '×¡×™×‘×” ××—×¨×ª', labelEn: 'Other', group: 'other', description: '' },
];

// =============================================================================
// COMPONENT
// =============================================================================

export default function RejectionFeedbackModal({
  isOpen,
  onClose,
  onSubmit,
  rejectedUser,
  rejectingUser,
  suggestionId,
  potentialMatchId,
}: RejectionFeedbackModalProps) {
  const [categories, setCategories] = useState<CategoryInfo[]>(DEFAULT_CATEGORIES);
  const [selectedCategory, setSelectedCategory] = useState<RejectionCategory | null>(null);
  const [freeText, setFreeText] = useState("");
  const [wasExpected, setWasExpected] = useState<boolean | null>(null);
  const [submitting, setSubmitting] = useState(false);
  const [expandedGroup, setExpandedGroup] = useState<string | null>("objective");
  const [error, setError] = useState<string | null>(null);

  // Fetch categories from API
  useEffect(() => {
    async function fetchCategories() {
      try {
        const response = await fetch("/api/matchmaker/rejection-feedback?action=categories");
        if (response.ok) {
          const data = await response.json();
          if (data.categories) {
            setCategories(data.categories);
          }
        }
      } catch (err) {
        // Use default categories
        console.warn("Could not fetch categories, using defaults");
      }
    }
    
    if (isOpen) {
      fetchCategories();
    }
  }, [isOpen]);

  // Reset on open
  useEffect(() => {
    if (isOpen) {
      setSelectedCategory(null);
      setFreeText("");
      setWasExpected(null);
      setError(null);
      setExpandedGroup("objective");
    }
  }, [isOpen]);

  // Group categories
  const groupedCategories = categories.reduce((acc, cat) => {
    if (!acc[cat.group]) acc[cat.group] = [];
    acc[cat.group].push(cat);
    return acc;
  }, {} as Record<string, CategoryInfo[]>);

  // Handle submit
  const handleSubmit = async () => {
    if (!selectedCategory) {
      setError("×™×© ×œ×‘×—×•×¨ ×¡×™×‘×ª ×“×—×™×™×”");
      return;
    }

    setSubmitting(true);
    setError(null);

    try {
      await onSubmit({
        rejectedUserId: rejectedUser.id,
        rejectingUserId: rejectingUser.id,
        suggestionId,
        potentialMatchId,
        category: selectedCategory,
        freeText: freeText.trim() || undefined,
        wasExpected: wasExpected ?? undefined,
      });

      onClose();
    } catch (err) {
      setError(err instanceof Error ? err.message : "×©×’×™××” ×‘×©××™×¨×ª ×”×¤×™×“×‘×§");
    } finally {
      setSubmitting(false);
    }
  };

  // Toggle group
  const toggleGroup = (group: string) => {
    setExpandedGroup(expandedGroup === group ? null : group);
  };

  if (!isOpen) return null;

  return (
    <AnimatePresence>
      {isOpen && (
        <>
          {/* Backdrop */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={onClose}
            className="fixed inset-0 bg-black/50 z-50"
          />

          {/* Modal */}
          <motion.div
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            exit={{ opacity: 0, scale: 0.95 }}
            className="fixed inset-4 md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 md:w-[500px] md:max-h-[80vh] bg-white rounded-2xl shadow-xl z-50 overflow-hidden flex flex-col"
            dir="rtl"
          >
            {/* Header */}
            <div className="flex items-center justify-between p-4 border-b bg-gray-50">
              <h2 className="text-lg font-bold text-gray-800">×ª×™×¢×•×“ ×¡×™×‘×ª ×“×—×™×™×”</h2>
              <button
                onClick={onClose}
                className="p-2 hover:bg-gray-200 rounded-full transition-colors"
              >
                <X size={20} />
              </button>
            </div>

            {/* Context */}
            <div className="px-4 py-3 bg-blue-50 border-b border-blue-100">
              <p className="text-sm text-blue-800">
                <span className="font-medium">{rejectingUser.firstName} {rejectingUser.lastName}</span>
                {" "}×“×—×” ××ª{" "}
                <span className="font-medium">{rejectedUser.firstName} {rejectedUser.lastName}</span>
              </p>
            </div>

            {/* Content */}
            <div className="flex-1 overflow-y-auto p-4 space-y-4">
              {/* Error */}
              {error && (
                <div className="p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm flex items-center gap-2">
                  <AlertTriangle size={16} />
                  {error}
                </div>
              )}

              {/* Categories */}
              <div className="space-y-2">
                <label className="text-sm font-medium text-gray-700">×¡×™×‘×ª ×”×“×—×™×™×”</label>
                
                {Object.entries(CATEGORY_GROUPS).map(([group, info]) => {
                  const groupCats = groupedCategories[group] || [];
                  if (groupCats.length === 0) return null;

                  const isExpanded = expandedGroup === group;
                  const colorClass = {
                    blue: "border-blue-200 bg-blue-50",
                    purple: "border-purple-200 bg-purple-50",
                    orange: "border-orange-200 bg-orange-50",
                    red: "border-red-200 bg-red-50",
                    gray: "border-gray-200 bg-gray-50",
                  }[info.color] || "border-gray-200 bg-gray-50";

                  return (
                    <div key={group} className={`rounded-lg border ${colorClass} overflow-hidden`}>
                      {/* Group Header */}
                      <button
                        onClick={() => toggleGroup(group)}
                        className="w-full flex items-center justify-between p-3 text-sm font-medium"
                      >
                        <span className="flex items-center gap-2">
                          {info.icon}
                          {info.title}
                        </span>
                        {isExpanded ? <ChevronUp size={16} /> : <ChevronDown size={16} />}
                      </button>

                      {/* Group Items */}
                      <AnimatePresence>
                        {isExpanded && (
                          <motion.div
                            initial={{ height: 0, opacity: 0 }}
                            animate={{ height: "auto", opacity: 1 }}
                            exit={{ height: 0, opacity: 0 }}
                            className="px-3 pb-3 space-y-1"
                          >
                            {groupCats.map((cat) => (
                              <button
                                key={cat.value}
                                onClick={() => setSelectedCategory(cat.value)}
                                className={`w-full flex items-center gap-2 p-2 rounded-lg text-sm text-right transition-colors ${
                                  selectedCategory === cat.value
                                    ? "bg-primary text-white"
                                    : "bg-white hover:bg-gray-100 text-gray-700"
                                }`}
                              >
                                {selectedCategory === cat.value && <Check size={14} />}
                                <span className="flex-1">{cat.label}</span>
                              </button>
                            ))}
                          </motion.div>
                        )}
                      </AnimatePresence>
                    </div>
                  );
                })}
              </div>

              {/* Was Expected */}
              <div className="space-y-2">
                <label className="text-sm font-medium text-gray-700">
                  ×”×× ×”×“×—×™×™×” ×”×™×™×ª×” ×¦×¤×•×™×”?
                </label>
                <div className="flex gap-2">
                  <button
                    onClick={() => setWasExpected(true)}
                    className={`flex-1 py-2 rounded-lg text-sm transition-colors ${
                      wasExpected === true
                        ? "bg-green-500 text-white"
                        : "bg-gray-100 text-gray-600 hover:bg-gray-200"
                    }`}
                  >
                    ×›×Ÿ, ×¦×¤×™×ª×™ ×œ×–×”
                  </button>
                  <button
                    onClick={() => setWasExpected(false)}
                    className={`flex-1 py-2 rounded-lg text-sm transition-colors ${
                      wasExpected === false
                        ? "bg-orange-500 text-white"
                        : "bg-gray-100 text-gray-600 hover:bg-gray-200"
                    }`}
                  >
                    ×œ×, ×”×¤×ª×™×¢ ××•×ª×™
                  </button>
                </div>
              </div>

              {/* Free Text */}
              <div className="space-y-2">
                <label className="text-sm font-medium text-gray-700">
                  ×¤×™×¨×•×˜ × ×•×¡×£ (××•×¤×¦×™×•× ×œ×™)
                </label>
                <textarea
                  value={freeText}
                  onChange={(e) => setFreeText(e.target.value)}
                  placeholder="×”×•×¡×£ ××™×“×¢ × ×•×¡×£ ×©×™×¢×–×•×¨ ×œ×”×‘×™×Ÿ ××ª ×”×“×—×™×™×”..."
                  rows={3}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm resize-none focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
            </div>

            {/* Footer */}
            <div className="p-4 border-t bg-gray-50 flex gap-3">
              <button
                onClick={onClose}
                className="flex-1 py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors"
              >
                ×‘×™×˜×•×œ
              </button>
              <button
                onClick={handleSubmit}
                disabled={!selectedCategory || submitting}
                className="flex-1 py-2 px-4 bg-primary text-white rounded-lg hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"
              >
                {submitting ? (
                  <>
                    <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                    ×©×•××¨...
                  </>
                ) : (
                  <>
                    <Check size={16} />
                    ×©××•×¨
                  </>
                )}
              </button>
            </div>
          </motion.div>
        </>
      )}
    </AnimatePresence>
  );
}

// =============================================================================
// HOOK FOR EASY USAGE
// =============================================================================

export function useRejectionFeedback() {
  const [isOpen, setIsOpen] = useState(false);
  const [context, setContext] = useState<{
    rejectedUser: { id: string; firstName: string; lastName: string };
    rejectingUser: { id: string; firstName: string; lastName: string };
    suggestionId?: string;
    potentialMatchId?: string;
  } | null>(null);

  const open = (data: NonNullable<typeof context>) => {
    setContext(data);
    setIsOpen(true);
  };

  const close = () => {
    setIsOpen(false);
    setContext(null);
  };

  const submit = async (data: RejectionFeedbackData) => {
    const response = await fetch("/api/matchmaker/rejection-feedback", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data),
    });

    if (!response.ok) {
      throw new Error("Failed to save rejection feedback");
    }
  };

  return {
    isOpen,
    context,
    open,
    close,
    submit,
  };
}
--- End of Content for RejectionFeedbackModal.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches\index.ts
--------------------------------------------------------------------------------
Content:
// =============================================================================
// src/components/matchmaker/PotentialMatches/index.ts
// Export file for PotentialMatches components
// =============================================================================

// Main Dashboard Component
export { default as PotentialMatchesDashboard } from './PotentialMatchesDashboard';
export { default } from './PotentialMatchesDashboard';

// Sub-components
export { default as PotentialMatchCard } from './PotentialMatchCard';
export { default as PotentialMatchesStats } from './PotentialMatchesStats';

// Hooks
export { usePotentialMatches } from './hooks/usePotentialMatches';

// Re-export types
export type {
  PotentialMatch,
  PotentialMatchesResponse,
  LastScanInfo,
  PotentialMatchFilters,
  PotentialMatchSortBy,
  PotentialMatchFilterStatus,
  PotentialMatchAction,
  BatchScanResponse,
  BatchScanProgress,
  ScoreBreakdown,
  CandidateBasicInfo,
  ActiveSuggestionInfo,
} from './types/potentialMatches';
--- End of Content for index.ts ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches\hooks
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches\hooks\useHiddenCandidates.ts
--------------------------------------------------------------------------------
Content:
// src/hooks/useHiddenCandidates.ts

import { useState, useEffect, useCallback } from 'react';
import { toast } from 'sonner';

// =============================================================================
// TYPES
// =============================================================================

export interface HiddenCandidateInfo {
  id: string; // ID ×©×œ ×¨×©×•××ª ×”×”×¡×ª×¨×”
  candidateId: string;
  reason: string | null;
  hiddenAt: string;
  candidate: {
    id: string;
    firstName: string;
    lastName: string;
    phone: string | null;
    mainImage: string | null;
    gender: 'MALE' | 'FEMALE' | null;
    city: string | null;
    religiousLevel: string | null;
    availabilityStatus: string | null;
  };
}

interface UseHiddenCandidatesReturn {
  // State
  hiddenCandidates: HiddenCandidateInfo[];
  hiddenCandidateIds: Set<string>;
  isLoading: boolean;
  error: string | null;
  
  // Actions
  hideCandidate: (candidateId: string, reason?: string) => Promise<boolean>;
  unhideCandidate: (hiddenRecordId: string) => Promise<boolean>;
  updateReason: (hiddenRecordId: string, reason: string) => Promise<boolean>;
  refreshHiddenCandidates: () => Promise<void>;
  
  // Helpers
  isHidden: (candidateId: string) => boolean;
  getHiddenRecord: (candidateId: string) => HiddenCandidateInfo | undefined;
}

// =============================================================================
// HOOK
// =============================================================================

export function useHiddenCandidates(): UseHiddenCandidatesReturn {
  const [hiddenCandidates, setHiddenCandidates] = useState<HiddenCandidateInfo[]>([]);
  const [hiddenCandidateIds, setHiddenCandidateIds] = useState<Set<string>>(new Set());
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  // =============================================================================
  // FETCH HIDDEN CANDIDATES
  // =============================================================================
  const refreshHiddenCandidates = useCallback(async () => {
    try {
      setIsLoading(true);
      setError(null);

      const response = await fetch('/api/matchmaker/hidden-candidates');
      const data = await response.json();

      if (!response.ok || !data.success) {
        throw new Error(data.error || 'Failed to fetch hidden candidates');
      }

      setHiddenCandidates(data.hiddenCandidates);
      setHiddenCandidateIds(new Set(data.hiddenCandidates.map((hc: HiddenCandidateInfo) => hc.candidateId)));

    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'Unknown error';
      setError(errorMessage);
      console.error('Error fetching hidden candidates:', err);
    } finally {
      setIsLoading(false);
    }
  }, []);

  // Initial fetch
  useEffect(() => {
    refreshHiddenCandidates();
  }, [refreshHiddenCandidates]);

  // =============================================================================
  // HIDE CANDIDATE
  // =============================================================================
  const hideCandidate = useCallback(async (candidateId: string, reason?: string): Promise<boolean> => {
    try {
      const response = await fetch('/api/matchmaker/hidden-candidates', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ candidateId, reason }),
      });

      const data = await response.json();

      if (!response.ok || !data.success) {
        throw new Error(data.error || 'Failed to hide candidate');
      }

      // Optimistic update
      setHiddenCandidateIds(prev => new Set([...prev, candidateId]));
      
      // Refresh full list
      await refreshHiddenCandidates();

      toast.success(data.message || '×”××•×¢××“ ×”×•×¡×ª×¨ ×‘×”×¦×œ×—×”');
      return true;

    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'Unknown error';
      toast.error(`×©×’×™××” ×‘×”×¡×ª×¨×ª ×”××•×¢××“: ${errorMessage}`);
      console.error('Error hiding candidate:', err);
      return false;
    }
  }, [refreshHiddenCandidates]);

  // =============================================================================
  // UNHIDE CANDIDATE
  // =============================================================================
  const unhideCandidate = useCallback(async (hiddenRecordId: string): Promise<boolean> => {
    try {
      // Find the candidate ID before deletion for optimistic update
      const record = hiddenCandidates.find(hc => hc.id === hiddenRecordId);
      const candidateId = record?.candidateId;

      const response = await fetch(`/api/matchmaker/hidden-candidates/${hiddenRecordId}`, {
        method: 'DELETE',
      });

      const data = await response.json();

      if (!response.ok || !data.success) {
        throw new Error(data.error || 'Failed to unhide candidate');
      }

      // Optimistic update
      if (candidateId) {
        setHiddenCandidateIds(prev => {
          const newSet = new Set(prev);
          newSet.delete(candidateId);
          return newSet;
        });
        setHiddenCandidates(prev => prev.filter(hc => hc.id !== hiddenRecordId));
      }

      toast.success(data.message || '×”××•×¢××“ ×”×•×—×–×¨ ×œ×¨×©×™××”');
      return true;

    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'Unknown error';
      toast.error(`×©×’×™××” ×‘×”×—×–×¨×ª ×”××•×¢××“: ${errorMessage}`);
      console.error('Error unhiding candidate:', err);
      return false;
    }
  }, [hiddenCandidates]);

  // =============================================================================
  // UPDATE REASON
  // =============================================================================
  const updateReason = useCallback(async (hiddenRecordId: string, reason: string): Promise<boolean> => {
    try {
      const response = await fetch(`/api/matchmaker/hidden-candidates/${hiddenRecordId}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ reason }),
      });

      const data = await response.json();

      if (!response.ok || !data.success) {
        throw new Error(data.error || 'Failed to update reason');
      }

      // Update local state
      setHiddenCandidates(prev => 
        prev.map(hc => 
          hc.id === hiddenRecordId 
            ? { ...hc, reason } 
            : hc
        )
      );

      toast.success('×”×¡×™×‘×” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”');
      return true;

    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'Unknown error';
      toast.error(`×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¡×™×‘×”: ${errorMessage}`);
      console.error('Error updating reason:', err);
      return false;
    }
  }, []);

  // =============================================================================
  // HELPERS
  // =============================================================================
  const isHidden = useCallback((candidateId: string): boolean => {
    return hiddenCandidateIds.has(candidateId);
  }, [hiddenCandidateIds]);

  const getHiddenRecord = useCallback((candidateId: string): HiddenCandidateInfo | undefined => {
    return hiddenCandidates.find(hc => hc.candidateId === candidateId);
  }, [hiddenCandidates]);

  // =============================================================================
  // RETURN
  // =============================================================================
  return {
    hiddenCandidates,
    hiddenCandidateIds,
    isLoading,
    error,
    hideCandidate,
    unhideCandidate,
    updateReason,
    refreshHiddenCandidates,
    isHidden,
    getHiddenRecord,
  };
}

export default useHiddenCandidates;
--- End of Content for useHiddenCandidates.ts ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches\hooks\usePotentialMatches.ts
--------------------------------------------------------------------------------
Content:
// =============================================================================
// src/components/matchmaker/PotentialMatches/hooks/usePotentialMatches.ts
// =============================================================================
// ğŸ¯ Hook ×œ× ×™×”×•×œ ×”×ª×××•×ª ×¤×•×˜× ×¦×™××œ×™×•×ª - V3.0 Unified
//
// âœ… Features:
// - Advanced Pagination & Filtering (From V2)
// - Bulk Actions & Selection Management (From V2)
// - SSE Streaming for Real-time Scan Progress (From V3)
// - Robust Async Scan with Polling Fallback (From V3)
// - Comprehensive State Management
// =============================================================================

import { useState, useEffect, useCallback, useMemo, useRef } from 'react';
import { toast } from 'sonner';

// =============================================================================
// TYPES
// =============================================================================

// --- Data Types ---
export interface PotentialMatch {
  id: string;
  maleUserId: string;
  femaleUserId: string;
  aiScore: number;
  scoreForMale?: number | null;
  scoreForFemale?: number | null;
  shortReasoning?: string | null;
  status: 'PENDING' | 'REVIEWED' | 'SHORTLISTED' | 'SENT' | 'DECLINED';
  scannedAt: Date;
  hasWarning?: boolean;
  // Expanded user objects
  male: {
    id: string;
    firstName: string;
    lastName: string;
    profile?: any;
    images?: Array<{ url: string; isMain: boolean }>;
  };
  female: {
    id: string;
    firstName: string;
    lastName: string;
    profile?: any;
    images?: Array<{ url: string; isMain: boolean }>;
  };
}

export interface PotentialMatchesStats {
  total: number;
  pending: number;
  reviewed: number;
  shortlisted: number;
  sent: number;
  declined: number;
}

export interface LastScanInfo {
  date: Date;
  matchCount: number;
  durationMs: number;
}

// --- Filter & Pagination Types ---
export type PotentialMatchSortBy = 'score_desc' | 'score_asc' | 'date_desc' | 'date_asc';

export interface PotentialMatchFilters {
  searchTerm?: string;
  status: string; // 'pending' | 'reviewed' | ...
  minScore: number;
  maxScore: number;
  religiousLevel: string | null;
  city: string | null;
  hasWarning: boolean | null;
  scannedAfter: Date | null;
  sortBy: PotentialMatchSortBy;
}

// --- Scan Types (V3) ---
export interface ScanProgress {
  phase: string;
  currentUserIndex: number;
  totalUsers: number;
  currentUserName?: string;
  progressPercent: number;
  // Detailed stats
  pairsEvaluated: number;
  pairsPassedQuickFilter: number;
  pairsPassedVectorFilter: number;
  pairsSentToAi: number;
  matchesFoundSoFar: number;
  // System
  scanId: string;
  status: 'running' | 'completed' | 'failed' | 'partial';
  message?: string;
  error?: string | null;
}

export interface ScanResult {
  matchesFound: number;
  newMatches: number;
  updatedMatches: number;
  durationMs: number;
}

export interface ScanOptions {
  method?: 'algorithmic' | 'vector' | 'hybrid'; // Kept for V2 compatibility
  action?: 'full_scan' | 'scan_single' | 'scan_new_users'; // V3 actions
  forceRefresh?: boolean;
  incremental?: boolean;
  userId?: string;
  userIds?: string[];
  useStreaming?: boolean;
}

// --- Hook Return Interface ---
interface UsePotentialMatchesReturn {
  // Data
  matches: PotentialMatch[];
  stats: PotentialMatchesStats | null;
  lastScanInfo: LastScanInfo | null;
  
  // Pagination
  pagination: {
    total: number;
    page: number;
    pageSize: number;
    totalPages: number;
  };

  // Loading States
  isLoading: boolean;
  isRefreshing: boolean;
  isActioning: boolean;
  
  // Scan States (Enhanced)
  isScanning: boolean;
  scanProgress: ScanProgress | null;
  scanResult: ScanResult | null;
  
  // Filters
  filters: PotentialMatchFilters;
  setFilters: (filters: Partial<PotentialMatchFilters>) => void;
  resetFilters: () => void;

  // Pagination Controls
  setPage: (page: number) => void;
  setPageSize: (size: number) => void;

  // Actions
  refresh: () => Promise<void>;
  reviewMatch: (matchId: string) => Promise<boolean>;
  dismissMatch: (matchId: string, reason?: string) => Promise<boolean>;
  restoreMatch: (matchId: string) => Promise<boolean>;
  saveMatch: (matchId: string) => Promise<boolean>;
  createSuggestion: (matchId: string, data?: {
    priority?: 'LOW' | 'MEDIUM' | 'HIGH' | 'URGENT';
    firstPartyNotes?: string;
    secondPartyNotes?: string;
    matchingReason?: string;
  }) => Promise<string | null>;

  // Bulk Actions
  bulkDismiss: (matchIds: string[], reason?: string) => Promise<number>;
  bulkReview: (matchIds: string[]) => Promise<number>;
  bulkRestore: (matchIds: string[]) => Promise<number>;

  // Scan Controls
  startScan: (options?: ScanOptions) => Promise<string | null>;
  cancelScan: () => Promise<boolean>;

  // Selection
  selectedMatchIds: string[];
  toggleSelection: (matchId: string) => void;
  selectAll: () => void;
  clearSelection: () => void;
  isSelected: (matchId: string) => boolean;

  // Error
  error: string | null;
}

// =============================================================================
// CONSTANTS & DEFAULTS
// =============================================================================
const API_BASE_SCAN = '/api/ai/batch-scan-symmetric';
const API_BASE_MATCHES = '/api/matchmaker/potential-matches';
const POLLING_INTERVAL = 3000;

const DEFAULT_FILTERS: PotentialMatchFilters = {
  status: 'pending',
  minScore: 70,
  maxScore: 100,
  religiousLevel: null,
  city: null,
  hasWarning: null,
  scannedAfter: null,
  sortBy: 'score_desc',
};

const DEFAULT_PAGINATION = {
  total: 0,
  page: 1,
  pageSize: 20,
  totalPages: 0,
};

// =============================================================================
// HOOK IMPLEMENTATION
// =============================================================================
export function usePotentialMatches(options: {
  initialFilters?: Partial<PotentialMatchFilters>;
  autoRefresh?: boolean;
  refreshInterval?: number;
} = {}): UsePotentialMatchesReturn {
  const {
    initialFilters = {},
    autoRefresh = false,
    refreshInterval = 30000,
  } = options;

  // --- State: Data & UI ---
  const [matches, setMatches] = useState<PotentialMatch[]>([]);
  const [stats, setStats] = useState<PotentialMatchesStats | null>(null);
  const [lastScanInfo, setLastScanInfo] = useState<LastScanInfo | null>(null);
  const [pagination, setPagination] = useState(DEFAULT_PAGINATION);
  const [filters, setFiltersState] = useState<PotentialMatchFilters>({
    ...DEFAULT_FILTERS,
    ...initialFilters,
  });
  const [selectedMatchIds, setSelectedMatchIds] = useState<string[]>([]);
  const [error, setError] = useState<string | null>(null);

  // --- State: Loading ---
  const [isLoading, setIsLoading] = useState(true);
  const [isRefreshing, setIsRefreshing] = useState(false);
  const [isActioning, setIsActioning] = useState(false);

  // --- State: Scanning (V3 Enhanced) ---
  const [isScanning, setIsScanning] = useState(false);
  const [scanProgress, setScanProgress] = useState<ScanProgress | null>(null);
  const [scanResult, setScanResult] = useState<ScanResult | null>(null);
  const [activeScanId, setActiveScanId] = useState<string | null>(null);

  // --- Refs ---
  const pollingIntervalRef = useRef<NodeJS.Timeout | null>(null);
  const eventSourceRef = useRef<EventSource | null>(null);
  const lastFiltersRef = useRef<PotentialMatchFilters>(filters);

  // Update ref when filters change
  useEffect(() => {
    lastFiltersRef.current = filters;
  }, [filters]);

  // Cleanup on unmount
  useEffect(() => {
    return () => {
      if (pollingIntervalRef.current) clearInterval(pollingIntervalRef.current);
      if (eventSourceRef.current) eventSourceRef.current.close();
    };
  }, []);

  // ==========================================================================
  // FETCH DATA
  // ==========================================================================
  const fetchMatches = useCallback(async (showLoadingState = true) => {
    if (showLoadingState) setIsLoading(true);
    else setIsRefreshing(true);
    
    setError(null);

    try {
      const params = new URLSearchParams();
      params.set('page', String(pagination.page));
      params.set('pageSize', String(pagination.pageSize));
      
      // Filter Mapping
      if (filters.searchTerm) params.set('searchTerm', filters.searchTerm);
      params.set('status', filters.status);
      params.set('minScore', String(filters.minScore));
      params.set('maxScore', String(filters.maxScore));
      params.set('sortBy', filters.sortBy);
      
      if (filters.hasWarning !== null) params.set('hasWarning', String(filters.hasWarning));
      if (filters.religiousLevel) params.set('religiousLevel', filters.religiousLevel);
      if (filters.city) params.set('city', filters.city);

      const response = await fetch(`${API_BASE_MATCHES}?${params.toString()}`);
      const data = await response.json();

      if (!data.success) {
        throw new Error(data.error || 'Failed to fetch matches');
      }

      setMatches(data.matches);
      setStats(data.stats);
      setLastScanInfo(data.lastScanInfo);
      setPagination(data.pagination);

    } catch (err) {
      const message = err instanceof Error ? err.message : '×©×’×™××” ×‘×˜×¢×™× ×ª ×”×”×ª×××•×ª';
      setError(message);
      // Don't show toast for background refresh errors to avoid spam
      if (showLoadingState) toast.error(message);
    } finally {
      setIsLoading(false);
      setIsRefreshing(false);
    }
  }, [filters, pagination.page, pagination.pageSize]);

  // Initial fetch
  useEffect(() => {
    fetchMatches(true);
  }, [fetchMatches]);

  // Auto refresh
  useEffect(() => {
    if (!autoRefresh) return;
    const interval = setInterval(() => {
      fetchMatches(false);
    }, refreshInterval);
    return () => clearInterval(interval);
  }, [autoRefresh, refreshInterval, fetchMatches]);

  // ==========================================================================
  // FILTERS & PAGINATION
  // ==========================================================================
  const setFilters = useCallback((newFilters: Partial<PotentialMatchFilters>) => {
    setFiltersState(prev => ({ ...prev, ...newFilters }));
    setPagination(prev => ({ ...prev, page: 1 }));
  }, []);

  const resetFilters = useCallback(() => {
    setFiltersState(DEFAULT_FILTERS);
    setPagination(prev => ({ ...prev, page: 1 }));
  }, []);

  const setPage = useCallback((page: number) => {
    setPagination(prev => ({ ...prev, page }));
  }, []);

  const setPageSize = useCallback((pageSize: number) => {
    setPagination(prev => ({ ...prev, pageSize, page: 1 }));
  }, []);

  // ==========================================================================
  // SINGLE ACTIONS
  // ==========================================================================
  const performAction = useCallback(async (
    matchId: string,
    action: string,
    additionalData?: any
  ): Promise<boolean> => {
    setIsActioning(true);
    try {
      // Note: Using generic endpoint to maintain compatibility with V2 implementation
      // or specific endpoint if required. Assuming V2 Generic POST structure:
      const response = await fetch(API_BASE_MATCHES, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ matchId, action, ...additionalData }),
      });

      const data = await response.json();

      if (!data.success) throw new Error(data.error || 'Action failed');

      // Optimistic Updates
      setMatches(prev => {
        if (action === 'dismiss') return prev.filter(m => m.id !== matchId);
        
        const statusMap: Record<string, any> = {
          'review': 'REVIEWED',
          'restore': 'PENDING',
          'save': 'SHORTLISTED',
          'create_suggestion': 'SENT'
        };

        if (statusMap[action]) {
          return prev.map(m => m.id === matchId ? { ...m, status: statusMap[action] } : m);
        }
        return prev;
      });

      // Update selection if item removed
      if (action === 'dismiss') {
        setSelectedMatchIds(prev => prev.filter(id => id !== matchId));
      }

      return true;
    } catch (err) {
      const message = err instanceof Error ? err.message : '×”×¤×¢×•×œ×” × ×›×©×œ×”';
      toast.error(message);
      return false;
    } finally {
      setIsActioning(false);
    }
  }, []);

  const reviewMatch = (id: string) => performAction(id, 'review');
  
  const dismissMatch = async (id: string, reason?: string) => {
    const success = await performAction(id, 'dismiss', { reason });
    if (success) toast.success('×”×”×ª×××” × ×“×—×ª×”');
    return success;
  };
  
  const restoreMatch = async (id: string) => {
    const success = await performAction(id, 'restore');
    if (success) toast.success('×”×”×ª×××” ×©×•×—×–×¨×”');
    return success;
  };
  
  const saveMatch = async (id: string) => {
    const success = await performAction(id, 'save');
    if (success) toast.success('×”×”×ª×××” × ×©××¨×”');
    return success;
  };

  const createSuggestion = useCallback(async (matchId: string, data?: any) => {
    setIsActioning(true);
    try {
      const response = await fetch(API_BASE_MATCHES, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ matchId, action: 'create_suggestion', ...data }),
      });
      const result = await response.json();
      
      if (!result.success) throw new Error(result.error);
      
      setMatches(prev => prev.map(m => m.id === matchId ? { ...m, status: 'SENT' } : m));
      toast.success('×”×¦×¢×” × ×•×¦×¨×” ×‘×”×¦×œ×—×”!');
      return result.suggestionId;
    } catch (err) {
      toast.error(err instanceof Error ? err.message : '×©×’×™××” ×‘×™×¦×™×¨×ª ×”×¦×¢×”');
      return null;
    } finally {
      setIsActioning(false);
    }
  }, []);

  // ==========================================================================
  // BULK ACTIONS
  // ==========================================================================
  const performBulkAction = useCallback(async (
    matchIds: string[],
    action: 'dismiss' | 'review' | 'restore',
    reason?: string
  ): Promise<number> => {
    if (matchIds.length === 0) return 0;
    setIsActioning(true);

    try {
      const response = await fetch(API_BASE_MATCHES, {
        method: 'DELETE', // As per V2 spec
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ matchIds, action, reason }),
      });

      const data = await response.json();
      if (!data.success) throw new Error(data.error);

      await fetchMatches(false);
      setSelectedMatchIds([]);
      return data.processed;
    } catch (err) {
      toast.error(err instanceof Error ? err.message : '×¤×¢×•×œ×” ××¨×•×‘×” × ×›×©×œ×”');
      return 0;
    } finally {
      setIsActioning(false);
    }
  }, [fetchMatches]);

  const bulkDismiss = (ids: string[], reason?: string) => performBulkAction(ids, 'dismiss', reason).then(c => { if(c) toast.success(`${c} ×”×ª×××•×ª × ×“×—×•`); return c; });
  const bulkReview = (ids: string[]) => performBulkAction(ids, 'review').then(c => { if(c) toast.success(`${c} ×”×ª×××•×ª ×¡×•×× ×•`); return c; });
  const bulkRestore = (ids: string[]) => performBulkAction(ids, 'restore').then(c => { if(c) toast.success(`${c} ×”×ª×××•×ª ×©×•×—×–×¨×•`); return c; });

  // ==========================================================================
  // SCAN LOGIC - V3.0 (Streaming + Polling)
  // ==========================================================================
  
  // Helper to process progress updates
  const updateScanState = useCallback((data: any) => {
    if (!data) return;
    
    setScanProgress({
      phase: data.phase || 'running',
      currentUserIndex: data.currentUserIndex || 0,
      totalUsers: data.totalUsers || 0,
      currentUserName: data.currentUserName,
      progressPercent: data.progressPercent || 0,
      pairsEvaluated: data.stats?.pairsEvaluated || data.candidatesScanned || 0,
      pairsPassedQuickFilter: data.stats?.pairsPassedQuickFilter || 0,
      pairsPassedVectorFilter: data.stats?.pairsPassedVectorFilter || 0,
      pairsSentToAi: data.stats?.pairsSentToAi || 0,
      matchesFoundSoFar: data.stats?.matchesFoundSoFar || data.matchesFound || 0,
      scanId: data.scanId || data.id,
      status: data.status || 'running',
      message: data.message,
      error: data.error
    });
  }, []);

  const handleScanCompletion = useCallback((result: ScanResult | null) => {
    setIsScanning(false);
    setActiveScanId(null);
    setScanResult(result);
    
    if (pollingIntervalRef.current) clearInterval(pollingIntervalRef.current);
    if (eventSourceRef.current) eventSourceRef.current.close();

    const matchesFound = result?.matchesFound ?? 0;
    const newMatches = result?.newMatches ?? 0;
    
    toast.success('×”×¡×¨×™×§×” ×”×•×©×œ××”!', {
      description: `× ××¦××• ${matchesFound} ×”×ª×××•×ª (${newMatches} ×—×“×©×•×ª)`,
      duration: 5000,
    });
    
    // Refresh list
    fetchMatches(false);
  }, [fetchMatches]);

  const startPolling = useCallback((scanId: string) => {
    if (pollingIntervalRef.current) clearInterval(pollingIntervalRef.current);
    
    const poll = async () => {
      try {
        const res = await fetch(`${API_BASE_SCAN}?scanId=${scanId}`);
        const data = await res.json();
        
        if (data.success && data.scan) {
          updateScanState(data.scan);
          
          if (['completed', 'failed', 'partial'].includes(data.scan.status)) {
            if (data.scan.status === 'failed') {
               setIsScanning(false);
               toast.error(data.scan.error || '×”×¡×¨×™×§×” × ×›×©×œ×”');
            } else {
               handleScanCompletion({
                 matchesFound: data.scan.matchesFound,
                 newMatches: data.scan.newMatches,
                 updatedMatches: 0,
                 durationMs: data.scan.durationMs
               });
            }
          }
        }
      } catch (err) {
        console.error('Polling error:', err);
      }
    };
    
    pollingIntervalRef.current = setInterval(poll, POLLING_INTERVAL);
    poll();
  }, [updateScanState, handleScanCompletion]);

  const startSSETracking = useCallback((scanId: string) => {
    if (eventSourceRef.current) eventSourceRef.current.close();

    const evtSource = new EventSource(`${API_BASE_SCAN}?scanId=${scanId}&stream=true`);
    eventSourceRef.current = evtSource;

    evtSource.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);
        
        if (data.type === 'progress') {
          updateScanState(data);
        } else if (data.type === 'complete') {
          handleScanCompletion(data.result);
        } else if (data.type === 'error') {
          setIsScanning(false);
          toast.error('×©×’×™××” ×‘×¡×¨×™×§×”', { description: data.error });
          evtSource.close();
        }
      } catch (e) {
        console.error('SSE Parse Error', e);
      }
    };

    evtSource.onerror = () => {
      console.warn('SSE disconnected, falling back to polling');
      evtSource.close();
      startPolling(scanId);
    };
  }, [updateScanState, handleScanCompletion, startPolling]);

  const startScan = useCallback(async (opts: ScanOptions = {}): Promise<string | null> => {
    if (isScanning) {
      toast.warning('×¡×¨×™×§×” ×›×‘×¨ ×¨×¦×”');
      return activeScanId;
    }

    setIsScanning(true);
    setScanResult(null);
    setScanProgress(null);

    const {
      useStreaming = true,
      action = 'full_scan',
      forceRefresh = false,
      incremental = false,
      userId, userIds
    } = opts;

    try {
      const response = await fetch(API_BASE_SCAN, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          action,
          forceRefresh,
          incremental,
          userId,
          userIds
        }),
      });

      const data = await response.json();

      if (!data.success) {
        if (data.status === 'already_running') {
          toast.warning('×¡×¨×™×§×” ×›×‘×¨ ×¨×¦×” ×‘×¨×§×¢');
          setActiveScanId(data.scanId);
          startPolling(data.scanId); // Catch up with existing scan
          return data.scanId;
        }
        throw new Error(data.error || 'Failed to start scan');
      }

      toast.info('×”×¡×¨×™×§×” ×”×—×œ×”!');
      setActiveScanId(data.scanId);

      if (useStreaming && typeof EventSource !== 'undefined') {
        startSSETracking(data.scanId);
      } else {
        startPolling(data.scanId);
      }

      return data.scanId;

    } catch (err) {
      const msg = err instanceof Error ? err.message : '×”×¤×¢×œ×ª ×”×¡×¨×™×§×” × ×›×©×œ×”';
      toast.error(msg);
      setIsScanning(false);
      return null;
    }
  }, [isScanning, activeScanId, startSSETracking, startPolling]);

  const cancelScan = useCallback(async (): Promise<boolean> => {
    if (!activeScanId) return false;
    try {
      await fetch(API_BASE_SCAN, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'cancel', scanId: activeScanId }),
      });
      
      setIsScanning(false);
      setActiveScanId(null);
      if (pollingIntervalRef.current) clearInterval(pollingIntervalRef.current);
      if (eventSourceRef.current) eventSourceRef.current.close();
      
      toast.info('×”×¡×¨×™×§×” ×‘×•×˜×œ×”');
      return true;
    } catch (err) {
      console.error('Cancel error:', err);
      return false;
    }
  }, [activeScanId]);

  // ==========================================================================
  // SELECTION HELPERS
  // ==========================================================================
  const toggleSelection = useCallback((matchId: string) => {
    setSelectedMatchIds(prev =>
      prev.includes(matchId) ? prev.filter(id => id !== matchId) : [...prev, matchId]
    );
  }, []);

  const selectAll = useCallback(() => setSelectedMatchIds(matches.map(m => m.id)), [matches]);
  const clearSelection = useCallback(() => setSelectedMatchIds([]), []);
  const isSelected = useCallback((matchId: string) => selectedMatchIds.includes(matchId), [selectedMatchIds]);

  // ==========================================================================
  // RETURN
  // ==========================================================================
  return {
    // Data
    matches,
    stats,
    lastScanInfo,
    pagination,
    
    // Status
    isLoading,
    isRefreshing,
    isActioning,
    error,
    
    // Scan Status
    isScanning,
    scanProgress,
    scanResult,
    
    // Filters
    filters,
    setFilters,
    resetFilters,
    
    // Pagination
    setPage,
    setPageSize,
    
    // Actions
    refresh: () => fetchMatches(false),
    reviewMatch,
    dismissMatch,
    restoreMatch,
    saveMatch,
    createSuggestion,
    
    // Bulk
    bulkDismiss,
    bulkReview,
    bulkRestore,
    
    // Scan Controls
    startScan,
    cancelScan,
    
    // Selection
    selectedMatchIds,
    toggleSelection,
    selectAll,
    clearSelection,
    isSelected,
  };
}

export default usePotentialMatches;
--- End of Content for usePotentialMatches.ts ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches\types
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\components\matchmaker\new\PotentialMatches\types\potentialMatches.ts
--------------------------------------------------------------------------------
Content:
// =============================================================================
// src/types/potentialMatches.ts
// ×˜×™×¤×•×¡×™× ××œ××™× ×œ××¢×¨×›×ª ×”×”×ª×××•×ª ×”×¤×•×˜× ×¦×™××œ×™×•×ª ×•×”×¡×¨×™×§×” ×”×œ×™×œ×™×ª
// =============================================================================

// =============================================================================
// ENUMS (××§×‘×™×œ×™× ×œ-Prisma)
// =============================================================================

export type PotentialMatchStatus = 
  | 'PENDING'      // ×˜×¨× × ×‘×“×§
  | 'REVIEWED'     // × ×‘×“×§ ××š ×œ× ×”×•×—×œ×˜
  | 'SENT'         // × ×©×œ×—×” ×”×¦×¢×”
  | 'DISMISSED'    // × ×“×—×” ×¢"×™ ×”×©×“×›×Ÿ
  | 'EXPIRED'
    | 'SHORTLISTED';     // ×¤×’ ×ª×•×§×£
  

export type AvailabilityStatus = 
  | 'AVAILABLE' 
  | 'NOT_LOOKING' 
  | 'PAUSED' 
  | 'DATING' 
  | 'ENGAGED';

// =============================================================================
// SCORE BREAKDOWN - ×¤×™×¨×•×˜ ×¦×™×•×Ÿ AI
// =============================================================================

export interface ScoreBreakdown {
  religious: number;          // ×”×ª×××” ×“×ª×™×ª (××§×¡ 35)
  ageCompatibility: number;   // ×”×ª×××ª ×’×™×œ (××§×¡ 10)
  careerFamily: number;       // ××™×–×•×Ÿ ×§×¨×™×™×¨×”-××©×¤×—×” (××§×¡ 15)
  lifestyle: number;          // ×¡×’× ×•×Ÿ ×—×™×™× (××§×¡ 15)
  ambition: number;           // ×©××¤×ª× ×•×ª (××§×¡ 12)
  communication: number;      // ×¡×’× ×•×Ÿ ×ª×§×©×•×¨×ª (××§×¡ 12)
  values: number;             // ×¢×¨×›×™× ××©×•×ª×¤×™× (××§×¡ 11)
}

// =============================================================================
// CANDIDATE INFO - ××™×“×¢ ×‘×¡×™×¡×™ ×¢×œ ××•×¢××“
// =============================================================================

export interface CandidateBasicInfo {
  id: string;
  firstName: string;
  lastName: string;
  age: number;
  city: string | null;
  religiousLevel: string | null;
  occupation: string | null;
  mainImage: string | null;
  isVerified: boolean;
  isProfileComplete: boolean;
  availabilityStatus: AvailabilityStatus;
  lastActive?: Date | null;
  registeredAt?: Date;
  phone?: string | null;
}

// =============================================================================
// ACTIVE SUGGESTION INFO - ××™×“×¢ ×¢×œ ×”×¦×¢×” ×¤×¢×™×œ×”
// =============================================================================

export interface ActiveSuggestionInfo {
  suggestionId: string;
  status: string;
  withCandidateName: string;
  withCandidateId: string;
  createdAt: Date;
  isBlocking: boolean;
}

// =============================================================================
// POTENTIAL MATCH - ×”×ª×××” ×¤×•×˜× ×¦×™××œ×™×ª ××œ××”
// =============================================================================

export interface PotentialMatch {
  id: string;
  
  // ×”×–×•×’
  male: CandidateBasicInfo;
  female: CandidateBasicInfo;
  
  // ×¦×™×•× ×™×
  aiScore: number;
  firstPassScore: number | null;
  scoreBreakdown: ScoreBreakdown | null;
  
  // × ×™××•×§×™×
  shortReasoning: string | null;
  detailedReasoning: string | null;
  
  // ×¨×§×¢
  backgroundCompatibility: 'excellent' | 'good' | 'possible' | 'problematic' | 'not_recommended' | null;
  backgroundMultiplier: number | null;
  ageScore: number | null;
  
  // ×¡×˜×˜×•×¡
  status: PotentialMatchStatus;
  
  // ×ª××¨×™×›×™×
  scannedAt: Date;
  reviewedAt: Date | null;
  
  // ××–×”×¨×•×ª ×¢×œ ×”×¦×¢×•×ª ×¤×¢×™×œ×•×ª
  maleActiveSuggestion: ActiveSuggestionInfo | null;
  femaleActiveSuggestion: ActiveSuggestionInfo | null;
  hasActiveWarning: boolean;
  
  // ×§×™×©×•×¨ ×œ×”×¦×¢×” ×©× ×•×¦×¨×” (×× ×™×©)
  suggestionId: string | null;
}

// =============================================================================
// PAGINATION
// =============================================================================

export interface Pagination {
  total: number;
  page: number;
  pageSize: number;
  totalPages: number;
}

// =============================================================================
// STATS - ×¡×˜×˜×™×¡×˜×™×§×•×ª
// =============================================================================

export interface PotentialMatchesStats {
  total: number;
  pending: number;
  reviewed: number;
  sent: number;
  dismissed: number;
  expired: number;
  withWarnings: number;
  avgScore: number;
  highScore: number;   // 85+
  mediumScore: number; // 70-85
}

// =============================================================================
// LAST SCAN INFO - ××™×“×¢ ×¢×œ ×”×¡×¨×™×§×” ×”××—×¨×•× ×”
// =============================================================================

export interface LastScanInfo {
  id: string;
  startedAt: Date;
  completedAt: Date | null;
  status: 'running' | 'completed' | 'failed' | 'partial';
  totalCandidates: number;
  candidatesScanned: number;
  matchesFound: number;
  newMatches: number;
  updatedMatches?: number;
  durationMs: number | null;
  method?: string;
}

// =============================================================================
// API RESPONSES
// =============================================================================

export interface PotentialMatchesResponse {
  success: boolean;
  matches: PotentialMatch[];
  pagination: Pagination;
  stats: PotentialMatchesStats;
  lastScanInfo: LastScanInfo | null;
  error?: string;
}

export interface PotentialMatchActionResponse {
  success: boolean;
  message: string;
  match?: {
    id: string;
    status: PotentialMatchStatus;
  };
  suggestionId?: string;
  error?: string;
}

export interface BulkActionResponse {
  success: boolean;
  processed: number;
  message: string;
  error?: string;
}

// =============================================================================
// BATCH SCAN TYPES
// =============================================================================

export interface BatchScanRequest {
  method?: 'algorithmic' | 'vector' | 'hybrid';
  minScoreThreshold?: number;
  maxCandidates?: number;
  forceRefresh?: boolean;
}

export interface BatchScanResponse {
  success: boolean;
  status: 'started' | 'already_running' | 'completed' | 'partial' | 'failed';
  scanId: string;
  message: string;
  stats?: {
    totalCandidates: number;
    maleCandidates: number;
    femaleCandidates: number;
    candidatesScanned: number;
    matchesFound: number;
    newMatches: number;
    updatedMatches: number;
    expiredMatches: number;
    durationMs: number;
    durationMinutes: number;
    errors: number;
  };
  topResults?: Array<{
    candidate: string;
    matches: number;
    new: number;
  }>;
  error?: string;
}

export interface BatchScanProgress {
  scanId: string;
  status: 'running' | 'completed' | 'failed' | 'partial';
  progress: number;
  currentCandidate: string | null;
  candidatesScanned: number;
  totalCandidates: number;
  matchesFound: number;
  elapsedMs: number;
  estimatedRemainingMs: number | null;
  error: string | null;
}

// =============================================================================
// FILTER & SORT OPTIONS
// =============================================================================

export type PotentialMatchSortBy = 
  | 'score_desc' 
  | 'score_asc' 
  | 'date_desc' 
  | 'date_asc'
  | 'male_waiting_time'
  | 'female_waiting_time';

export type PotentialMatchFilterStatus = 
  | 'all' 
  | 'pending' 
  | 'reviewed' 
  | 'sent' 
  | 'dismissed'
  | 'shortlisted'
  | 'expired'
  | 'with_warnings'
  | 'no_warnings';

export interface PotentialMatchFilters {
  status: PotentialMatchFilterStatus;
  minScore: number;
  maxScore: number;
  religiousLevel: string | null;
  city: string | null;
  hasWarning: boolean | null;
  scannedAfter: Date | null;
  sortBy: PotentialMatchSortBy;
  searchTerm?: string;
  candidateId?: string;
}

// =============================================================================
// ACTION TYPES
// =============================================================================

export type PotentialMatchAction = 
  | 'review'
  | 'dismiss'
  | 'restore'
  | 'create_suggestion'
   | 'save';;

export interface PotentialMatchActionRequest {
  matchId: string;
  action: PotentialMatchAction;
  reason?: string;
  suggestionData?: {
    priority: 'LOW' | 'MEDIUM' | 'HIGH' | 'URGENT';
    firstPartyNotes?: string;
    secondPartyNotes?: string;
    matchingReason?: string;
  };
}

export interface BulkActionRequest {
  matchIds: string[];
  action: 'dismiss' | 'review' | 'restore';
  reason?: string;
}

// =============================================================================
// RELIGIOUS LEVELS (×œ×ª×¦×•×’×”)
// =============================================================================

export const RELIGIOUS_LEVEL_LABELS: Record<string, string> = {
  'charedi_hasidic': '×—×¨×“×™ ×—×¡×™×“×™',
  'charedi_litvak': '×—×¨×“×™ ×œ×™×˜××™',
  'charedi_sephardic': '×—×¨×“×™ ×¡×¤×¨×“×™',
  'chabad': '×—×‘"×“',
  'breslov': '×‘×¨×¡×œ×‘',
  'charedi_modern': '×—×¨×“×™ ××•×“×¨× ×™',
  'dati_leumi_torani': '×“×ª×™ ×œ××•××™ ×ª×•×¨× ×™',
  'dati_leumi_standard': '×“×ª×™ ×œ××•××™',
  'dati_leumi_liberal': '×“×ª×™ ×œ××•××™ ×œ×™×‘×¨×œ×™',
  'masorti_strong': '××¡×•×¨×ª×™ ×—×–×§',
  'masorti_light': '××¡×•×¨×ª×™',
  'secular_traditional_connection': '×—×™×œ×•× ×™ ×¢× ×§×©×¨ ×œ××¡×•×¨×ª',
  'secular': '×—×™×œ×•× ×™',
  'spiritual_not_religious': '×¨×•×—× ×™ ×œ× ×“×ª×™',
  'other': '××—×¨',
};

export function getReligiousLevelLabel(level: string | null): string {
  if (!level) return '×œ× ×¦×•×™×Ÿ';
  return RELIGIOUS_LEVEL_LABELS[level] || level;
}

// =============================================================================
// BACKGROUND COMPATIBILITY (×œ×ª×¦×•×’×”)
// =============================================================================

export const BACKGROUND_COMPATIBILITY_LABELS: Record<string, { label: string; color: string }> = {
  'excellent': { label: '×¨×§×¢ ××¦×•×™×Ÿ', color: 'bg-emerald-100 text-emerald-700 border-emerald-200' },
  'good': { label: '×¨×§×¢ ×˜×•×‘', color: 'bg-blue-100 text-blue-700 border-blue-200' },
  'possible': { label: '×¨×§×¢ ××¤×©×¨×™', color: 'bg-amber-100 text-amber-700 border-amber-200' },
  'problematic': { label: '×¤×¢×¨ ×¨×§×¢', color: 'bg-orange-100 text-orange-700 border-orange-200' },
  'not_recommended': { label: '×¨×§×¢ ×‘×¢×™×™×ª×™', color: 'bg-red-100 text-red-700 border-red-200' },
};

export function getBackgroundBadge(compatibility: string | null): { label: string; color: string } | null {
  if (!compatibility) return null;
  return BACKGROUND_COMPATIBILITY_LABELS[compatibility] || null;
}

// =============================================================================
// STATUS (×œ×ª×¦×•×’×”)
// =============================================================================

export const STATUS_LABELS: Record<PotentialMatchStatus, { label: string; color: string }> = {
  'PENDING': { label: '×××ª×™×Ÿ', color: 'bg-yellow-100 text-yellow-700' },
  'REVIEWED': { label: '× ×‘×“×§', color: 'bg-blue-100 text-blue-700' },
  'SENT': { label: '× ×©×œ×—×” ×”×¦×¢×”', color: 'bg-green-100 text-green-700' },
  'DISMISSED': { label: '× ×“×—×”', color: 'bg-gray-100 text-gray-700' },
  'EXPIRED': { label: '×¤×’ ×ª×•×§×£', color: 'bg-red-100 text-red-700' },
   'SHORTLISTED': { label: '×©××•×¨ ×‘×¦×“', color: 'bg-purple-100 text-purple-700' },
};

export function getStatusBadge(status: PotentialMatchStatus): { label: string; color: string } {
  return STATUS_LABELS[status] || { label: status, color: 'bg-gray-100 text-gray-700' };
}

// =============================================================================
// SCORE UTILITIES
// =============================================================================

export function getScoreColor(score: number): string {
  if (score >= 85) return 'text-emerald-600';
  if (score >= 75) return 'text-blue-600';
  if (score >= 70) return 'text-amber-600';
  return 'text-gray-600';
}

export function getScoreBgGradient(score: number): string {
  if (score >= 85) return 'from-emerald-500 to-green-500';
  if (score >= 75) return 'from-blue-500 to-cyan-500';
  if (score >= 70) return 'from-amber-500 to-yellow-500';
  return 'from-gray-500 to-slate-500';
}

export function getScoreLabel(score: number): string {
  if (score >= 90) return '××¦×•×™×Ÿ';
  if (score >= 85) return '×’×‘×•×” ×××•×“';
  if (score >= 80) return '×’×‘×•×”';
  if (score >= 75) return '×˜×•×‘ ×××•×“';
  if (score >= 70) return '×˜×•×‘';
  return '×‘×™× ×•× ×™';
}
--- End of Content for potentialMatches.ts ---

