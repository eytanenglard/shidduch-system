################################################################################
# Directory Content Map For: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]
# Generated on: 2025-12-18 21:25:56
# Filter: Only content of code files (.bat, .c, .cfg, .conf, .cpp, .cs, .css, .go, .h, .html, .ini, .java, .js, .json, .jsx, .kt, .less, .md, .php, .py, .rb, .rs, .scss, .sh, .sql, .swift, .ts, .tsx, .txt, .xml, .yaml, .yml) is included.
################################################################################

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\AppContent.tsx
--------------------------------------------------------------------------------
Content:
// src/app/AppContent.tsx

'use client';

import { usePathname } from 'next/navigation';
import Navbar from '@/components/layout/Navbar';
import { Toaster } from 'sonner';
import { ReactNode, useState, useEffect } from 'react';
import { cn } from '@/lib/utils'; // ודא שהייבוא הזה קיים
import type { Dictionary } from '@/types/dictionary';

interface AppContentProps {
  children: ReactNode;
  dict: Dictionary;
}

export default function AppContent({ children, dict }: AppContentProps) {
  const pathname = usePathname();
  const [isMainNavbarVisible, setIsMainNavbarVisible] = useState(true);

  useEffect(() => {
    const locale = pathname.split('/')[1];
    const isHomePage =
      pathname === `/${locale}` || (pathname === '/' && !locale);

    if (!isHomePage) {
      setIsMainNavbarVisible(true);
      return;
    }

    const handleScroll = () => {
      setIsMainNavbarVisible(window.scrollY <= 10);
    };

    window.addEventListener('scroll', handleScroll, { passive: true });
    handleScroll();

    return () => {
      window.removeEventListener('scroll', handleScroll);
    };
  }, [pathname]);

  // לוגיקה להסתרה ידנית של ה-Navbar (למשל, בשאלון)
  const isNavbarManuallyHidden = false; // <- הגדרה חדשה שתמיד מציגה את ה-Navbar

  // משתנה עזר שקובע אם צריך להוסיף את הריפוד העליון
  const shouldApplyNavbarPadding = !isNavbarManuallyHidden;

  return (
    <div className="flex flex-col min-h-screen">
      <Toaster position="top-center" richColors />

      {/* ה-Navbar נשאר עם position: fixed כפי שהיה */}
      {!isNavbarManuallyHidden && (
        <div
          className={`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ease-in-out ${
            isMainNavbarVisible
              ? 'opacity-100'
              : 'opacity-0 -translate-y-full pointer-events-none'
          }`}
        >
          <Navbar dict={dict} />
        </div>
      )}

      {/* 
        --- התיקון המרכזי כאן ---
        אנו מוסיפים לאלמנט ה-<main> ריפוד עליון (padding-top) בגובה של ה-Navbar (שהוא h-20, כלומר 5rem או 80px).
        הריפוד מתווסף באופן מותנה רק כאשר ה-Navbar באמת מוצג, כדי למנוע רווח מיותר בעמודים שבהם הוא מוסתר.
      */}
      <main
        className={cn(
          'flex-grow',
          shouldApplyNavbarPadding && 'pt-20' // pt-20 = padding-top: 5rem (80px)
        )}
      >
        {children}
      </main>
    </div>
  );
}
--- End of Content for AppContent.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\[locale]_contents.txt
--------------------------------------------------------------------------------
[This is the output log file itself. Content not included.]

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\apple-touch-icon.png
--------------------------------------------------------------------------------
[Content skipped: File extension '.png' is not in the allowed code list.]

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\favicon-96x96.png
--------------------------------------------------------------------------------
[Content skipped: File extension '.png' is not in the allowed code list.]

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\favicon.ico
--------------------------------------------------------------------------------
[Content skipped: File extension '.ico' is not in the allowed code list.]

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\favicon.svg
--------------------------------------------------------------------------------
[Content skipped: File extension '.svg' is not in the allowed code list.]

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\layout.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/layout.tsx

import { Rubik } from 'next/font/google'; // הפונט החם והנעים
import '../globals.css';
import Providers from '@/components/Providers';
import AppContent from './AppContent';
import GoogleAnalytics from '@/components/analytics/GoogleAnalytics';
import AccessibilityFeatures from '@/components/questionnaire/components/AccessibilityFeatures';
import type { Metadata } from 'next';
import { getDictionary } from '@/lib/dictionaries';
import { Locale } from '../../../i18n-config';
import FeedbackWidget from '@/components/layout/FeedbackWidget';
import { QuestionnaireStateProvider } from '@/app/[locale]/contexts/QuestionnaireStateContext';

// הגדרת פונט Rubik - עגול, אנושי, נגיש וחם
const rubik = Rubik({
  subsets: ['hebrew', 'latin'],
  variable: '--font-rubik', // שם המשתנה
  display: 'swap',
  weight: ['300', '400', '500', '600', '700', '800'], // מגוון משקלים לעיצוב עשיר
});

type LayoutParams = Promise<{
  locale: string;
}>;

export async function generateMetadata(props: {
  params: LayoutParams;
}): Promise<Metadata> {
  const params = await props.params;
  const locale = params.locale as Locale;
  
  const dictionary = await getDictionary(locale);
  return {
    title: dictionary.metadata.title,
    description: dictionary.metadata.description,
    keywords: dictionary.metadata.keywords,
    openGraph: dictionary.metadata.openGraph,
    twitter: dictionary.metadata.twitter,
  };
}

export default async function RootLayout(props: {
  children: React.ReactNode;
  params: LayoutParams;
}) {
  const params = await props.params;
  const locale = params.locale as Locale;
  
  const dictionary = await getDictionary(locale);
  const direction = locale === 'he' ? 'rtl' : 'ltr';

  return (
    <html
      lang={locale}
      dir={direction}
      className={direction === 'rtl' ? 'dir-rtl' : 'dir-ltr'}
      suppressHydrationWarning
    >
      <head />
      <body
        // שימוש במשתנה של רוביק
        className={`${rubik.variable} antialiased font-sans`}
        suppressHydrationWarning
      >
        <GoogleAnalytics />
        <Providers>
          <QuestionnaireStateProvider dict={dictionary}>
            <AppContent dict={dictionary}>
              <FeedbackWidget
                dict={dictionary.feedbackWidget}
                locale={locale}
              />
              {props.children}
            </AppContent>
          </QuestionnaireStateProvider>
          <AccessibilityFeatures
            dict={dictionary.questionnaire.accessibilityFeatures}
          />
        </Providers>
      </body>
    </html>
  );
}
--- End of Content for layout.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/page.tsx

import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../i18n-config';
import HomePage from '@/components/HomePage/HomePage';
import { generateDemoData } from '@/components/HomePage/components/demo-data';

// ✅ Next.js 15: params is a Promise with string type (not union)
type HomePageProps = {
  params: Promise<{ locale: string }>;
};

export default async function Home(props: HomePageProps) {
  const params = await props.params;
  const locale = params.locale as Locale;

  // שאר הקוד נשאר זהה
  const [dictionary, demoData] = await Promise.all([
    getDictionary(locale),
    generateDemoData(locale),
  ]);

  return <HomePage dict={dictionary} demoData={demoData} locale={locale} />;
}
--- End of Content for page.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\site.webmanifest
--------------------------------------------------------------------------------
[Content skipped: File extension '.webmanifest' is not in the allowed code list.]

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\web-app-manifest-192x192.png
--------------------------------------------------------------------------------
[Content skipped: File extension '.png' is not in the allowed code list.]

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\web-app-manifest-512x512.png
--------------------------------------------------------------------------------
[Content skipped: File extension '.png' is not in the allowed code list.]

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)
================================================================================

(This directory contains subdirectories but no files directly. See subdirectories below.)

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\admin
================================================================================

(This directory contains subdirectories but no files directly. See subdirectories below.)

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\admin\engagement
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\admin\engagement\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/(authenticated)/admin/engagement/page.tsx
import { Suspense } from 'react';
import { getServerSession } from 'next-auth';
import { redirect } from 'next/navigation';
import EngagementDashboard from '@/components/admin/EngagementDashboard';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../../i18n-config';
import { authOptions } from '@/lib/auth';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

type EngagementPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function EngagementPage({ params }: EngagementPageProps) {
  const { locale } = await params;
  const session = await getServerSession(authOptions);

  if (session?.user?.role !== 'ADMIN') {
    redirect('/');
  }

  const dict = await getDictionary(locale);

  return (
    <Suspense
      fallback={
        <StandardizedLoadingSpinner
          text="טוען נתוני מעורבות..."
          subtext="מנתחים את הפעילות במערכת"
        />
      }
    >
      <EngagementDashboard dict={dict} />
    </Suspense>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\matches
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\matches\MatchesClientPage.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/matches/MatchesClientPage.tsx

'use client';

import { useSession } from 'next-auth/react';
import MatchSuggestionsContainer from '@/components/suggestions/MatchSuggestionsContainer';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';
import type {
  SuggestionsDictionary,
  ProfileCardDict,
} from '@/types/dictionary';

/**
 * הממשק (interface) מגדיר את ה-props שהרכיב הזה מקבל.
 * הוא מצפה לקבל אובייקט 'dict' המכיל את שני מילוני התרגום
 * הדרושים לו ולרכיבי הילד שלו: מילון ההצעות ומילון כרטיס הפרופיל.
 */
interface MatchesClientPageProps {
  suggestionsDict: SuggestionsDictionary;
  profileCardDict: ProfileCardDict;
}

/**
 * רכיב צד-לקוח (Client Component) האחראי על הצגת עמוד ההצעות.
 * הוא מנהל את אימות המשתמש ומעביר את הנתונים והתרגומים לרכיב התצוגה הראשי.
 */
export default function MatchesClientPage({ suggestionsDict, profileCardDict }: MatchesClientPageProps) {
  // קבלת נתוני המשתמש והסטטוס של החיבור
  const { data: session, status } = useSession();

  // בזמן שהחיבור מתבצע, הצג את רכיב הטעינה האחיד
  if (status === 'loading') {
    return (
      <StandardizedLoadingSpinner 
        text="טוען התאמות..." 
        subtext="מחפשים את השידוכים המתאימים ביותר עבורך"
        className="min-h-[60vh]"
      />
    );
  }

  // אם המשתמש אינו מחובר, הצג הודעה מתאימה
  if (!session?.user?.id) {
    // ניתן להוסיף כאן רכיב מעוצב יותר או הפנייה לדף ההתחברות
    return (
      <div className="container mx-auto p-6 text-center text-red-600">
        אינך מורשה לצפות בדף זה. יש להתחבר למערכת.
      </div>
    );
  }

  // אם המשתמש מחובר, רנדר את קונטיינר ההצעות והעבר לו את הנתונים הנדרשים
  return (
    <MatchSuggestionsContainer
      userId={session.user.id}
      suggestionsDict={suggestionsDict}
      profileCardDict={profileCardDict}
    />
  );
}
--- End of Content for MatchesClientPage.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\matches\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/(authenticated)/matches/page.tsx
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import MatchesClientPage from './MatchesClientPage';

// הגדרת ה-props הנכונה
type MatchesPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function MatchesPage({ params }: MatchesPageProps) {
  // שימוש ב-await כדי לחלץ את המידע מה-Promise
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <MatchesClientPage
      suggestionsDict={dictionary.suggestions}
      profileCardDict={dictionary.profilePage.profileCard}
    />
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\matchmaker
================================================================================

(This directory contains subdirectories but no files directly. See subdirectories below.)

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\matchmaker\clients
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\matchmaker\clients\CandidatesManagerClient.tsx
--------------------------------------------------------------------------------
Content:
// File: CandidatesManagerClient.tsx

'use client';

import CandidatesManager from '@/components/matchmaker/new/CandidatesManager/index';
import type { MatchmakerPageDictionary } from '@/types/dictionaries/matchmaker';
import type { ProfilePageDictionary } from '@/types/dictionary';

interface CandidatesManagerClientProps {
  matchmakerDict: MatchmakerPageDictionary;
  profileDict: ProfilePageDictionary;
  locale: string; // ▼▼▼ ADDED: locale prop ▼▼▼
}

export default function CandidatesManagerClient({
  matchmakerDict,
  profileDict,
  locale, // ▼▼▼ ADDED: destructure locale ▼▼▼
}: CandidatesManagerClientProps) {
  // ▼▼▼ CHANGE: Pass the dictionaries and the new locale prop down ▼▼▼
  return (
    <CandidatesManager
      matchmakerDict={matchmakerDict}
      profileDict={profileDict}
      locale={locale}
    />
  );
}
--- End of Content for CandidatesManagerClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\matchmaker\clients\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/(authenticated)/matchmaker/clients/page.tsx
import { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../../i18n-config';
import CandidatesManagerClient from './CandidatesManagerClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

type ClientsPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function ClientsPage({ params }: ClientsPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <Suspense
      fallback={
        <StandardizedLoadingSpinner
          text="טוען את מנהל המועמדים..."
          subtext="מכינים את רשימת הלקוחות והפרופילים"
        />
      }
    >
      <CandidatesManagerClient
        matchmakerDict={dictionary.matchmakerPage}
        profileDict={dictionary.profilePage}
        locale={locale}
      />
    </Suspense>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\matchmaker\suggestions
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\matchmaker\suggestions\MatchmakerDashboardPageClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/matchmaker/dashboard/MatchmakerDashboardPageClient.tsx

"use client";

import { Suspense } from "react";
import MatchmakerDashboard from "@/components/matchmaker/suggestions/container/MatchmakerDashboard";
import StandardizedLoadingSpinner from "@/components/questionnaire/common/StandardizedLoadingSpinner";
import type {
  SuggestionsDictionary,
  MatchmakerPageDictionary,
  ProfilePageDictionary,
} from "@/types/dictionary";

// ✅ 1. הגדר את ה-props כפרמטרים נפרדים
interface MatchmakerDashboardPageClientProps {
  suggestionsDict: SuggestionsDictionary;
  matchmakerDict: MatchmakerPageDictionary;
  profileDict: ProfilePageDictionary;
}

// ✅ 2. עדכן את הרכיב כך שיקבל את המילונים הנפרדים
export default function MatchmakerDashboardPageClient({
  suggestionsDict,
  matchmakerDict,
  profileDict,
}: MatchmakerDashboardPageClientProps) {
  return (
    <div className="min-h-screen bg-background">
      <Suspense
        fallback={
          <StandardizedLoadingSpinner 
            text="טוען לוח בקרה לשדכנים..." 
            subtext="מכינים את המועמדים וההצעות"
          />
        }
      >
        {/* ✅ 3. העבר את המילונים הנפרדים הלאה לרכיב MatchmakerDashboard */}
        <MatchmakerDashboard
          suggestionsDict={suggestionsDict}
          matchmakerDict={matchmakerDict}
          profileDict={profileDict}
        />
      </Suspense>
    </div>
  );
}
--- End of Content for MatchmakerDashboardPageClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\matchmaker\suggestions\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/(authenticated)/matchmaker/suggestions/page.tsx
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../../i18n-config';
import MatchmakerDashboardPageClient from './MatchmakerDashboardPageClient';
import type {
  MatchmakerPageDictionary,
  SuggestionsDictionary,
  ProfilePageDictionary,
} from '@/types/dictionary';

// הגדרת ה-props הנכונה
type SuggestionsPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function SuggestionsPage({ params }: SuggestionsPageProps) {
  // שימוש ב-await כדי לחלץ את המידע מה-Promise
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <MatchmakerDashboardPageClient
      suggestionsDict={dictionary.suggestions as SuggestionsDictionary}
      matchmakerDict={dictionary.matchmakerPage as MatchmakerPageDictionary}
      profileDict={dictionary.profilePage as ProfilePageDictionary}
    />
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\messages
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\messages\MessagesClientPage.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/messages/MessagesClientPage.tsx
'use client';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

import React, { useState, useEffect, useCallback } from 'react';
import { useSession } from 'next-auth/react';
import { Loader2, Inbox, Zap, RefreshCw } from 'lucide-react';
import { AnimatePresence, motion } from 'framer-motion';
import type { FeedItem } from '@/types/messages';
import NotificationCard from '@/components/messages/NotificationCard';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { cn } from '@/lib/utils';
import { Alert, AlertTitle, AlertDescription } from '@/components/ui/alert';
import type { MessagesPageDict } from '@/types/dictionary';
import type { Locale } from '../../../../../i18n-config';

type FilterType = 'all' | 'action_required' | 'updates';

interface MessagesClientPageProps {
  dict: MessagesPageDict;
  locale: Locale;
}

export default function MessagesClientPage({ dict, locale }: MessagesClientPageProps) {
  const { data: session } = useSession();
  const [feedItems, setFeedItems] = useState<FeedItem[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [activeFilter, setActiveFilter] = useState<FilterType>('all');

  const userId = session?.user?.id;

  const fetchFeed = useCallback(async () => {
    setIsLoading(true);
    setError(null);
    try {
      const response = await fetch('/api/messages/feed');
      if (!response.ok) throw new Error('Failed to fetch activity feed');
      const data = await response.json();
      if (data.success) {
        setFeedItems(data.feed);
      } else {
        throw new Error(data.error || 'API returned an error');
      }
    } catch (err) {
      setError(
        err instanceof Error ? err.message : 'An unknown error occurred'
      );
    } finally {
      setIsLoading(false);
    }
  }, []);

  useEffect(() => {
    if (userId) {
      fetchFeed();
    } else {
      setIsLoading(false); 
    }
  }, [userId, fetchFeed]);

  const filteredItems = React.useMemo(() => {
    if (activeFilter === 'all') return feedItems;
    if (activeFilter === 'action_required')
      return feedItems.filter((item) => item.type === 'ACTION_REQUIRED');
    if (activeFilter === 'updates')
      return feedItems.filter(
        (item) =>
          item.type === 'STATUS_UPDATE' || item.type === 'NEW_SUGGESTION'
      );
    return feedItems;
  }, [feedItems, activeFilter]);

  const actionRequiredCount = feedItems.filter(
    (item) => item.type === 'ACTION_REQUIRED'
  ).length;
  if (isLoading) {
    // החלפת ה-div הישן. משתמשים ב-className כדי להתאים לגובה שהיה קודם
    return (
      <StandardizedLoadingSpinner className="h-[calc(100vh-80px)]" />
    );
  }


  return (
    <div 
      className="min-h-screen bg-gradient-to-br from-slate-50 via-cyan-50/20 to-emerald-50/20"
      dir={locale === 'he' ? 'rtl' : 'ltr'}
    >
      <div className="container mx-auto px-4 py-8 max-w-4xl">
        <header className="text-center mb-10">
          <h1 className="text-3xl md:text-4xl font-bold bg-gradient-to-r from-purple-600 via-cyan-600 to-emerald-600 bg-clip-text text-transparent mb-3">
            {dict.header.title}
          </h1>
          <p className="text-lg text-gray-600">
            {dict.header.subtitle}
          </p>
        </header>

        <AnimatePresence>
          {actionRequiredCount > 0 && (
            <motion.div
              initial={{ opacity: 0, y: -20, height: 0 }}
              animate={{ opacity: 1, y: 0, height: 'auto' }}
              exit={{ opacity: 0, y: -20, height: 0 }}
              transition={{ duration: 0.5, ease: 'easeInOut' }}
              className="mb-8"
            >
              <Alert className="bg-gradient-to-r from-orange-400 to-amber-400 text-white border-0 shadow-2xl rounded-2xl">
                <Zap className="h-5 w-5 text-white" />
                <AlertTitle className="font-bold text-lg">
                  {actionRequiredCount === 1
                    ? dict.actionBanner.titleSingle
                    : dict.actionBanner.titleMultiple.replace('{{count}}', actionRequiredCount.toString())}
                </AlertTitle>
                <AlertDescription>
                  {dict.actionBanner.description}
                </AlertDescription>
              </Alert>
            </motion.div>
          )}
        </AnimatePresence>

        <div className="flex flex-col sm:flex-row justify-between items-center gap-4 mb-8">
          <div className="flex items-center gap-2 p-1 bg-white/80 backdrop-blur-sm rounded-full shadow-md border border-gray-200">
            <Button
              variant={activeFilter === 'all' ? 'default' : 'ghost'}
              onClick={() => setActiveFilter('all')}
              className="rounded-full"
            >
              {dict.filters.all}
            </Button>
            <Button
              variant={activeFilter === 'action_required' ? 'default' : 'ghost'}
              onClick={() => setActiveFilter('action_required')}
              className="rounded-full relative"
            >
              {dict.filters.actionRequired}
              {actionRequiredCount > 0 && (
                <Badge className="absolute -top-1 -right-2 bg-orange-500 text-white animate-pulse">
                  {actionRequiredCount}
                </Badge>
              )}
            </Button>
            <Button
              variant={activeFilter === 'updates' ? 'default' : 'ghost'}
              onClick={() => setActiveFilter('updates')}
              className="rounded-full"
            >
              {dict.filters.updates}
            </Button>
          </div>
          <Button variant="outline" onClick={fetchFeed} disabled={isLoading}>
            <RefreshCw
              className={cn('w-4 h-4', locale === 'he' ? 'ml-2' : 'mr-2', isLoading && 'animate-spin')}
            />
            {dict.filters.refresh}
          </Button>
        </div>

        {error && (
          <div className="text-center p-4 bg-red-50 text-red-700 rounded-lg">
            {dict.error.replace('{{error}}', error)}
          </div>
        )}

        {filteredItems.length === 0 && !isLoading ? (
          <div className="flex flex-col items-center justify-center min-h-[400px] text-center p-8 bg-white/50 rounded-2xl shadow-inner border border-gray-200/50">
            <Inbox className="w-20 h-20 text-gray-300 mb-6" />
            <h3 className="text-2xl font-bold text-gray-700">{dict.emptyState.title}</h3>
            <p className="text-gray-500 mt-2 max-w-md">
              {activeFilter === 'all'
                ? dict.emptyState.descriptionAll
                : dict.emptyState.descriptionFiltered}
            </p>
          </div>
        ) : (
          <div className="space-y-4">
            <AnimatePresence>
              {filteredItems.map((item, index) => (
                <motion.div
                  key={item.id}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, y: -20 }}
                  transition={{ duration: 0.3, delay: index * 0.05 }}
                >
                  <NotificationCard 
                    item={item} 
                    userId={userId!} 
                    dict={dict.notificationCard}
                    locale={locale}
                  />
                </motion.div>
              ))}
            </AnimatePresence>
          </div>
        )}
      </div>
    </div>
  );
}
--- End of Content for MessagesClientPage.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\messages\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/(authenticated)/messages/page.tsx
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import MessagesClientPage from './MessagesClientPage';

// הגדרת ה-props הנכונה
type MessagesPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function MessagesPage({ params }: MessagesPageProps) {
  // שימוש ב-await כדי לחלץ את המידע מה-Promise
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return <MessagesClientPage dict={dictionary.messagesPage} locale={locale} />;
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\profile
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\profile\ProfilePageClient.tsx
--------------------------------------------------------------------------------
Content:
'use client';

import React, { Suspense } from 'react';
import UnifiedProfileDashboard from '@/components/profile/sections/UnifiedProfileDashboard';
import { useSearchParams } from 'next/navigation';
import { ProfilePageDictionary } from '@/types/dictionary';

// ממשק ה-props של ProfilePageContent נשאר כפי שהוא
interface ProfilePageContentProps {
  dict: ProfilePageDictionary;
  locale: 'he' | 'en';
}

// קומפוננטת התוכן
const ProfilePageContent = ({ dict, locale }: ProfilePageContentProps) => {
  const searchParams = useSearchParams();
  const tabFromUrl = searchParams.get('tab');
  console.log(
    '---[ CLIENT LOG 1 | ProfilePageClient.tsx ]--- קורא את פרמטר ה-URL. הערך של "tab" הוא:',
    tabFromUrl
  );
  const viewOnly = searchParams.get('viewOnly') === 'true';
  const userId = searchParams.get('userId') || undefined;
  const initialTab = searchParams.get('tab') || 'overview';
  console.log(
    `---[ CLIENT LOG 2 | ProfilePageClient.tsx ]--- מגדיר את initialTab לערך "${initialTab}". הערך הזה מועבר ל-UnifiedProfileDashboard.`
  );
  
  return (
    <div className="min-h-screen bg-background">
      <UnifiedProfileDashboard
        viewOnly={viewOnly}
        userId={userId}
        initialTab={initialTab}
        dict={dict}
        locale={locale} // <-- העברת ה-locale לקומפוננטה
      />
    </div>
  );
};

// ממשק ה-props של ProfilePageClient עודכן
interface ProfilePageClientProps {
  dict: ProfilePageDictionary;
  locale: 'he' | 'en'; // <--- ✨ התיקון כאן
}

// רכיב הלקוח הראשי
const ProfilePageClient = ({ dict, locale }: ProfilePageClientProps) => {
  return (
    <Suspense>
      {/* Suspense פנימי עבור useSearchParams */}
      {/* מעבירים את ה-locale הלאה ל-ProfilePageContent */}
      <ProfilePageContent dict={dict} locale={locale} />
    </Suspense>
  );
};

export default ProfilePageClient;
--- End of Content for ProfilePageClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\profile\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/(authenticated)/profile/page.tsx
import React, { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import { Locale } from '@/../i18n-config';
import ProfilePageClient from './ProfilePageClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

// הגדרת ה-props הנכונה
type ProfilePageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function ProfilePage({ params }: ProfilePageProps) {
  // שימוש ב-await כדי לחלץ את המידע מה-Promise
  const { locale } = await params;
  
  console.log(
    `---[ SERVER LOG | page.tsx ]--- עמוד הפרופיל נטען עבור שפה: "${locale}".`
  );
  
  const dictionary = await getDictionary(locale);

  return (
    <Suspense
      fallback={
        <StandardizedLoadingSpinner text={dictionary.profilePage.pageLoader} />
      }
    >
      <ProfilePageClient dict={dictionary.profilePage} locale={locale} />
    </Suspense>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\settings
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\settings\SettingsClientPage.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/settings/SettingsClientPage.tsx

'use client';

import { useSession } from 'next-auth/react';
import AccountSettings from '@/components/profile/account-settings';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';
import type { AccountSettingsDict } from '@/types/dictionary';
import type { Locale } from '../../../../../i18n-config';

interface SettingsClientPageProps {
  dict: AccountSettingsDict;
  locale: Locale;
}

export default function SettingsClientPage({
  dict,
  locale,
}: SettingsClientPageProps) {
  const { data: session, status } = useSession();

  if (status === 'loading') {
    return (
      <StandardizedLoadingSpinner
        text="טוען הגדרות חשבון..."
        className="min-h-[600px]"
      />
    );
  }

  if (status === 'unauthenticated') {
    return (
      <div className="container mx-auto p-6 text-center text-red-600">
        Access Denied. Please sign in to view your account settings.
      </div>
    );
  }

  if (!session?.user) {
    return (
      <div className="container mx-auto p-6 text-center text-red-600">
        Error: Could not load user data. The session might be invalid.
      </div>
    );
  }

  const userData = {
    id: session.user.id,
    email: session.user.email,
    firstName: session.user.firstName,
    lastName: session.user.lastName,
    role: session.user.role,
    status: session.user.status,
    isVerified: session.user.isVerified,
    lastLogin: session.user.lastLogin ?? null,
    createdAt: session.user.createdAt,
    engagementEmailsConsent: session.user.engagementEmailsConsent,
    promotionalEmailsConsent: session.user.promotionalEmailsConsent,
  };

  return <AccountSettings user={userData} dict={dict} locale={locale} />;
}
--- End of Content for SettingsClientPage.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\(authenticated)\settings\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/(authenticated)/settings/page.tsx
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import SettingsClientPage from './SettingsClientPage';
import { redirect } from 'next/navigation';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/lib/auth';

// הגדרת ה-props הנכונה
type SettingsPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function SettingsPage({ params }: SettingsPageProps) {
  // שימוש ב-await כדי לחלץ את המידע מה-Promise
  const { locale } = await params;
  const session = await getServerSession(authOptions);
  if (!session?.user) {
    redirect(`/${locale}/auth/signin?callbackUrl=/${locale}/settings`);
  }

  const dictionary = await getDictionary(locale);

  return (
    <div className="container mx-auto p-4 sm:p-6">
      <SettingsClientPage
        dict={dictionary.profilePage.accountSettings}
        locale={locale}
      />
    </div>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\admin
================================================================================

(This directory contains subdirectories but no files directly. See subdirectories below.)

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\admin\referrals
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\admin\referrals\page.tsx
--------------------------------------------------------------------------------
Content:
'use client';

import React, { useState, useEffect } from 'react';
import { motion } from 'framer-motion';
import {
  Users,
  MousePointer,
  UserCheck,
  Trophy,
  TrendingUp,
  Download,
  RefreshCw,
  Search,
  Filter,
  ChevronDown,
  ChevronUp,
  ExternalLink,
  Copy,
  Check,
  Calendar,
  Gift,
  Crown,
  Loader2,
  AlertCircle,
  Plus,
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Badge } from '@/components/ui/badge';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

// ================== Types ==================

interface CampaignStats {
  id: string;
  name: string;
  slug: string;
  startDate: string;
  endDate: string;
  isActive: boolean;
  totalReferrers: number;
  totalClicks: number;
  totalRegistrations: number;
  totalVerified: number;
  conversionRate: number;
  prizeTiers: Array<{ threshold: number; prize: string }> | string | null;
  grandPrize?: string;
}

// Helper function to parse prizeTiers
function parsePrizeTiers(
  prizeTiers: CampaignStats['prizeTiers']
): Array<{ threshold: number; prize: string }> {
  if (!prizeTiers) return [];
  if (typeof prizeTiers === 'string') {
    try {
      return JSON.parse(prizeTiers);
    } catch {
      return [];
    }
  }
  if (Array.isArray(prizeTiers)) {
    return prizeTiers;
  }
  return [];
}

interface ReferrerData {
  id: string;
  name: string;
  email?: string;
  phone?: string;
  code: string;
  tier: 'AMBASSADOR' | 'COMMUNITY';
  clickCount: number;
  registrationCount: number;
  verifiedCount: number;
  completedCount: number;
  referralsCount: number;
  createdAt: string;
  prizesAwarded?: Array<{ prize: string; awardedAt: string }>;
}

type SortField = 'verifiedCount' | 'clickCount' | 'createdAt' | 'name';
type SortOrder = 'asc' | 'desc';

// ================== Stats Card ==================

interface StatCardProps {
  title: string;
  value: number | string;
  icon: React.ReactNode;
  color: 'teal' | 'orange' | 'rose' | 'amber' | 'blue';
  subtitle?: string;
  trend?: number;
}

const StatCard: React.FC<StatCardProps> = ({
  title,
  value,
  icon,
  color,
  subtitle,
  trend,
}) => {
  const colorClasses = {
    teal: 'from-teal-500 to-emerald-600',
    orange: 'from-orange-500 to-amber-600',
    rose: 'from-rose-500 to-pink-600',
    amber: 'from-amber-500 to-yellow-600',
    blue: 'from-blue-500 to-indigo-600',
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      className="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden"
    >
      <div className={`h-1 bg-gradient-to-r ${colorClasses[color]}`} />
      <div className="p-5">
        <div className="flex items-center justify-between mb-3">
          <span className="text-sm text-gray-500">{title}</span>
          <div
            className={`p-2 rounded-lg bg-gradient-to-br ${colorClasses[color]} text-white`}
          >
            {icon}
          </div>
        </div>
        <div className="flex items-end justify-between">
          <div>
            <div className="text-3xl font-bold text-gray-900">
              {typeof value === 'number' ? value.toLocaleString() : value}
            </div>
            {subtitle && (
              <div className="text-xs text-gray-500 mt-1">{subtitle}</div>
            )}
          </div>
          {trend !== undefined && (
            <div
              className={`flex items-center text-sm ${trend >= 0 ? 'text-emerald-600' : 'text-red-500'}`}
            >
              <TrendingUp
                className={`w-4 h-4 mr-1 ${trend < 0 ? 'rotate-180' : ''}`}
              />
              {Math.abs(trend)}%
            </div>
          )}
        </div>
      </div>
    </motion.div>
  );
};

// ================== Campaign Info Card ==================

interface CampaignInfoProps {
  campaign: CampaignStats;
}

const CampaignInfoCard: React.FC<CampaignInfoProps> = ({ campaign }) => {
  const now = new Date();
  const endDate = new Date(campaign.endDate);
  const startDate = new Date(campaign.startDate);
  const daysRemaining = Math.max(
    0,
    Math.ceil((endDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24))
  );
  const totalDays = Math.ceil(
    (endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24)
  );
  const progress = Math.min(
    100,
    ((totalDays - daysRemaining) / totalDays) * 100
  );

  return (
    <Card className="border-teal-200">
      <CardHeader className="pb-3">
        <div className="flex items-center justify-between">
          <CardTitle className="text-lg flex items-center gap-2">
            <Calendar className="w-5 h-5 text-teal-600" />
            פרטי הקמפיין
          </CardTitle>
          <Badge variant={campaign.isActive ? 'default' : 'secondary'}>
            {campaign.isActive ? 'פעיל' : 'לא פעיל'}
          </Badge>
        </div>
      </CardHeader>
      <CardContent className="space-y-4">
        <div>
          <div className="text-xl font-bold text-gray-900">{campaign.name}</div>
          <div className="text-sm text-gray-500">קוד: {campaign.slug}</div>
        </div>

        <div className="grid grid-cols-2 gap-4 text-sm">
          <div>
            <div className="text-gray-500">תאריך התחלה</div>
            <div className="font-medium">
              {new Date(campaign.startDate).toLocaleDateString('he-IL')}
            </div>
          </div>
          <div>
            <div className="text-gray-500">תאריך סיום</div>
            <div className="font-medium">
              {new Date(campaign.endDate).toLocaleDateString('he-IL')}
            </div>
          </div>
        </div>

        <div>
          <div className="flex justify-between text-sm mb-1">
            <span className="text-gray-500">התקדמות</span>
            <span className="font-medium">{daysRemaining} ימים נותרו</span>
          </div>
          <div className="h-2 bg-gray-100 rounded-full overflow-hidden">
            <div
              className="h-full bg-gradient-to-r from-teal-400 to-emerald-500 rounded-full transition-all duration-500"
              style={{ width: `${progress}%` }}
            />
          </div>
        </div>

        {/* Prize Tiers */}
        <div className="pt-2 border-t border-gray-100">
          <div className="text-sm font-medium text-gray-700 mb-2 flex items-center gap-1">
            <Gift className="w-4 h-4" />
            פרסים
          </div>
          <div className="space-y-1">
            {parsePrizeTiers(campaign.prizeTiers).map((tier, index) => (
              <div key={index} className="flex justify-between text-sm">
                <span className="text-gray-600">{tier.threshold}+ מאומתים</span>
                <span className="font-medium">{tier.prize}</span>
              </div>
            ))}
            {campaign.grandPrize && (
              <div className="flex justify-between text-sm pt-1 border-t border-gray-100">
                <span className="text-amber-600 flex items-center gap-1">
                  <Crown className="w-3 h-3" />
                  מקום ראשון
                </span>
                <span className="font-medium text-amber-600">
                  {campaign.grandPrize}
                </span>
              </div>
            )}
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

// ================== Referrers Table (Native HTML) ==================

interface ReferrersTableProps {
  referrers: ReferrerData[];
  sortField: SortField;
  sortOrder: SortOrder;
  onSort: (field: SortField) => void;
  onCopyCode: (code: string) => void;
  copiedCode: string | null;
}

const ReferrersTable: React.FC<ReferrersTableProps> = ({
  referrers,
  sortField,
  sortOrder,
  onSort,
  onCopyCode,
  copiedCode,
}) => {
  const SortHeader: React.FC<{
    field: SortField;
    children: React.ReactNode;
  }> = ({ field, children }) => (
    <th
      className="px-4 py-3 text-right text-sm font-medium text-gray-700 cursor-pointer hover:bg-gray-100 transition-colors"
      onClick={() => onSort(field)}
    >
      <div className="flex items-center gap-1">
        {children}
        {sortField === field &&
          (sortOrder === 'desc' ? (
            <ChevronDown className="w-4 h-4" />
          ) : (
            <ChevronUp className="w-4 h-4" />
          ))}
      </div>
    </th>
  );

  const getTierBadge = (tier: string) => {
    if (tier === 'AMBASSADOR') {
      return (
        <Badge className="bg-amber-100 text-amber-700 border-amber-200">
          שגריר
        </Badge>
      );
    }
    return <Badge variant="secondary">קהילה</Badge>;
  };

  return (
    <div className="rounded-xl border border-gray-200 overflow-hidden overflow-x-auto">
      <table className="w-full">
        <thead className="bg-gray-50">
          <tr>
            <th className="px-4 py-3 text-right text-sm font-medium text-gray-700 w-12">
              #
            </th>
            <SortHeader field="name">שם</SortHeader>
            <th className="px-4 py-3 text-right text-sm font-medium text-gray-700">
              קוד
            </th>
            <th className="px-4 py-3 text-right text-sm font-medium text-gray-700">
              סוג
            </th>
            <SortHeader field="clickCount">לחיצות</SortHeader>
            <th className="px-4 py-3 text-right text-sm font-medium text-gray-700">
              נרשמו
            </th>
            <SortHeader field="verifiedCount">מאומתים</SortHeader>
            <th className="px-4 py-3 text-right text-sm font-medium text-gray-700">
              המרה
            </th>
            <SortHeader field="createdAt">הצטרף</SortHeader>
            <th className="px-4 py-3 text-right text-sm font-medium text-gray-700">
              פעולות
            </th>
          </tr>
        </thead>
        <tbody className="divide-y divide-gray-200">
          {referrers.map((referrer, index) => {
            const conversionRate =
              referrer.clickCount > 0
                ? (
                    (referrer.verifiedCount / referrer.clickCount) *
                    100
                  ).toFixed(1)
                : '0';

            return (
              <tr key={referrer.id} className="hover:bg-gray-50">
                <td className="px-4 py-3 font-medium text-gray-500">
                  {index + 1}
                </td>
                <td className="px-4 py-3">
                  <div>
                    <div className="font-medium text-gray-900">
                      {referrer.name}
                    </div>
                    {referrer.email && (
                      <div className="text-xs text-gray-500">
                        {referrer.email}
                      </div>
                    )}
                  </div>
                </td>
                <td className="px-4 py-3">
                  <div className="flex items-center gap-1">
                    <code className="bg-gray-100 px-2 py-0.5 rounded text-sm font-mono">
                      {referrer.code}
                    </code>
                    <button
                      onClick={() => onCopyCode(referrer.code)}
                      className="p-1 hover:bg-gray-100 rounded transition-colors"
                    >
                      {copiedCode === referrer.code ? (
                        <Check className="w-3 h-3 text-teal-600" />
                      ) : (
                        <Copy className="w-3 h-3 text-gray-400" />
                      )}
                    </button>
                  </div>
                </td>
                <td className="px-4 py-3">{getTierBadge(referrer.tier)}</td>
                <td className="px-4 py-3 text-center">{referrer.clickCount}</td>
                <td className="px-4 py-3 text-center">
                  {referrer.registrationCount}
                </td>
                <td className="px-4 py-3">
                  <span
                    className={`font-bold ${referrer.verifiedCount >= 3 ? 'text-teal-600' : 'text-gray-900'}`}
                  >
                    {referrer.verifiedCount}
                  </span>
                </td>
                <td className="px-4 py-3">
                  <span
                    className={`${parseFloat(conversionRate) >= 10 ? 'text-emerald-600' : 'text-gray-600'}`}
                  >
                    {conversionRate}%
                  </span>
                </td>
                <td className="px-4 py-3 text-sm text-gray-500">
                  {new Date(referrer.createdAt).toLocaleDateString('he-IL')}
                </td>
                <td className="px-4 py-3">
                  <a
                    href={`/he/referral/dashboard?code=${referrer.code}`}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="p-1 hover:bg-gray-100 rounded transition-colors inline-flex"
                  >
                    <ExternalLink className="w-4 h-4 text-gray-400" />
                  </a>
                </td>
              </tr>
            );
          })}
        </tbody>
      </table>
    </div>
  );
};

// ================== Main Admin Page ==================

export default function AdminReferralsPage() {
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [campaign, setCampaign] = useState<CampaignStats | null>(null);
  const [referrers, setReferrers] = useState<ReferrerData[]>([]);
  const [filteredReferrers, setFilteredReferrers] = useState<ReferrerData[]>(
    []
  );

  // Filters & Sort
  const [searchTerm, setSearchTerm] = useState('');
  const [tierFilter, setTierFilter] = useState<
    'all' | 'AMBASSADOR' | 'COMMUNITY'
  >('all');
  const [sortField, setSortField] = useState<SortField>('verifiedCount');
  const [sortOrder, setSortOrder] = useState<SortOrder>('desc');

  const [copiedCode, setCopiedCode] = useState<string | null>(null);
  const [isRefreshing, setIsRefreshing] = useState(false);

  // Fetch data
  const fetchData = async () => {
    // 2.5 seconds minimum delay for the animation
    const minDelayPromise = new Promise((resolve) => setTimeout(resolve, 2500));

    try {
      const res = await fetch('/api/referral/campaign?stats=true');
      const data = await res.json();

      if (!data.success) {
        throw new Error(data.error || 'Failed to load data');
      }

      setCampaign(data.campaign);
      setReferrers(data.referrers || []);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Error loading data');
    } finally {
      await minDelayPromise;
      setIsLoading(false);
      setIsRefreshing(false);
    }
  };

  useEffect(() => {
    fetchData();
  }, []);

  // Filter & Sort
  useEffect(() => {
    let result = [...referrers];

    // Search
    if (searchTerm) {
      const term = searchTerm.toLowerCase();
      result = result.filter(
        (r) =>
          r.name.toLowerCase().includes(term) ||
          r.code.toLowerCase().includes(term) ||
          r.email?.toLowerCase().includes(term)
      );
    }

    // Tier filter
    if (tierFilter !== 'all') {
      result = result.filter((r) => r.tier === tierFilter);
    }

    // Sort
    result.sort((a, b) => {
      let aVal: number | string = a[sortField];
      let bVal: number | string = b[sortField];

      if (sortField === 'createdAt') {
        aVal = new Date(a.createdAt).getTime();
        bVal = new Date(b.createdAt).getTime();
      }

      if (typeof aVal === 'string' && typeof bVal === 'string') {
        return sortOrder === 'asc'
          ? aVal.localeCompare(bVal)
          : bVal.localeCompare(aVal);
      }

      return sortOrder === 'asc'
        ? (aVal as number) - (bVal as number)
        : (bVal as number) - (aVal as number);
    });

    setFilteredReferrers(result);
  }, [referrers, searchTerm, tierFilter, sortField, sortOrder]);

  const handleSort = (field: SortField) => {
    if (sortField === field) {
      setSortOrder(sortOrder === 'desc' ? 'asc' : 'desc');
    } else {
      setSortField(field);
      setSortOrder('desc');
    }
  };

  const handleCopyCode = async (code: string) => {
    const url = `${window.location.origin}/r/${code}`;
    await navigator.clipboard.writeText(url);
    setCopiedCode(code);
    setTimeout(() => setCopiedCode(null), 2000);
  };

  const handleRefresh = () => {
    setIsRefreshing(true);
    fetchData();
  };

  const exportToCSV = () => {
    const headers = [
      'שם',
      'אימייל',
      'טלפון',
      'קוד',
      'סוג',
      'לחיצות',
      'נרשמו',
      'מאומתים',
      'תאריך הצטרפות',
    ];
    const rows = filteredReferrers.map((r) => [
      r.name,
      r.email || '',
      r.phone || '',
      r.code,
      r.tier === 'AMBASSADOR' ? 'שגריר' : 'קהילה',
      r.clickCount,
      r.registrationCount,
      r.verifiedCount,
      new Date(r.createdAt).toLocaleDateString('he-IL'),
    ]);

    const csvContent = [headers, ...rows]
      .map((row) => row.map((cell) => `"${cell}"`).join(','))
      .join('\n');

    const blob = new Blob(['\uFEFF' + csvContent], {
      type: 'text/csv;charset=utf-8;',
    });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `referrers_${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
  };

  // Loading
  if (isLoading) {
    return <StandardizedLoadingSpinner text="טוען נתונים..." />;
  }

  // Error
  if (error) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gray-50">
        <div className="text-center max-w-md">
          <AlertCircle className="w-12 h-12 text-red-500 mx-auto mb-4" />
          <h1 className="text-xl font-bold text-gray-900 mb-2">שגיאה</h1>
          <p className="text-gray-600 mb-4">{error}</p>
          <Button onClick={handleRefresh}>נסה שוב</Button>
        </div>
      </div>
    );
  }

  return (
    <main className="min-h-screen bg-gray-50 py-8" dir="rtl">
      <div className="container mx-auto px-4 max-w-7xl">
        {/* Header */}
        <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
          <div>
            <h1 className="text-2xl md:text-3xl font-bold text-gray-900">
              ניהול קמפיין רפרל
            </h1>
            <p className="text-gray-600 mt-1">
              מעקב אחר ביצועי המפנים והקמפיין
            </p>
          </div>
          <div className="flex items-center gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={handleRefresh}
              disabled={isRefreshing}
            >
              <RefreshCw
                className={`w-4 h-4 ml-1 ${isRefreshing ? 'animate-spin' : ''}`}
              />
              רענן
            </Button>
            <Button variant="outline" size="sm" onClick={exportToCSV}>
              <Download className="w-4 h-4 ml-1" />
              ייצא CSV
            </Button>
            <Button size="sm">
              <Plus className="w-4 h-4 ml-1" />
              הוסף שגריר
            </Button>
          </div>
        </div>

        {/* Stats Grid */}
        {campaign && (
          <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
            <StatCard
              title="סה״כ מפנים"
              value={campaign.totalReferrers}
              icon={<Users className="w-5 h-5" />}
              color="blue"
            />
            <StatCard
              title="לחיצות"
              value={campaign.totalClicks}
              icon={<MousePointer className="w-5 h-5" />}
              color="teal"
            />
            <StatCard
              title="הרשמות"
              value={campaign.totalRegistrations}
              icon={<Users className="w-5 h-5" />}
              color="orange"
            />
            <StatCard
              title="מאומתים"
              value={campaign.totalVerified}
              icon={<UserCheck className="w-5 h-5" />}
              color="rose"
            />
            <StatCard
              title="המרה"
              value={`${(campaign.conversionRate ?? 0).toFixed(1)}%`}
              icon={<TrendingUp className="w-5 h-5" />}
              color="amber"
              subtitle="מלחיצה לאימות"
            />
          </div>
        )}

        <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
          {/* Campaign Info - Sidebar */}
          <div className="lg:col-span-1">
            {campaign && <CampaignInfoCard campaign={campaign} />}
          </div>

          {/* Main Content */}
          <div className="lg:col-span-3 space-y-6">
            {/* Filters */}
            <Card>
              <CardContent className="pt-6">
                <div className="flex flex-col md:flex-row gap-4">
                  <div className="flex-1 relative">
                    <Search className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" />
                    <Input
                      placeholder="חיפוש לפי שם, קוד או אימייל..."
                      value={searchTerm}
                      onChange={(e) => setSearchTerm(e.target.value)}
                      className="pr-10"
                    />
                  </div>
                  <Select
                    value={tierFilter}
                    onValueChange={(v) => setTierFilter(v as typeof tierFilter)}
                  >
                    <SelectTrigger className="w-full md:w-40">
                      <Filter className="w-4 h-4 ml-2" />
                      <SelectValue placeholder="סוג מפנה" />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="all">הכל</SelectItem>
                      <SelectItem value="AMBASSADOR">שגרירים</SelectItem>
                      <SelectItem value="COMMUNITY">קהילה</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </CardContent>
            </Card>

            {/* Table */}
            <Card>
              <CardHeader className="pb-3">
                <div className="flex items-center justify-between">
                  <CardTitle className="text-lg">
                    רשימת מפנים ({filteredReferrers.length})
                  </CardTitle>
                </div>
              </CardHeader>
              <CardContent>
                {filteredReferrers.length > 0 ? (
                  <ReferrersTable
                    referrers={filteredReferrers}
                    sortField={sortField}
                    sortOrder={sortOrder}
                    onSort={handleSort}
                    onCopyCode={handleCopyCode}
                    copiedCode={copiedCode}
                  />
                ) : (
                  <div className="text-center py-12 text-gray-500">
                    {searchTerm || tierFilter !== 'all'
                      ? 'לא נמצאו תוצאות לחיפוש'
                      : 'אין מפנים עדיין'}
                  </div>
                )}
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    </main>
  );
}
--- End of Content for page.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\admin\referrals\referrals_contents.txt
--------------------------------------------------------------------------------
Content:
################################################################################
# Directory Content Map For: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\admin\referrals
# Generated on: 2025-12-16 09:48:31
# Filter: Only content of code files (.bat, .c, .cfg, .conf, .cpp, .cs, .css, .go, .h, .html, .ini, .java, .js, .json, .jsx, .kt, .less, .md, .php, .py, .rb, .rs, .scss, .sh, .sql, .swift, .ts, .tsx, .txt, .xml, .yaml, .yml) is included.
################################################################################

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\admin\referrals
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\admin\referrals\page.tsx
--------------------------------------------------------------------------------
Content:
'use client';

import React, { useState, useEffect } from 'react';
import { motion } from 'framer-motion';
import {
  Users,
  MousePointer,
  UserCheck,
  Trophy,
  TrendingUp,
  Download,
  RefreshCw,
  Search,
  Filter,
  ChevronDown,
  ChevronUp,
  ExternalLink,
  Copy,
  Check,
  Calendar,
  Gift,
  Crown,
  Loader2,
  AlertCircle,
  Plus,
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Badge } from '@/components/ui/badge';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

// ================== Types ==================

interface CampaignStats {
  id: string;
  name: string;
  slug: string;
  startDate: string;
  endDate: string;
  isActive: boolean;
  totalReferrers: number;
  totalClicks: number;
  totalRegistrations: number;
  totalVerified: number;
  conversionRate: number;
  prizeTiers: Array<{ threshold: number; prize: string }> | string | null;
  grandPrize?: string;
}

// Helper function to parse prizeTiers
function parsePrizeTiers(
  prizeTiers: CampaignStats['prizeTiers']
): Array<{ threshold: number; prize: string }> {
  if (!prizeTiers) return [];
  if (typeof prizeTiers === 'string') {
    try {
      return JSON.parse(prizeTiers);
    } catch {
      return [];
    }
  }
  if (Array.isArray(prizeTiers)) {
    return prizeTiers;
  }
  return [];
}

interface ReferrerData {
  id: string;
  name: string;
  email?: string;
  phone?: string;
  code: string;
  tier: 'AMBASSADOR' | 'COMMUNITY';
  clickCount: number;
  registrationCount: number;
  verifiedCount: number;
  completedCount: number;
  referralsCount: number;
  createdAt: string;
  prizesAwarded?: Array<{ prize: string; awardedAt: string }>;
}

type SortField = 'verifiedCount' | 'clickCount' | 'createdAt' | 'name';
type SortOrder = 'asc' | 'desc';

// ================== Stats Card ==================

interface StatCardProps {
  title: string;
  value: number | string;
  icon: React.ReactNode;
  color: 'teal' | 'orange' | 'rose' | 'amber' | 'blue';
  subtitle?: string;
  trend?: number;
}

const StatCard: React.FC<StatCardProps> = ({
  title,
  value,
  icon,
  color,
  subtitle,
  trend,
}) => {
  const colorClasses = {
    teal: 'from-teal-500 to-emerald-600',
    orange: 'from-orange-500 to-amber-600',
    rose: 'from-rose-500 to-pink-600',
    amber: 'from-amber-500 to-yellow-600',
    blue: 'from-blue-500 to-indigo-600',
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      className="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden"
    >
      <div className={`h-1 bg-gradient-to-r ${colorClasses[color]}`} />
      <div className="p-5">
        <div className="flex items-center justify-between mb-3">
          <span className="text-sm text-gray-500">{title}</span>
          <div
            className={`p-2 rounded-lg bg-gradient-to-br ${colorClasses[color]} text-white`}
          >
            {icon}
          </div>
        </div>
        <div className="flex items-end justify-between">
          <div>
            <div className="text-3xl font-bold text-gray-900">
              {typeof value === 'number' ? value.toLocaleString() : value}
            </div>
            {subtitle && (
              <div className="text-xs text-gray-500 mt-1">{subtitle}</div>
            )}
          </div>
          {trend !== undefined && (
            <div
              className={`flex items-center text-sm ${trend >= 0 ? 'text-emerald-600' : 'text-red-500'}`}
            >
              <TrendingUp
                className={`w-4 h-4 mr-1 ${trend < 0 ? 'rotate-180' : ''}`}
              />
              {Math.abs(trend)}%
            </div>
          )}
        </div>
      </div>
    </motion.div>
  );
};

// ================== Campaign Info Card ==================

interface CampaignInfoProps {
  campaign: CampaignStats;
}

const CampaignInfoCard: React.FC<CampaignInfoProps> = ({ campaign }) => {
  const now = new Date();
  const endDate = new Date(campaign.endDate);
  const startDate = new Date(campaign.startDate);
  const daysRemaining = Math.max(
    0,
    Math.ceil((endDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24))
  );
  const totalDays = Math.ceil(
    (endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24)
  );
  const progress = Math.min(
    100,
    ((totalDays - daysRemaining) / totalDays) * 100
  );

  return (
    <Card className="border-teal-200">
      <CardHeader className="pb-3">
        <div className="flex items-center justify-between">
          <CardTitle className="text-lg flex items-center gap-2">
            <Calendar className="w-5 h-5 text-teal-600" />
            פרטי הקמפיין
          </CardTitle>
          <Badge variant={campaign.isActive ? 'default' : 'secondary'}>
            {campaign.isActive ? 'פעיל' : 'לא פעיל'}
          </Badge>
        </div>
      </CardHeader>
      <CardContent className="space-y-4">
        <div>
          <div className="text-xl font-bold text-gray-900">{campaign.name}</div>
          <div className="text-sm text-gray-500">קוד: {campaign.slug}</div>
        </div>

        <div className="grid grid-cols-2 gap-4 text-sm">
          <div>
            <div className="text-gray-500">תאריך התחלה</div>
            <div className="font-medium">
              {new Date(campaign.startDate).toLocaleDateString('he-IL')}
            </div>
          </div>
          <div>
            <div className="text-gray-500">תאריך סיום</div>
            <div className="font-medium">
              {new Date(campaign.endDate).toLocaleDateString('he-IL')}
            </div>
          </div>
        </div>

        <div>
          <div className="flex justify-between text-sm mb-1">
            <span className="text-gray-500">התקדמות</span>
            <span className="font-medium">{daysRemaining} ימים נותרו</span>
          </div>
          <div className="h-2 bg-gray-100 rounded-full overflow-hidden">
            <div
              className="h-full bg-gradient-to-r from-teal-400 to-emerald-500 rounded-full transition-all duration-500"
              style={{ width: `${progress}%` }}
            />
          </div>
        </div>

        {/* Prize Tiers */}
        <div className="pt-2 border-t border-gray-100">
          <div className="text-sm font-medium text-gray-700 mb-2 flex items-center gap-1">
            <Gift className="w-4 h-4" />
            פרסים
          </div>
          <div className="space-y-1">
            {parsePrizeTiers(campaign.prizeTiers).map((tier, index) => (
              <div key={index} className="flex justify-between text-sm">
                <span className="text-gray-600">{tier.threshold}+ מאומתים</span>
                <span className="font-medium">{tier.prize}</span>
              </div>
            ))}
            {campaign.grandPrize && (
              <div className="flex justify-between text-sm pt-1 border-t border-gray-100">
                <span className="text-amber-600 flex items-center gap-1">
                  <Crown className="w-3 h-3" />
                  מקום ראשון
                </span>
                <span className="font-medium text-amber-600">
                  {campaign.grandPrize}
                </span>
              </div>
            )}
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

// ================== Referrers Table (Native HTML) ==================

interface ReferrersTableProps {
  referrers: ReferrerData[];
  sortField: SortField;
  sortOrder: SortOrder;
  onSort: (field: SortField) => void;
  onCopyCode: (code: string) => void;
  copiedCode: string | null;
}

const ReferrersTable: React.FC<ReferrersTableProps> = ({
  referrers,
  sortField,
  sortOrder,
  onSort,
  onCopyCode,
  copiedCode,
}) => {
  const SortHeader: React.FC<{
    field: SortField;
    children: React.ReactNode;
  }> = ({ field, children }) => (
    <th
      className="px-4 py-3 text-right text-sm font-medium text-gray-700 cursor-pointer hover:bg-gray-100 transition-colors"
      onClick={() => onSort(field)}
    >
      <div className="flex items-center gap-1">
        {children}
        {sortField === field &&
          (sortOrder === 'desc' ? (
            <ChevronDown className="w-4 h-4" />
          ) : (
            <ChevronUp className="w-4 h-4" />
          ))}
      </div>
    </th>
  );

  const getTierBadge = (tier: string) => {
    if (tier === 'AMBASSADOR') {
      return (
        <Badge className="bg-amber-100 text-amber-700 border-amber-200">
          שגריר
        </Badge>
      );
    }
    return <Badge variant="secondary">קהילה</Badge>;
  };

  return (
    <div className="rounded-xl border border-gray-200 overflow-hidden overflow-x-auto">
      <table className="w-full">
        <thead className="bg-gray-50">
          <tr>
            <th className="px-4 py-3 text-right text-sm font-medium text-gray-700 w-12">
              #
            </th>
            <SortHeader field="name">שם</SortHeader>
            <th className="px-4 py-3 text-right text-sm font-medium text-gray-700">
              קוד
            </th>
            <th className="px-4 py-3 text-right text-sm font-medium text-gray-700">
              סוג
            </th>
            <SortHeader field="clickCount">לחיצות</SortHeader>
            <th className="px-4 py-3 text-right text-sm font-medium text-gray-700">
              נרשמו
            </th>
            <SortHeader field="verifiedCount">מאומתים</SortHeader>
            <th className="px-4 py-3 text-right text-sm font-medium text-gray-700">
              המרה
            </th>
            <SortHeader field="createdAt">הצטרף</SortHeader>
            <th className="px-4 py-3 text-right text-sm font-medium text-gray-700">
              פעולות
            </th>
          </tr>
        </thead>
        <tbody className="divide-y divide-gray-200">
          {referrers.map((referrer, index) => {
            const conversionRate =
              referrer.clickCount > 0
                ? (
                    (referrer.verifiedCount / referrer.clickCount) *
                    100
                  ).toFixed(1)
                : '0';

            return (
              <tr key={referrer.id} className="hover:bg-gray-50">
                <td className="px-4 py-3 font-medium text-gray-500">
                  {index + 1}
                </td>
                <td className="px-4 py-3">
                  <div>
                    <div className="font-medium text-gray-900">
                      {referrer.name}
                    </div>
                    {referrer.email && (
                      <div className="text-xs text-gray-500">
                        {referrer.email}
                      </div>
                    )}
                  </div>
                </td>
                <td className="px-4 py-3">
                  <div className="flex items-center gap-1">
                    <code className="bg-gray-100 px-2 py-0.5 rounded text-sm font-mono">
                      {referrer.code}
                    </code>
                    <button
                      onClick={() => onCopyCode(referrer.code)}
                      className="p-1 hover:bg-gray-100 rounded transition-colors"
                    >
                      {copiedCode === referrer.code ? (
                        <Check className="w-3 h-3 text-teal-600" />
                      ) : (
                        <Copy className="w-3 h-3 text-gray-400" />
                      )}
                    </button>
                  </div>
                </td>
                <td className="px-4 py-3">{getTierBadge(referrer.tier)}</td>
                <td className="px-4 py-3 text-center">{referrer.clickCount}</td>
                <td className="px-4 py-3 text-center">
                  {referrer.registrationCount}
                </td>
                <td className="px-4 py-3">
                  <span
                    className={`font-bold ${referrer.verifiedCount >= 3 ? 'text-teal-600' : 'text-gray-900'}`}
                  >
                    {referrer.verifiedCount}
                  </span>
                </td>
                <td className="px-4 py-3">
                  <span
                    className={`${parseFloat(conversionRate) >= 10 ? 'text-emerald-600' : 'text-gray-600'}`}
                  >
                    {conversionRate}%
                  </span>
                </td>
                <td className="px-4 py-3 text-sm text-gray-500">
                  {new Date(referrer.createdAt).toLocaleDateString('he-IL')}
                </td>
                <td className="px-4 py-3">
                  <a
                    href={`/he/referral/dashboard?code=${referrer.code}`}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="p-1 hover:bg-gray-100 rounded transition-colors inline-flex"
                  >
                    <ExternalLink className="w-4 h-4 text-gray-400" />
                  </a>
                </td>
              </tr>
            );
          })}
        </tbody>
      </table>
    </div>
  );
};

// ================== Main Admin Page ==================

export default function AdminReferralsPage() {
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [campaign, setCampaign] = useState<CampaignStats | null>(null);
  const [referrers, setReferrers] = useState<ReferrerData[]>([]);
  const [filteredReferrers, setFilteredReferrers] = useState<ReferrerData[]>(
    []
  );

  // Filters & Sort
  const [searchTerm, setSearchTerm] = useState('');
  const [tierFilter, setTierFilter] = useState<
    'all' | 'AMBASSADOR' | 'COMMUNITY'
  >('all');
  const [sortField, setSortField] = useState<SortField>('verifiedCount');
  const [sortOrder, setSortOrder] = useState<SortOrder>('desc');

  const [copiedCode, setCopiedCode] = useState<string | null>(null);
  const [isRefreshing, setIsRefreshing] = useState(false);

  // Fetch data
  const fetchData = async () => {
    // 2.5 seconds minimum delay for the animation
    const minDelayPromise = new Promise((resolve) => setTimeout(resolve, 2500));

    try {
      const res = await fetch('/api/referral/campaign?stats=true');
      const data = await res.json();

      if (!data.success) {
        throw new Error(data.error || 'Failed to load data');
      }

      setCampaign(data.campaign);
      setReferrers(data.referrers || []);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Error loading data');
    } finally {
      await minDelayPromise;
      setIsLoading(false);
      setIsRefreshing(false);
    }
  };

  useEffect(() => {
    fetchData();
  }, []);

  // Filter & Sort
  useEffect(() => {
    let result = [...referrers];

    // Search
    if (searchTerm) {
      const term = searchTerm.toLowerCase();
      result = result.filter(
        (r) =>
          r.name.toLowerCase().includes(term) ||
          r.code.toLowerCase().includes(term) ||
          r.email?.toLowerCase().includes(term)
      );
    }

    // Tier filter
    if (tierFilter !== 'all') {
      result = result.filter((r) => r.tier === tierFilter);
    }

    // Sort
    result.sort((a, b) => {
      let aVal: number | string = a[sortField];
      let bVal: number | string = b[sortField];

      if (sortField === 'createdAt') {
        aVal = new Date(a.createdAt).getTime();
        bVal = new Date(b.createdAt).getTime();
      }

      if (typeof aVal === 'string' && typeof bVal === 'string') {
        return sortOrder === 'asc'
          ? aVal.localeCompare(bVal)
          : bVal.localeCompare(aVal);
      }

      return sortOrder === 'asc'
        ? (aVal as number) - (bVal as number)
        : (bVal as number) - (aVal as number);
    });

    setFilteredReferrers(result);
  }, [referrers, searchTerm, tierFilter, sortField, sortOrder]);

  const handleSort = (field: SortField) => {
    if (sortField === field) {
      setSortOrder(sortOrder === 'desc' ? 'asc' : 'desc');
    } else {
      setSortField(field);
      setSortOrder('desc');
    }
  };

  const handleCopyCode = async (code: string) => {
    const url = `${window.location.origin}/r/${code}`;
    await navigator.clipboard.writeText(url);
    setCopiedCode(code);
    setTimeout(() => setCopiedCode(null), 2000);
  };

  const handleRefresh = () => {
    setIsRefreshing(true);
    fetchData();
  };

  const exportToCSV = () => {
    const headers = [
      'שם',
      'אימייל',
      'טלפון',
      'קוד',
      'סוג',
      'לחיצות',
      'נרשמו',
      'מאומתים',
      'תאריך הצטרפות',
    ];
    const rows = filteredReferrers.map((r) => [
      r.name,
      r.email || '',
      r.phone || '',
      r.code,
      r.tier === 'AMBASSADOR' ? 'שגריר' : 'קהילה',
      r.clickCount,
      r.registrationCount,
      r.verifiedCount,
      new Date(r.createdAt).toLocaleDateString('he-IL'),
    ]);

    const csvContent = [headers, ...rows]
      .map((row) => row.map((cell) => `"${cell}"`).join(','))
      .join('\n');

    const blob = new Blob(['\uFEFF' + csvContent], {
      type: 'text/csv;charset=utf-8;',
    });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `referrers_${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
  };

  // Loading
  if (isLoading) {
    return <StandardizedLoadingSpinner text="טוען נתונים..." />;
  }

  // Error
  if (error) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gray-50">
        <div className="text-center max-w-md">
          <AlertCircle className="w-12 h-12 text-red-500 mx-auto mb-4" />
          <h1 className="text-xl font-bold text-gray-900 mb-2">שגיאה</h1>
          <p className="text-gray-600 mb-4">{error}</p>
          <Button onClick={handleRefresh}>נסה שוב</Button>
        </div>
      </div>
    );
  }

  return (
    <main className="min-h-screen bg-gray-50 py-8" dir="rtl">
      <div className="container mx-auto px-4 max-w-7xl">
        {/* Header */}
        <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
          <div>
            <h1 className="text-2xl md:text-3xl font-bold text-gray-900">
              ניהול קמפיין רפרל
            </h1>
            <p className="text-gray-600 mt-1">
              מעקב אחר ביצועי המפנים והקמפיין
            </p>
          </div>
          <div className="flex items-center gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={handleRefresh}
              disabled={isRefreshing}
            >
              <RefreshCw
                className={`w-4 h-4 ml-1 ${isRefreshing ? 'animate-spin' : ''}`}
              />
              רענן
            </Button>
            <Button variant="outline" size="sm" onClick={exportToCSV}>
              <Download className="w-4 h-4 ml-1" />
              ייצא CSV
            </Button>
            <Button size="sm">
              <Plus className="w-4 h-4 ml-1" />
              הוסף שגריר
            </Button>
          </div>
        </div>

        {/* Stats Grid */}
        {campaign && (
          <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
            <StatCard
              title="סה״כ מפנים"
              value={campaign.totalReferrers}
              icon={<Users className="w-5 h-5" />}
              color="blue"
            />
            <StatCard
              title="לחיצות"
              value={campaign.totalClicks}
              icon={<MousePointer className="w-5 h-5" />}
              color="teal"
            />
            <StatCard
              title="הרשמות"
              value={campaign.totalRegistrations}
              icon={<Users className="w-5 h-5" />}
              color="orange"
            />
            <StatCard
              title="מאומתים"
              value={campaign.totalVerified}
              icon={<UserCheck className="w-5 h-5" />}
              color="rose"
            />
            <StatCard
              title="המרה"
              value={`${(campaign.conversionRate ?? 0).toFixed(1)}%`}
              icon={<TrendingUp className="w-5 h-5" />}
              color="amber"
              subtitle="מלחיצה לאימות"
            />
          </div>
        )}

        <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
          {/* Campaign Info - Sidebar */}
          <div className="lg:col-span-1">
            {campaign && <CampaignInfoCard campaign={campaign} />}
          </div>

          {/* Main Content */}
          <div className="lg:col-span-3 space-y-6">
            {/* Filters */}
            <Card>
              <CardContent className="pt-6">
                <div className="flex flex-col md:flex-row gap-4">
                  <div className="flex-1 relative">
                    <Search className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" />
                    <Input
                      placeholder="חיפוש לפי שם, קוד או אימייל..."
                      value={searchTerm}
                      onChange={(e) => setSearchTerm(e.target.value)}
                      className="pr-10"
                    />
                  </div>
                  <Select
                    value={tierFilter}
                    onValueChange={(v) => setTierFilter(v as typeof tierFilter)}
                  >
                    <SelectTrigger className="w-full md:w-40">
                      <Filter className="w-4 h-4 ml-2" />
                      <SelectValue placeholder="סוג מפנה" />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="all">הכל</SelectItem>
                      <SelectItem value="AMBASSADOR">שגרירים</SelectItem>
                      <SelectItem value="COMMUNITY">קהילה</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </CardContent>
            </Card>

            {/* Table */}
            <Card>
              <CardHeader className="pb-3">
                <div className="flex items-center justify-between">
                  <CardTitle className="text-lg">
                    רשימת מפנים ({filteredReferrers.length})
                  </CardTitle>
                </div>
              </CardHeader>
              <CardContent>
                {filteredReferrers.length > 0 ? (
                  <ReferrersTable
                    referrers={filteredReferrers}
                    sortField={sortField}
                    sortOrder={sortOrder}
                    onSort={handleSort}
                    onCopyCode={handleCopyCode}
                    copiedCode={copiedCode}
                  />
                ) : (
                  <div className="text-center py-12 text-gray-500">
                    {searchTerm || tierFilter !== 'all'
                      ? 'לא נמצאו תוצאות לחיפוש'
                      : 'אין מפנים עדיין'}
                  </div>
                )}
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    </main>
  );
}
--- End of Content for page.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\admin\referrals\referrals_contents.txt
--------------------------------------------------------------------------------
[This is the output log file itself. Content not included.]

--- End of Content for referrals_contents.txt ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth
================================================================================

(This directory contains subdirectories but no files directly. See subdirectories below.)

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\error
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\error\AuthErrorClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/error/AuthErrorClient.tsx
'use client';

import { useSearchParams, useRouter } from "next/navigation";
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { AlertTriangle } from "lucide-react";
import type { AuthErrorDict } from '@/types/dictionaries/auth';

interface AuthErrorClientProps {
    dict: AuthErrorDict;
}

export default function AuthErrorClient({ dict }: AuthErrorClientProps) {
  const searchParams = useSearchParams();
  const router = useRouter();
  const error = searchParams.get("error");

  const getErrorMessage = (error: string | null) => {
    switch (error) {
      case "CredentialsSignin":
        return dict.errors.CredentialsSignin;
      case "OAuthAccountNotLinked":
        return dict.errors.OAuthAccountNotLinked;
      default:
        return dict.errors.Default;
    }
  };

  return (
    <Card className="w-full max-w-md">
      <CardHeader className="text-center">
        <AlertTriangle className="mx-auto h-12 w-12 text-red-500" />
        <CardTitle className="text-2xl font-bold text-red-600 mt-4">
          {dict.title}
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-4 text-center">
        <p className="text-gray-600">{getErrorMessage(error)}</p>
        <Button onClick={() => router.push("/auth/signin")} className="w-full">
          {dict.backButton}
        </Button>
      </CardContent>
    </Card>
  );
}
--- End of Content for AuthErrorClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\error\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/error/page.tsx
import { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import AuthErrorClient from './AuthErrorClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

function Loading() {
  return <StandardizedLoadingSpinner />;
}

type ErrorPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function ErrorPage({ params }: ErrorPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    // הוסר bg-gray-50
    <div className="min-h-screen flex items-center justify-center p-4">
      <Suspense fallback={<Loading />}>
        <AuthErrorClient dict={dictionary.auth.errorPage} />
      </Suspense>
    </div>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\forgot-password
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\forgot-password\ForgotPasswordClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/forgot-password/ForgotPasswordClient.tsx
'use client';

import { useState, FormEvent } from 'react';
import { useRouter } from 'next/navigation';
import { motion, AnimatePresence } from 'framer-motion';
import Link from 'next/link';
import {
  Mail,
  Loader2,
  AlertCircle,
  ArrowLeft,
  ArrowRight,
  Send,
  KeyRound,
  Sparkles,
  CheckCircle2,
} from 'lucide-react';

import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import type { ForgotPasswordDict } from '@/types/dictionaries/auth';

// ============================================================================
// TYPE DEFINITIONS
// ============================================================================

interface ForgotPasswordClientProps {
  dict: ForgotPasswordDict;
  locale: 'he' | 'en';
}

// ============================================================================
// ANIMATION VARIANTS
// ============================================================================

const containerVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.1,
      delayChildren: 0.2,
    },
  },
};

const itemVariants = {
  hidden: { opacity: 0, y: 20 },
  visible: {
    opacity: 1,
    y: 0,
    transition: { duration: 0.5, ease: 'easeOut' },
  },
};

// ============================================================================
// BACKGROUND COMPONENT (Teal/Orange Theme)
// ============================================================================

const DynamicBackground: React.FC = () => (
  <div className="fixed inset-0 overflow-hidden pointer-events-none -z-10">
    {/* Floating Gradients */}
    <motion.div
      className="absolute top-10 left-10 w-96 h-96 bg-gradient-to-br from-teal-400/20 to-emerald-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, -30, 0],
        x: [0, 20, 0],
        scale: [1, 1.1, 1],
      }}
      transition={{
        duration: 15,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
    />
    <motion.div
      className="absolute top-40 right-20 w-80 h-80 bg-gradient-to-br from-orange-400/20 to-amber-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 40, 0],
        x: [0, -30, 0],
        scale: [1, 1.15, 1],
      }}
      transition={{
        duration: 18,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 1,
      }}
    />
    <motion.div
      className="absolute bottom-32 left-1/4 w-72 h-72 bg-gradient-to-br from-rose-400/15 to-orange-500/15 rounded-full blur-3xl"
      animate={{
        y: [0, -25, 0],
        x: [0, 15, 0],
        scale: [1, 1.08, 1],
      }}
      transition={{
        duration: 20,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 2,
      }}
    />

    {/* Dot Pattern (Teal) */}
    <div className="absolute inset-0 opacity-[0.03] bg-[radial-gradient(#0d9488_1px,transparent_1px)] [background-size:24px_24px]" />

    {/* SVG Decorative Wave (Teal -> Orange) */}
    <svg
      className="absolute inset-0 w-full h-full"
      viewBox="0 0 1000 1000"
      xmlns="http://www.w3.org/2000/svg"
      preserveAspectRatio="none"
    >
      <defs>
        <linearGradient id="waveGrad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stopColor="#0d9488" stopOpacity="0.08" />
          <stop offset="100%" stopColor="#f97316" stopOpacity="0.04" />
        </linearGradient>
      </defs>
      <motion.path
        d="M0,200 C300,100 700,300 1000,200 L1000,0 L0,0 Z"
        fill="url(#waveGrad)"
        initial={{ opacity: 0.6 }}
        animate={{ opacity: [0.6, 0.9, 0.6] }}
        transition={{ duration: 8, repeat: Infinity, ease: 'easeInOut' }}
      />
    </svg>
  </div>
);

// ============================================================================
// MAIN COMPONENT
// ============================================================================

export default function ForgotPasswordClient({
  dict,
  locale,
}: ForgotPasswordClientProps) {
  const router = useRouter();
  const [email, setEmail] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [success, setSuccess] = useState(false);

  const isRTL = locale === 'he';

  const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    setIsLoading(true);
    setError(null);

    if (!email) {
      setError(dict.errors.missingEmail);
      setIsLoading(false);
      return;
    }

    try {
      const response = await fetch(
        `/api/auth/request-password-reset?locale=${locale}`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email }),
        }
      );

      const data = await response.json();

      if (!response.ok || !data.success) {
        throw new Error(data.error || dict.errors.default);
      }

      // Show success message before redirect
      setSuccess(true);

      // Redirect after showing success
      setTimeout(() => {
        router.push(
          `/${locale}/auth/reset-password?email=${encodeURIComponent(email)}`
        );
      }, 1500);
    } catch (err) {
      setError(err instanceof Error ? err.message : dict.errors.default);
      setIsLoading(false);
    }
  };

  return (
    <>
      <DynamicBackground />

      <div className="min-h-screen flex flex-col items-center justify-center p-4 sm:p-8 relative z-10">
        {/* Back to Sign In Link */}
        <motion.div
          initial={{ opacity: 0, x: isRTL ? 20 : -20 }}
          animate={{ opacity: 1, x: 0 }}
          transition={{ duration: 0.5 }}
          className={`absolute top-6 ${isRTL ? 'right-6' : 'left-6'}`}
        >
          <Link
            href={`/${locale}/auth/signin`}
            className="group flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors duration-300"
          >
            {isRTL ? (
              <ArrowRight className="w-4 h-4 group-hover:translate-x-1 transition-transform" />
            ) : (
              <ArrowLeft className="w-4 h-4 group-hover:-translate-x-1 transition-transform" />
            )}
            <span className="text-sm font-medium">
              {locale === 'he' ? 'חזרה להתחברות' : 'Back to Sign In'}
            </span>
          </Link>
        </motion.div>

        {/* Hero Section */}
        <motion.div
          variants={containerVariants}
          initial="hidden"
          animate="visible"
          className="mb-8 text-center"
        >
          <motion.div variants={itemVariants} className="mb-4">
            {/* Key Icon Background: Teal -> Orange */}
            <div className="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-teal-400 to-orange-500 rounded-2xl shadow-lg mb-6">
              <motion.div
                animate={{
                  rotate: [0, -10, 10, -10, 0],
                  scale: [1, 1.1, 1],
                }}
                transition={{
                  duration: 3,
                  repeat: Infinity,
                  ease: 'easeInOut',
                }}
              >
                <KeyRound className="w-10 h-10 text-white" />
              </motion.div>
            </div>
          </motion.div>

          <motion.h1
            variants={itemVariants}
            className="text-3xl md:text-4xl font-bold mb-3"
          >
            {/* Title Gradient: Teal -> Orange -> Amber */}
            <span className="text-transparent bg-clip-text bg-gradient-to-r from-teal-500 via-orange-500 to-amber-500 animate-gradient-slow">
              {dict.title}
            </span>
          </motion.h1>

          <motion.p
            variants={itemVariants}
            className="text-gray-600 text-base md:text-lg max-w-md mx-auto px-4"
          >
            {dict.subtitle}
          </motion.p>

          {/* Decorative Line (Teal -> Orange) */}
          <motion.div variants={itemVariants} className="relative mt-6">
            <div className="w-20 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400 rounded-full mx-auto" />
          </motion.div>
        </motion.div>

        {/* Main Card */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.3 }}
          className="w-full max-w-md"
        >
          <div className="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/60 overflow-hidden relative">
            {/* Top Gradient Line */}
            <div className="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400" />

            {/* Decorative Elements */}
            <div className="absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-teal-400/10 to-transparent rounded-full transform translate-x-20 -translate-y-20 pointer-events-none" />
            <div className="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-br from-orange-400/10 to-transparent rounded-full transform -translate-x-16 translate-y-16 pointer-events-none" />

            <div className="relative z-10 p-6 sm:p-8">
              {/* Success State */}
              <AnimatePresence mode="wait">
                {success ? (
                  <motion.div
                    key="success"
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    exit={{ opacity: 0, scale: 0.9 }}
                    className="text-center py-8"
                  >
                    {/* Success Icon (Green is usually good to keep for success, or switch to Teal) */}
                    <motion.div
                      initial={{ scale: 0 }}
                      animate={{ scale: 1 }}
                      transition={{
                        delay: 0.2,
                        type: 'spring',
                        stiffness: 200,
                      }}
                      className="inline-flex items-center justify-center w-20 h-20 bg-emerald-100 rounded-full mb-6"
                    >
                      <CheckCircle2 className="w-10 h-10 text-emerald-600" />
                    </motion.div>

                    <motion.h2
                      initial={{ opacity: 0, y: 10 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 0.3 }}
                      className="text-2xl font-bold text-gray-800 mb-3"
                    >
                      {locale === 'he' ? 'נשלח בהצלחה!' : 'Email Sent!'}
                    </motion.h2>

                    <motion.p
                      initial={{ opacity: 0, y: 10 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 0.4 }}
                      className="text-gray-600 mb-6"
                    >
                      {locale === 'he'
                        ? 'מעביר אותך לדף איפוס הסיסמה...'
                        : 'Redirecting to reset password...'}
                    </motion.p>

                    <motion.div
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      transition={{ delay: 0.5 }}
                    >
                      {/* Loader -> Teal */}
                      <Loader2 className="w-6 h-6 animate-spin text-teal-500 mx-auto" />
                    </motion.div>
                  </motion.div>
                ) : (
                  <motion.div
                    key="form"
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    exit={{ opacity: 0 }}
                  >
                    {/* Info Box -> Teal/Orange mix */}
                    <motion.div
                      initial={{ opacity: 0, y: -10 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 0.2 }}
                      className="mb-6 p-4 bg-gradient-to-r from-teal-50 to-orange-50 rounded-2xl border border-teal-100"
                    >
                      <div className="flex items-start gap-3">
                        <div className="p-2 bg-white rounded-lg flex-shrink-0">
                          {/* Sparkles -> Teal */}
                          <Sparkles className="w-5 h-5 text-teal-500" />
                        </div>
                        <p className="text-sm text-gray-700 leading-relaxed pt-1">
                          {locale === 'he'
                            ? 'נשלח לך קישור לאיפוס הסיסמה למייל שרשמת'
                            : "We'll send you a link to reset your password"}
                        </p>
                      </div>
                    </motion.div>

                    {/* Error Alert */}
                    <AnimatePresence>
                      {error && (
                        <motion.div
                          initial={{ opacity: 0, y: -10, height: 0 }}
                          animate={{ opacity: 1, y: 0, height: 'auto' }}
                          exit={{ opacity: 0, y: -10, height: 0 }}
                          className="mb-6"
                        >
                          <Alert variant="destructive" className="border-2">
                            <div className="flex items-start gap-3">
                              <div className="p-2 bg-red-100 rounded-lg flex-shrink-0">
                                <AlertCircle className="h-5 w-5 text-red-600" />
                              </div>
                              <div className="flex-1">
                                <AlertTitle className="font-bold mb-1">
                                  {dict.errors.title}
                                </AlertTitle>
                                <AlertDescription className="text-sm">
                                  {error}
                                </AlertDescription>
                              </div>
                            </div>
                          </Alert>
                        </motion.div>
                      )}
                    </AnimatePresence>

                    {/* Form */}
                    <form onSubmit={handleSubmit} className="space-y-6">
                      {/* Email Field */}
                      <div className="space-y-2">
                        <label
                          htmlFor="email-forgot"
                          className="block text-sm font-semibold text-gray-700"
                        >
                          {dict.emailLabel}
                        </label>
                        <div className="relative group">
                          <div
                            className={`absolute ${isRTL ? 'right-3' : 'left-3'} top-1/2 transform -translate-y-1/2 transition-colors ${
                              email ? 'text-teal-500' : 'text-gray-400'
                            }`}
                          >
                            <Mail className="h-5 w-5" />
                          </div>
                          <Input
                            type="email"
                            id="email-forgot"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            placeholder={dict.emailPlaceholder}
                            required
                            // Input Focus -> Teal
                            className={`w-full ${isRTL ? 'pr-11 pl-4' : 'pl-11 pr-4'} py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-teal-200 focus:border-teal-400 focus:outline-none transition-all bg-white/50 backdrop-blur-sm hover:border-gray-300 text-gray-800 placeholder:text-gray-400`}
                            disabled={isLoading}
                            dir={isRTL ? 'rtl' : 'ltr'}
                          />
                        </div>
                      </div>

                      {/* Submit Button -> Teal/Orange/Amber */}
                      <Button
                        type="submit"
                        disabled={isLoading}
                        className="w-full py-4 bg-gradient-to-r from-teal-500 via-orange-500 to-amber-500 hover:from-teal-600 hover:via-orange-600 hover:to-amber-600 shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center gap-2 rounded-xl text-base font-semibold group relative overflow-hidden"
                      >
                        {/* Shine effect */}
                        <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000" />

                        {isLoading ? (
                          <>
                            <Loader2 className="h-5 w-5 animate-spin" />
                            <span>{dict.submitButtonLoading}</span>
                          </>
                        ) : (
                          <>
                            <Send className="w-5 h-5" />
                            <span>{dict.submitButton}</span>
                          </>
                        )}
                      </Button>
                    </form>

                    {/* Back Link */}
                    <div className="mt-8 text-center">
                      <p className="text-gray-600 text-sm">
                        {locale === 'he'
                          ? 'זכרת את הסיסמה?'
                          : 'Remember your password?'}{' '}
                        <Link
                          href={`/${locale}/auth/signin`}
                          className="text-teal-600 font-semibold hover:text-teal-700 hover:underline transition-colors inline-flex items-center gap-1"
                        >
                          {dict.backToSignInLink}
                          {isRTL ? (
                            <ArrowLeft className="w-3 h-3" />
                          ) : (
                            <ArrowRight className="w-3 h-3" />
                          )}
                        </Link>
                      </p>
                    </div>
                  </motion.div>
                )}
              </AnimatePresence>
            </div>

            {/* Bottom Shine Effect -> Teal/Orange */}
            <div className="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400 opacity-50" />
          </div>
        </motion.div>

        {/* Help Text */}
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 0.8, duration: 0.5 }}
          className="mt-8 text-center max-w-md"
        >
          <p className="text-xs text-gray-500">
            {locale === 'he'
              ? 'לא קיבלת מייל? בדוק את תיקיית הספאם או נסה שוב'
              : "Didn't receive an email? Check your spam folder or try again"}
          </p>
        </motion.div>
      </div>

      {/* Animations CSS */}
      <style>{`
        @keyframes gradient-slow {
          0%,
          100% {
            background-position: 0% 50%;
          }
          50% {
            background-position: 100% 50%;
          }
        }
        .animate-gradient-slow {
          background-size: 200% 200%;
          animation: gradient-slow 6s ease infinite;
        }
      `}</style>
    </>
  );
}
--- End of Content for ForgotPasswordClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\forgot-password\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/forgot-password/page.tsx
import Link from 'next/link';
import { ArrowLeft } from 'lucide-react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import ForgotPasswordClient from './ForgotPasswordClient';

// ▼▼▼ כאן השינוי ▼▼▼
type ForgotPasswordPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function ForgotPasswordPage({ params }: ForgotPasswordPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-cyan-50 via-white to-pink-50 p-4 sm:p-8">
      <Link
        href="/"
        className="absolute top-4 left-4 rtl:right-4 rtl:left-auto text-gray-600 hover:text-gray-800 transition-colors flex items-center gap-1 text-sm z-20"
      >
        <ArrowLeft
          className={`h-4 w-4 ${locale === 'he' ? 'transform rotate-180' : ''}`}
        />{' '}
        חזרה לדף הבית
      </Link>
      <ForgotPasswordClient
        dict={dictionary.auth.forgotPassword}
        locale={locale}
      />
    </div>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\register
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\register\RegisterClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/register/RegisterClient.tsx
'use client';

import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

import React, { useEffect, useState } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { useSession } from 'next-auth/react';
import {
  RegistrationProvider,
  useRegistration,
} from '@/components/auth/RegistrationContext';
import Link from 'next/link';
import { motion, AnimatePresence } from 'framer-motion';
import { Info, Sparkles, Heart, Shield } from 'lucide-react';

// Import step components
import WelcomeStep from '@/components/auth/steps/WelcomeStep';
import BasicInfoStep from '@/components/auth/steps/BasicInfoStep';
import EmailVerificationCodeStep from '@/components/auth/steps/EmailVerificationCodeStep';
import PersonalDetailsStep from '@/components/auth/steps/PersonalDetailsStep';
import CompleteStep from '@/components/auth/steps/CompleteStep';
import ProgressBar from '@/components/auth/ProgressBar';

import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import type { User as SessionUserType } from '@/types/next-auth';
import type { RegisterStepsDict } from '@/types/dictionaries/auth';

// ============================================================================
// TYPE DEFINITIONS
// ============================================================================

interface RegisterClientProps {
  dict: RegisterStepsDict;
  locale: 'he' | 'en';
}

// ============================================================================
// ANIMATION VARIANTS
// ============================================================================

const pageTransition = {
  initial: { opacity: 0, y: 20 },
  animate: { opacity: 1, y: 0 },
  exit: { opacity: 0, y: -20 },
  transition: { duration: 0.4, ease: 'easeOut' },
};

const containerVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.1,
      delayChildren: 0.2,
    },
  },
};

const itemVariants = {
  hidden: { opacity: 0, y: 20 },
  visible: {
    opacity: 1,
    y: 0,
    transition: { duration: 0.5, ease: 'easeOut' },
  },
};

// ============================================================================
// BACKGROUND COMPONENT (Teal/Orange Theme)
// ============================================================================

const DynamicBackground: React.FC = () => (
  <div className="fixed inset-0 overflow-hidden pointer-events-none -z-10">
    {/* Floating Gradients */}
    <motion.div
      className="absolute top-10 left-10 w-96 h-96 bg-gradient-to-br from-teal-400/20 to-emerald-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, -30, 0],
        x: [0, 20, 0],
        scale: [1, 1.1, 1],
      }}
      transition={{
        duration: 15,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
    />
    <motion.div
      className="absolute top-40 right-20 w-80 h-80 bg-gradient-to-br from-orange-400/20 to-amber-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 40, 0],
        x: [0, -30, 0],
        scale: [1, 1.15, 1],
      }}
      transition={{
        duration: 18,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 1,
      }}
    />
    <motion.div
      className="absolute bottom-32 left-1/4 w-72 h-72 bg-gradient-to-br from-rose-400/15 to-orange-500/15 rounded-full blur-3xl"
      animate={{
        y: [0, -25, 0],
        x: [0, 15, 0],
        scale: [1, 1.08, 1],
      }}
      transition={{
        duration: 20,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 2,
      }}
    />
    <motion.div
      className="absolute bottom-20 right-10 w-64 h-64 bg-gradient-to-br from-teal-400/20 to-cyan-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 35, 0],
        scale: [1, 1.12, 1],
      }}
      transition={{
        duration: 16,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 0.5,
      }}
    />

    {/* Dot Pattern (Teal Accent) */}
    <div className="absolute inset-0 opacity-[0.03] bg-[radial-gradient(#0d9488_1px,transparent_1px)] [background-size:24px_24px]" />

    {/* SVG Decorative Waves (Teal -> Orange) */}
    <svg
      className="absolute inset-0 w-full h-full"
      viewBox="0 0 1000 1000"
      xmlns="http://www.w3.org/2000/svg"
      preserveAspectRatio="none"
    >
      <defs>
        <linearGradient id="waveGrad1" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stopColor="#0d9488" stopOpacity="0.08" />{' '}
          {/* Teal */}
          <stop offset="100%" stopColor="#f97316" stopOpacity="0.04" />{' '}
          {/* Orange */}
        </linearGradient>
        <linearGradient id="waveGrad2" x1="100%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stopColor="#f59e0b" stopOpacity="0.06" />{' '}
          {/* Amber */}
          <stop offset="100%" stopColor="#14b8a6" stopOpacity="0.03" />{' '}
          {/* Teal */}
        </linearGradient>
      </defs>
      <motion.path
        d="M0,200 C300,100 700,300 1000,200 L1000,0 L0,0 Z"
        fill="url(#waveGrad1)"
        initial={{ opacity: 0.6 }}
        animate={{ opacity: [0.6, 0.9, 0.6] }}
        transition={{ duration: 8, repeat: Infinity, ease: 'easeInOut' }}
      />
      <motion.path
        d="M0,800 C300,700 700,900 1000,800 L1000,1000 L0,1000 Z"
        fill="url(#waveGrad2)"
        initial={{ opacity: 0.6 }}
        animate={{ opacity: [0.6, 0.8, 0.6] }}
        transition={{
          duration: 10,
          repeat: Infinity,
          ease: 'easeInOut',
          delay: 2,
        }}
      />
    </svg>
  </div>
);

// ============================================================================
// HERO SECTION
// ============================================================================

interface HeroSectionProps {
  title: string;
  subtitle: string;
  locale: 'he' | 'en';
}

const HeroSection: React.FC<HeroSectionProps> = ({
  title,
  subtitle,
  locale,
}) => {
  const isRTL = locale === 'he';

  return (
    <motion.div
      variants={containerVariants}
      initial="hidden"
      animate="visible"
      className="mb-8 text-center"
    >
      <motion.div variants={itemVariants} className="mb-4">
        <div className="inline-flex items-center gap-3 bg-white/80 backdrop-blur-sm rounded-full px-6 py-3 shadow-lg border border-white/60 mb-6">
          <motion.div
            animate={{ rotate: [0, 10, -10, 0] }}
            transition={{ duration: 2, repeat: Infinity, ease: 'easeInOut' }}
          >
            {/* Sparkles - Teal (Tech) */}
            <Sparkles className="w-5 h-5 text-teal-500" />
          </motion.div>
          <span className="text-sm font-medium text-gray-700">
            {locale === 'he' ? 'הצעד הראשון למסע שלכם' : 'Your First Step'}
          </span>
          {/* Heart - Orange (Human) */}
          <Heart className="w-5 h-5 text-orange-500" />
        </div>
      </motion.div>

      <motion.h1
        variants={itemVariants}
        className="text-3xl md:text-4xl lg:text-5xl font-bold mb-4"
      >
        {/* Main Gradient Text */}
        <span className="text-transparent bg-clip-text bg-gradient-to-r from-teal-500 via-orange-500 to-amber-500 animate-gradient-slow">
          {title}
        </span>
      </motion.h1>

      <motion.p
        variants={itemVariants}
        className="text-gray-600 text-base md:text-lg max-w-2xl mx-auto leading-relaxed px-4"
        style={{
          direction: isRTL ? 'rtl' : 'ltr',
          textAlign: 'center',
        }}
      >
        {subtitle}
      </motion.p>

      {/* Decorative Line (Teal -> Orange) */}
      <motion.div variants={itemVariants} className="relative mt-6">
        <div className="w-24 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400 rounded-full mx-auto" />
        <motion.div
          className="absolute top-0 left-1/2 -translate-x-1/2 w-2 h-2 bg-white rounded-full border-2 border-orange-400"
          animate={{ scale: [1, 1.3, 1] }}
          transition={{ duration: 2, repeat: Infinity, ease: 'easeInOut' }}
        />
      </motion.div>
    </motion.div>
  );
};

// ============================================================================
// MAIN REGISTRATION STEPS CONTENT
// ============================================================================

const RegisterStepsContent: React.FC<{
  dict: RegisterStepsDict;
  locale: 'he' | 'en';
}> = ({ dict, locale }) => {
  const {
    data: registrationContextData,
    initializeFromSession,
    resetForm,
    goToStep,
  } = useRegistration();
  const router = useRouter();
  const { data: session, status: sessionStatus } = useSession();
  const searchParams = useSearchParams();

  const [showIncompleteProfileMessage, setShowIncompleteProfileMessage] =
    useState(false);
  const [initializationAttempted, setInitializationAttempted] = useState(false);

  const isRTL = locale === 'he';

  // Handle incomplete profile message
  useEffect(() => {
    const reasonParam = searchParams.get('reason');
    if (
      (reasonParam === 'complete_profile' || reasonParam === 'verify_phone') &&
      !registrationContextData.isCompletingProfile
    ) {
      setShowIncompleteProfileMessage(true);
    } else {
      setShowIncompleteProfileMessage(false);
    }
  }, [searchParams, registrationContextData.isCompletingProfile]);

  // Initialize from session
  useEffect(() => {
    if (sessionStatus === 'loading') return;

    if (sessionStatus === 'authenticated' && session?.user) {
      const user = session.user as SessionUserType;
      if (
        user.isProfileComplete &&
        user.isPhoneVerified &&
        user.termsAndPrivacyAcceptedAt
      ) {
        if (
          typeof window !== 'undefined' &&
          window.location.pathname !== `/${locale}/profile`
        ) {
          router.push(`/${locale}/profile`);
        }
        return;
      }

      const needsSetup =
        !user.termsAndPrivacyAcceptedAt ||
        !user.isProfileComplete ||
        !user.isPhoneVerified;
      if (
        needsSetup &&
        (!initializationAttempted ||
          (registrationContextData.step === 0 &&
            !registrationContextData.isVerifyingEmailCode))
      ) {
        initializeFromSession(user);
        setInitializationAttempted(true);
      }
    }
  }, [
    sessionStatus,
    session,
    router,
    registrationContextData,
    initializeFromSession,
    resetForm,
    goToStep,
    initializationAttempted,
    searchParams,
    locale,
  ]);

  // Render appropriate step
  const renderStep = (): React.ReactNode => {
    if (sessionStatus === 'loading') {
      return (
        <StandardizedLoadingSpinner
          text={locale === 'he' ? 'טוען...' : 'Loading...'}
          className="min-h-[400px]"
        />
      );
    }

    if (
      registrationContextData.isVerifyingEmailCode &&
      !registrationContextData.isCompletingProfile
    ) {
      return (
        <EmailVerificationCodeStep
          dict={dict.steps.emailVerification}
          locale={locale}
        />
      );
    }

    if (registrationContextData.isCompletingProfile) {
      switch (registrationContextData.step) {
        case 2:
          return (
            <PersonalDetailsStep
              personalDetailsDict={dict.steps.personalDetails}
              optionalInfoDict={dict.steps.optionalInfo}
              consentDict={dict.consentCheckbox}
              validationDict={dict.validationErrors} // הוספה כאן: העברת המילון החדש
              locale={locale}
            />
          );
        case 4:
          return <CompleteStep dict={dict.steps.complete} />;
        default:
          resetForm();
          return <WelcomeStep dict={dict.steps.welcome} locale={locale} />;
      }
    }

    switch (registrationContextData.step) {
      case 0:
        return <WelcomeStep dict={dict.steps.welcome} locale={locale} />;
      case 1:
        return (
          <BasicInfoStep
            dict={dict.steps.basicInfo}
            consentDict={dict.consentCheckbox}
            validationDict={dict.validationErrors} // הוספה כאן: העברת המילון החדש
            locale={locale}
          />
        );
      default:
        resetForm();
        return <WelcomeStep dict={dict.steps.welcome} locale={locale} />;
    }
  };

  // Determine page title and progress
  let pageTitle = dict.headers.registerTitle;
  let stepDescription = dict.headers.welcomeDescription;
  let currentProgressBarStep = 0;
  let totalProgressBarSteps = 3;
  let showProgressBar = false;

  if (
    registrationContextData.isVerifyingEmailCode &&
    !registrationContextData.isCompletingProfile
  ) {
    // Flow A: Account Creation -> Email Verify
    pageTitle = dict.headers.verifyEmailTitle;
    stepDescription = dict.headers.verifyEmailDescription.replace(
      '{{email}}',
      registrationContextData.emailForVerification || ''
    );
    showProgressBar = true;
    currentProgressBarStep = 2; // Step 2 of 2
    totalProgressBarSteps = 2;
  } else if (registrationContextData.isCompletingProfile) {
    // Flow B: Profile Completion (Google / Post-Email)
    pageTitle = dict.headers.completeProfileTitle;
    totalProgressBarSteps = 2; // Fixed: Now it's 2 steps (Details + Phone)

    if (registrationContextData.step === 2) {
      // Step 1: Personal Details
      stepDescription = session?.user?.termsAndPrivacyAcceptedAt
        ? dict.headers.personalDetailsConsentedDescription
        : dict.headers.personalDetailsDescription;
      currentProgressBarStep = 1; // Step 1 of 2
      showProgressBar = true;
    } else if (registrationContextData.step === 4) {
      // Transition state
      stepDescription = session?.user?.isPhoneVerified
        ? dict.headers.completionReadyDescription
        : dict.headers.completionPhoneVerificationDescription;
      showProgressBar = false;
    } else {
      stepDescription = dict.headers.loadingProfileDescription;
      showProgressBar = false;
    }
  } else {
    // Initial Register Flow
    if (registrationContextData.step === 1) {
      pageTitle = dict.headers.registerTitle;
      stepDescription = dict.headers.accountCreationDescription;
      currentProgressBarStep = 1; // Step 1 of 2 (Account Creation)
      totalProgressBarSteps = 2;
      showProgressBar = true;
    }
  }

  const isWideStep =
    registrationContextData.isCompletingProfile &&
    registrationContextData.step === 2;

  return (
    <>
      <DynamicBackground />

      <div className="min-h-screen flex flex-col items-center justify-center p-4 sm:p-8 relative z-10">
        {/* Hero Section */}
        <HeroSection
          title={pageTitle}
          subtitle={stepDescription}
          locale={locale}
        />

        {/* Incomplete Profile Alert */}
        <AnimatePresence>
          {showIncompleteProfileMessage && (
            <motion.div
              initial={{ opacity: 0, y: -20, scale: 0.95 }}
              animate={{ opacity: 1, y: 0, scale: 1 }}
              exit={{ opacity: 0, y: -20, scale: 0.95 }}
              transition={{ duration: 0.3 }}
              className="w-full max-w-md md:max-w-2xl mb-6 mx-auto"
            >
              <Alert className="bg-gradient-to-r from-amber-50 to-orange-50 border-2 border-amber-200 shadow-lg">
                <div className="flex items-start gap-3">
                  <div className="p-2 bg-amber-100 rounded-lg">
                    <Info className="h-5 w-5 text-amber-600" />
                  </div>
                  <div className="flex-1">
                    <AlertTitle className="font-bold text-amber-900 mb-1">
                      {dict.incompleteProfileAlert.title}
                    </AlertTitle>
                    <AlertDescription className="text-sm text-amber-800 leading-relaxed">
                      {searchParams.get('reason') === 'verify_phone'
                        ? dict.incompleteProfileAlert.verifyPhoneDescription
                        : dict.incompleteProfileAlert.description}
                    </AlertDescription>
                  </div>
                </div>
              </Alert>
            </motion.div>
          )}
        </AnimatePresence>

        {/* Progress Bar */}
        <AnimatePresence>
          {showProgressBar && (
            <motion.div
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -10 }}
              transition={{ duration: 0.4 }}
              className="w-full max-w-md md:max-w-2xl mb-6 mx-auto"
            >
              <ProgressBar
                currentStep={currentProgressBarStep}
                totalSteps={totalProgressBarSteps}
                stepLabel={dict.progressBar.stepLabel}
                locale={locale}
              />
            </motion.div>
          )}
        </AnimatePresence>

        {/* Main Card Container */}
        <motion.div
          {...pageTransition}
          className="w-full max-w-md md:max-w-2xl relative"
        >
          <div className="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/60 overflow-hidden relative">
            {/* Decorative Elements - POINTER EVENTS NONE */}
            <div className="absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-teal-400/10 to-transparent rounded-full transform translate-x-20 -translate-y-20 pointer-events-none" />
            <div className="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-br from-orange-400/10 to-transparent rounded-full transform -translate-x-16 translate-y-16 pointer-events-none" />

            {/* Content - Z-10 RELATIVE */}
            <div className="relative z-10 p-6 sm:p-8 md:p-12">
              <AnimatePresence mode="wait">
                <motion.div
                  key={registrationContextData.step}
                  initial={{ opacity: 0, x: isRTL ? -20 : 20 }}
                  animate={{ opacity: 1, x: 0 }}
                  exit={{ opacity: 0, x: isRTL ? 20 : -20 }}
                  transition={{ duration: 0.3 }}
                  className={isWideStep ? 'w-full' : 'max-w-md mx-auto'}
                >
                  {renderStep()}
                </motion.div>
              </AnimatePresence>
            </div>

            {/* Bottom Shine Effect (Teal -> Orange) */}
            <div className="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400 opacity-50 pointer-events-none" />
          </div>
        </motion.div>

        {/* Support Link */}
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 0.5, duration: 0.5 }}
          className="mt-8 text-center"
        >
          <p className="text-sm text-gray-500">
            {dict.contactSupport}{' '}
            <Link
              href={`/${locale}/contact`}
              className="text-teal-600 hover:text-teal-700 font-medium hover:underline transition-colors inline-flex items-center gap-1"
            >
              {dict.contactSupportLink}
              <Shield className="w-3 h-3" />
            </Link>
          </p>
        </motion.div>
      </div>

      {/* Animations CSS */}
      <style>{`
        @keyframes gradient-slow {
          0%,
          100% {
            background-position: 0% 50%;
          }
          50% {
            background-position: 100% 50%;
          }
        }
        .animate-gradient-slow {
          background-size: 200% 200%;
          animation: gradient-slow 6s ease infinite;
        }
      `}</style>
    </>
  );
};

// ============================================================================
// MAIN EXPORT WITH PROVIDER
// ============================================================================

export default function RegisterClient({ dict, locale }: RegisterClientProps) {
  return (
    <RegistrationProvider>
      <RegisterStepsContent dict={dict} locale={locale} />
    </RegistrationProvider>
  );
}
--- End of Content for RegisterClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\register\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/register/page.tsx
import { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import RegisterClient from './RegisterClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

// עדכון רכיב הטעינה
function Loading() {
  return <StandardizedLoadingSpinner />;
}

type RegisterPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function RegisterPage({ params }: RegisterPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <Suspense fallback={<Loading />}>
      <RegisterClient
        dict={dictionary.auth.register}
        locale={locale}
      />
    </Suspense>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\reset-password
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\reset-password\ResetPasswordClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/reset-password/ResetPasswordClient.tsx
'use client';

import { useState, FormEvent, useEffect } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import {
  Lock,
  KeySquare,
  Loader2,
  AlertCircle,
  CheckCircle,
  Eye,
  EyeOff,
  Mail,
} from 'lucide-react';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import Link from 'next/link';
import type { ResetPasswordDict } from '@/types/dictionaries/auth';

interface ResetPasswordClientProps {
  dict: ResetPasswordDict;
  locale: 'he' | 'en'; // הוסף
}

const validatePassword = (
  value: string,
  validationMessage: string
): string | null => {
  const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/;
  if (!passwordRegex.test(value)) {
    return validationMessage;
  }
  return null;
};

export default function ResetPasswordClient({
  dict,
  locale,
}: ResetPasswordClientProps) {
  const router = useRouter();
  const searchParams = useSearchParams();

  const [email, setEmail] = useState('');
  const [otp, setOtp] = useState('');
  const [newPassword, setNewPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [passwordError, setPasswordError] = useState<string | null>(null);
  const [successMessage, setSuccessMessage] = useState<string | null>(null);
  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);

  useEffect(() => {
    const emailFromQuery = searchParams.get('email');
    if (emailFromQuery) setEmail(emailFromQuery);
  }, [searchParams]);

  const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    setIsLoading(true);
    setError(null);
    setPasswordError(null);

    if (!email) {
      setError(dict.errors.missingEmail);
      setIsLoading(false);
      return;
    }
    if (!otp || otp.length !== 6 || !/^\d+$/.test(otp)) {
      setError(dict.errors.invalidOtp);
      setIsLoading(false);
      return;
    }
    const passValidationError = validatePassword(
      newPassword,
      dict.passwordValidation.length
    );
    if (passValidationError) {
      setPasswordError(passValidationError);
      setIsLoading(false);
      return;
    }
    if (newPassword !== confirmPassword) {
      setError(dict.errors.passwordsMismatch);
      setIsLoading(false);
      return;
    }

    try {
      const response = await fetch(
        `/api/auth/reset-password?locale=${locale}`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, otp, newPassword }),
        }
      );
      const data = await response.json();
      if (!response.ok) throw new Error(data.error || dict.errors.default);

      setSuccessMessage(dict.successMessage);
      setTimeout(() => router.push('/auth/signin?reset=success'), 3000);
    } catch (err) {
      setError(err instanceof Error ? err.message : dict.errors.default);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="w-full max-w-md bg-white rounded-xl shadow-xl overflow-hidden relative">
      <div className="absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-cyan-500 to-pink-500"></div>
      <div className="p-6 sm:p-8">
        <div className="text-center mb-6">
          <h1 className="text-2xl font-bold text-gray-800 mb-2">
            {dict.title}
          </h1>
          <p className="text-gray-600 text-sm">{dict.subtitle}</p>
        </div>

        {error && (
          <Alert variant="destructive" className="mb-4" role="alert">
            <AlertCircle className="h-4 w-4" />
            <AlertTitle>שגיאה</AlertTitle>
            <AlertDescription>{error}</AlertDescription>
          </Alert>
        )}
        {passwordError && !error && (
          <Alert variant="destructive" className="mb-4" role="alert">
            <AlertCircle className="h-4 w-4" />
            <AlertTitle>שגיאת סיסמה</AlertTitle>
            <AlertDescription>{passwordError}</AlertDescription>
          </Alert>
        )}
        {successMessage && (
          <Alert className="mb-4 bg-green-50">
            <CheckCircle className="h-4 w-4 text-green-600" />
            <AlertTitle>הצלחה!</AlertTitle>
            <AlertDescription>
              {successMessage} {dict.successRedirect}
            </AlertDescription>
          </Alert>
        )}

        {!successMessage && (
          <form onSubmit={handleSubmit} className="space-y-5">
            <div className="space-y-1">
              <label
                htmlFor="email-reset"
                className="block text-sm font-medium text-gray-700"
              >
                {dict.emailLabel} <span className="text-red-500">*</span>
              </label>
              <div className="relative">
                <Mail className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5" />
                <Input
                  type="email"
                  id="email-reset"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  placeholder={dict.emailPlaceholder}
                  required
                  disabled={isLoading || !!searchParams.get('email')}
                />
              </div>
            </div>
            <div className="space-y-1">
              <label
                htmlFor="otp-reset"
                className="block text-sm font-medium text-gray-700"
              >
                {dict.otpLabel} <span className="text-red-500">*</span>
              </label>
              <div className="relative">
                <KeySquare className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5" />
                <Input
                  type="text"
                  id="otp-reset"
                  value={otp}
                  onChange={(e) =>
                    setOtp(e.target.value.replace(/[^0-9]/g, '').slice(0, 6))
                  }
                  placeholder={dict.otpPlaceholder}
                  maxLength={6}
                  required
                  disabled={isLoading}
                  inputMode="numeric"
                />
              </div>
            </div>
            <div className="space-y-1">
              <label
                htmlFor="new-password-reset"
                className="block text-sm font-medium text-gray-700"
              >
                {dict.newPasswordLabel} <span className="text-red-500">*</span>
              </label>
              <div className="relative">
                <Lock className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5" />
                <Input
                  type={showPassword ? 'text' : 'password'}
                  id="new-password-reset"
                  value={newPassword}
                  onChange={(e) => setNewPassword(e.target.value)}
                  onBlur={(e) =>
                    setPasswordError(
                      validatePassword(
                        e.target.value,
                        dict.passwordValidation.length
                      )
                    )
                  }
                  placeholder={dict.newPasswordPlaceholder}
                  required
                  disabled={isLoading}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute left-3 top-1/2 -translate-y-1/2"
                  aria-label={
                    showPassword ? dict.hidePasswordAria : dict.showPasswordAria
                  }
                >
                  {showPassword ? (
                    <EyeOff className="h-5 w-5" />
                  ) : (
                    <Eye className="h-5 w-5" />
                  )}
                </button>
              </div>
              {!passwordError && (
                <p className="mt-1 text-xs text-gray-500">
                  {dict.passwordHint}
                </p>
              )}
            </div>
            <div className="space-y-1">
              <label
                htmlFor="confirm-password-reset"
                className="block text-sm font-medium text-gray-700"
              >
                {dict.confirmPasswordLabel}{' '}
                <span className="text-red-500">*</span>
              </label>
              <div className="relative">
                <Lock className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5" />
                <Input
                  type={showConfirmPassword ? 'text' : 'password'}
                  id="confirm-password-reset"
                  value={confirmPassword}
                  onChange={(e) => setConfirmPassword(e.target.value)}
                  placeholder={dict.confirmPasswordPlaceholder}
                  required
                  disabled={isLoading}
                />
                <button
                  type="button"
                  onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                  className="absolute left-3 top-1/2 -translate-y-1/2"
                  aria-label={
                    showConfirmPassword
                      ? dict.hidePasswordAria
                      : dict.showPasswordAria
                  }
                >
                  {showConfirmPassword ? (
                    <EyeOff className="h-5 w-5" />
                  ) : (
                    <Eye className="h-5 w-5" />
                  )}
                </button>
              </div>
            </div>
            <Button
              type="submit"
              disabled={
                isLoading ||
                !!passwordError ||
                !otp ||
                !newPassword ||
                !confirmPassword ||
                newPassword !== confirmPassword
              }
              className="w-full"
            >
              {isLoading ? (
                <>
                  <Loader2 className="h-5 w-5 animate-spin mr-2" />
                  <span>{dict.submitButtonLoading}</span>
                </>
              ) : (
                dict.submitButton
              )}
            </Button>
          </form>
        )}

        <div className="mt-6 text-center">
          <Link
            href="/auth/signin"
            className="text-sm text-cyan-600 hover:text-cyan-700 hover:underline"
          >
            {dict.backToSignInLink}
          </Link>
        </div>
      </div>
    </div>
  );
}
--- End of Content for ResetPasswordClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\reset-password\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/reset-password/page.tsx
import { Suspense } from 'react';
import Link from 'next/link';
import { ArrowLeft } from 'lucide-react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import ResetPasswordClient from './ResetPasswordClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

// עדכון רכיב הטעינה
function Loading() {
  return <StandardizedLoadingSpinner />;
}

type ResetPasswordPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function ResetPasswordPage({ params }: ResetPasswordPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-cyan-50 via-white to-pink-50 p-4 sm:p-8">
      <Link
        href="/"
        className="absolute top-4 left-4 rtl:right-4 rtl:left-auto text-gray-600 hover:text-gray-800 transition-colors flex items-center gap-1 text-sm z-20"
      >
        <ArrowLeft
          className={`h-4 w-4 ${locale === 'he' ? 'transform rotate-180' : ''}`}
        />{' '}
        חזרה לדף הבית
      </Link>
      <Suspense fallback={<Loading />}>
        <ResetPasswordClient
          dict={dictionary.auth.resetPassword}
          locale={locale}
        />
      </Suspense>
    </div>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\setup-account
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\setup-account\SetupAccountClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/setup-account/SetupAccountClient.tsx
'use client';

import React, { useState, useEffect } from 'react';
import { useSearchParams } from 'next/navigation';
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
  CardDescription,
  CardFooter,
} from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { toast } from 'sonner';
import { Loader2, KeyRound } from 'lucide-react';
import type { SetupAccountDict } from '@/types/dictionaries/auth';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

interface SetupAccountClientProps {
  dict: SetupAccountDict;
}

export default function SetupAccountClient({ dict }: SetupAccountClientProps) {
  const searchParams = useSearchParams();
  const [token, setToken] = useState<string | null>(null);
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState('');
  const [success, setSuccess] = useState(false);

  useEffect(() => {
    const tokenFromUrl = searchParams.get('token');
    if (tokenFromUrl) {
      setToken(tokenFromUrl);
    } else {
      setError(dict.errors.linkInvalid);
    }
  }, [searchParams, dict.errors.linkInvalid]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    if (password.length < 8) {
      setError(dict.errors.passwordLength);
      return;
    }
    if (password !== confirmPassword) {
      setError(dict.errors.passwordsMismatch);
      return;
    }

    setIsLoading(true);

    try {
      const response = await fetch('/api/auth/complete-setup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token, password }),
      });
      const result = await response.json();
      if (!response.ok) throw new Error(result.error || dict.errors.default);

      setSuccess(true);
      toast.success(dict.success.title);

      setTimeout(() => {
        window.location.assign('/profile');
      }, 1500);
    } catch (err) {
      setError(err instanceof Error ? err.message : dict.errors.unexpected);
      setIsLoading(false);
    }
  };

  if (success) {
    return (
      <div className="w-full max-w-md mx-auto">
        <StandardizedLoadingSpinner
          text={dict.success.title}
          subtext={dict.success.description}
          className="bg-white rounded-xl shadow-lg p-8"
        />
      </div>
    );
  }

  return (
    <Card className="w-full max-w-md mx-auto">
      <CardHeader>
        <CardTitle>{dict.title}</CardTitle>
        <CardDescription>{dict.description}</CardDescription>
      </CardHeader>
      <CardContent>
        {!token ? (
          <div className="text-red-500 text-center p-4 bg-red-50 rounded-md">
            {error}
          </div>
        ) : (
          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <Label htmlFor="password">{dict.newPasswordLabel}</Label>
              <Input
                id="password"
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
              />
              <p className="text-xs text-muted-foreground mt-1">
                {dict.passwordHint}
              </p>
            </div>
            <div>
              <Label htmlFor="confirmPassword">
                {dict.confirmPasswordLabel}
              </Label>
              <Input
                id="confirmPassword"
                type="password"
                value={confirmPassword}
                onChange={(e) => setConfirmPassword(e.target.value)}
                required
              />
            </div>
            {error && (
              <p className="text-sm font-medium text-destructive">{error}</p>
            )}
            <CardFooter className="p-0 pt-4">
              <Button type="submit" className="w-full" disabled={isLoading}>
                {isLoading ? (
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                ) : (
                  <KeyRound className="mr-2 h-4 w-4" />
                )}
                {isLoading ? dict.submitButtonLoading : dict.submitButton}
              </Button>
            </CardFooter>
          </form>
        )}
      </CardContent>
    </Card>
  );
}
--- End of Content for SetupAccountClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\setup-account\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/setup-account/page.tsx
import { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import SetupAccountClient from './SetupAccountClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

function Loading() {
  return <StandardizedLoadingSpinner />;
}

type SetupAccountPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function SetupAccountPage({ params }: SetupAccountPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    // הסרתי את bg-gray-100 לטובת הגרדיאנט המובנה או נקי
    <div className="flex items-center justify-center min-h-screen p-4">
      <Suspense fallback={<Loading />}>
        <SetupAccountClient dict={dictionary.auth.setupAccount} />
      </Suspense>
    </div>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\signin
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\signin\SignInClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/signin/SignInClient.tsx
'use client';

import { useState, useEffect, FormEvent } from 'react';
import { useSearchParams, useRouter } from 'next/navigation';
import { useSession, signIn } from 'next-auth/react';
import { motion, AnimatePresence } from 'framer-motion';
import Link from 'next/link';
import {
  Mail,
  Lock,
  AlertCircle,
  Loader2,
  ArrowLeft,
  ArrowRight,
  Sparkles,
  Heart,
  Shield,
  Eye,
  EyeOff,
} from 'lucide-react';

import { Button } from '@/components/ui/button';
import { Label } from '@/components/ui/label';
import type { SignInDict } from '@/types/dictionaries/auth';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

// ============================================================================
// TYPE DEFINITIONS
// ============================================================================

interface SignInClientProps {
  dict: SignInDict;
  locale: 'he' | 'en';
}

// ============================================================================
// ANIMATION VARIANTS
// ============================================================================

const containerVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.1,
      delayChildren: 0.2,
    },
  },
};

const itemVariants = {
  hidden: { opacity: 0, y: 20 },
  visible: {
    opacity: 1,
    y: 0,
    transition: { duration: 0.5, ease: 'easeOut' },
  },
};

// ============================================================================
// BACKGROUND COMPONENT
// ============================================================================

const DynamicBackground: React.FC = () => (
  <div className="fixed inset-0 overflow-hidden pointer-events-none -z-10">
    {/* Floating Gradients */}
    <motion.div
      className="absolute top-10 left-10 w-96 h-96 bg-gradient-to-br from-teal-400/20 to-emerald-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, -30, 0],
        x: [0, 20, 0],
        scale: [1, 1.1, 1],
      }}
      transition={{
        duration: 15,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
    />
    <motion.div
      className="absolute top-40 right-20 w-80 h-80 bg-gradient-to-br from-orange-400/20 to-amber-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 40, 0],
        x: [0, -30, 0],
        scale: [1, 1.15, 1],
      }}
      transition={{
        duration: 18,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 1,
      }}
    />
    <motion.div
      className="absolute bottom-32 left-1/4 w-72 h-72 bg-gradient-to-br from-rose-400/15 to-orange-500/15 rounded-full blur-3xl"
      animate={{
        y: [0, -25, 0],
        x: [0, 15, 0],
        scale: [1, 1.08, 1],
      }}
      transition={{
        duration: 20,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 2,
      }}
    />
    <motion.div
      className="absolute bottom-20 right-10 w-64 h-64 bg-gradient-to-br from-teal-400/20 to-cyan-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 35, 0],
        scale: [1, 1.12, 1],
      }}
      transition={{
        duration: 16,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 0.5,
      }}
    />

    {/* Dot Pattern */}
    <div className="absolute inset-0 opacity-[0.03] bg-[radial-gradient(#0d9488_1px,transparent_1px)] [background-size:24px_24px]" />

    {/* SVG Decorative Waves */}
    <svg
      className="absolute inset-0 w-full h-full"
      viewBox="0 0 1000 1000"
      xmlns="http://www.w3.org/2000/svg"
      preserveAspectRatio="none"
    >
      <defs>
        <linearGradient id="waveGrad1" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stopColor="#0d9488" stopOpacity="0.08" />
          <stop offset="100%" stopColor="#f97316" stopOpacity="0.04" />
        </linearGradient>
      </defs>
      <motion.path
        d="M0,200 C300,100 700,300 1000,200 L1000,0 L0,0 Z"
        fill="url(#waveGrad1)"
        initial={{ opacity: 0.6 }}
        animate={{ opacity: [0.6, 0.9, 0.6] }}
        transition={{ duration: 8, repeat: Infinity, ease: 'easeInOut' }}
      />
    </svg>
  </div>
);

// ============================================================================
// MAIN SIGNIN COMPONENT
// ============================================================================

export default function SignInClient({ dict, locale }: SignInClientProps) {
  const router = useRouter();
  const searchParams = useSearchParams();
  const { data: session, status } = useSession();

  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  const [error, setError] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [isGoogleLoading, setIsGoogleLoading] = useState(false);
  const [shouldShake, setShouldShake] = useState(false);

  const isRTL = locale === 'he';

  // Handle authenticated redirect
  useEffect(() => {
    if (status === 'authenticated') {
      const redirectUrl = session?.redirectUrl || `/${locale}/profile`;
      router.push(redirectUrl);
    }
  }, [status, session, router, locale]);

  // Handle URL error parameters
  useEffect(() => {
    const errorMessage = searchParams.get('error');
    if (errorMessage) {
      switch (errorMessage) {
        case 'CredentialsSignin':
          setError(dict.errors.credentialsSignin);
          break;
        case 'OAuthAccountNotLinked':
          setError(dict.errors.oauthAccountNotLinked);
          break;
        default:
          setError(dict.errors.default.replace('{errorMessage}', errorMessage));
      }
      setShouldShake(true);
      setTimeout(() => setShouldShake(false), 500);
    }
  }, [searchParams, dict.errors]);

  const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    setError('');
    setIsLoading(true);

    if (!email || !password) {
      setError(dict.errors.missingFields);
      setShouldShake(true);
      setTimeout(() => setShouldShake(false), 500);
      setIsLoading(false);
      return;
    }

    const result = await signIn('credentials', {
      email: email.toLowerCase(),
      password,
      redirect: false,
    });

    if (result?.error) {
      setError(dict.errors.credentialsSignin);
      setShouldShake(true);
      setTimeout(() => setShouldShake(false), 500);
    }

    setIsLoading(false);
  };

  const handleGoogleSignIn = async () => {
    setIsGoogleLoading(true);
    setError('');
    await signIn('google', undefined, { hl: locale });
  };

  // Show loading state
  if (status === 'loading' || status === 'authenticated') {
    const loadingText =
      status === 'authenticated' ? dict.loader.success : dict.loader.loading;
    const subText =
      status === 'authenticated'
        ? dict.loader.redirecting
        : dict.loader.checking;

    return (
      <>
        <DynamicBackground />
        <StandardizedLoadingSpinner text={loadingText} subtext={subText} />
      </>
    );
  }

  // Main sign-in form
  return (
    <>
      <DynamicBackground />

      <div className="min-h-screen flex flex-col items-center justify-center p-4 sm:p-8 relative z-10">
        {/* Hero Section */}
        <motion.div
          variants={containerVariants}
          initial="hidden"
          animate="visible"
          className="mb-8 text-center"
        >
          <motion.div variants={itemVariants} className="mb-4">
            <div className="inline-flex items-center gap-3 bg-white/80 backdrop-blur-sm rounded-full px-6 py-3 shadow-lg border border-white/60 mb-6">
              <motion.div
                animate={{ rotate: [0, 10, -10, 0] }}
                transition={{
                  duration: 2,
                  repeat: Infinity,
                  ease: 'easeInOut',
                }}
              >
                {/* Heart -> Orange */}
                <Heart className="w-5 h-5 text-orange-500" />
              </motion.div>
              <span className="text-sm font-medium text-gray-700">
                {locale === 'he' ? 'ברוכים השבים' : 'Welcome Back'}
              </span>
              {/* Sparkles -> Teal */}
              <Sparkles className="w-5 h-5 text-teal-500" />
            </div>
          </motion.div>

          <motion.h1
            variants={itemVariants}
            className="text-3xl md:text-4xl font-bold mb-3"
          >
            {/* Title Gradient -> Teal-Orange-Amber */}
            <span className="text-transparent bg-clip-text bg-gradient-to-r from-teal-500 via-orange-500 to-amber-500 animate-gradient-slow">
              {dict.title}
            </span>
          </motion.h1>

          <motion.p
            variants={itemVariants}
            className="text-gray-600 text-base md:text-lg max-w-md mx-auto"
          >
            {dict.subtitle}
          </motion.p>

          {/* Decorative Line (Teal -> Orange) */}
          <motion.div variants={itemVariants} className="relative mt-6">
            <div className="w-20 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400 rounded-full mx-auto" />
          </motion.div>
        </motion.div>

        {/* Main Card */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={
            shouldShake
              ? { opacity: 1, y: 0, x: [-10, 10, -10, 10, 0] }
              : { opacity: 1, y: 0 }
          }
          transition={
            shouldShake ? { duration: 0.5 } : { duration: 0.5, delay: 0.3 }
          }
          className="w-full max-w-md"
        >
          <div className="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/60 overflow-hidden relative">
            {/* Top Gradient Line (Teal -> Orange) */}
            <div className="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400 pointer-events-none" />

            {/* Decorative Elements */}
            <div className="absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-teal-400/10 to-transparent rounded-full transform translate-x-20 -translate-y-20 pointer-events-none" />
            <div className="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-br from-orange-400/10 to-transparent rounded-full transform -translate-x-16 translate-y-16 pointer-events-none" />

            <div className="relative z-10 p-6 sm:p-8">
              {/* Error Alert */}
              <AnimatePresence>
                {error && (
                  <motion.div
                    initial={{ opacity: 0, y: -10, height: 0 }}
                    animate={{ opacity: 1, y: 0, height: 'auto' }}
                    exit={{ opacity: 0, y: -10, height: 0 }}
                    className="mb-6"
                  >
                    <div
                      role="alert"
                      className="p-4 bg-red-50 border-2 border-red-200 rounded-2xl flex items-start gap-3 shadow-sm"
                    >
                      <div className="p-2 bg-red-100 rounded-lg flex-shrink-0">
                        <AlertCircle className="h-5 w-5 text-red-600" />
                      </div>
                      <div className="flex-1">
                        <p className="text-red-800 text-sm font-medium leading-relaxed">
                          {error}
                        </p>
                      </div>
                    </div>
                  </motion.div>
                )}
              </AnimatePresence>

              {/* Sign In Form */}
              <form onSubmit={handleSubmit} className="space-y-5 mb-6">
                {/* Email Field */}
                <div className="space-y-2">
                  <Label
                    htmlFor="email"
                    className="block text-sm font-semibold text-gray-700"
                  >
                    {dict.emailLabel}
                  </Label>
                  <div className="relative group">
                    <div
                      className={`absolute ${isRTL ? 'right-3' : 'left-3'} top-1/2 transform -translate-y-1/2 transition-colors ${
                        email ? 'text-teal-500' : 'text-gray-400'
                      }`}
                    >
                      <Mail className="h-5 w-5" />
                    </div>
                    <input
                      type="email"
                      id="email"
                      name="email"
                      autoComplete="email"
                      value={email}
                      onChange={(e) => setEmail(e.target.value)}
                      // Focus Colors: Teal
                      className={`w-full ${isRTL ? 'pr-11 pl-4' : 'pl-11 pr-4'} py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-teal-200 focus:border-teal-400 focus:outline-none transition-colors bg-white/50 backdrop-blur-sm hover:border-gray-300 text-gray-800 placeholder:text-gray-400 relative z-10 touch-manipulation`}
                      placeholder={dict.emailPlaceholder}
                      required
                      disabled={isLoading || isGoogleLoading}
                      dir={isRTL ? 'rtl' : 'ltr'}
                    />
                  </div>
                </div>

                {/* Password Field */}
                <div className="space-y-2">
                  <div className="flex items-center justify-between">
                    <Label
                      htmlFor="password"
                      className="block text-sm font-semibold text-gray-700"
                    >
                      {dict.passwordLabel}
                    </Label>
                  </div>
                  <div className="relative group">
                    <div
                      className={`absolute ${isRTL ? 'right-3' : 'left-3'} top-1/2 transform -translate-y-1/2 transition-colors ${
                        password ? 'text-teal-500' : 'text-gray-400'
                      }`}
                    >
                      <Lock className="h-5 w-5" />
                    </div>
                    <input
                      type={showPassword ? 'text' : 'password'}
                      id="password"
                      name="password"
                      autoComplete="current-password"
                      value={password}
                      onChange={(e) => setPassword(e.target.value)}
                      // Focus Colors: Teal
                      className={`w-full ${isRTL ? 'pr-11 pl-12' : 'pl-11 pr-12'} py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-teal-200 focus:border-teal-400 focus:outline-none transition-colors bg-white/50 backdrop-blur-sm hover:border-gray-300 text-gray-800 placeholder:text-gray-400 relative z-10 touch-manipulation`}
                      placeholder={dict.passwordPlaceholder}
                      required
                      disabled={isLoading || isGoogleLoading}
                      dir={isRTL ? 'rtl' : 'ltr'}
                    />
                    <button
                      type="button"
                      onClick={() => setShowPassword(!showPassword)}
                      className={`absolute ${isRTL ? 'left-3' : 'right-3'} top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors z-20 touch-manipulation p-1`}
                      tabIndex={-1}
                    >
                      {showPassword ? (
                        <EyeOff className="h-5 w-5" />
                      ) : (
                        <Eye className="h-5 w-5" />
                      )}
                    </button>
                  </div>
                  <div
                    className={`flex ${isRTL ? 'justify-start' : 'justify-end'}`}
                  >
                    <Link
                      href={`/${locale}/auth/forgot-password`}
                      // Link Color: Teal
                      className="text-sm text-teal-600 hover:text-teal-700 hover:underline font-medium transition-colors relative z-20 touch-manipulation"
                    >
                      {dict.forgotPasswordLink}
                    </Link>
                  </div>
                </div>

                {/* Submit Button (Teal -> Orange -> Amber) */}
                <Button
                  type="submit"
                  disabled={isLoading || isGoogleLoading}
                  className="w-full relative z-20 py-4 bg-gradient-to-r from-teal-500 via-orange-500 to-amber-500 hover:from-teal-600 hover:via-orange-600 hover:to-amber-600 shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center gap-2 rounded-xl text-base font-semibold group overflow-hidden touch-manipulation active:scale-[0.98]"
                >
                  {/* Shine effect */}
                  <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000 pointer-events-none" />

                  {isLoading ? (
                    <>
                      <Loader2 className="h-5 w-5 animate-spin" />
                      <span>{dict.submitButtonLoading}</span>
                    </>
                  ) : (
                    <>
                      <span>{dict.submitButton}</span>
                      {isRTL ? (
                        <ArrowLeft className="w-5 h-5 group-hover:-translate-x-1 transition-transform" />
                      ) : (
                        <ArrowRight className="w-5 h-5 group-hover:translate-x-1 transition-transform" />
                      )}
                    </>
                  )}
                </Button>
              </form>

              {/* Divider */}
              <div className="relative mb-6">
                <div className="absolute inset-0 flex items-center">
                  <div className="w-full border-t-2 border-gray-200" />
                </div>
                <div className="relative flex justify-center">
                  <span className="px-4 bg-white/80 text-sm font-medium text-gray-500">
                    {dict.orDivider}
                  </span>
                </div>
              </div>

              {/* Google Sign In Button */}
              <Button
                type="button"
                onClick={handleGoogleSignIn}
                disabled={isLoading || isGoogleLoading}
                variant="outline"
                className="w-full relative z-20 border-2 border-gray-200 hover:border-gray-300 hover:bg-gray-50 py-4 rounded-xl flex items-center justify-center gap-3 group transition-all duration-200 bg-white/50 backdrop-blur-sm touch-manipulation active:scale-[0.98]"
              >
                {isGoogleLoading ? (
                  <>
                    <Loader2 className="animate-spin h-5 w-5" />
                    <span className="font-medium">
                      {dict.googleButtonLoading}
                    </span>
                  </>
                ) : (
                  <>
                    <svg
                      className="h-5 w-5 flex-shrink-0"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                    >
                      <path
                        d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                        fill="#4285F4"
                      />
                      <path
                        d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                        fill="#34A853"
                      />
                      <path
                        d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                        fill="#FBBC05"
                      />
                      <path
                        d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                        fill="#EA4335"
                      />
                    </svg>
                    <span className="text-gray-700 font-medium group-hover:text-gray-900 transition-colors">
                      {dict.googleButton}
                    </span>
                  </>
                )}
              </Button>

              {/* Sign Up Link */}
              <div className="mt-8 text-center">
                <p className="text-gray-600 text-sm">
                  {dict.noAccountPrompt}{' '}
                  <Link
                    href={`/${locale}/auth/register`}
                    // Link Color: Teal
                    className="text-teal-600 font-semibold hover:text-teal-700 hover:underline transition-colors inline-flex items-center gap-1 relative z-20 touch-manipulation"
                  >
                    {dict.signUpLink}
                    {isRTL ? (
                      <ArrowLeft className="w-3 h-3" />
                    ) : (
                      <ArrowRight className="w-3 h-3" />
                    )}
                  </Link>
                </p>
              </div>
            </div>

            {/* Bottom Shine Effect (Teal -> Orange) */}
            <div className="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400 opacity-50 pointer-events-none" />
          </div>
        </motion.div>

        {/* Trust Badge */}
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 0.8, duration: 0.5 }}
          className="mt-8 flex items-center gap-2 text-sm text-gray-500"
        >
          {/* Shield -> Teal */}
          <Shield className="w-4 h-4 text-teal-500" />
          <span>
            {locale === 'he'
              ? 'המידע שלך מוגן ומאובטח'
              : 'Your data is protected and secure'}
          </span>
        </motion.div>
      </div>

      {/* Animations CSS */}
      <style>{`
        @keyframes gradient-slow {
          0%,
          100% {
            background-position: 0% 50%;
          }
          50% {
            background-position: 100% 50%;
          }
        }
        .animate-gradient-slow {
          background-size: 200% 200%;
          animation: gradient-slow 6s ease infinite;
        }
      `}</style>
    </>
  );
}
--- End of Content for SignInClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\signin\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/signin/page.tsx
import { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import SignInClient from './SignInClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

// עדכון רכיב הטעינה
function Loading() {
  return <StandardizedLoadingSpinner />;
}

type SignInPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function SignInPage({ params }: SignInPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-cyan-50 via-white to-pink-50 p-4">
      <Suspense fallback={<Loading />}>
        <SignInClient dict={dictionary.auth.signIn} locale={locale} />
      </Suspense>
    </div>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\update-phone
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\update-phone\UpdatePhoneClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/update-phone/UpdatePhoneClient.tsx
'use client';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

import { useState, useCallback, FormEvent } from 'react';
import { useRouter } from 'next/navigation';
import { useSession } from 'next-auth/react';
import { Button } from '@/components/ui/button';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { AlertCircle, Loader2 } from 'lucide-react';
import Link from 'next/link';
import type { UpdatePhoneDict } from '@/types/dictionaries/auth';

// ======================= ייבואים חדשים =======================
import PhoneNumberInput from '@/components/auth/PhoneNumberInput';
import { isPossiblePhoneNumber } from 'react-phone-number-input';
// =============================================================

interface UpdatePhoneClientProps {
  dict: UpdatePhoneDict;
  // הוספת locale לממשק כדי שנוכל לקבל אותו
  locale: 'he' | 'en';
}

const UpdatePhoneClient = ({ dict, locale }: UpdatePhoneClientProps) => {
  const router = useRouter();
  const { status: sessionStatus } = useSession();
  const [newPhone, setNewPhone] = useState<string | undefined>('');
  const [error, setError] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);

  const handleSubmit = useCallback(
    async (e: FormEvent) => {
      e.preventDefault();
      setError(null);

      // ======================= ולידציה מעודכנת =======================
      if (!newPhone || !isPossiblePhoneNumber(newPhone)) {
        setError(dict.errors.invalidFormat);
        return;
      }
      // ===============================================================

      setIsLoading(true);
      try {
        const response = await fetch('/api/auth/update-and-resend-code', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ newPhone }),
        });
        const result = await response.json();
        if (!response.ok) {
          throw new Error(result.error || dict.errors.updateFailed);
        }
        // הניווט הוא יחסי ולכן אין צורך ב-locale כאן
        router.push('/auth/verify-phone');
      } catch (err: unknown) {
        if (err instanceof Error) {
          setError(err.message);
        } else {
          setError(dict.errors.unexpected);
        }
      } finally {
        setIsLoading(false);
      }
    },
    [newPhone, router, dict]
  );

   if (sessionStatus === 'loading') {
    // החלפת ה-div הישן
    return <StandardizedLoadingSpinner text={dict.loaderText} />;
  }

  if (sessionStatus === 'unauthenticated') {
    router.push('/auth/signin?callbackUrl=/auth/update-phone');
    return null;
  }

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-cyan-50 via-white to-pink-50 p-4">
      <div className="w-full max-w-sm bg-white rounded-xl shadow-xl p-6 sm:p-8 space-y-6">
        <div className="text-center">
          <h1 className="text-2xl font-bold text-gray-800">{dict.title}</h1>
          <p
            className="text-gray-600 mt-2 text-sm sm:text-base"
            dangerouslySetInnerHTML={{
              __html: dict.description.replace(/\n/g, '<br />'),
            }}
          />
        </div>

        {error && (
          <Alert variant="destructive">
            <AlertCircle className="h-4 w-4" />
            <AlertTitle>{dict.errors.title}</AlertTitle>
            <AlertDescription>{error}</AlertDescription>
          </Alert>
        )}

        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1 text-right">
              {dict.newPhoneLabel}
            </label>
            {/* ======================= החלפת שדה הקלט הישן ======================= */}
            <PhoneNumberInput
              value={newPhone}
              onChange={setNewPhone}
              disabled={isLoading}
              locale={locale}
            />
            {/* ====================================================================== */}
          </div>
          <Button
            type="submit"
            disabled={isLoading || !newPhone}
            className="w-full"
          >
            {isLoading ? (
              <Loader2 className="animate-spin h-5 w-5" />
            ) : (
              dict.submitButton
            )}
          </Button>
        </form>

        <div className="text-center mt-4">
          <Link
            href="/auth/verify-phone"
            className="text-sm text-cyan-600 hover:underline"
          >
            {dict.backToVerificationLink}
          </Link>
        </div>
      </div>
    </div>
  );
};

export default UpdatePhoneClient;
--- End of Content for UpdatePhoneClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\update-phone\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/update-phone/page.tsx
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import UpdatePhoneClient from './UpdatePhoneClient';

// ▼▼▼ כאן השינוי ▼▼▼
type UpdatePhonePageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function UpdatePhonePage({ params }: UpdatePhonePageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <UpdatePhoneClient dict={dictionary.auth.updatePhone} locale={locale} />
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\verify-email
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\verify-email\VerifyEmailClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/verify-email/VerifyEmailClient.tsx
'use client';

import { useState, useEffect, useRef } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { useSession } from 'next-auth/react';
import { motion, AnimatePresence } from 'framer-motion';
import {
  Loader2,
  AlertCircle,
  CheckCircle,
  Mail,
  ArrowRight,
  ArrowLeft,
  Sparkles,
  Send,
  Shield,
  Clock,
  RefreshCw,
} from 'lucide-react';

import { Button } from '@/components/ui/button';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import type { VerifyEmailDict } from '@/types/dictionaries/auth';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

// ============================================================================
// TYPE DEFINITIONS
// ============================================================================

interface VerificationState {
  status: 'pending' | 'verifying' | 'success' | 'error';
  message: string;
}

interface VerifyEmailClientProps {
  dict: VerifyEmailDict;
  locale: 'he' | 'en';
}

// ============================================================================
// ANIMATION VARIANTS
// ============================================================================

const containerVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.1,
      delayChildren: 0.2,
    },
  },
};

const itemVariants = {
  hidden: { opacity: 0, y: 20 },
  visible: {
    opacity: 1,
    y: 0,
    transition: { duration: 0.5, ease: 'easeOut' },
  },
};

const cardVariants = {
  hidden: { opacity: 0, scale: 0.95, y: 30 },
  visible: {
    opacity: 1,
    scale: 1,
    y: 0,
    transition: { duration: 0.6, ease: [0.25, 0.46, 0.45, 0.94] },
  },
};

// ============================================================================
// DYNAMIC BACKGROUND COMPONENT
// ============================================================================

const DynamicBackground: React.FC = () => (
  <div className="fixed inset-0 overflow-hidden pointer-events-none -z-10">
    {/* Floating Gradients */}
    <motion.div
      className="absolute top-10 left-10 w-96 h-96 bg-gradient-to-br from-teal-400/20 to-emerald-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, -30, 0],
        x: [0, 20, 0],
        scale: [1, 1.1, 1],
      }}
      transition={{
        duration: 15,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
    />
    <motion.div
      className="absolute top-40 right-20 w-80 h-80 bg-gradient-to-br from-orange-400/20 to-amber-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 40, 0],
        x: [0, -30, 0],
        scale: [1, 1.15, 1],
      }}
      transition={{
        duration: 18,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 1,
      }}
    />
    <motion.div
      className="absolute bottom-32 left-1/4 w-72 h-72 bg-gradient-to-br from-rose-400/15 to-orange-500/15 rounded-full blur-3xl"
      animate={{
        y: [0, -25, 0],
        x: [0, 15, 0],
        scale: [1, 1.08, 1],
      }}
      transition={{
        duration: 20,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 2,
      }}
    />
    <motion.div
      className="absolute bottom-20 right-10 w-64 h-64 bg-gradient-to-br from-teal-400/20 to-cyan-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 20, 0],
        x: [0, -10, 0],
        scale: [1, 1.12, 1],
      }}
      transition={{
        duration: 16,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 0.5,
      }}
    />

    {/* Decorative Dots Pattern (Teal) */}
    <div className="absolute inset-0 opacity-5 bg-[radial-gradient(#0d9488_1px,transparent_1px)] [background-size:30px_30px]"></div>

    {/* SVG Decorative Paths (Teal -> Orange) */}
    <svg
      className="absolute inset-0 w-full h-full"
      viewBox="0 0 1200 800"
      xmlns="http://www.w3.org/2000/svg"
    >
      <defs>
        <linearGradient
          id="decorativeGradient"
          x1="0%"
          y1="0%"
          x2="100%"
          y2="100%"
        >
          <stop offset="0%" stopColor="#0d9488" stopOpacity="0.08" />
          <stop offset="50%" stopColor="#f97316" stopOpacity="0.06" />
          <stop offset="100%" stopColor="#14b8a6" stopOpacity="0.08" />
        </linearGradient>
      </defs>
      <motion.path
        d="M0,100 C300,50 600,150 1200,100 L1200,0 L0,0 Z"
        fill="url(#decorativeGradient)"
        initial={{ opacity: 0.8 }}
        animate={{ opacity: [0.8, 1, 0.8] }}
        transition={{ duration: 4, repeat: Infinity, ease: 'easeInOut' }}
      />
      <motion.path
        d="M0,700 C400,650 800,750 1200,700 L1200,800 L0,800 Z"
        fill="url(#decorativeGradient)"
        initial={{ opacity: 0.8 }}
        animate={{ opacity: [0.8, 1, 0.8] }}
        transition={{
          duration: 4,
          repeat: Infinity,
          ease: 'easeInOut',
          delay: 2,
        }}
      />
    </svg>
  </div>
);

// ============================================================================
// ANIMATED ICON COMPONENTS
// ============================================================================

const AnimatedMailIcon: React.FC = () => (
  <motion.div
    className="relative inline-flex items-center justify-center w-24 h-24 mb-6"
    initial={{ scale: 0, rotate: -180 }}
    animate={{ scale: 1, rotate: 0 }}
    transition={{ duration: 0.6, ease: 'easeOut' }}
  >
    <motion.div
      // Gradient: Teal -> Emerald
      className="absolute inset-0 rounded-full bg-gradient-to-br from-teal-400/20 to-emerald-500/20"
      animate={{
        scale: [1, 1.2, 1],
        opacity: [0.5, 0.8, 0.5],
      }}
      transition={{
        duration: 2,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
    />
    {/* Inner Gradient: Teal -> Emerald */}
    <div className="relative w-20 h-20 rounded-2xl bg-gradient-to-br from-teal-400 to-emerald-500 flex items-center justify-center shadow-lg">
      <Mail className="w-10 h-10 text-white" />
    </div>
  </motion.div>
);

const AnimatedSuccessIcon: React.FC = () => (
  <motion.div
    className="relative inline-flex items-center justify-center w-24 h-24 mb-6"
    initial={{ scale: 0 }}
    animate={{ scale: 1 }}
    transition={{ duration: 0.5, ease: 'backOut' }}
  >
    <motion.div
      // Gradient: Green -> Emerald (Success state stays green/emerald, fits palette)
      className="absolute inset-0 rounded-full bg-gradient-to-br from-green-400/30 to-emerald-500/30"
      animate={{
        scale: [1, 1.3, 1],
        opacity: [0.5, 0, 0.5],
      }}
      transition={{
        duration: 1.5,
        repeat: Infinity,
        ease: 'easeOut',
      }}
    />
    <div className="relative w-20 h-20 rounded-full bg-gradient-to-br from-green-400 to-emerald-500 flex items-center justify-center shadow-lg">
      <motion.div
        initial={{ scale: 0 }}
        animate={{ scale: 1 }}
        transition={{ delay: 0.2, duration: 0.3 }}
      >
        <CheckCircle className="w-10 h-10 text-white" />
      </motion.div>
    </div>
  </motion.div>
);

const AnimatedErrorIcon: React.FC = () => (
  <motion.div
    className="relative inline-flex items-center justify-center w-24 h-24 mb-6"
    initial={{ scale: 0, rotate: 180 }}
    animate={{ scale: 1, rotate: 0 }}
    transition={{ duration: 0.5, ease: 'easeOut' }}
  >
    <motion.div
      // Gradient: Red -> Rose (Fits 'Rose' from palette)
      className="absolute inset-0 rounded-full bg-gradient-to-br from-red-400/30 to-rose-500/30"
      animate={{
        scale: [1, 1.2, 1],
      }}
      transition={{
        duration: 2,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
    />
    <div className="relative w-20 h-20 rounded-full bg-gradient-to-br from-red-400 to-rose-500 flex items-center justify-center shadow-lg">
      <AlertCircle className="w-10 h-10 text-white" />
    </div>
  </motion.div>
);

// ============================================================================
// MAIN COMPONENT
// ============================================================================

export default function VerifyEmailClient({
  dict,
  locale,
}: VerifyEmailClientProps) {
  const router = useRouter();
  const searchParams = useSearchParams();
  const { data: session } = useSession();
  const verificationApiCallMadeRef = useRef(false);
  const isRTL = locale === 'he';

  const [verification, setVerification] = useState<VerificationState>({
    status: 'pending',
    message: '',
  });
  const [isResending, setIsResending] = useState(false);
  const [infoMessage, setInfoMessage] = useState<string | null>(null);

  useEffect(() => {
    if (verificationApiCallMadeRef.current) return;
    verificationApiCallMadeRef.current = true;

    const token = searchParams.get('token');
    const email = searchParams.get('email');

    if (!token) {
      if (email) {
        setInfoMessage(dict.pendingMessage);
      } else {
        setVerification({
          status: 'error',
          message: dict.errors.linkInvalid,
        });
      }
      return;
    }

    verifyToken(token);
  }, [searchParams, dict]);

  const verifyToken = async (token: string) => {
    setVerification({ status: 'verifying', message: '' });

    if (
      session?.user?.email &&
      searchParams.get('email') &&
      session.user.email !== searchParams.get('email')
    ) {
      setVerification({
        status: 'error',
        message: dict.errors.sessionMismatch,
      });
      return;
    }

    try {
      const response = await fetch('/api/auth/verify', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token: token, type: 'EMAIL' }),
      });
      const data = await response.json();
      if (!response.ok) throw new Error(data.error);

      setVerification({ status: 'success', message: dict.successMessage });
      setTimeout(() => router.push(`/${locale}/auth/signin`), 2000);
    } catch (error) {
      let errorMessage = dict.errors.default;
      if (error instanceof Error) {
        if (error.message.includes('הטוקן כבר נוצל'))
          errorMessage = dict.errors.tokenUsed;
        else if (error.message.includes('תוקף הטוקן פג'))
          errorMessage = dict.errors.tokenExpired;
        else errorMessage = error.message;
      }
      setVerification({ status: 'error', message: errorMessage });
    }
  };

  const handleResendVerification = async () => {
    const email = searchParams.get('email');
    if (!email) {
      setVerification({ status: 'error', message: dict.errors.noEmail });
      return;
    }
    setIsResending(true);
    setVerification({ status: 'pending', message: '' });
    try {
      const response = await fetch('/api/auth/resend-verification', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: email, type: 'EMAIL' }),
      });
      const data = await response.json();
      if (!response.ok) throw new Error(data.error || dict.errors.resendFailed);
      setInfoMessage(dict.alerts.resendSuccess);
    } catch (error) {
      setVerification({
        status: 'error',
        message:
          error instanceof Error ? error.message : dict.errors.resendFailed,
      });
    } finally {
      setIsResending(false);
    }
  };

  const emailParam = searchParams.get('email');

  return (
    <div className="min-h-screen flex flex-col items-center justify-center p-4 relative">
      <DynamicBackground />

      <motion.div
        variants={containerVariants}
        initial="hidden"
        animate="visible"
        className="w-full max-w-lg relative z-10"
      >
        {/* Header Section */}
        <motion.div variants={itemVariants} className="text-center mb-8">
          <motion.div
            className="inline-flex items-center gap-3 bg-white/80 backdrop-blur-sm rounded-full px-6 py-3 shadow-lg border border-white/60 mb-6"
            whileHover={{ scale: 1.05 }}
            transition={{ duration: 0.3 }}
          >
            {/* Shield: Teal */}
            <Shield className="w-6 h-6 text-teal-500" />
            <span className="text-teal-700 font-semibold text-lg">
              {dict.title}
            </span>
          </motion.div>
        </motion.div>

        {/* Main Card */}
        <motion.div
          variants={cardVariants}
          className="relative overflow-hidden rounded-3xl bg-white/70 backdrop-blur-xl shadow-2xl border border-white/60 p-8 md:p-12"
        >
          {/* Decorative Elements (Teal/Orange) */}
          <div className="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-teal-400/20 to-transparent rounded-full transform translate-x-16 -translate-y-16 blur-2xl" />
          <div className="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-br from-orange-400/20 to-transparent rounded-full transform -translate-x-16 translate-y-16 blur-2xl" />
          <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-gradient-to-br from-amber-400/5 to-transparent rounded-full blur-3xl" />

          <div className="relative z-10">
            <AnimatePresence mode="wait">
              {/* Pending State */}
              {verification.status === 'pending' && (
                <motion.div
                  key="pending"
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, y: -20 }}
                  transition={{ duration: 0.4 }}
                  className="text-center space-y-6"
                >
                  <AnimatedMailIcon />

                  <div className="space-y-3">
                    <h2 className="text-3xl font-bold text-gray-800">
                      {dict.title}
                    </h2>

                    {infoMessage && (
                      <motion.div
                        initial={{ opacity: 0, scale: 0.95 }}
                        animate={{ opacity: 1, scale: 1 }}
                        transition={{ duration: 0.3 }}
                      >
                        {/* Info Alert: Teal/Blue */}
                        <Alert className="border-teal-200 bg-teal-50">
                          <Sparkles className="h-5 w-5 text-teal-600" />
                          <AlertDescription className="text-teal-700">
                            {infoMessage}
                          </AlertDescription>
                        </Alert>
                      </motion.div>
                    )}

                    {emailParam && (
                      <div className="space-y-4 pt-4">
                        {/* Email Box: Teal Light */}
                        <div className="bg-gradient-to-r from-teal-50 to-emerald-50 rounded-2xl p-6 border border-teal-100">
                          <p className="text-gray-600 text-sm mb-2">
                            {dict.emailSentTo}
                          </p>
                          <p className="text-xl font-bold text-gray-800 break-all">
                            {emailParam}
                          </p>
                        </div>

                        <p className="text-gray-600 leading-relaxed">
                          {dict.checkYourInbox}
                        </p>

                        <motion.div
                          whileHover={{ scale: 1.02 }}
                          whileTap={{ scale: 0.98 }}
                        >
                          {/* Resend Button: Teal -> Orange */}
                          <Button
                            onClick={handleResendVerification}
                            disabled={isResending}
                            className="w-full py-6 text-lg font-semibold rounded-xl bg-gradient-to-r from-teal-500 via-orange-500 to-amber-500 hover:from-teal-600 hover:via-orange-600 hover:to-amber-600 text-white shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 relative overflow-hidden group"
                          >
                            {isResending ? (
                              <div className="flex items-center justify-center gap-3">
                                <Loader2 className="animate-spin h-5 w-5" />
                                <span>{dict.resendButtonLoading}</span>
                              </div>
                            ) : (
                              <div className="flex items-center justify-center gap-3">
                                <RefreshCw className="h-5 w-5" />
                                <span>{dict.resendButton}</span>
                                <Send className="h-5 w-5" />
                              </div>
                            )}
                            <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent group-hover:translate-x-full transition-transform duration-1000" />
                          </Button>
                        </motion.div>
                      </div>
                    )}
                  </div>
                </motion.div>
              )}

              {/* Verifying State - Updated with StandardizedLoadingSpinner */}
              {verification.status === 'verifying' && (
                <motion.div
                  key="verifying"
                  initial={{ opacity: 0, scale: 0.9 }}
                  animate={{ opacity: 1, scale: 1 }}
                  exit={{ opacity: 0, scale: 0.9 }}
                  transition={{ duration: 0.4 }}
                  className="w-full"
                >
                  <StandardizedLoadingSpinner
                    text={dict.verifyingMessage}
                    subtext={
                      isRTL
                        ? 'מאמתים את הפרטים שלך...'
                        : 'Verifying your details...'
                    }
                    className="min-h-[250px]"
                  />
                </motion.div>
              )}

              {/* Success State */}
              {verification.status === 'success' && (
                <motion.div
                  key="success"
                  initial={{ opacity: 0, scale: 0.9 }}
                  animate={{ opacity: 1, scale: 1 }}
                  exit={{ opacity: 0, scale: 0.9 }}
                  transition={{ duration: 0.4 }}
                  className="text-center space-y-6"
                >
                  <AnimatedSuccessIcon />

                  <div className="space-y-4">
                    <h2 className="text-2xl md:text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-teal-600 to-emerald-600">
                      {verification.message}
                    </h2>

                    <div className="bg-gradient-to-r from-teal-50 to-emerald-50 rounded-2xl p-6 border border-teal-100">
                      <div className="flex items-center justify-center gap-3">
                        <Clock className="w-5 h-5 text-teal-600" />
                        <p className="text-gray-700">{dict.successRedirect}</p>
                      </div>
                      <motion.div
                        className="mt-4"
                        animate={{ rotate: 360 }}
                        transition={{
                          duration: 2,
                          repeat: Infinity,
                          ease: 'linear',
                        }}
                      >
                        <Loader2 className="h-6 w-6 mx-auto text-teal-600" />
                      </motion.div>
                    </div>
                  </div>
                </motion.div>
              )}

              {/* Error State */}
              {verification.status === 'error' && (
                <motion.div
                  key="error"
                  initial={{ opacity: 0, scale: 0.9 }}
                  animate={{ opacity: 1, scale: 1 }}
                  exit={{ opacity: 0, scale: 0.9 }}
                  transition={{ duration: 0.4 }}
                  className="text-center space-y-6"
                >
                  <AnimatedErrorIcon />

                  <div className="space-y-4">
                    <h2 className="text-2xl font-bold text-red-600">
                      {dict.errorMessage}
                    </h2>

                    <Alert
                      variant="destructive"
                      className="border-red-200 bg-red-50"
                    >
                      <AlertCircle className="h-5 w-5" />
                      <AlertTitle className="font-semibold">
                        {dict.errors.title || 'שגיאה'}
                      </AlertTitle>
                      <AlertDescription>
                        {verification.message}
                      </AlertDescription>
                    </Alert>

                    <motion.div
                      whileHover={{ scale: 1.02 }}
                      whileTap={{ scale: 0.98 }}
                      className="pt-4"
                    >
                      {/* Back Button: Gray/Teal */}
                      <Button
                        onClick={() => router.push(`/${locale}/auth/signin`)}
                        className="w-full py-6 text-lg font-semibold rounded-xl bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white shadow-lg hover:shadow-xl transition-all duration-300"
                      >
                        <div className="flex items-center justify-center gap-3">
                          {isRTL ? (
                            <ArrowRight className="h-5 w-5" />
                          ) : (
                            <ArrowLeft className="h-5 w-5" />
                          )}
                          <span>{dict.backToSignInButton}</span>
                        </div>
                      </Button>
                    </motion.div>
                  </div>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </motion.div>

        {/* Bottom Decoration */}
        <motion.div variants={itemVariants} className="mt-8 text-center">
          <div className="inline-flex items-center gap-2 text-sm text-gray-500">
            <Shield className="h-4 w-4" />
            <span>מוגן באמצעות הצפנת SSL</span>
          </div>
        </motion.div>
      </motion.div>
    </div>
  );
}
--- End of Content for VerifyEmailClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\verify-email\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/verify-email/page.tsx
import { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import VerifyEmailClient from './VerifyEmailClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

// עדכון רכיב הטעינה
function Loading() {
  return <StandardizedLoadingSpinner />;
}

type VerifyEmailPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function VerifyEmailPage({
  params,
}: VerifyEmailPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    // הסרתי את ה-bg-gray-50 הישן כי הספינר החדש כבר כולל רקע יפה
    <div className="flex items-center justify-center min-h-screen">
      <Suspense fallback={<Loading />}>
        <VerifyEmailClient dict={dictionary.auth.verifyEmail} locale={locale} />
      </Suspense>
    </div>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\verify-phone
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\verify-phone\VerifyPhoneClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/verify-phone/VerifyPhoneClient.tsx
'use client';

import { useState, useCallback, useRef, useEffect, FormEvent } from 'react';
import { useSession } from 'next-auth/react';
import { useRouter } from 'next/navigation';
import { motion, AnimatePresence } from 'framer-motion';
import Link from 'next/link';
import {
  Loader2,
  AlertCircle,
  CheckCircle,
  MessageSquare,
  ArrowRight,
  ArrowLeft,
  Sparkles,
  Shield,
  Clock,
  RefreshCw,
} from 'lucide-react';

import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
// Import ProgressBar
import ProgressBar from '@/components/auth/ProgressBar';
import type { VerifyPhoneDict } from '@/types/dictionaries/auth';

// ============================================================================
// TYPE DEFINITIONS
// ============================================================================

interface VerifyPhoneClientProps {
  dict: VerifyPhoneDict;
  locale: 'he' | 'en';
}

const OTP_LENGTH = 6;
const RESEND_COOLDOWN = 60;

// ============================================================================
// ANIMATION VARIANTS
// ============================================================================

const containerVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.1,
      delayChildren: 0.2,
    },
  },
};

const itemVariants = {
  hidden: { opacity: 0, y: 20 },
  visible: {
    opacity: 1,
    y: 0,
    transition: { duration: 0.5, ease: 'easeOut' },
  },
};

const cardVariants = {
  hidden: { opacity: 0, scale: 0.95, y: 30 },
  visible: {
    opacity: 1,
    scale: 1,
    y: 0,
    transition: { duration: 0.6, ease: [0.25, 0.46, 0.45, 0.94] },
  },
};

// ============================================================================
// DYNAMIC BACKGROUND COMPONENT (Teal/Orange Theme)
// ============================================================================

const DynamicBackground: React.FC = () => (
  <div className="fixed inset-0 overflow-hidden pointer-events-none -z-10">
    {/* Floating Gradients */}
    <motion.div
      className="absolute top-10 left-10 w-96 h-96 bg-gradient-to-br from-teal-400/20 to-emerald-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, -30, 0],
        x: [0, 20, 0],
        scale: [1, 1.1, 1],
      }}
      transition={{
        duration: 15,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
    />
    <motion.div
      className="absolute top-40 right-20 w-80 h-80 bg-gradient-to-br from-orange-400/20 to-amber-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 40, 0],
        x: [0, -30, 0],
        scale: [1, 1.15, 1],
      }}
      transition={{
        duration: 18,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 1,
      }}
    />
    <motion.div
      className="absolute bottom-32 left-1/4 w-72 h-72 bg-gradient-to-br from-rose-400/15 to-orange-500/15 rounded-full blur-3xl"
      animate={{
        y: [0, -25, 0],
        x: [0, 15, 0],
        scale: [1, 1.08, 1],
      }}
      transition={{
        duration: 20,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 2,
      }}
    />
    <motion.div
      className="absolute bottom-20 right-10 w-64 h-64 bg-gradient-to-br from-teal-400/20 to-cyan-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 20, 0],
        x: [0, -10, 0],
        scale: [1, 1.12, 1],
      }}
      transition={{
        duration: 16,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 0.5,
      }}
    />

    {/* Decorative Dots Pattern (Teal) */}
    <div className="absolute inset-0 opacity-5 bg-[radial-gradient(#0d9488_1px,transparent_1px)] [background-size:30px_30px]"></div>

    {/* SVG Decorative Paths (Teal -> Orange) */}
    <svg
      className="absolute inset-0 w-full h-full"
      viewBox="0 0 1200 800"
      xmlns="http://www.w3.org/2000/svg"
    >
      <defs>
        <linearGradient
          id="decorativeGradient"
          x1="0%"
          y1="0%"
          x2="100%"
          y2="100%"
        >
          <stop offset="0%" stopColor="#0d9488" stopOpacity="0.08" />
          <stop offset="50%" stopColor="#f97316" stopOpacity="0.06" />
          <stop offset="100%" stopColor="#14b8a6" stopOpacity="0.08" />
        </linearGradient>
      </defs>
      <motion.path
        d="M0,100 C300,50 600,150 1200,100 L1200,0 L0,0 Z"
        fill="url(#decorativeGradient)"
        initial={{ opacity: 0.8 }}
        animate={{ opacity: [0.8, 1, 0.8] }}
        transition={{ duration: 4, repeat: Infinity, ease: 'easeInOut' }}
      />
      <motion.path
        d="M0,700 C400,650 800,750 1200,700 L1200,800 L0,800 Z"
        fill="url(#decorativeGradient)"
        initial={{ opacity: 0.8 }}
        animate={{ opacity: [0.8, 1, 0.8] }}
        transition={{
          duration: 4,
          repeat: Infinity,
          ease: 'easeInOut',
          delay: 2,
        }}
      />
    </svg>
  </div>
);

// ============================================================================
// CIRCULAR TIMER COMPONENT
// ============================================================================

interface CircularTimerProps {
  seconds: number;
  maxSeconds: number;
}

const CircularTimer: React.FC<CircularTimerProps> = ({
  seconds,
  maxSeconds,
}) => {
  const progress = (seconds / maxSeconds) * 100;
  const circumference = 2 * Math.PI * 20;
  const strokeDashoffset = circumference - (progress / 100) * circumference;

  return (
    <div className="relative inline-flex items-center justify-center w-10 h-10">
      <svg className="w-10 h-10 transform -rotate-90">
        <circle
          cx="20"
          cy="20"
          r="18"
          stroke="currentColor"
          strokeWidth="2"
          fill="none"
          className="text-gray-200"
        />
        <motion.circle
          cx="20"
          cy="20"
          r="18"
          stroke="currentColor"
          strokeWidth="2"
          fill="none"
          strokeDasharray={circumference}
          strokeDashoffset={strokeDashoffset}
          strokeLinecap="round"
          // Color updated to Teal
          className="text-teal-500"
          initial={{ strokeDashoffset: circumference }}
          animate={{ strokeDashoffset }}
          transition={{ duration: 0.3, ease: 'linear' }}
        />
      </svg>
      <span className="absolute text-xs font-semibold text-gray-600">
        {seconds}
      </span>
    </div>
  );
};

// ============================================================================
// MAIN COMPONENT
// ============================================================================

const VerifyPhoneClient: React.FC<VerifyPhoneClientProps> = ({
  dict,
  locale,
}) => {
  const { data: session, update: updateSession } = useSession();
  const router = useRouter();
  const isRTL = locale === 'he';

  // Debug logging
  useEffect(() => {
    console.log('[VerifyPhoneClient] Component mounted');
    console.log('[VerifyPhoneClient] Session data:', session);
    console.log('[VerifyPhoneClient] User phone:', session?.user?.phone);
  }, [session]);

  // State
  const [code, setCode] = useState<string[]>(Array(OTP_LENGTH).fill(''));
  const [isLoading, setIsLoading] = useState(false);
  const [isResending, setIsResending] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [successMessage, setSuccessMessage] = useState<string | null>(null);
  const [infoMessage, setInfoMessage] = useState<string | null>(null);
  const [resendTimer, setResendTimer] = useState(0);
  const [focusedIndex, setFocusedIndex] = useState<number | null>(null);

  const inputRefs = useRef<(HTMLInputElement | null)[]>([]);
  const resendTimerRef = useRef<NodeJS.Timeout | null>(null);

  const resendDisabled = resendTimer > 0;

  // Timer Management
  const startResendTimer = useCallback(() => {
    setResendTimer(RESEND_COOLDOWN);
    if (resendTimerRef.current) {
      clearInterval(resendTimerRef.current);
    }
    resendTimerRef.current = setInterval(() => {
      setResendTimer((prev) => {
        if (prev <= 1) {
          if (resendTimerRef.current) {
            clearInterval(resendTimerRef.current);
            resendTimerRef.current = null;
          }
          return 0;
        }
        return prev - 1;
      });
    }, 1000);
  }, []);

  useEffect(() => {
    startResendTimer();
    return () => {
      if (resendTimerRef.current) {
        clearInterval(resendTimerRef.current);
      }
    };
  }, [startResendTimer]);

  // Input Handling
  const handleInputChange = useCallback(
    (index: number, value: string) => {
      if (!/^\d*$/.test(value)) return;
      const newCode = [...code];
      newCode[index] = value.slice(0, 1);
      setCode(newCode);
      setError(null);

      if (value && index < OTP_LENGTH - 1) {
        inputRefs.current[index + 1]?.focus();
      }
    },
    [code]
  );

  const handleKeyDown = useCallback(
    (index: number, e: React.KeyboardEvent<HTMLInputElement>) => {
      if (e.key === 'Backspace' && !code[index] && index > 0) {
        inputRefs.current[index - 1]?.focus();
      }
      if (e.key === 'ArrowLeft' && index > 0) {
        inputRefs.current[index - 1]?.focus();
      }
      if (e.key === 'ArrowRight' && index < OTP_LENGTH - 1) {
        inputRefs.current[index + 1]?.focus();
      }
    },
    [code]
  );

  // Verify Code
  const handleVerifyCode = useCallback(
    async (e: FormEvent<HTMLFormElement>) => {
      e.preventDefault();
      setError(null);
      setInfoMessage(null);

      const fullCode = code.join('');
      if (fullCode.length !== OTP_LENGTH) {
        setError(dict.errors.incompleteCode);
        return;
      }

      setIsLoading(true);

      try {
        const response = await fetch(
          `/api/auth/verify-phone-code?locale=${locale}`,
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ code: fullCode }),
          }
        );

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || dict.errors.default);
        }

        setSuccessMessage(dict.success.verifying);

        const updatedSession = await updateSession();

        if (updatedSession?.user?.isPhoneVerified) {
          router.push(`/${locale}/profile`);
        } else {
          setError('Failed to update session. Please try logging in again.');
          setIsLoading(false);
        }
      } catch (err: unknown) {
        setError(err instanceof Error ? err.message : dict.errors.unexpected);
        setIsLoading(false);
      }
    },
    [code, updateSession, dict, locale, router]
  );

  // Resend Code
  const handleResendCode = useCallback(async () => {
    if (resendDisabled || isResending) return;
    setError(null);
    setInfoMessage(null);
    setIsResending(true);

    try {
      const response = await fetch(
        `/api/auth/resend-phone-code?locale=${locale}`,
        {
          method: 'POST',
        }
      );
      if (!response.ok) throw new Error((await response.json()).error);
      setInfoMessage(dict.info.resent);
      startResendTimer();
    } catch (err: unknown) {
      setError(err instanceof Error ? err.message : dict.errors.unexpected);
    } finally {
      setIsResending(false);
    }
  }, [isResending, resendDisabled, startResendTimer, dict, locale]);

  // Get Hidden Phone
  const getHiddenPhone = () => {
    const phone = session?.user?.phone;
    if (!phone || phone.length < 4) {
      return dict.yourPhoneNumber;
    }
    const hiddenPhone = `${phone.substring(0, 3)}••••${phone.substring(phone.length - 3)}`;
    return hiddenPhone;
  };

  // --- Helper to safely render text with dynamic OTP length ---
  const renderWithGradientNumber = (text: string) => {
    // If the JSON contains the placeholder, we split and insert the styled number
    if (text.includes('{{OTP_LENGTH}}')) {
      const parts = text.split('{{OTP_LENGTH}}');
      return (
        <>
          {parts[0]}
          {/* Number Accent: Teal -> Pink (retained for contrast) or Teal -> Orange */}
          <span className="text-transparent bg-clip-text bg-gradient-to-r from-teal-600 to-orange-600">
            {OTP_LENGTH}
          </span>
          {parts[1]}
        </>
      );
    }
    // Fallback: Return text as is (avoids double number bug)
    return text;
  };

  const disableForm = isLoading || !!successMessage;
  const disableResend = isResending || resendDisabled || !!successMessage;
  const isCodeComplete = code.every((digit) => digit !== '');

  return (
    <div className="min-h-screen flex flex-col items-center justify-center p-4 relative">
      <DynamicBackground />

      <motion.div
        variants={containerVariants}
        initial="hidden"
        animate="visible"
        className="w-full max-w-lg relative z-10"
      >
        {/* Header Section */}
        <motion.div variants={itemVariants} className="text-center mb-8">
          {/* --- Progress Bar Added Here --- */}
          <div className="w-full max-w-xs mx-auto mb-6">
            <ProgressBar
              currentStep={2}
              totalSteps={2}
              stepLabel={locale === 'he' ? 'שלב {{step}}' : 'Step {{step}}'}
              locale={locale}
            />
          </div>
          {/* ------------------------------- */}

          <motion.div
            className="inline-flex items-center gap-3 bg-white/80 backdrop-blur-sm rounded-full px-6 py-3 shadow-lg border border-white/60 mb-6"
            whileHover={{ scale: 1.05 }}
            transition={{ duration: 0.3 }}
          >
            {/* Shield: Teal */}
            <Shield className="w-6 h-6 text-teal-500" />
            <span className="text-teal-700 font-semibold text-lg">
              {dict.title}
            </span>
          </motion.div>

          {/* Fixed Header Logic */}
          <h1 className="text-3xl md:text-4xl font-bold text-gray-800 mb-4">
            {renderWithGradientNumber(dict.description)}
          </h1>
        </motion.div>

        {/* Main Card */}
        <motion.div
          variants={cardVariants}
          className="relative overflow-hidden rounded-3xl bg-white/70 backdrop-blur-xl shadow-2xl border border-white/60 p-8 md:p-10"
        >
          {/* Decorative Elements (Teal/Orange) */}
          <div className="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-teal-400/20 to-transparent rounded-full transform translate-x-16 -translate-y-16 blur-2xl" />
          <div className="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-br from-orange-400/20 to-transparent rounded-full transform -translate-x-16 translate-y-16 blur-2xl" />
          <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-gradient-to-br from-amber-400/5 to-transparent rounded-full blur-3xl" />

          <div className="relative z-10 space-y-8">
            {/* WhatsApp/Phone Icon & Phone Number */}
            <div className="text-center space-y-3">
              <div className="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-teal-400 to-emerald-600 shadow-lg mb-2">
                <MessageSquare className="w-8 h-8 text-white" />
              </div>
              {/* Fixed Code Sent To Logic */}
              <p className="text-gray-600 text-sm md:text-base">
                {renderWithGradientNumber(dict.codeSentTo)}
              </p>
              <p className="text-xl font-bold text-gray-800">
                {getHiddenPhone()}
              </p>
              <p className="text-gray-500 text-sm">{dict.enterCodePrompt}</p>
            </div>

            {/* Alerts */}
            <AnimatePresence mode="wait">
              {error && (
                <motion.div
                  initial={{ opacity: 0, y: -10, scale: 0.95 }}
                  animate={{ opacity: 1, y: 0, scale: 1 }}
                  exit={{ opacity: 0, y: -10, scale: 0.95 }}
                  transition={{ duration: 0.3 }}
                >
                  <Alert
                    variant="destructive"
                    className="border-red-200 bg-red-50"
                  >
                    <AlertCircle className="h-5 w-5" />
                    <AlertTitle className="font-semibold">
                      {dict.errors.title}
                    </AlertTitle>
                    <AlertDescription>{error}</AlertDescription>
                  </Alert>
                </motion.div>
              )}

              {successMessage && (
                <motion.div
                  initial={{ opacity: 0, y: -10, scale: 0.95 }}
                  animate={{ opacity: 1, y: 0, scale: 1 }}
                  exit={{ opacity: 0, y: -10, scale: 0.95 }}
                  transition={{ duration: 0.3 }}
                >
                  <Alert className="border-emerald-200 bg-emerald-50">
                    <motion.div
                      animate={{ scale: [1, 1.2, 1] }}
                      transition={{
                        duration: 0.6,
                        repeat: Infinity,
                        repeatDelay: 1,
                      }}
                    >
                      <CheckCircle className="h-5 w-5 text-emerald-600" />
                    </motion.div>
                    <AlertTitle className="font-semibold text-emerald-800">
                      {dict.success.title}
                    </AlertTitle>
                    <AlertDescription className="text-emerald-700">
                      {successMessage}
                    </AlertDescription>
                  </Alert>
                </motion.div>
              )}

              {infoMessage && (
                <motion.div
                  initial={{ opacity: 0, y: -10, scale: 0.95 }}
                  animate={{ opacity: 1, y: 0, scale: 1 }}
                  exit={{ opacity: 0, y: -10, scale: 0.95 }}
                  transition={{ duration: 0.3 }}
                >
                  {/* Info: Teal */}
                  <Alert className="border-teal-200 bg-teal-50">
                    <Sparkles className="h-5 w-5 text-teal-600" />
                    <AlertTitle className="font-semibold text-teal-800">
                      {dict.info.title}
                    </AlertTitle>
                    <AlertDescription className="text-teal-700">
                      {infoMessage}
                    </AlertDescription>
                  </Alert>
                </motion.div>
              )}
            </AnimatePresence>

            {/* OTP Input Form */}
            <form onSubmit={handleVerifyCode} className="space-y-8">
              {/* Code Input Boxes */}
              <div className="flex justify-center gap-2 md:gap-3" dir="ltr">
                {code.map((digit, index) => (
                  <motion.div
                    key={index}
                    initial={{ opacity: 0, scale: 0.8 }}
                    animate={{ opacity: 1, scale: 1 }}
                    transition={{ duration: 0.3, delay: index * 0.05 }}
                    whileHover={{ scale: 1.05 }}
                  >
                    <Input
                      ref={(el: HTMLInputElement | null) => {
                        inputRefs.current[index] = el;
                      }}
                      type="text"
                      inputMode="numeric"
                      maxLength={1}
                      value={digit}
                      onChange={(e) => handleInputChange(index, e.target.value)}
                      onKeyDown={(e) => handleKeyDown(index, e)}
                      onFocus={() => setFocusedIndex(index)}
                      onBlur={() => setFocusedIndex(null)}
                      disabled={disableForm}
                      required
                      aria-label={dict.digitAriaLabel.replace(
                        '{{index}}',
                        (index + 1).toString()
                      )}
                      // Updated Focus and Filled Colors (Teal/Emerald)
                      className={`
                        w-12 h-14 md:w-14 md:h-16 
                        text-center text-2xl md:text-3xl font-bold 
                        border-2 rounded-xl
                        transition-all duration-300
                        shadow-md
                        ${
                          focusedIndex === index
                            ? 'border-teal-500 ring-4 ring-teal-200 scale-105 bg-white'
                            : digit
                              ? 'border-teal-400 bg-teal-50'
                              : 'border-gray-300 bg-white/50'
                        }
                        ${disableForm ? 'opacity-50 cursor-not-allowed' : 'hover:border-teal-400'}
                      `}
                    />
                  </motion.div>
                ))}
              </div>

              {/* Progress Indicator (Teal -> Orange) */}
              <div className="flex justify-center items-center gap-2">
                {code.map((digit, index) => (
                  <motion.div
                    key={index}
                    className={`h-1.5 rounded-full transition-all duration-300 ${
                      digit
                        ? 'bg-gradient-to-r from-teal-500 to-orange-500 w-8'
                        : 'bg-gray-200 w-4'
                    }`}
                    animate={{
                      scale: digit ? [1, 1.2, 1] : 1,
                    }}
                    transition={{ duration: 0.3 }}
                  />
                ))}
              </div>

              {/* Verify Button (Main Gradient) */}
              <motion.div
                whileHover={{ scale: disableForm ? 1 : 1.02 }}
                whileTap={{ scale: disableForm ? 1 : 0.98 }}
              >
                <Button
                  type="submit"
                  disabled={disableForm || !isCodeComplete}
                  className="w-full py-6 text-lg font-bold rounded-xl bg-gradient-to-r from-teal-500 via-orange-500 to-amber-500 hover:from-teal-600 hover:via-orange-600 hover:to-amber-600 text-white shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed relative overflow-hidden group"
                >
                  {isLoading ? (
                    <div className="flex items-center justify-center gap-3">
                      <Loader2 className="animate-spin h-6 w-6" />
                      <span>{dict.verifyingButton}</span>
                    </div>
                  ) : (
                    <div className="flex items-center justify-center gap-3">
                      <CheckCircle className="h-6 w-6" />
                      <span>{dict.verifyButton}</span>
                      {isRTL ? (
                        <ArrowLeft className="h-5 w-5 group-hover:-translate-x-1 transition-transform" />
                      ) : (
                        <ArrowRight className="h-5 w-5 group-hover:translate-x-1 transition-transform" />
                      )}
                    </div>
                  )}
                  {/* Shine effect */}
                  <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent group-hover:translate-x-full transition-transform duration-1000" />
                </Button>
              </motion.div>
            </form>

            {/* Resend Section */}
            <div className="space-y-4 pt-6 border-t border-gray-200">
              <div className="text-center">
                <p className="text-sm text-gray-600 mb-3">
                  {dict.resend.prompt}
                </p>
                <motion.div
                  whileHover={{ scale: disableResend ? 1 : 1.05 }}
                  whileTap={{ scale: disableResend ? 1 : 0.95 }}
                >
                  <Button
                    type="button"
                    variant="outline"
                    onClick={handleResendCode}
                    disabled={disableResend}
                    className={`
                      px-6 py-3 rounded-full border-2 font-semibold
                      transition-all duration-300
                      ${
                        disableResend
                          ? 'border-gray-300 text-gray-400 cursor-not-allowed'
                          : 'border-teal-500 text-teal-600 hover:bg-teal-50 hover:border-teal-600'
                      }
                    `}
                  >
                    {isResending ? (
                      <div className="flex items-center gap-2">
                        <Loader2 className="animate-spin h-4 w-4" />
                        <span>{dict.resend.buttonLoading}</span>
                      </div>
                    ) : resendDisabled ? (
                      <div className="flex items-center gap-3">
                        <CircularTimer
                          seconds={resendTimer}
                          maxSeconds={RESEND_COOLDOWN}
                        />
                        <span>
                          {dict.resend.timer.replace(
                            '{{timer}}',
                            resendTimer.toString()
                          )}
                        </span>
                      </div>
                    ) : (
                      <div className="flex items-center gap-2">
                        <RefreshCw className="h-4 w-4" />
                        <span>{dict.resend.button}</span>
                      </div>
                    )}
                  </Button>
                </motion.div>
              </div>

              {/* Wrong Number Link */}
              <div className="text-center">
                <Link
                  href={`/${locale}/auth/update-phone`}
                  className={`
                    text-sm font-medium inline-flex items-center gap-2
                    transition-all duration-300
                    ${
                      disableForm
                        ? 'text-gray-400 pointer-events-none'
                        : 'text-teal-600 hover:text-teal-700 hover:gap-3'
                    }
                  `}
                >
                  <Clock className="h-4 w-4" />
                  <span>{dict.wrongNumberLink}</span>
                </Link>
              </div>
            </div>

            {/* Back to Sign In */}
            <div className="text-center pt-4 border-t border-gray-200">
              <Link
                href={`/${locale}/auth/signin`}
                className={`
                  text-xs text-gray-500 hover:text-gray-700 
                  transition-colors duration-300
                  inline-flex items-center gap-2
                  ${disableForm ? 'pointer-events-none opacity-50' : ''}
                `}
              >
                {isRTL ? (
                  <ArrowRight className="h-3 w-3" />
                ) : (
                  <ArrowLeft className="h-3 w-3" />
                )}
                <span>{dict.backToSignInLink}</span>
              </Link>
            </div>
          </div>
        </motion.div>

        {/* Bottom Decoration */}
        <motion.div variants={itemVariants} className="mt-8 text-center">
          <div className="inline-flex items-center gap-2 text-sm text-gray-500">
            <Shield className="h-4 w-4" />
            <span>מוגן באמצעות הצפנת SSL</span>
          </div>
        </motion.div>
      </motion.div>

      {/* Custom Styles */}
      <style>{`
        @keyframes shimmer {
          0% {
            background-position: -1000px 0;
          }
          100% {
            background-position: 1000px 0;
          }
        }
      `}</style>
    </div>
  );
};

export default VerifyPhoneClient;
--- End of Content for VerifyPhoneClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\verify-phone\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/verify-phone/page.tsx
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import VerifyPhoneClient from './VerifyPhoneClient';

// ▼▼▼ כאן השינוי ▼▼▼
type VerifyPhonePageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function VerifyPhonePage({ params }: VerifyPhonePageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <VerifyPhoneClient
      dict={dictionary.auth.verifyPhone}
      locale={locale}
    />
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\contact
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\contact\ContactClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/contact/ContactClient.tsx
'use client';
import React, { useState, useRef } from 'react';
import { useRouter } from 'next/navigation';
import { motion, useInView } from 'framer-motion';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
  CardDescription,
} from '@/components/ui/card';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import {
  Loader2,
  Send,
  CheckCircle,
  AlertTriangle,
  HeartHandshake,
  MessageCircle,
  Phone,
  Mail,
  Clock,
  Shield,
  Users,
  UserPlus,
  HelpCircle,
  Lightbulb,
  Target,
} from 'lucide-react';
import { z } from 'zod';
import Image from 'next/image';
import Link from 'next/link';
import { getRelativeCloudinaryPath } from '@/lib/utils';
// --- START: FIX 2 ---
// Import the type from the main dictionary file
import type { ContactPageDict } from '@/types/dictionary';
// --- END: FIX 2 ---

// Map string keys from the dictionary to actual Icon components
const iconsMap: { [key: string]: React.ElementType } = {
  process: HelpCircle,
  consultation: HeartHandshake,
  general: MessageCircle,
  technical: Users,
};

interface ContactClientProps {
  dict: ContactPageDict;
}

export default function ContactClient({ dict }: ContactClientProps) {
  // --- START: FIX 1 ---
  // Define the teamMembers constant inside the component that uses it
  const teamMembers = [
    {
      name: dict.sidebar.team.members[0].name,
      image:
        'https://res.cloudinary.com/dmfxoi6g0/image/upload/v1753700882/dina4_gr0ako.jpg',
    },
    {
      name: dict.sidebar.team.members[1].name,
      image:
        'https://res.cloudinary.com/dmfxoi6g0/image/upload/v1764678709/6a978d37-584c-4c70-8dac-36682d3149ff_olupeg.jpg',
    },
  ];
  // --- END: FIX 1 ---

  const [name, setName] = useState('');
  const [email, setEmail] = useState('');
  const [category, setCategory] = useState('');
  const [message, setMessage] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [success, setSuccess] = useState(false);
  const [validationErrors, setValidationErrors] = useState<Record<
    string,
    string[] | undefined
  > | null>(null);

  const heroRef = useRef(null);
  const formRef = useRef(null);
  const isHeroInView = useInView(heroRef, { once: true });
  const isFormInView = useInView(formRef, { once: true });

  const contactSchema = z.object({
    name: z.string().min(2, { message: dict.form.errors.nameMin }),
    email: z.string().email({ message: dict.form.errors.emailInvalid }),
    category: z.string().min(1, { message: dict.form.errors.categoryRequired }),
    message: z.string().min(10, { message: dict.form.errors.messageMin }),
  });

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    setError(null);
    setSuccess(false);
    setValidationErrors(null);
    const validationResult = contactSchema.safeParse({
      name,
      email,
      category,
      message,
    });
    if (!validationResult.success) {
      setValidationErrors(validationResult.error.flatten().fieldErrors);
      setIsLoading(false);
      return;
    }

    try {
      const response = await fetch('/api/contact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(validationResult.data),
      });
      const data = await response.json();
      if (!response.ok)
        throw new Error(data.error || dict.form.errors.sendError);
      setSuccess(true);
    } catch (err: unknown) {
      setError(
        err instanceof Error ? err.message : dict.form.errors.unexpectedError
      );
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-cyan-50 via-white to-pink-50">
      <motion.section
        ref={heroRef}
        className="relative pt-20 pb-12 px-4 text-center"
        initial={{ opacity: 0 }}
        animate={isHeroInView ? { opacity: 1 } : {}}
      >
        <div className="relative max-w-4xl mx-auto">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={isHeroInView ? { opacity: 1, y: 0 } : {}}
            transition={{ duration: 0.8, delay: 0.2 }}
            className="inline-flex items-center gap-3 mb-8"
          >
            <HeartHandshake className="w-6 h-6 text-cyan-500" />
            <span className="text-cyan-700 font-semibold">
              {dict.hero.header}
            </span>
          </motion.div>
          <motion.h1
            className="text-4xl sm:text-6xl font-bold text-gray-800 my-6"
            initial={{ opacity: 0, y: 50 }}
            animate={isHeroInView ? { opacity: 1, y: 0 } : {}}
            transition={{ duration: 0.8, delay: 0.4 }}
          >
            {dict.hero.title}
            <br />
            <span className="text-transparent bg-clip-text bg-gradient-to-r from-cyan-600 to-pink-600">
              {dict.hero.highlightedTitle}
            </span>
          </motion.h1>
          <motion.p
            className="text-xl text-gray-600 mb-8"
            initial={{ opacity: 0, y: 30 }}
            animate={isHeroInView ? { opacity: 1, y: 0 } : {}}
            transition={{ duration: 0.8, delay: 0.6 }}
          >
            {dict.hero.subtitle}
            <br />
            <span className="font-semibold text-cyan-700">
              {dict.hero.guarantee}
            </span>
          </motion.p>
        </div>
      </motion.section>

      <div className="max-w-7xl mx-auto px-4 pb-20 pt-8">
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <motion.div
            ref={formRef}
            className="lg:col-span-2"
            initial={{ opacity: 0, x: -50 }}
            animate={isFormInView ? { opacity: 1, x: 0 } : {}}
            transition={{ duration: 0.8 }}
          >
            <Card className="shadow-2xl">
              <CardHeader className="text-center">
                <Mail className="w-8 h-8 mx-auto mb-4 text-cyan-600" />
                <CardTitle>{dict.form.title}</CardTitle>
                <CardDescription>{dict.form.description}</CardDescription>
              </CardHeader>
              <CardContent className="p-8">
                {success ? (
                  <motion.div
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                  >
                    <Alert className="bg-green-50">
                      <CheckCircle className="h-5 w-5 text-green-600" />
                      <AlertTitle>{dict.successMessage.title}</AlertTitle>
                      <AlertDescription>
                        {dict.successMessage.description}
                        <div className="mt-4 flex gap-3">
                          <Link href="/auth/register">
                            <Button size="sm">
                              <UserPlus className="w-4 h-4 ml-2" />
                              {dict.successMessage.signUpButton}
                            </Button>
                          </Link>
                          <Link href="/questionnaire">
                            <Button variant="outline" size="sm">
                              {dict.successMessage.questionnaireButton}
                            </Button>
                          </Link>
                        </div>
                      </AlertDescription>
                    </Alert>
                  </motion.div>
                ) : (
                  <form onSubmit={handleSubmit} className="space-y-6">
                    <div className="grid md:grid-cols-2 gap-4">
                      <div>
                        <label htmlFor="name">{dict.form.nameLabel}</label>
                        <Input
                          id="name"
                          value={name}
                          onChange={(e) => setName(e.target.value)}
                          placeholder={dict.form.namePlaceholder}
                        />
                        {validationErrors?.name && (
                          <p className="text-xs text-red-600 mt-1">
                            {validationErrors.name[0]}
                          </p>
                        )}
                      </div>
                      <div>
                        <label htmlFor="email">{dict.form.emailLabel}</label>
                        <Input
                          id="email"
                          type="email"
                          value={email}
                          onChange={(e) => setEmail(e.target.value)}
                          placeholder={dict.form.emailPlaceholder}
                        />
                        {validationErrors?.email && (
                          <p className="text-xs text-red-600 mt-1">
                            {validationErrors.email[0]}
                          </p>
                        )}
                      </div>
                    </div>
                    <div>
                      <label>{dict.form.categoryLabel}</label>
                      <div className="grid md:grid-cols-2 gap-3 mt-2">
                        {dict.form.categories.map((cat) => {
                          const IconComponent =
                            iconsMap[cat.value] || HelpCircle;
                          return (
                            <label
                              key={cat.value}
                              className={`flex items-center gap-3 p-4 rounded-xl border-2 cursor-pointer ${category === cat.value ? 'border-cyan-500 bg-cyan-50' : 'border-gray-200'}`}
                            >
                              <input
                                type="radio"
                                name="category"
                                value={cat.value}
                                checked={category === cat.value}
                                onChange={(e) => setCategory(e.target.value)}
                                className="sr-only"
                              />
                              <IconComponent
                                className={`w-5 h-5 ${category === cat.value ? 'text-cyan-600' : 'text-gray-400'}`}
                              />
                              <span>{cat.label}</span>
                            </label>
                          );
                        })}
                      </div>
                      {validationErrors?.category && (
                        <p className="text-xs text-red-600 mt-1">
                          {validationErrors.category[0]}
                        </p>
                      )}
                    </div>
                    <div>
                      <label htmlFor="message">{dict.form.messageLabel}</label>
                      <Textarea
                        id="message"
                        value={message}
                        onChange={(e) => setMessage(e.target.value)}
                        placeholder={dict.form.messagePlaceholder}
                        rows={6}
                      />
                      {validationErrors?.message && (
                        <p className="text-xs text-red-600 mt-1">
                          {validationErrors.message[0]}
                        </p>
                      )}
                    </div>
                    {error && (
                      <Alert variant="destructive">
                        <AlertTriangle className="h-4 w-4" />
                        <AlertTitle>Error</AlertTitle>
                        <AlertDescription>{error}</AlertDescription>
                      </Alert>
                    )}
                    <Button
                      type="submit"
                      className="w-full"
                      disabled={isLoading}
                    >
                      {isLoading ? (
                        <>
                          <Loader2 className="ml-2 h-5 w-5 animate-spin" />
                          {dict.form.submitButtonLoading}
                        </>
                      ) : (
                        <>
                          <Send className="ml-2 h-5 w-5" />
                          {dict.form.submitButton}
                        </>
                      )}
                    </Button>
                    <div className="text-center text-sm text-gray-500">
                      <Shield className="w-4 h-4 inline ml-2" />
                      {dict.form.privacyCommitment}
                    </div>
                  </form>
                )}
              </CardContent>
            </Card>
          </motion.div>

          <motion.div
            className="space-y-6"
            initial={{ opacity: 0, x: 50 }}
            animate={isFormInView ? { opacity: 1, x: 0 } : {}}
            transition={{ duration: 0.8, delay: 0.2 }}
          >
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Users className="w-6 h-6 text-cyan-500" />
                  {dict.sidebar.team.title}
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                {dict.sidebar.team.members.map((member, index) => (
                  <div key={index} className="flex items-center gap-4">
                    <div className="relative w-16 h-16 rounded-full overflow-hidden border-2 border-white shadow-md flex-shrink-0">
                      <Image
                        src={getRelativeCloudinaryPath(
                          teamMembers[index].image
                        )}
                        alt={member.name}
                        fill
                        sizes="64px"
                        className="object-cover"
                      />
                    </div>
                    <div>
                      <h4 className="font-bold">{member.name}</h4>
                      <p className="text-sm text-cyan-600">{member.role}</p>
                      <p className="text-xs text-gray-500">
                        {member.description}
                      </p>
                    </div>
                  </div>
                ))}
              </CardContent>
            </Card>
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Lightbulb className="w-6 h-6 text-orange-500" />
                  {dict.sidebar.faq.title}
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                {dict.sidebar.faq.items.map((item, index) => (
                  <div key={index} className="p-4 bg-gray-50 rounded-xl">
                    <h4 className="font-semibold">{item.question}</h4>
                    <p className="text-sm">{item.answer}</p>
                  </div>
                ))}
              </CardContent>
            </Card>
            <Card className="bg-gradient-to-br from-cyan-600 to-pink-600 text-white">
              <CardContent className="p-6">
                <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
                  <Phone className="w-6 h-6" />
                  {dict.sidebar.otherWays.title}
                </h3>
                <div className="space-y-3">
                  <div className="flex items-center gap-3">
                    <Phone className="w-5 h-5" />
                    <span>{dict.sidebar.otherWays.phone}</span>
                  </div>
                  <div className="flex items-center gap-3">
                    <Mail className="w-5 h-5" />
                    <span>{dict.sidebar.otherWays.email}</span>
                  </div>
                  <div className="flex items-center gap-3">
                    <Clock className="w-5 h-5" />
                    <span>{dict.sidebar.otherWays.hours}</span>
                  </div>
                </div>
                <div className="mt-6 p-4 bg-white/20 rounded-xl">
                  <p className="text-sm">
                    <strong>{dict.sidebar.otherWays.commitment.title}</strong>{' '}
                    {dict.sidebar.otherWays.commitment.body}
                  </p>
                </div>
              </CardContent>
            </Card>
            <Card>
              <CardContent className="p-6 text-center">
                <Target className="w-12 h-12 mx-auto mb-4 text-pink-500" />
                <h3 className="text-xl font-bold">{dict.sidebar.cta.title}</h3>
                <p className="text-gray-600 mb-6">
                  {dict.sidebar.cta.description}
                </p>
                <div className="space-y-3">
                  <Link href="/auth/register">
                    <Button className="w-full">
                      <UserPlus className="w-4 h-4 ml-2" />
                      {dict.sidebar.cta.signUpButton}
                    </Button>
                  </Link>
                  <Link href="/questionnaire">
                    <Button variant="outline" className="w-full">
                      {dict.sidebar.cta.questionnaireButton}
                    </Button>
                  </Link>
                </div>
              </CardContent>
            </Card>
          </motion.div>
        </div>
      </div>

      <footer className="bg-gray-800 text-white py-8 px-4">
        <div className="max-w-4xl mx-auto text-center">
          {/* Logo is hardcoded, can be moved to a shared component if needed */}
          <p className="text-gray-400 mb-4">{dict.footer.tagline}</p>
          <p className="text-sm text-gray-500">
            {dict.footer.copyright.replace(
              '{year}',
              new Date().getFullYear().toString()
            )}
          </p>
        </div>
      </footer>
    </div>
  );
}
--- End of Content for ContactClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\contact\contact_contents.txt
--------------------------------------------------------------------------------
Content:
################################################################################
# Directory Content Map For: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\contact
# Generated on: 2025-11-04 14:59:04
################################################################################

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\contact
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\contact\ContactClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/contact/ContactClient.tsx
'use client';
import React, { useState, useRef } from 'react';
import { useRouter } from 'next/navigation';
import { motion, useInView } from 'framer-motion';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
  CardDescription,
} from '@/components/ui/card';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import {
  Loader2,
  Send,
  CheckCircle,
  AlertTriangle,
  HeartHandshake,
  MessageCircle,
  Phone,
  Mail,
  Clock,
  Shield,
  Users,
  UserPlus,
  HelpCircle,
  Lightbulb,
  Target,
} from 'lucide-react';
import { z } from 'zod';
import Image from 'next/image';
import Link from 'next/link';
import { getRelativeCloudinaryPath } from '@/lib/utils';
// --- START: FIX 2 ---
// Import the type from the main dictionary file
import type { ContactPageDict } from '@/types/dictionary';
// --- END: FIX 2 ---

// Map string keys from the dictionary to actual Icon components
const iconsMap: { [key: string]: React.ElementType } = {
  process: HelpCircle,
  consultation: HeartHandshake,
  general: MessageCircle,
  technical: Users,
};

interface ContactClientProps {
  dict: ContactPageDict;
}

export default function ContactClient({ dict }: ContactClientProps) {
  // --- START: FIX 1 ---
  // Define the teamMembers constant inside the component that uses it
  const teamMembers = [
    {
      name: dict.sidebar.team.members[0].name,
      image:
        'https://res.cloudinary.com/dmfxoi6g0/image/upload/v1753700882/dina4_gr0ako.jpg',
    },
    {
      name: dict.sidebar.team.members[1].name,
      image:
        'https://res.cloudinary.com/dmfxoi6g0/image/upload/v1764678709/6a978d37-584c-4c70-8dac-36682d3149ff_olupeg.jpg',
    },
  ];
  // --- END: FIX 1 ---

  const [name, setName] = useState('');
  const [email, setEmail] = useState('');
  const [category, setCategory] = useState('');
  const [message, setMessage] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [success, setSuccess] = useState(false);
  const [validationErrors, setValidationErrors] = useState<Record<
    string,
    string[] | undefined
  > | null>(null);

  const heroRef = useRef(null);
  const formRef = useRef(null);
  const isHeroInView = useInView(heroRef, { once: true });
  const isFormInView = useInView(formRef, { once: true });

  const contactSchema = z.object({
    name: z.string().min(2, { message: dict.form.errors.nameMin }),
    email: z.string().email({ message: dict.form.errors.emailInvalid }),
    category: z.string().min(1, { message: dict.form.errors.categoryRequired }),
    message: z.string().min(10, { message: dict.form.errors.messageMin }),
  });

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    setError(null);
    setSuccess(false);
    setValidationErrors(null);
    const validationResult = contactSchema.safeParse({
      name,
      email,
      category,
      message,
    });
    if (!validationResult.success) {
      setValidationErrors(validationResult.error.flatten().fieldErrors);
      setIsLoading(false);
      return;
    }

    try {
      const response = await fetch('/api/contact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(validationResult.data),
      });
      const data = await response.json();
      if (!response.ok)
        throw new Error(data.error || dict.form.errors.sendError);
      setSuccess(true);
    } catch (err: unknown) {
      setError(
        err instanceof Error ? err.message : dict.form.errors.unexpectedError
      );
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-cyan-50 via-white to-pink-50">
      <motion.section
        ref={heroRef}
        className="relative pt-20 pb-12 px-4 text-center"
        initial={{ opacity: 0 }}
        animate={isHeroInView ? { opacity: 1 } : {}}
      >
        <div className="relative max-w-4xl mx-auto">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={isHeroInView ? { opacity: 1, y: 0 } : {}}
            transition={{ duration: 0.8, delay: 0.2 }}
            className="inline-flex items-center gap-3 mb-8"
          >
            <HeartHandshake className="w-6 h-6 text-cyan-500" />
            <span className="text-cyan-700 font-semibold">
              {dict.hero.header}
            </span>
          </motion.div>
          <motion.h1
            className="text-4xl sm:text-6xl font-bold text-gray-800 my-6"
            initial={{ opacity: 0, y: 50 }}
            animate={isHeroInView ? { opacity: 1, y: 0 } : {}}
            transition={{ duration: 0.8, delay: 0.4 }}
          >
            {dict.hero.title}
            <br />
            <span className="text-transparent bg-clip-text bg-gradient-to-r from-cyan-600 to-pink-600">
              {dict.hero.highlightedTitle}
            </span>
          </motion.h1>
          <motion.p
            className="text-xl text-gray-600 mb-8"
            initial={{ opacity: 0, y: 30 }}
            animate={isHeroInView ? { opacity: 1, y: 0 } : {}}
            transition={{ duration: 0.8, delay: 0.6 }}
          >
            {dict.hero.subtitle}
            <br />
            <span className="font-semibold text-cyan-700">
              {dict.hero.guarantee}
            </span>
          </motion.p>
        </div>
      </motion.section>

      <div className="max-w-7xl mx-auto px-4 pb-20 pt-8">
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <motion.div
            ref={formRef}
            className="lg:col-span-2"
            initial={{ opacity: 0, x: -50 }}
            animate={isFormInView ? { opacity: 1, x: 0 } : {}}
            transition={{ duration: 0.8 }}
          >
            <Card className="shadow-2xl">
              <CardHeader className="text-center">
                <Mail className="w-8 h-8 mx-auto mb-4 text-cyan-600" />
                <CardTitle>{dict.form.title}</CardTitle>
                <CardDescription>{dict.form.description}</CardDescription>
              </CardHeader>
              <CardContent className="p-8">
                {success ? (
                  <motion.div
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                  >
                    <Alert className="bg-green-50">
                      <CheckCircle className="h-5 w-5 text-green-600" />
                      <AlertTitle>{dict.successMessage.title}</AlertTitle>
                      <AlertDescription>
                        {dict.successMessage.description}
                        <div className="mt-4 flex gap-3">
                          <Link href="/auth/register">
                            <Button size="sm">
                              <UserPlus className="w-4 h-4 ml-2" />
                              {dict.successMessage.signUpButton}
                            </Button>
                          </Link>
                          <Link href="/questionnaire">
                            <Button variant="outline" size="sm">
                              {dict.successMessage.questionnaireButton}
                            </Button>
                          </Link>
                        </div>
                      </AlertDescription>
                    </Alert>
                  </motion.div>
                ) : (
                  <form onSubmit={handleSubmit} className="space-y-6">
                    <div className="grid md:grid-cols-2 gap-4">
                      <div>
                        <label htmlFor="name">{dict.form.nameLabel}</label>
                        <Input
                          id="name"
                          value={name}
                          onChange={(e) => setName(e.target.value)}
                          placeholder={dict.form.namePlaceholder}
                        />
                        {validationErrors?.name && (
                          <p className="text-xs text-red-600 mt-1">
                            {validationErrors.name[0]}
                          </p>
                        )}
                      </div>
                      <div>
                        <label htmlFor="email">{dict.form.emailLabel}</label>
                        <Input
                          id="email"
                          type="email"
                          value={email}
                          onChange={(e) => setEmail(e.target.value)}
                          placeholder={dict.form.emailPlaceholder}
                        />
                        {validationErrors?.email && (
                          <p className="text-xs text-red-600 mt-1">
                            {validationErrors.email[0]}
                          </p>
                        )}
                      </div>
                    </div>
                    <div>
                      <label>{dict.form.categoryLabel}</label>
                      <div className="grid md:grid-cols-2 gap-3 mt-2">
                        {dict.form.categories.map((cat) => {
                          const IconComponent =
                            iconsMap[cat.value] || HelpCircle;
                          return (
                            <label
                              key={cat.value}
                              className={`flex items-center gap-3 p-4 rounded-xl border-2 cursor-pointer ${category === cat.value ? 'border-cyan-500 bg-cyan-50' : 'border-gray-200'}`}
                            >
                              <input
                                type="radio"
                                name="category"
                                value={cat.value}
                                checked={category === cat.value}
                                onChange={(e) => setCategory(e.target.value)}
                                className="sr-only"
                              />
                              <IconComponent
                                className={`w-5 h-5 ${category === cat.value ? 'text-cyan-600' : 'text-gray-400'}`}
                              />
                              <span>{cat.label}</span>
                            </label>
                          );
                        })}
                      </div>
                      {validationErrors?.category && (
                        <p className="text-xs text-red-600 mt-1">
                          {validationErrors.category[0]}
                        </p>
                      )}
                    </div>
                    <div>
                      <label htmlFor="message">{dict.form.messageLabel}</label>
                      <Textarea
                        id="message"
                        value={message}
                        onChange={(e) => setMessage(e.target.value)}
                        placeholder={dict.form.messagePlaceholder}
                        rows={6}
                      />
                      {validationErrors?.message && (
                        <p className="text-xs text-red-600 mt-1">
                          {validationErrors.message[0]}
                        </p>
                      )}
                    </div>
                    {error && (
                      <Alert variant="destructive">
                        <AlertTriangle className="h-4 w-4" />
                        <AlertTitle>Error</AlertTitle>
                        <AlertDescription>{error}</AlertDescription>
                      </Alert>
                    )}
                    <Button
                      type="submit"
                      className="w-full"
                      disabled={isLoading}
                    >
                      {isLoading ? (
                        <>
                          <Loader2 className="ml-2 h-5 w-5 animate-spin" />
                          {dict.form.submitButtonLoading}
                        </>
                      ) : (
                        <>
                          <Send className="ml-2 h-5 w-5" />
                          {dict.form.submitButton}
                        </>
                      )}
                    </Button>
                    <div className="text-center text-sm text-gray-500">
                      <Shield className="w-4 h-4 inline ml-2" />
                      {dict.form.privacyCommitment}
                    </div>
                  </form>
                )}
              </CardContent>
            </Card>
          </motion.div>

          <motion.div
            className="space-y-6"
            initial={{ opacity: 0, x: 50 }}
            animate={isFormInView ? { opacity: 1, x: 0 } : {}}
            transition={{ duration: 0.8, delay: 0.2 }}
          >
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Users className="w-6 h-6 text-cyan-500" />
                  {dict.sidebar.team.title}
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                {dict.sidebar.team.members.map((member, index) => (
                  <div key={index} className="flex items-center gap-4">
                    <div className="relative w-16 h-16 rounded-full overflow-hidden border-2 border-white shadow-md flex-shrink-0">
                      <Image
                        src={getRelativeCloudinaryPath(
                          teamMembers[index].image
                        )}
                        alt={member.name}
                        fill
                        sizes="64px"
                        className="object-cover"
                      />
                    </div>
                    <div>
                      <h4 className="font-bold">{member.name}</h4>
                      <p className="text-sm text-cyan-600">{member.role}</p>
                      <p className="text-xs text-gray-500">
                        {member.description}
                      </p>
                    </div>
                  </div>
                ))}
              </CardContent>
            </Card>
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Lightbulb className="w-6 h-6 text-orange-500" />
                  {dict.sidebar.faq.title}
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                {dict.sidebar.faq.items.map((item, index) => (
                  <div key={index} className="p-4 bg-gray-50 rounded-xl">
                    <h4 className="font-semibold">{item.question}</h4>
                    <p className="text-sm">{item.answer}</p>
                  </div>
                ))}
              </CardContent>
            </Card>
            <Card className="bg-gradient-to-br from-cyan-600 to-pink-600 text-white">
              <CardContent className="p-6">
                <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
                  <Phone className="w-6 h-6" />
                  {dict.sidebar.otherWays.title}
                </h3>
                <div className="space-y-3">
                  <div className="flex items-center gap-3">
                    <Phone className="w-5 h-5" />
                    <span>{dict.sidebar.otherWays.phone}</span>
                  </div>
                  <div className="flex items-center gap-3">
                    <Mail className="w-5 h-5" />
                    <span>{dict.sidebar.otherWays.email}</span>
                  </div>
                  <div className="flex items-center gap-3">
                    <Clock className="w-5 h-5" />
                    <span>{dict.sidebar.otherWays.hours}</span>
                  </div>
                </div>
                <div className="mt-6 p-4 bg-white/20 rounded-xl">
                  <p className="text-sm">
                    <strong>{dict.sidebar.otherWays.commitment.title}</strong>{' '}
                    {dict.sidebar.otherWays.commitment.body}
                  </p>
                </div>
              </CardContent>
            </Card>
            <Card>
              <CardContent className="p-6 text-center">
                <Target className="w-12 h-12 mx-auto mb-4 text-pink-500" />
                <h3 className="text-xl font-bold">{dict.sidebar.cta.title}</h3>
                <p className="text-gray-600 mb-6">
                  {dict.sidebar.cta.description}
                </p>
                <div className="space-y-3">
                  <Link href="/auth/register">
                    <Button className="w-full">
                      <UserPlus className="w-4 h-4 ml-2" />
                      {dict.sidebar.cta.signUpButton}
                    </Button>
                  </Link>
                  <Link href="/questionnaire">
                    <Button variant="outline" className="w-full">
                      {dict.sidebar.cta.questionnaireButton}
                    </Button>
                  </Link>
                </div>
              </CardContent>
            </Card>
          </motion.div>
        </div>
      </div>

      <footer className="bg-gray-800 text-white py-8 px-4">
        <div className="max-w-4xl mx-auto text-center">
          {/* Logo is hardcoded, can be moved to a shared component if needed */}
          <p className="text-gray-400 mb-4">{dict.footer.tagline}</p>
          <p className="text-sm text-gray-500">
            {dict.footer.copyright.replace(
              '{year}',
              new Date().getFullYear().toString()
            )}
          </p>
        </div>
      </footer>
    </div>
  );
}
--- End of Content for ContactClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\contact\contact_contents.txt
--------------------------------------------------------------------------------
[This is the output log file itself. Content not included.]

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\contact\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/contact/page.tsx
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../i18n-config';
import ContactClient from './ContactClient';

// ▼▼▼ כאן השינוי ▼▼▼
type ContactPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function ContactPage({ params }: ContactPageProps) {
  const { locale } = await params; // הוספת await
  const dictionary = await getDictionary(locale);

  return <ContactClient dict={dictionary.contactPage} />;
}
--- End of Content for page.tsx ---

--- End of Content for contact_contents.txt ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\contact\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/contact/page.tsx
import { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../i18n-config';
import ContactClient from './ContactClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

type ContactPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function ContactPage({ params }: ContactPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <Suspense
      fallback={
        <StandardizedLoadingSpinner
          text="טוען..."
          subtext="מכינים את הטופס ליצירת קשר"
        />
      }
    >
      <ContactClient dict={dictionary.contactPage} />
    </Suspense>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\contexts
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\contexts\NotificationContext.tsx
--------------------------------------------------------------------------------
Content:
// src/app/contexts/NotificationContext.tsx
"use client";
import React, {
  createContext,
  useContext,
  useEffect,
  useRef,
  useState,
  useCallback,
} from "react";
import { useSession } from "next-auth/react";
import type { Session } from "next-auth";
// --- START OF CHANGE: Import new types ---
import type { NotificationCount } from "@/types/messages"; // This type will now be defined in the new file
import type { FeedItem } from "@/types/messages";
// --- END OF CHANGE ---

interface NotificationContextType {
  notifications: NotificationCount;
  refreshNotifications: () => Promise<void>;
  isLoadingNotifications: boolean;
}

const NotificationContext = createContext<NotificationContextType>({
  notifications: { availabilityRequests: 0, messages: 0, total: 0 },
  refreshNotifications: async () => {},
  isLoadingNotifications: true,
});

export const useNotifications = () => useContext(NotificationContext);

export function NotificationProvider({
  children,
}: {
  children: React.ReactNode;
}) {
  const { data: session, status } = useSession() as {
    data: Session | null;
    status: string;
  };
  const [notifications, setNotifications] = useState<NotificationCount>({
    availabilityRequests: 0,
    messages: 0,
    total: 0,
  });
  const [isLoadingNotifications, setIsLoadingNotifications] = useState(true);

  // --- FIX: Provide 'undefined' as the initial value for useRef ---
  const pollingInterval = useRef<NodeJS.Timeout | undefined>(undefined);

  const fetchNotifications = useCallback(async () => {
    if (status !== "authenticated" || !session?.user?.id) {
      setNotifications({ availabilityRequests: 0, messages: 0, total: 0 });
      setIsLoadingNotifications(false);
      return;
    }

    setIsLoadingNotifications(true);
    try {
      // --- START OF CHANGE: Call the new API endpoint ---
      const response = await fetch("/api/messages/feed");
      if (!response.ok) {
        throw new Error(`Server responded with ${response.status}`);
      }
      const data = await response.json();
      
      // --- START OF CHANGE: Calculate counts from the new feed ---
      if (data.success && Array.isArray(data.feed)) {
        const feed: FeedItem[] = data.feed;
        const actionRequiredCount = feed.filter(item => item.type === 'ACTION_REQUIRED').length;
        
        // כאן ניתן בעתיד להוסיף ספירה של הודעות שלא נקראו
        const unreadMessagesCount = 0; 
        
        const newNotifications: NotificationCount = {
          // availabilityRequests נשאר כאן למקרה שנרצה להשתמש בו בעתיד, כרגע הוא משולב ב-total
          availabilityRequests: actionRequiredCount, 
          messages: unreadMessagesCount,
          total: actionRequiredCount + unreadMessagesCount,
        };
        setNotifications(newNotifications);
      } else {
        // אם ה-API לא החזיר מבנה תקין
        setNotifications({ availabilityRequests: 0, messages: 0, total: 0 });
      }
      // --- END OF CHANGE ---
      
    } catch (error) {
      console.error("[NotificationContext] Error fetching notifications:", error);
      setNotifications({ availabilityRequests: 0, messages: 0, total: 0 });
    } finally {
      setIsLoadingNotifications(false);
    }
  }, [status, session?.user?.id]);

  useEffect(() => {
    // The rest of the useEffect remains the same, it will now call the updated fetchNotifications
    if (status === "authenticated" && session?.user?.id) {
      fetchNotifications();
      if (pollingInterval.current) clearInterval(pollingInterval.current);
      pollingInterval.current = setInterval(fetchNotifications, 60000); // Poll every 60 seconds
    } else {
      if (pollingInterval.current) clearInterval(pollingInterval.current);
      setNotifications({ availabilityRequests: 0, messages: 0, total: 0 });
      if (status !== "loading") setIsLoadingNotifications(false);
    }
    
    return () => {
      if (pollingInterval.current) clearInterval(pollingInterval.current);
    };
  }, [session?.user?.id, status, fetchNotifications]);

  const value = {
    notifications,
    refreshNotifications: fetchNotifications,
    isLoadingNotifications,
  };

  return (
    <NotificationContext.Provider value={value}>
      {children}
    </NotificationContext.Provider>
  );
}
--- End of Content for NotificationContext.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\contexts\QuestionnaireStateContext.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/contexts/QuestionnaireStateContext.tsx
'use client';

import React, {
  createContext,
  useContext,
  useState,
  useCallback,
  useRef,
} from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { AlertTriangle, Save, X } from 'lucide-react';
import type { Dictionary } from '@/types/dictionary'; // ודא שהנתיב נכון

// הגדרת ה-Props עבור המודאל
interface UnsavedChangesModalProps {
  isOpen: boolean;
  onCancel: () => void;
  onConfirm: () => void; // המשך ללא שמירה
  onSaveAndConfirm: () => Promise<void>; // שמור והמשך
  isSaving: boolean;
  dict: Dictionary['unsavedChangesModal'];
}

// רכיב המודאל עצמו
const UnsavedChangesModal: React.FC<UnsavedChangesModalProps> = ({
  isOpen,
  onCancel,
  onConfirm,
  onSaveAndConfirm,
  isSaving,
  dict,
}) => {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/60 z-[300] flex items-center justify-center p-4">
      <Card className="max-w-md w-full">
        <CardHeader>
          <CardTitle className="flex items-center">
            <AlertTriangle className="w-6 h-6 mr-3 text-amber-500" />
            {dict.title}
          </CardTitle>
        </CardHeader>
        <CardContent>
          <p className="text-gray-600 mb-6">{dict.description}</p>
          <div className="flex flex-col sm:flex-row justify-end gap-2">
            <Button variant="ghost" onClick={onCancel}>
              {dict.cancelButton}
            </Button>
            <Button variant="destructive" onClick={onConfirm}>
              <X className="w-4 h-4 mr-2" />
              {dict.continueWithoutSavingButton}
            </Button>
            <Button onClick={onSaveAndConfirm} disabled={isSaving}>
              <Save className="w-4 h-4 mr-2" />
              {isSaving ? dict.savingButton : dict.saveAndContinueButton}
            </Button>
          </div>
        </CardContent>
      </Card>
    </div>
  );
};

// הגדרת הטיפוסים עבור ה-Context
interface QuestionnaireStateContextType {
  isDirty: boolean;
  setIsDirty: (isDirty: boolean) => void;
  promptNavigation: (onConfirmCallback: () => void) => void;
  setSaveHandler: (handler: (() => Promise<void>) | null) => void;
}

const QuestionnaireStateContext = createContext<
  QuestionnaireStateContextType | undefined
>(undefined);

// ה-Provider שיעטוף את האפליקציה
export const QuestionnaireStateProvider = ({
  children,
  dict,
}: {
  children: React.ReactNode;
  dict: Dictionary;
}) => {
  const [isDirty, setIsDirty] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [isSaving, setIsSaving] = useState(false);

  const onConfirmCallbackRef = useRef<() => void>(() => {});
  const saveHandlerRef = useRef<(() => Promise<void>) | null>(null);

  const promptNavigation = (onConfirm: () => void) => {
    onConfirmCallbackRef.current = onConfirm;
    setIsModalOpen(true);
  };

  const setSaveHandler = useCallback(
    (handler: (() => Promise<void>) | null) => {
      saveHandlerRef.current = handler;
    },
    []
  );

  const handleCancel = () => {
    setIsModalOpen(false);
  };

  const handleConfirm = () => {
    setIsDirty(false); // מאפסים את המצב כי המשתמש בחר להמשיך
    onConfirmCallbackRef.current();
    setIsModalOpen(false);
  };

  const handleSaveAndConfirm = async () => {
    if (saveHandlerRef.current) {
      setIsSaving(true);
      await saveHandlerRef.current();
      setIsSaving(false);
      setIsDirty(false);
      onConfirmCallbackRef.current();
      setIsModalOpen(false);
    }
  };

  const value = {
    isDirty,
    setIsDirty,
    promptNavigation,
    setSaveHandler,
  };

  return (
    <QuestionnaireStateContext.Provider value={value}>
      {children}
      <UnsavedChangesModal
        isOpen={isModalOpen}
        onCancel={handleCancel}
        onConfirm={handleConfirm}
        onSaveAndConfirm={handleSaveAndConfirm}
        isSaving={isSaving}
        dict={dict.unsavedChangesModal}
      />
    </QuestionnaireStateContext.Provider>
  );
};

// Hook מותאם אישית לשימוש קל
export const useQuestionnaireState = () => {
  const context = useContext(QuestionnaireStateContext);
  if (context === undefined) {
    throw new Error(
      'useQuestionnaireState must be used within a QuestionnaireStateProvider'
    );
  }
  return context;
};
--- End of Content for QuestionnaireStateContext.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\friends
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\friends\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/friends/page.tsx
// דף הפניית חברים - קמפיין חנוכה "מוסיפים אור בחנוכה"
// NeshamaTech - מעודכן: קאונטדאון ראשי בראש הדף

'use client';

import React, { useState, useRef, useEffect } from 'react';
import { motion, useInView, AnimatePresence } from 'framer-motion';
import {
  Users,
  Heart,
  Share2,
  Sparkles,
  ArrowLeft,
  ArrowRight,
  CheckCircle2,
  Copy,
  Check,
  Crown,
  TrendingUp,
  ChevronDown,
  Loader2,
  AlertCircle,
  Search,
  KeyRound,
  Gift,
  Flame,
  X,
  Forward,
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { useParams } from 'next/navigation';
import { HanukkahCountdown } from '@/components/referral/HanukkahCountdown';

// ================== Hanukkah Config ==================
const HANUKKAH_CONFIG = {
  startDate: new Date('2025-12-14T00:00:00'),
};

// חישוב איזה נר היום
const getCurrentCandle = (): number => {
  const now = new Date();
  const campaignStart = new Date(HANUKKAH_CONFIG.startDate);
  campaignStart.setHours(17, 0, 0, 0);

  if (now < campaignStart) {
    return 1;
  }

  const diffTime = now.getTime() - campaignStart.getTime();
  const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

  return Math.min(Math.max(diffDays + 1, 1), 8);
};

// ================== Hanukkiah SVG Component ==================
interface HanukkiahProps {
  litCandles: number;
  className?: string;
}

const Hanukkiah: React.FC<HanukkiahProps> = ({
  litCandles,
  className = '',
}) => {
  const candlePositions = [
    { x: 25, height: 35 },
    { x: 55, height: 35 },
    { x: 85, height: 35 },
    { x: 115, height: 35 },
    { x: 160, height: 50 }, // שמש
    { x: 205, height: 35 },
    { x: 235, height: 35 },
    { x: 265, height: 35 },
    { x: 295, height: 35 },
  ];

  const getLitStatus = (index: number): boolean => {
    if (index === 4) return true;
    if (index > 4) {
      return litCandles >= 9 - index;
    }
    return litCandles >= 8 - index;
  };

  return (
    <svg
      viewBox="0 0 320 120"
      className={className}
      xmlns="http://www.w3.org/2000/svg"
    >
      <defs>
        <linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stopColor="#F6E05E" />
          <stop offset="50%" stopColor="#D69E2E" />
          <stop offset="100%" stopColor="#B7791F" />
        </linearGradient>
        <linearGradient id="flameGradient" x1="0%" y1="100%" x2="0%" y2="0%">
          <stop offset="0%" stopColor="#14b8a6" />
          <stop offset="50%" stopColor="#F6AD55" />
          <stop offset="100%" stopColor="#ED8936" />
        </linearGradient>
        <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="3" result="coloredBlur" />
          <feMerge>
            <feMergeNode in="coloredBlur" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>
      </defs>

      <rect
        x="60"
        y="100"
        width="200"
        height="8"
        rx="2"
        fill="url(#goldGradient)"
      />
      <rect
        x="150"
        y="85"
        width="20"
        height="20"
        rx="2"
        fill="url(#goldGradient)"
      />

      {candlePositions.map((pos, index) => {
        const isLit = getLitStatus(index);
        const isShamash = index === 4;
        const baseY = isShamash ? 35 : 50;

        return (
          <g key={index}>
            <rect
              x={pos.x - 4}
              y={baseY}
              width="8"
              height={pos.height}
              rx="2"
              fill={isShamash ? '#FBD38D' : '#E2E8F0'}
              stroke="url(#goldGradient)"
              strokeWidth="1"
            />
            <line
              x1={pos.x}
              y1={baseY}
              x2={pos.x}
              y2={baseY - 5}
              stroke="#4A5568"
              strokeWidth="1"
            />
            {isLit && (
              <g filter="url(#glow)">
                <motion.ellipse
                  cx={pos.x}
                  cy={baseY - 12}
                  rx="5"
                  ry="10"
                  fill="url(#flameGradient)"
                  animate={{
                    scaleY: [0.8, 1, 0.9, 1, 0.8],
                    opacity: [0.8, 1, 0.9, 1, 0.8],
                  }}
                  transition={{
                    duration: 1.5,
                    repeat: Infinity,
                    ease: 'easeInOut',
                  }}
                />
                <motion.ellipse
                  cx={pos.x}
                  cy={baseY - 14}
                  rx="2"
                  ry="5"
                  fill="#FEF3C7"
                  animate={{ scaleY: [0.9, 1.1, 0.9] }}
                  transition={{
                    duration: 1,
                    repeat: Infinity,
                    ease: 'easeInOut',
                  }}
                />
              </g>
            )}
          </g>
        );
      })}

      <rect x="157" y="50" width="6" height="35" fill="url(#goldGradient)" />

      {[25, 55, 85, 115, 205, 235, 265, 295].map((x, i) => (
        <g key={`stand-${i}`}>
          <line
            x1={x}
            y1="85"
            x2={x}
            y2="100"
            stroke="url(#goldGradient)"
            strokeWidth="3"
          />
          <line
            x1={x}
            y1="85"
            x2="160"
            y2="85"
            stroke="url(#goldGradient)"
            strokeWidth="2"
          />
        </g>
      ))}
    </svg>
  );
};

// ================== Small Decorative Hanukkiah ==================
const SmallHanukkiah: React.FC<{ className?: string }> = ({
  className = '',
}) => (
  <svg
    viewBox="0 0 100 60"
    className={className}
    xmlns="http://www.w3.org/2000/svg"
  >
    <defs>
      <linearGradient
        id="smallGoldGradient"
        x1="0%"
        y1="0%"
        x2="100%"
        y2="100%"
      >
        <stop offset="0%" stopColor="#F6E05E" />
        <stop offset="100%" stopColor="#D69E2E" />
      </linearGradient>
    </defs>
    <rect
      x="20"
      y="50"
      width="60"
      height="4"
      rx="1"
      fill="url(#smallGoldGradient)"
    />
    {[25, 35, 45, 55, 65, 75].map((x, i) => (
      <rect
        key={i}
        x={x - 1.5}
        y={30}
        width="3"
        height="20"
        rx="1"
        fill="#E2E8F0"
        stroke="url(#smallGoldGradient)"
        strokeWidth="0.5"
      />
    ))}
    <rect
      x="48.5"
      y="20"
      width="3"
      height="30"
      rx="1"
      fill="#FBD38D"
      stroke="url(#smallGoldGradient)"
      strokeWidth="0.5"
    />
  </svg>
);

// ================== Dynamic Background ==================
const DynamicBackground: React.FC = () => {
  return (
    <div className="fixed inset-0 -z-10">
      {/* Base gradient */}
      <div className="absolute inset-0 bg-gradient-to-br from-slate-50 via-teal-50/30 to-orange-50/40" />

      {/* Animated orbs */}
      <motion.div
        className="absolute top-20 right-10 w-72 h-72 rounded-full bg-gradient-to-br from-teal-200/20 to-emerald-200/20 blur-3xl"
        animate={{
          x: [0, 30, 0],
          y: [0, -20, 0],
          scale: [1, 1.1, 1],
        }}
        transition={{
          duration: 15,
          repeat: Infinity,
          ease: 'easeInOut',
        }}
      />
      <motion.div
        className="absolute bottom-40 left-10 w-96 h-96 rounded-full bg-gradient-to-br from-orange-200/20 to-amber-200/20 blur-3xl"
        animate={{
          x: [0, -20, 0],
          y: [0, 30, 0],
          scale: [1, 1.05, 1],
        }}
        transition={{
          duration: 18,
          repeat: Infinity,
          ease: 'easeInOut',
        }}
      />
      <motion.div
        className="absolute top-1/2 left-1/3 w-64 h-64 rounded-full bg-gradient-to-br from-rose-200/15 to-pink-200/15 blur-3xl"
        animate={{
          x: [0, 40, 0],
          y: [0, -40, 0],
        }}
        transition={{
          duration: 20,
          repeat: Infinity,
          ease: 'easeInOut',
        }}
      />

      {/* Subtle pattern overlay */}
      <div
        className="absolute inset-0 opacity-[0.015]"
        style={{
          backgroundImage: `url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23000000' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`,
        }}
      />
    </div>
  );
};

// ================== Content / Translations ==================
const content = {
  he: {
    hero: {
      badge: '🕎 מוסיפים אור בחנוכה',
      title: 'האירו את הדרך לחברים',
      subtitle:
        'כמו הנס של פך השמן - לפעמים משהו קטן יכול להוביל למשהו גדול. הקישור שתשלחו עשוי להיות תחילת הקשר שהם מחפשים.',
      highlight:
        '🏆 מי שיביא הכי הרבה חברים עד סוף החנוכה יזכה בארוחה זוגית על חשבוננו!',
      cta: 'רוצה להאיר את הדרך',
      stats: [
        { value: 'אישי', label: 'ליווי' },
        { value: 'מעמיק', label: 'שאלון' },
        { value: 'דיסקרטי', label: 'תהליך' },
      ],
    },
    howItWorks: {
      title: 'איך מוסיפים אור?',
      steps: [
        {
          title: 'נרשמים',
          desc: 'ממלאים פרטים ומקבלים קישור אישי',
          gradient: 'from-teal-400 to-emerald-500',
        },
        {
          title: 'משתפים',
          desc: 'שולחים לחברים שמחפשים קשר רציני',
          gradient: 'from-orange-400 to-amber-500',
        },
        {
          title: 'עוקבים',
          desc: 'רואים כמה נרות הדלקתם',
          gradient: 'from-rose-400 to-pink-500',
        },
        {
          title: 'מאירים',
          desc: 'עוזרים להרחיב את הקהילה',
          gradient: 'from-teal-500 to-cyan-500',
        },
      ],
    },
    prize: {
      badge: 'הפרס הגדול 🕎',
      title: 'הארה קטנה, השפעה גדולה',
      text: 'לעזור לחבר למצוא את מי שהוא מחפש - זה כמו להדליק נר. האור מתפשט הלאה. מי שיביא הכי הרבה חברים עד סוף החנוכה - נשמח לפנק בארוחה זוגית.',
      prizeTitle: '🍽️ ארוחה זוגית מפנקת',
      prizeSubtitle: 'למאיר/ת האור הגדול/ה של הקמפיין',
    },
    form: {
      title: 'הצטרפו למאירי האור',
      subtitle: 'מלאו את הפרטים וקבלו קישור אישי לשיתוף',
      labels: {
        name: 'שם מלא',
        email: 'אימייל',
        phone: 'טלפון',
        code: 'קוד מועדף (אופציונלי)',
        contactHint: '* נדרש לפחות אימייל או טלפון',
      },
      placeholders: {
        name: 'השם שלכם',
        email: 'email@example.com',
        phone: '050-1234567',
        code: 'למשל: DAVID',
      },
      buttons: {
        submit: 'קבלו קישור אישי',
        submitting: 'רושמים אתכם...',
        copy: 'העתקה',
        copied: 'הועתק!',
        whatsapp: 'שתפו את האור 🕎',
        dashboard: 'לדף המעקב שלי',
      },
      messages: {
        linkPreview: 'הקישור שלכם:',
        codeTaken: 'הקוד הזה כבר תפוס, נסו אחר',
        successTitle: '🕎 נרשמתם בהצלחה!',
        successDesc:
          'הנה הקישור האישי שלכם. שתפו אותו עם חברים והוסיפו אור בחנוכה הזה!',
        genericError: 'משהו השתבש, נסו שוב',
        contactRequired: 'נא למלא לפחות אימייל או טלפון',
      },
    },
    existing: {
      title: 'כבר יש לכם קישור?',
      subtitle: 'הכניסו את הפרטים שלכם למעבר לדף המעקב',
      tabs: { code: 'קוד', email: 'אימייל', phone: 'טלפון' },
      placeholders: {
        code: 'הקוד שלכם',
        email: 'האימייל שלכם',
        phone: 'הטלפון שלכם',
      },
      button: { search: 'לדף המעקב', searching: 'מחפש...' },
      errors: {
        notFound: 'לא מצאנו מפנה עם הפרטים האלה',
        generic: 'שגיאה בחיפוש',
      },
    },
    faq: {
      title: 'שאלות נפוצות',
      questions: [
        {
          q: 'למי כדאי לשלוח את הקישור?',
          a: 'לחברים רווקים שמחפשים קשר רציני ומשמעותי, שיעריכו גישה אישית ומכבדת לשידוכים.',
        },
        {
          q: 'מה החבר/ה שלי יקבלו?',
          a: 'הם יוכלו להירשם לשירות שלנו, למלא את השאלון המעמיק, ולקבל ליווי אישי מצוות השדכנים שלנו.',
        },
        {
          q: 'עד מתי נמשך הקמפיין?',
          a: 'קמפיין "מוסיפים אור בחנוכה" נמשך לאורך כל ימי החנוכה. בסופו נכריז על המנצח/ת!',
        },
        {
          q: 'מה מקבלים על הפניות?',
          a: 'מי שיביא הכי הרבה חברים מאומתים עד סוף החנוכה יקבל שובר לארוחה זוגית מפנקת.',
        },
        {
          q: 'האם יש הגבלה על מספר ההפניות?',
          a: 'לא, אתם מוזמנים לשתף עם כל מי שאתם חושבים שיתאים. ככל שתוסיפו יותר אור - כך גדל הסיכוי לזכות!',
        },
      ],
    },
    whatsappModal: {
      title: 'שתפו את האור',
      subtitle: 'הזמינו חברים להצטרף בחנוכה',
      messageLabel: 'ההודעה שתשלח:',
      copyMessage: 'העתקת ההודעה',
      copyLink: 'העתקת הקישור בלבד',
      copied: 'הועתק!',
      sendWhatsapp: 'פתיחת וואטסאפ ושליחה לחבר',
      tip: 'כמו שמוסיפים נר כל יום - כל חבר שמצטרף מוסיף אור לקהילה!',
    },
  },
  en: {
    hero: {
      badge: '🕎 Adding Light this Hanukkah',
      title: 'Light the way for friends',
      subtitle:
        "Like the miracle of the oil - sometimes something small can lead to something great. The link you send could be the beginning of the relationship they're looking for.",
      highlight:
        "🏆 Whoever brings the most friends by the end of Hanukkah wins a couple's dinner on us!",
      cta: 'I want to light the way',
      stats: [
        { value: 'Personal', label: 'Guidance' },
        { value: 'Deep', label: 'Questionnaire' },
        { value: 'Discreet', label: 'Process' },
      ],
    },
    howItWorks: {
      title: 'How to add light?',
      steps: [
        {
          title: 'Register',
          desc: 'Fill in details and get your personal link',
          gradient: 'from-teal-400 to-emerald-500',
        },
        {
          title: 'Share',
          desc: 'Send to friends looking for serious relationships',
          gradient: 'from-orange-400 to-amber-500',
        },
        {
          title: 'Track',
          desc: 'See how many candles you lit',
          gradient: 'from-rose-400 to-pink-500',
        },
        {
          title: 'Illuminate',
          desc: 'Help expand the community',
          gradient: 'from-teal-500 to-cyan-500',
        },
      ],
    },
    prize: {
      badge: 'The Grand Prize 🕎',
      title: 'Small light, big impact',
      text: "Helping a friend find who they're looking for - it's like lighting a candle. The light spreads. Whoever brings the most friends by the end of Hanukkah - we'd love to treat to a couple's dinner.",
      prizeTitle: "🍽️ Pampering couple's dinner",
      prizeSubtitle: "For the campaign's biggest light-bringer",
    },
    form: {
      title: 'Join the light-bringers',
      subtitle: 'Fill in your details and get a personal link to share',
      labels: {
        name: 'Full Name',
        email: 'Email',
        phone: 'Phone',
        code: 'Preferred Code (Optional)',
        contactHint: '* At least email or phone is required',
      },
      placeholders: {
        name: 'Your name',
        email: 'email@example.com',
        phone: '050-1234567',
        code: 'e.g., DAVID',
      },
      buttons: {
        submit: 'Get my personal link',
        submitting: 'Registering...',
        copy: 'Copy',
        copied: 'Copied!',
        whatsapp: 'Share the light 🕎',
        dashboard: 'Go to my dashboard',
      },
      messages: {
        linkPreview: 'Your link:',
        codeTaken: 'This code is taken, try another',
        successTitle: '🕎 Successfully registered!',
        successDesc:
          'Here is your personal link. Share it with friends and add light this Hanukkah!',
        genericError: 'Something went wrong, please try again',
        contactRequired: 'Please provide at least an email or phone number',
      },
    },
    existing: {
      title: 'Already have a link?',
      subtitle: 'Enter your details to go to your tracking page',
      tabs: { code: 'Code', email: 'Email', phone: 'Phone' },
      placeholders: {
        code: 'Your code',
        email: 'Your email',
        phone: 'Your phone',
      },
      button: { search: 'Go to dashboard', searching: 'Searching...' },
      errors: {
        notFound: "We couldn't find a referrer with these details",
        generic: 'Search error',
      },
    },
    faq: {
      title: 'Frequently Asked Questions',
      questions: [
        {
          q: 'Who should I send the link to?',
          a: 'Single friends looking for a serious, meaningful relationship who would appreciate a personal and respectful approach to matchmaking.',
        },
        {
          q: 'What will my friend receive?',
          a: 'They can register for our service, complete the in-depth questionnaire, and receive personal guidance from our matchmaking team.',
        },
        {
          q: 'When does the campaign end?',
          a: 'The "Adding Light this Hanukkah" campaign runs throughout the holiday. We\'ll announce the winner at the end!',
        },
        {
          q: 'What do you get for referrals?',
          a: "Whoever brings the most verified friends by the end of Hanukkah wins a voucher for a couple's dinner.",
        },
        {
          q: 'Is there a limit on referrals?',
          a: "No, you're welcome to share with anyone you think would be a good fit. The more light you add, the better your chances!",
        },
      ],
    },
    whatsappModal: {
      title: 'Share the light',
      subtitle: 'Invite friends to join this Hanukkah',
      messageLabel: 'Message to send:',
      copyMessage: 'Copy message',
      copyLink: 'Copy link only',
      copied: 'Copied!',
      sendWhatsapp: 'Open WhatsApp and send',
      tip: 'Like adding a candle each night - every friend who joins adds light to the community!',
    },
  },
};

// ================== WhatsApp Share Modal ==================
interface WhatsAppShareModalProps {
  isOpen: boolean;
  onClose: () => void;
  shareUrl: string;
  locale: string;
}

const WhatsAppShareModal: React.FC<WhatsAppShareModalProps> = ({
  isOpen,
  onClose,
  shareUrl,
  locale,
}) => {
  const [copiedMessage, setCopiedMessage] = useState(false);
  const [copiedLink, setCopiedLink] = useState(false);
  const isHebrew = locale === 'he';
  const t = isHebrew ? content.he.whatsappModal : content.en.whatsappModal;

  const shareMessage = isHebrew
    ? `היי, חנוכה שמח! 🕎✨

נתקלתי במיזם חדש וממש איכותי לשידוכים - NeshamaTech.
זה משהו ברמה אחרת לגמרי - עם שדכנים אנושיים, טכנולוגיה חכמה ושמירה אמיתית על דיסקרטיות.

חשבתי עליך כי אני יודע/ת שאת/ה מחפש/ת משהו רציני ומכבד, וזה נראה לי בול הסגנון. שווה בדיקה.

הנה הקישור שלי:
${shareUrl}

חג אורים שמח! 🕯️`
    : `Hey, Happy Hanukkah! 🕎✨

I came across a new and really high-quality matchmaking platform - NeshamaTech.
It's on a completely different level - with human matchmakers, smart technology, and real discretion.

I thought of you because I know you're looking for something serious and respectful, and this seems right up your alley. Worth checking out.

Here's my link:
${shareUrl}

Happy Festival of Lights! 🕯️`;

  const handleCopyMessage = async () => {
    await navigator.clipboard.writeText(shareMessage);
    setCopiedMessage(true);
    setTimeout(() => setCopiedMessage(false), 2000);
  };

  const handleCopyLink = async () => {
    await navigator.clipboard.writeText(shareUrl);
    setCopiedLink(true);
    setTimeout(() => setCopiedLink(false), 2000);
  };

  const handleWhatsAppShare = () => {
    const encodedMessage = encodeURIComponent(shareMessage);
    window.open(`https://wa.me/?text=${encodedMessage}`, '_blank');
  };

  if (!isOpen) return null;

  return (
    <AnimatePresence>
      <motion.div
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        exit={{ opacity: 0 }}
        className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
        onClick={onClose}
      >
        <motion.div
          initial={{ scale: 0.9, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          exit={{ scale: 0.9, opacity: 0 }}
          onClick={(e) => e.stopPropagation()}
          className="bg-white rounded-3xl p-6 max-w-md w-full shadow-2xl max-h-[90vh] overflow-y-auto"
          dir={isHebrew ? 'rtl' : 'ltr'}
        >
          {/* Header */}
          <div className="flex items-center justify-between mb-4">
            <div>
              <h3 className="text-xl font-bold text-gray-900">{t.title}</h3>
              <p className="text-sm text-gray-600">{t.subtitle}</p>
            </div>
            <button
              onClick={onClose}
              className="p-2 hover:bg-gray-100 rounded-full transition-colors"
            >
              <X className="w-5 h-5 text-gray-500" />
            </button>
          </div>

          {/* Message Preview */}
          <div className="mb-4">
            <label className="block text-sm font-medium text-gray-700 mb-2">
              {t.messageLabel}
            </label>
            <div className="bg-gray-50 rounded-xl p-4 text-sm text-gray-700 whitespace-pre-wrap max-h-48 overflow-y-auto border border-gray-100">
              {shareMessage}
            </div>
          </div>

          {/* Action Buttons */}
          <div className="space-y-3">
            <Button
              onClick={handleWhatsAppShare}
              className="w-full h-12 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white rounded-xl"
            >
              <Forward className={`w-5 h-5 ${isHebrew ? 'ml-2' : 'mr-2'}`} />
              {t.sendWhatsapp}
            </Button>

            <div className="grid grid-cols-2 gap-3">
              <Button
                onClick={handleCopyMessage}
                variant="outline"
                className="h-11 rounded-xl"
              >
                {copiedMessage ? (
                  <>
                    <Check
                      className={`w-4 h-4 ${isHebrew ? 'ml-1' : 'mr-1'} text-green-500`}
                    />
                    {t.copied}
                  </>
                ) : (
                  <>
                    <Copy className={`w-4 h-4 ${isHebrew ? 'ml-1' : 'mr-1'}`} />
                    {t.copyMessage}
                  </>
                )}
              </Button>
              <Button
                onClick={handleCopyLink}
                variant="outline"
                className="h-11 rounded-xl"
              >
                {copiedLink ? (
                  <>
                    <Check
                      className={`w-4 h-4 ${isHebrew ? 'ml-1' : 'mr-1'} text-green-500`}
                    />
                    {t.copied}
                  </>
                ) : (
                  <>
                    <Copy className={`w-4 h-4 ${isHebrew ? 'ml-1' : 'mr-1'}`} />
                    {t.copyLink}
                  </>
                )}
              </Button>
            </div>
          </div>

          {/* Tip */}
          <div className="mt-4 p-3 bg-amber-50 rounded-xl border border-amber-100">
            <p className="text-sm text-amber-700 text-center">{t.tip}</p>
          </div>
        </motion.div>
      </motion.div>
    </AnimatePresence>
  );
};

// ================== Hero Section ==================
const HeroSection: React.FC<{
  locale: string;
  onScrollToForm: () => void;
}> = ({ locale, onScrollToForm }) => {
  const isHebrew = locale === 'he';
  const t = isHebrew ? content.he.hero : content.en.hero;
  const currentCandle = getCurrentCandle();

  return (
    <section className="relative pt-8 pb-16 px-4 overflow-hidden">
      {/* Hanukkah Countdown at top */}
      <div className="max-w-4xl mx-auto mb-8">
        <HanukkahCountdown locale={locale} />
      </div>

      {/* Main Content */}
      <div className="max-w-4xl mx-auto text-center">
        {/* Badge */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5 }}
          className="inline-flex items-center gap-2 bg-gradient-to-r from-amber-100 to-orange-100 text-amber-800 px-5 py-2.5 rounded-full text-sm font-medium mb-6 shadow-sm border border-amber-200/50"
        >
          <Flame className="w-4 h-4" />
          {t.badge}
        </motion.div>

        {/* Hanukkiah */}
        <motion.div
          initial={{ opacity: 0, scale: 0.9 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{ duration: 0.6, delay: 0.2 }}
          className="max-w-xs mx-auto mb-6"
        >
          <Hanukkiah litCandles={currentCandle} className="w-full h-auto" />
        </motion.div>

        {/* Title */}
        <motion.h1
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.3 }}
          className="text-4xl md:text-5xl lg:text-6xl font-bold mb-6"
        >
          <span className="text-transparent bg-clip-text bg-gradient-to-r from-teal-600 via-emerald-600 to-orange-500">
            {t.title}
          </span>
        </motion.h1>

        {/* Subtitle */}
        <motion.p
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.4 }}
          className="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto mb-6 leading-relaxed"
        >
          {t.subtitle}
        </motion.p>

        {/* Highlight */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.5 }}
          className="bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-4 mb-8 max-w-xl mx-auto border border-amber-100"
        >
          <p className="text-amber-800 font-medium">{t.highlight}</p>
        </motion.div>

        {/* CTA Button */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.6 }}
        >
          <Button
            onClick={onScrollToForm}
            size="lg"
            className="h-14 px-8 text-lg font-semibold bg-gradient-to-r from-teal-500 to-orange-500 hover:from-teal-600 hover:to-orange-600 text-white rounded-2xl shadow-xl hover:shadow-2xl transition-all"
          >
            <Sparkles className={`w-5 h-5 ${isHebrew ? 'ml-2' : 'mr-2'}`} />
            {t.cta}
            {isHebrew ? (
              <ArrowLeft className="w-5 h-5 mr-2" />
            ) : (
              <ArrowRight className="w-5 h-5 ml-2" />
            )}
          </Button>
        </motion.div>

        {/* Stats */}
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ duration: 0.5, delay: 0.7 }}
          className="flex justify-center gap-8 mt-12"
        >
          {t.stats.map((stat, i) => (
            <div key={i} className="text-center">
              <div className="text-2xl font-bold text-gray-900">
                {stat.value}
              </div>
              <div className="text-sm text-gray-500">{stat.label}</div>
            </div>
          ))}
        </motion.div>
      </div>
    </section>
  );
};

// ================== How It Works Section ==================
const HowItWorksSection: React.FC<{ locale: string }> = ({ locale }) => {
  const ref = useRef(null);
  const isInView = useInView(ref, { once: true, amount: 0.2 });
  const isHebrew = locale === 'he';
  const t = isHebrew ? content.he.howItWorks : content.en.howItWorks;

  return (
    <section ref={ref} className="py-16 px-4">
      <div className="max-w-5xl mx-auto">
        <motion.h2
          initial={{ opacity: 0 }}
          animate={isInView ? { opacity: 1 } : {}}
          className="text-2xl md:text-3xl font-bold text-center text-gray-900 mb-12"
        >
          {t.title}
        </motion.h2>

        <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
          {t.steps.map((step, i) => (
            <motion.div
              key={i}
              initial={{ opacity: 0, y: 30 }}
              animate={isInView ? { opacity: 1, y: 0 } : {}}
              transition={{ delay: i * 0.1, duration: 0.5 }}
              className="relative"
            >
              <div className="bg-white/80 backdrop-blur-sm rounded-2xl p-5 shadow-lg border border-white/60 text-center h-full">
                {/* Number */}
                <div
                  className={`w-10 h-10 rounded-xl bg-gradient-to-br ${step.gradient} text-white flex items-center justify-center font-bold text-lg mx-auto mb-3 shadow-md`}
                >
                  {i + 1}
                </div>

                {/* Title */}
                <h3 className="font-bold text-gray-900 mb-1">{step.title}</h3>

                {/* Description */}
                <p className="text-sm text-gray-600">{step.desc}</p>
              </div>

              {/* Connector line (not on last item) */}
              {i < t.steps.length - 1 && (
                <div
                  className={`hidden md:block absolute top-1/2 ${isHebrew ? '-left-3' : '-right-3'} w-6 h-0.5 bg-gradient-to-r from-gray-200 to-gray-300`}
                />
              )}
            </motion.div>
          ))}
        </div>
      </div>
    </section>
  );
};

// ================== Prize Section ==================
const PrizeSection: React.FC<{ locale: string }> = ({ locale }) => {
  const ref = useRef(null);
  const isInView = useInView(ref, { once: true, amount: 0.2 });
  const isHebrew = locale === 'he';
  const t = isHebrew ? content.he.prize : content.en.prize;

  return (
    <section ref={ref} className="py-16 px-4">
      <div className="max-w-2xl mx-auto">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={isInView ? { opacity: 1, y: 0 } : {}}
          className="text-center"
        >
          {/* Badge */}
          <div className="inline-flex items-center gap-2 bg-amber-50 text-amber-700 px-4 py-2 rounded-full text-sm font-medium mb-6 border border-amber-200">
            <Gift className="w-4 h-4" />
            {t.badge}
          </div>

          {/* Title */}
          <h2 className="text-2xl md:text-3xl font-bold text-gray-900 mb-4">
            {t.title}
          </h2>

          {/* Text */}
          <p className="text-gray-600 mb-10 text-base leading-relaxed max-w-xl mx-auto">
            {t.text}
          </p>

          {/* Prize Card */}
          <motion.div
            initial={{ opacity: 0, scale: 0.95 }}
            animate={isInView ? { opacity: 1, scale: 1 } : {}}
            transition={{ delay: 0.3, duration: 0.5 }}
            className="bg-gradient-to-br from-amber-50 via-orange-50 to-rose-50 rounded-3xl p-8 md:p-10 shadow-xl border border-amber-100 relative overflow-hidden"
          >
            {/* Decorative elements */}
            <div className="absolute top-4 right-4 w-20 h-20 rounded-full bg-gradient-to-br from-amber-200/30 to-transparent blur-xl" />
            <div className="absolute bottom-4 left-4 w-16 h-16 rounded-full bg-gradient-to-br from-orange-200/30 to-transparent blur-xl" />

            <div className="relative z-10">
              {/* Icon */}
              <div className="w-16 h-16 mx-auto rounded-full bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center shadow-lg mb-5">
                <Crown className="w-8 h-8 text-white" />
              </div>

              {/* Prize details */}
              <div className="text-xl md:text-2xl font-bold text-gray-900 mb-2">
                {t.prizeTitle}
              </div>
              <div className="text-amber-600 font-medium">
                {t.prizeSubtitle}
              </div>
            </div>
          </motion.div>
        </motion.div>
      </div>
    </section>
  );
};

// ================== Signup Form ==================
const SignupForm: React.FC<{
  locale: string;
  formRef: React.RefObject<HTMLDivElement | null>;
}> = ({ locale, formRef }) => {
  const ref = useRef(null);
  const isInView = useInView(ref, { once: true, amount: 0.2 });
  const isHebrew = locale === 'he';
  const t = isHebrew ? content.he.form : content.en.form;

  const [form, setForm] = useState({
    name: '',
    email: '',
    phone: '',
    code: '',
  });
  const [loading, setLoading] = useState(false);
  const [success, setSuccess] = useState(false);
  const [error, setError] = useState('');
  const [generatedCode, setGeneratedCode] = useState('');
  const [copied, setCopied] = useState(false);
  const [codeStatus, setCodeStatus] = useState<
    'idle' | 'checking' | 'available' | 'taken'
  >('idle');
  const [isWhatsAppModalOpen, setIsWhatsAppModalOpen] = useState(false);

  // בדיקת זמינות קוד
  useEffect(() => {
    if (!form.code || form.code.length < 3) {
      setCodeStatus('idle');
      return;
    }

    const timer = setTimeout(async () => {
      setCodeStatus('checking');
      try {
        const response = await fetch(
          `/api/referral/register?code=${form.code}`
        );
        const data = await response.json();
        setCodeStatus(data.available ? 'available' : 'taken');
      } catch {
        setCodeStatus('idle');
      }
    }, 500);

    return () => clearTimeout(timer);
  }, [form.code]);

  // ולידציה: לפחות מייל או טלפון
  const hasValidContact = () => {
    return (
      (form.email && form.email.trim().length > 0) ||
      (form.phone && form.phone.trim().length > 0)
    );
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    // בדיקת ולידציה - לפחות מייל או טלפון
    if (!hasValidContact()) {
      setError(t.messages.contactRequired);
      return;
    }

    setLoading(true);
    setError('');

    try {
      const response = await fetch('/api/referral/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name: form.name,
          email: form.email || undefined,
          phone: form.phone || undefined,
          preferredCode: form.code,
        }),
      });

      const data = await response.json();

      if (!response.ok) {
        // טיפול בשגיאת מייל או טלפון נדרשים
        if (data.error === 'EMAIL_OR_PHONE_REQUIRED') {
          throw new Error(t.messages.contactRequired);
        }
        throw new Error(data.error || t.messages.genericError);
      }

      setGeneratedCode(data.referrer.code);
      setSuccess(true);
    } catch (err) {
      setError(err instanceof Error ? err.message : t.messages.genericError);
    } finally {
      setLoading(false);
    }
  };

  const copyToClipboard = async () => {
    const url = `${window.location.origin}/r/${generatedCode}`;
    await navigator.clipboard.writeText(url);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  const shareUrl =
    typeof window !== 'undefined'
      ? `${window.location.origin}/r/${generatedCode}`
      : '';

  return (
    <section ref={formRef} className="py-16 px-4">
      <div ref={ref} className="max-w-xl mx-auto">
        <AnimatePresence mode="wait">
          {!success ? (
            <motion.div
              key="form"
              initial={{ opacity: 0, y: 20 }}
              animate={isInView ? { opacity: 1, y: 0 } : {}}
              exit={{ opacity: 0 }}
              className="bg-white/90 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-white/60"
            >
              {/* Header */}
              <div className="text-center mb-8">
                <div className="w-14 h-14 mx-auto rounded-2xl bg-gradient-to-br from-teal-500 to-orange-500 flex items-center justify-center text-white mb-4 shadow-lg">
                  <Flame className="w-7 h-7" />
                </div>
                <h2 className="text-2xl font-bold text-gray-900">{t.title}</h2>
                <p className="text-gray-600 mt-1">{t.subtitle}</p>
              </div>

              {/* Error message */}
              {error && (
                <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-xl flex items-center gap-2">
                  <AlertCircle className="w-5 h-5 text-red-500 flex-shrink-0" />
                  <span className="text-red-700 text-sm">{error}</span>
                </div>
              )}

              {/* Form */}
              <form onSubmit={handleSubmit} className="space-y-5">
                {/* שם */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1.5">
                    {t.labels.name} *
                  </label>
                  <Input
                    required
                    value={form.name}
                    onChange={(e) => setForm({ ...form, name: e.target.value })}
                    placeholder={t.placeholders.name}
                    className="h-12 rounded-xl border-gray-200 focus:border-teal-500 focus:ring-teal-500"
                  />
                </div>

                {/* הערה על מייל/טלפון */}
                <div className="text-xs text-teal-600 font-medium bg-teal-50 px-3 py-2 rounded-lg">
                  {t.labels.contactHint}
                </div>

                {/* אימייל - לא required יותר */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1.5">
                    {t.labels.email}
                  </label>
                  <Input
                    type="email"
                    value={form.email}
                    onChange={(e) =>
                      setForm({ ...form, email: e.target.value })
                    }
                    placeholder={t.placeholders.email}
                    className="h-12 rounded-xl border-gray-200 focus:border-teal-500 focus:ring-teal-500"
                    dir="ltr"
                  />
                </div>

                {/* טלפון */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1.5">
                    {t.labels.phone}
                  </label>
                  <Input
                    type="tel"
                    value={form.phone}
                    onChange={(e) =>
                      setForm({ ...form, phone: e.target.value })
                    }
                    placeholder={t.placeholders.phone}
                    className="h-12 rounded-xl border-gray-200 focus:border-teal-500 focus:ring-teal-500"
                    dir="ltr"
                  />
                </div>

                {/* קוד מועדף */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1.5">
                    {t.labels.code}
                  </label>
                  <div className="relative">
                    <Input
                      value={form.code}
                      onChange={(e) =>
                        setForm({
                          ...form,
                          code: e.target.value
                            .toUpperCase()
                            .replace(/[^A-Z0-9]/g, ''),
                        })
                      }
                      placeholder={t.placeholders.code}
                      maxLength={15}
                      className={`h-12 rounded-xl border-gray-200 focus:border-teal-500 focus:ring-teal-500 font-mono ${
                        isHebrew ? 'pl-10' : 'pr-10'
                      }`}
                      dir="ltr"
                    />
                    <div
                      className={`absolute ${isHebrew ? 'left-3' : 'right-3'} top-1/2 -translate-y-1/2`}
                    >
                      {codeStatus === 'checking' && (
                        <Loader2 className="w-5 h-5 text-gray-400 animate-spin" />
                      )}
                      {codeStatus === 'available' && (
                        <CheckCircle2 className="w-5 h-5 text-green-500" />
                      )}
                      {codeStatus === 'taken' && (
                        <AlertCircle className="w-5 h-5 text-red-500" />
                      )}
                    </div>
                  </div>
                  <p className="text-xs text-gray-500 mt-1.5">
                    {t.messages.linkPreview} neshamatech.com/r/
                    {form.code || 'YOURCODE'}
                  </p>
                  {codeStatus === 'taken' && (
                    <p className="text-xs text-red-500 mt-1">
                      {t.messages.codeTaken}
                    </p>
                  )}
                </div>

                <Button
                  type="submit"
                  disabled={loading || codeStatus === 'taken'}
                  className="w-full h-12 text-base font-semibold bg-gradient-to-r from-teal-500 to-orange-500 hover:from-teal-600 hover:to-orange-600 text-white rounded-xl shadow-lg hover:shadow-xl transition-all"
                >
                  {loading ? (
                    <>
                      <Loader2
                        className={`w-5 h-5 ${isHebrew ? 'ml-2' : 'mr-2'} animate-spin`}
                      />
                      {t.buttons.submitting}
                    </>
                  ) : (
                    <>
                      <Sparkles
                        className={`w-5 h-5 ${isHebrew ? 'ml-2' : 'mr-2'}`}
                      />
                      {t.buttons.submit}
                    </>
                  )}
                </Button>
              </form>
            </motion.div>
          ) : (
            <motion.div
              key="success"
              initial={{ opacity: 0, scale: 0.95 }}
              animate={{ opacity: 1, scale: 1 }}
              className="bg-gradient-to-br from-teal-50 via-white to-orange-50 rounded-3xl p-8 shadow-2xl border border-teal-100 text-center"
            >
              {/* Success Icon */}
              <div className="w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-teal-400 to-emerald-500 flex items-center justify-center mb-5 shadow-xl">
                <CheckCircle2 className="w-10 h-10 text-white" />
              </div>

              {/* Success Message */}
              <h2 className="text-2xl font-bold text-gray-900 mb-2">
                {t.messages.successTitle}
              </h2>
              <p className="text-gray-600 mb-6">{t.messages.successDesc}</p>

              {/* Link Display */}
              <div className="bg-white rounded-xl p-4 shadow-sm border border-gray-100 mb-6">
                <div className="flex items-center justify-between gap-3 bg-gray-50 rounded-lg p-3">
                  <code
                    className="text-teal-600 font-mono text-sm truncate flex-1"
                    dir="ltr"
                  >
                    {shareUrl}
                  </code>
                  <Button
                    onClick={copyToClipboard}
                    variant="outline"
                    size="sm"
                    className={
                      copied ? 'bg-teal-50 text-teal-600 border-teal-200' : ''
                    }
                  >
                    {copied ? (
                      <>
                        <Check
                          className={`w-4 h-4 ${isHebrew ? 'ml-1' : 'mr-1'}`}
                        />
                        {t.buttons.copied}
                      </>
                    ) : (
                      <>
                        <Copy
                          className={`w-4 h-4 ${isHebrew ? 'ml-1' : 'mr-1'}`}
                        />
                        {t.buttons.copy}
                      </>
                    )}
                  </Button>
                </div>
              </div>

              {/* Action Buttons */}
              <div className="flex flex-col sm:flex-row gap-3 justify-center">
                <Button
                  onClick={() => setIsWhatsAppModalOpen(true)}
                  className="bg-gradient-to-r from-teal-500 to-orange-500 hover:from-teal-600 hover:to-orange-600 text-white px-6 py-5 rounded-xl"
                >
                  <Flame className={`w-5 h-5 ${isHebrew ? 'ml-2' : 'mr-2'}`} />
                  {t.buttons.whatsapp}
                </Button>
                <Button
                  onClick={() =>
                    window.open(
                      `/${locale}/referral/dashboard?code=${generatedCode}`,
                      '_blank'
                    )
                  }
                  variant="outline"
                  className="px-6 py-5 rounded-xl border-gray-200"
                >
                  <TrendingUp
                    className={`w-5 h-5 ${isHebrew ? 'ml-2' : 'mr-2'}`}
                  />
                  {t.buttons.dashboard}
                </Button>
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      </div>

      {/* WhatsApp Modal */}
      <WhatsAppShareModal
        isOpen={isWhatsAppModalOpen}
        onClose={() => setIsWhatsAppModalOpen(false)}
        shareUrl={shareUrl}
        locale={locale}
      />
    </section>
  );
};

// ================== Existing Referrer Section ==================
const ExistingReferrerSection: React.FC<{ locale: string }> = ({ locale }) => {
  const ref = useRef(null);
  const isInView = useInView(ref, { once: true, amount: 0.2 });
  const isHebrew = locale === 'he';
  const t = isHebrew ? content.he.existing : content.en.existing;

  const [searchValue, setSearchValue] = useState('');
  const [searchType, setSearchType] = useState<'code' | 'email' | 'phone'>(
    'code'
  );
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  const handleSearch = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!searchValue.trim()) return;

    setLoading(true);
    setError('');

    try {
      const params = new URLSearchParams();
      if (searchType === 'code') {
        params.set('code', searchValue.toUpperCase());
      } else if (searchType === 'email') {
        params.set('email', searchValue);
      } else {
        params.set('phone', searchValue);
      }

      const response = await fetch(`/api/referral/lookup?${params.toString()}`);
      const data = await response.json();

      if (data.success && data.code) {
        window.location.href = `/${locale}/referral/dashboard?code=${data.code}`;
      } else {
        setError(t.errors.notFound);
      }
    } catch {
      setError(t.errors.generic);
    } finally {
      setLoading(false);
    }
  };

  return (
    <section ref={ref} className="py-12 px-4">
      <div className="max-w-lg mx-auto">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={isInView ? { opacity: 1, y: 0 } : {}}
          className="bg-white/70 backdrop-blur-sm rounded-3xl p-6 shadow-xl border border-white/60"
        >
          {/* Header */}
          <div className="text-center mb-6">
            <div className="w-12 h-12 mx-auto rounded-xl bg-gradient-to-br from-slate-100 to-gray-200 flex items-center justify-center mb-3">
              <KeyRound className="w-6 h-6 text-gray-600" />
            </div>
            <h3 className="text-xl font-bold text-gray-800">{t.title}</h3>
            <p className="text-sm text-gray-600 mt-1">{t.subtitle}</p>
          </div>

          {/* Tabs */}
          <div className="flex gap-2 mb-4 p-1 bg-gray-100 rounded-xl">
            {[
              { type: 'code' as const, label: t.tabs.code },
              { type: 'email' as const, label: t.tabs.email },
              { type: 'phone' as const, label: t.tabs.phone },
            ].map((tab) => (
              <button
                key={tab.type}
                onClick={() => {
                  setSearchType(tab.type);
                  setError('');
                }}
                className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${
                  searchType === tab.type
                    ? 'bg-white text-teal-700 shadow-sm'
                    : 'text-gray-600 hover:text-gray-800'
                }`}
              >
                {tab.label}
              </button>
            ))}
          </div>

          {/* Search Form */}
          <form onSubmit={handleSearch} className="space-y-4">
            <div className="relative">
              <Input
                value={searchValue}
                onChange={(e) => setSearchValue(e.target.value)}
                placeholder={t.placeholders[searchType]}
                className={`h-12 rounded-xl ${isHebrew ? 'pr-4 pl-12' : 'pl-4 pr-12'}`}
                dir="ltr"
              />
              <Search
                className={`absolute ${isHebrew ? 'left-4' : 'right-4'} top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400`}
              />
            </div>

            {error && (
              <div className="flex items-center gap-2 text-red-600 text-sm">
                <AlertCircle className="w-4 h-4" />
                <span>{error}</span>
              </div>
            )}

            <Button
              type="submit"
              disabled={loading || !searchValue.trim()}
              className="w-full h-11 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-800 hover:to-gray-900 text-white rounded-xl"
            >
              {loading ? (
                <>
                  <Loader2
                    className={`w-4 h-4 ${isHebrew ? 'ml-2' : 'mr-2'} animate-spin`}
                  />
                  {t.button.searching}
                </>
              ) : (
                <>
                  <TrendingUp
                    className={`w-4 h-4 ${isHebrew ? 'ml-2' : 'mr-2'}`}
                  />
                  {t.button.search}
                </>
              )}
            </Button>
          </form>
        </motion.div>
      </div>
    </section>
  );
};

// ================== FAQ Section ==================
const FAQSection: React.FC<{ locale: string }> = ({ locale }) => {
  const ref = useRef(null);
  const isInView = useInView(ref, { once: true, amount: 0.2 });
  const isHebrew = locale === 'he';
  const t = isHebrew ? content.he.faq : content.en.faq;

  const [openIndex, setOpenIndex] = useState<number | null>(null);

  return (
    <section ref={ref} className="py-16 px-4">
      <div className="max-w-2xl mx-auto">
        <motion.h2
          initial={{ opacity: 0 }}
          animate={isInView ? { opacity: 1 } : {}}
          className="text-2xl md:text-3xl font-bold text-center text-gray-900 mb-10"
        >
          {t.title}
        </motion.h2>

        <div className="space-y-3">
          {t.questions.map((faq, i) => (
            <motion.div
              key={i}
              initial={{ opacity: 0, y: 10 }}
              animate={isInView ? { opacity: 1, y: 0 } : {}}
              transition={{ delay: i * 0.1 }}
            >
              <button
                onClick={() => setOpenIndex(openIndex === i ? null : i)}
                className={`w-full bg-white/80 backdrop-blur-sm rounded-2xl p-5 shadow-lg border border-white/60 hover:shadow-xl transition-all ${
                  isHebrew ? 'text-right' : 'text-left'
                }`}
              >
                <div className="flex items-center justify-between gap-4">
                  <h3 className="font-bold text-gray-800">{faq.q}</h3>
                  <ChevronDown
                    className={`w-5 h-5 text-gray-500 transition-transform flex-shrink-0 ${
                      openIndex === i ? 'rotate-180' : ''
                    }`}
                  />
                </div>
                <AnimatePresence>
                  {openIndex === i && (
                    <motion.p
                      initial={{ height: 0, opacity: 0 }}
                      animate={{ height: 'auto', opacity: 1 }}
                      exit={{ height: 0, opacity: 0 }}
                      className="text-gray-600 mt-3 overflow-hidden leading-relaxed"
                    >
                      {faq.a}
                    </motion.p>
                  )}
                </AnimatePresence>
              </button>
            </motion.div>
          ))}
        </div>
      </div>
    </section>
  );
};

// ================== Main Page Component ==================
export default function FriendsPage() {
  const params = useParams();
  const locale = (params?.locale as string) || 'he';
  const formRef = useRef<HTMLDivElement>(null);
  const isHebrew = locale === 'he';

  const scrollToForm = () => {
    formRef.current?.scrollIntoView({ behavior: 'smooth', block: 'center' });
  };

  return (
    <main className="min-h-screen relative" dir={isHebrew ? 'rtl' : 'ltr'}>
      <DynamicBackground />
      <HeroSection locale={locale} onScrollToForm={scrollToForm} />
      <HowItWorksSection locale={locale} />
      <ExistingReferrerSection locale={locale} />
      <PrizeSection locale={locale} />
      <SignupForm locale={locale} formRef={formRef} />
      <FAQSection locale={locale} />

      {/* Footer */}
      <div className="text-center py-8 text-gray-500 text-sm">
        חג אורים שמח! 🕎✨
      </div>

      {/* CSS Animations */}
      <style>{`
        @keyframes float-slow {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-20px); }
        }
        .animate-float-slow {
          animation: float-slow 15s ease-in-out infinite;
        }
      `}</style>
    </main>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\legal_contents.txt
--------------------------------------------------------------------------------
Content:
################################################################################
# Directory Content Map For: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal
# Generated on: 2025-10-26 16:21:50
################################################################################

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\legal_contents.txt
--------------------------------------------------------------------------------
[This is the output log file itself. Content not included.]

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\accessibility-statement
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\accessibility-statement\AccessibilityStatementClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/legal/accessibility-statement/AccessibilityStatementClient.tsx
'use client';

import React from 'react';
import Head from 'next/head';
import {
  Accessibility,
  CheckCircle,
  Type,
  Contrast,
  Eye,
  Hand,
  Speech,
  MousePointer,
  Sparkles,
} from 'lucide-react';
import { AccessibilityStatementDict } from '@/types/dictionaries/auth';

// Helper component for creating feature list items
const FeatureItem: React.FC<{
  icon: React.ElementType;
  title: string;
  description: string;
}> = ({ icon: Icon, title, description }) => (
  <li className="flex items-start gap-4">
    <div className="flex-shrink-0 mt-1 p-2 bg-cyan-100 rounded-full">
      <Icon className="w-5 h-5 text-cyan-700" />
    </div>
    <div>
      <h3 className="font-semibold text-gray-800">{title}</h3>
      <p className="text-gray-600 text-sm">{description}</p>
    </div>
  </li>
);

interface AccessibilityStatementClientProps {
  dict: AccessibilityStatementDict;
  locale: string;
}

const AccessibilityStatementClient: React.FC<AccessibilityStatementClientProps> = ({ dict, locale }) => {
  const brandName = 'NeshamaTech';
  const companyNameLegal = `ג'ואיש מאצ'פוינט בע"מ`; // This can also be moved to dict if needed
  const lastUpdatedDate = '28 באוגוסט 2025';
  const accessibilityCoordinatorName = 'איתן אנגלרד';
  const accessibilityCoordinatorEmail = 'eytanenglard@gmail.com';

  const pageTitle = dict.pageTitle.replace('{brandName}', brandName);
  const pageDescription = dict.pageDescription.replace('{brandName}', brandName);

  return (
    <>
      <Head>
        <title>{pageTitle}</title>
        <meta name="description" content={pageDescription} />
        <meta property="og:title" content={pageTitle} />
        <meta property="og:description" content={pageDescription} />
      </Head>
      <div className="bg-gradient-to-br from-cyan-50 via-white to-pink-50 min-h-screen py-12 px-4 sm:px-6 lg:px-8">
        <div className="container mx-auto max-w-4xl bg-white shadow-xl rounded-2xl p-8 sm:p-12 border border-gray-200/50">
          <header className="mb-10 text-center border-b pb-6 border-gray-200">
            <div className="inline-block p-4 bg-gradient-to-r from-cyan-100 to-pink-100 rounded-2xl mb-4">
              <Accessibility className="w-10 h-10 text-cyan-700" />
            </div>
            <h1 className="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-600 to-pink-600">
              {dict.mainTitle}
            </h1>
            <p className="mt-3 text-lg text-gray-600">
              {dict.siteName.replace('{brandName}', brandName)}
            </p>
            <p className="mt-2 text-sm text-gray-500">
              {dict.lastUpdated.replace('{lastUpdatedDate}', lastUpdatedDate)}
            </p>
          </header>

          <article
            className="prose prose-lg max-w-none text-gray-700 leading-relaxed"
            dir={locale === 'he' ? 'rtl' : 'ltr'}
          >
            <h2 id="commitment">{dict.commitment.title}</h2>
            <p dangerouslySetInnerHTML={{ __html: dict.commitment.p1.replace('{companyNameLegal}', companyNameLegal).replace('{brandName}', brandName) }} />
            <p>{dict.commitment.p2}</p>
            
            <h2 id="level">{dict.level.title}</h2>
            <ul>
                <li dangerouslySetInnerHTML={{ __html: dict.level.item1 }} />
                <li dangerouslySetInnerHTML={{ __html: dict.level.item2 }} />
            </ul>

            <h2 id="features">{dict.features.title}</h2>
            <p>{dict.features.p1}</p>

            <h3 className="flex items-center gap-3">
              <Sparkles className="text-blue-600" />
              {dict.features.dedicatedToolbarTitle}
            </h3>
            <p>{dict.features.p2}</p>
            <ul className="space-y-4 not-prose list-none p-0">
                <FeatureItem icon={Type} title={dict.features.fontAdjustment.title} description={dict.features.fontAdjustment.description} />
                <FeatureItem icon={Contrast} title={dict.features.contrastModes.title} description={dict.features.contrastModes.description} />
                <FeatureItem icon={Eye} title={dict.features.readableFont.title} description={dict.features.readableFont.description} />
                <FeatureItem icon={MousePointer} title={dict.features.largeCursor.title} description={dict.features.largeCursor.description} />
                <FeatureItem icon={Speech} title={dict.features.textToSpeech.title} description={dict.features.textToSpeech.description} />
                <FeatureItem icon={Hand} title={dict.features.reduceMotion.title} description={dict.features.reduceMotion.description} />
            </ul>
            
            <h3 className="flex items-center gap-3 mt-8">
              <CheckCircle className="text-emerald-600" />
              {dict.features.additionalAdjustmentsTitle}
            </h3>
            <ul>
              <li dangerouslySetInnerHTML={{ __html: dict.features.keyboardNav }} />
              <li dangerouslySetInnerHTML={{ __html: dict.features.screenReader }} />
              <li dangerouslySetInnerHTML={{ __html: dict.features.altText }} />
              <li dangerouslySetInnerHTML={{ __html: dict.features.accessibleForms }} />
              <li dangerouslySetInnerHTML={{ __html: dict.features.noFlashing }} />
            </ul>

            <h2 id="limitations">{dict.limitations.title}</h2>
            <p>{dict.limitations.p1}</p>
            <p>{dict.limitations.p2}</p>

            <h2 id="contact">{dict.contact.title}</h2>
            <p>{dict.contact.p1}</p>
            <ul>
                <li dangerouslySetInnerHTML={{ __html: dict.contact.name.replace('{accessibilityCoordinatorName}', accessibilityCoordinatorName) }} />
                <li>{dict.contact.email} <a href={`mailto:${accessibilityCoordinatorEmail}`} className="text-cyan-600 hover:text-cyan-700">{accessibilityCoordinatorEmail}</a></li>
            </ul>
            <p>{dict.contact.p2}</p>
            <p dangerouslySetInnerHTML={{ __html: dict.contact.p3.replace('{lastUpdatedDate}', lastUpdatedDate) }} />
          </article>
        </div>
      </div>
    </>
  );
};

export default AccessibilityStatementClient;
--- End of Content for AccessibilityStatementClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\accessibility-statement\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/legal/accessibility-statement/page.tsx
import React from 'react';
import { getDictionary } from '@/lib/dictionaries';
import { Locale } from '@/../i18n-config';
import AccessibilityStatementClient from './AccessibilityStatementClient';

// Server Component
export default async function AccessibilityStatementPage({
  params: { locale },
}: {
  params: { locale: Locale };
}) {
  const dictionary = await getDictionary(locale);

  return (
    <AccessibilityStatementClient
      dict={dictionary.auth.legal.accessibilityStatement}
      locale={locale}
    />
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\privacy-policy
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\privacy-policy\PrivacyPolicyClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/legal/privacy-policy/PrivacyPolicyClient.tsx
'use client';

import React from 'react';
import Head from 'next/head';
import { PrivacyPolicyDict } from '@/types/dictionaries/auth';

interface PrivacyPolicyClientProps {
  dict: PrivacyPolicyDict;
  locale: string;
}

const PrivacyPolicyClient: React.FC<PrivacyPolicyClientProps> = ({ dict, locale }) => {
  const brandName = `נשמה טק (NeshamaTech)`;
  const companyNameLegal = `ג'ואיש מאצ'פוינט בע"מ`;
  const companyNumber = '517172631';
  const lastUpdatedDate = '11 באוגוסט 2025';
  const companyEmail = 'neshamatech.jsmatch@gmail.com';
  const siteUrl = 'https://www.jewishmatchpoint.com';
  const companyRegisteredAddress = 'גולומב 7, רעננה, ישראל';

  const pageTitle = dict.pageTitle.replace('{brandName}', brandName);
  const pageDescription = dict.pageDescription.replace('{brandName}', brandName);

  return (
    <>
      <Head>
        <title>{pageTitle}</title>
        <meta name="description" content={pageDescription} />
        <meta property="og:title" content={pageTitle} />
        <meta property="og:description" content={pageDescription} />
        <meta property="og:url" content={`${siteUrl}/legal/privacy-policy`} />
        <meta name="twitter:card" content="summary_large_image" />
      </Head>
      <div className="bg-gradient-to-br from-cyan-50 via-white to-pink-50 min-h-screen py-12 px-4 sm:px-6 lg:px-8">
        <div className="container mx-auto max-w-4xl bg-white shadow-xl rounded-lg p-8 sm:p-12">
          <header className="mb-10 text-center border-b pb-6 border-gray-200">
            <h1 className="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 to-pink-500">
              {dict.mainTitle}
            </h1>
            <p className="mt-2 text-sm text-gray-500">
              {dict.lastUpdated.replace('{lastUpdatedDate}', lastUpdatedDate)}
            </p>
          </header>

          <article
            className="prose prose-lg max-w-none text-gray-700 leading-relaxed"
            dir={locale === 'he' ? 'rtl' : 'ltr'}
          >
            <p><strong>{dict.introduction.title}</strong></p>
            <p>{dict.introduction.p1.replace('{companyNameLegal}', companyNameLegal).replace('{companyNumber}', companyNumber)}</p>
            <p>{dict.introduction.p2}</p>
            <p>{dict.introduction.p3}</p>
            
            <h2 id="consent">{dict.consent.title}</h2>
            <p>{dict.consent.p1}</p>
            <p>{dict.consent.p2}</p>
            <p>{dict.consent.p3.replace('{companyNameLegal}', companyNameLegal).replace('{companyNumber}', companyNumber).replace('{companyRegisteredAddress}', companyRegisteredAddress)}</p>
            <p dangerouslySetInnerHTML={{ __html: dict.consent.p4 }} />

            <h2 id="collected-info">{dict.collectedInfo.title}</h2>
            <p>{dict.collectedInfo.p1}</p>
            <p><strong>{dict.collectedInfo.subTitle1}</strong></p>
            <ul>
                <li>{dict.collectedInfo.list1.item1}</li>
                <li>
                    {dict.collectedInfo.list1.item2.title}
                    <ul>
                        <li>{dict.collectedInfo.list1.item2.subItem1}</li>
                        <li>{dict.collectedInfo.list1.item2.subItem2}</li>
                        <li>{dict.collectedInfo.list1.item2.subItem3}</li>
                    </ul>
                </li>
                <li>{dict.collectedInfo.list1.item3}</li>
                <li>{dict.collectedInfo.list1.item4}</li>
                <li>{dict.collectedInfo.list1.item5}</li>
                <li>{dict.collectedInfo.list1.item6}</li>
            </ul>

            <p><strong>{dict.collectedInfo.subTitle2}</strong></p>
            <p>{dict.collectedInfo.p2}</p>

            <p><strong>{dict.collectedInfo.subTitle3}</strong></p>
            <p><strong>{dict.collectedInfo.p3_1}</strong></p>
            <p>{dict.collectedInfo.p3_2}</p>
            <p>{dict.collectedInfo.p3_3}</p>
            <p>{dict.collectedInfo.p3_4}</p>
            <p dangerouslySetInnerHTML={{ __html: dict.collectedInfo.p3_5 }} />
            <p dangerouslySetInnerHTML={{ __html: dict.collectedInfo.p3_6 }} />
            <p>{dict.collectedInfo.p3_7}</p>

            <p><strong>{dict.collectedInfo.subTitle4}</strong></p>
            <ul>
                <li>{dict.collectedInfo.list2.item1}</li>
                <li>{dict.collectedInfo.list2.item2}</li>
            </ul>

            <h2 id="how-we-use">{dict.howWeUse.title}</h2>
            <p>{dict.howWeUse.p1}</p>
            <ul>
                {Object.values(dict.howWeUse.list).map((item, index) => (
                    <li key={index}>{item}</li>
                ))}
            </ul>

            <h2 id="sharing-info">{dict.sharingInfo.title}</h2>
            <p>{dict.sharingInfo.p1}</p>
            <ul>
                {Object.values(dict.sharingInfo.list).map((item, index) => (
                    <li key={index}>{item}</li>
                ))}
            </ul>
            
            <h2 id="security">{dict.security.title}</h2>
            <p>{dict.security.p1}</p>
            
            <h2 id="retention">{dict.retention.title}</h2>
            <p>{dict.retention.p1}</p>
            
            <h2 id="your-rights">{dict.yourRights.title}</h2>
            <p>{dict.yourRights.p1}</p>
            
            <h2 id="cross-border">{dict.crossBorder.title}</h2>
            <p>{dict.crossBorder.p1}</p>
            
            <h2 id="minors">{dict.minors.title}</h2>
            <p>{dict.minors.p1}</p>
            
            <h2 id="changes">{dict.changes.title}</h2>
            <p>{dict.changes.p1}</p>
            
            <h2 id="contact">{dict.contact.title}</h2>
            <p>{dict.contact.p1}</p>
            <p dangerouslySetInnerHTML={{ __html: dict.contact.companyName.replace('{companyNameLegal}', companyNameLegal).replace('{companyNumber}', companyNumber) }} />
            <p>{dict.contact.email} <a href={`mailto:${companyEmail}`} className="text-cyan-600 hover:text-cyan-700">{companyEmail}</a></p>
            <p dangerouslySetInnerHTML={{ __html: dict.contact.address.replace('{companyRegisteredAddress}', companyRegisteredAddress) }} />
          </article>
        </div>
      </div>
    </>
  );
};

export default PrivacyPolicyClient;
--- End of Content for PrivacyPolicyClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\privacy-policy\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/legal/privacy-policy/page.tsx
import React from 'react';
import { getDictionary } from '@/lib/dictionaries';
import { Locale } from '@/../i18n-config';
import PrivacyPolicyClient from './PrivacyPolicyClient';

// Server Component
export default async function PrivacyPolicyPage({
  params: { locale },
}: {
  params: { locale: Locale };
}) {
  const dictionary = await getDictionary(locale);

  return (
    <PrivacyPolicyClient
      dict={dictionary.auth.legal.privacyPolicy}
      locale={locale}
    />
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\terms-of-service
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\terms-of-service\TermsOfServiceClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/legal/terms-of-service/TermsOfServiceClient.tsx
'use client';

import React from 'react';
import Head from 'next/head';
import { TermsOfServiceDict } from '@/types/dictionaries/auth';

interface TermsOfServiceClientProps {
  dict: TermsOfServiceDict;
  locale: string;
}

const TermsOfServiceClient: React.FC<TermsOfServiceClientProps> = ({ dict, locale }) => {
    const brandName = 'NeshamaTech';
    const companyNameLegal = `ג'ואיש מאצ'פוינט בע"מ`;
    const companyNumber = '517172631';
    const lastUpdatedDate = '11 באוגוסט 2025';
    const supportEmail = 'neshamatech.jsmatch@gmail.com';
    const siteUrl = 'https://www.jewishmatchpoint.com';
    const privacyPolicyUrl = '/legal/privacy-policy';
    const jurisdictionDistrict = 'תל-אביב-יפו';
    
    const pageTitle = dict.pageTitle.replace('{brandName}', brandName);
    const pageDescription = dict.pageDescription.replace('{brandName}', brandName);

    return (
        <>
        <Head>
            <title>{pageTitle}</title>
            <meta name="description" content={pageDescription} />
            <meta property="og:title" content={pageTitle} />
            <meta property="og:description" content={pageDescription} />
            <meta property="og:url" content={`${siteUrl}/legal/terms-of-service`} />
            <meta name="twitter:card" content="summary_large_image" />
        </Head>
        <div className="bg-gradient-to-br from-cyan-50 via-white to-pink-50 min-h-screen py-12 px-4 sm:px-6 lg:px-8">
            <div className="container mx-auto max-w-4xl bg-white shadow-xl rounded-lg p-8 sm:p-12">
            <header className="mb-10 text-center border-b pb-6 border-gray-200">
                <h1 className="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 to-pink-500">
                {dict.mainTitle}
                </h1>
                <p className="mt-3 text-lg text-gray-600">
                {dict.subTitle.replace('{brandName}', brandName).replace('{companyNameLegal}', companyNameLegal)}
                </p>
                <p className="mt-2 text-sm text-gray-500">
                {dict.lastUpdated.replace('{lastUpdatedDate}', lastUpdatedDate)}
                </p>
            </header>

            <article
                className="prose prose-lg max-w-none text-gray-700 leading-relaxed"
                dir={locale === 'he' ? 'rtl' : 'ltr'}
            >
                <h2 id="intro">{dict.introduction.title}</h2>
                <p dangerouslySetInnerHTML={{ __html: dict.introduction.p1_1.replace('{companyNameLegal}', companyNameLegal).replace('{companyNumber}', companyNumber) }} />
                <p dangerouslySetInnerHTML={{ __html: dict.introduction.p1_2.replace('{privacyPolicyUrl}', privacyPolicyUrl) }} />
                <p dangerouslySetInnerHTML={{ __html: dict.introduction.p1_3 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.introduction.p1_4 }} />
                <ul>
                    <li dangerouslySetInnerHTML={{ __html: dict.introduction.list.itemA }} />
                    <li dangerouslySetInnerHTML={{ __html: dict.introduction.list.itemB }} />
                    <li dangerouslySetInnerHTML={{ __html: dict.introduction.list.itemC }} />
                </ul>
                <p dangerouslySetInnerHTML={{ __html: dict.introduction.p1_5 }} />
                
                <h2 id="user-account">{dict.userAccount.title}</h2>
                <p dangerouslySetInnerHTML={{ __html: dict.userAccount.p2_1 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.userAccount.p2_2 }} />
                <ul>
                    {Object.values(dict.userAccount.list).map((item, index) => (
                        <li key={index} dangerouslySetInnerHTML={{ __html: item }} />
                    ))}
                </ul>
                <p dangerouslySetInnerHTML={{ __html: dict.userAccount.p2_3 }} />

                <h2 id="service-fees">{dict.serviceFees.title}</h2>
                <p dangerouslySetInnerHTML={{ __html: dict.serviceFees.p3_1 }} />
                <ul>
                    <li dangerouslySetInnerHTML={{ __html: dict.serviceFees.list.itemA }} />
                    <li dangerouslySetInnerHTML={{ __html: dict.serviceFees.list.itemB }} />
                    <li dangerouslySetInnerHTML={{ __html: dict.serviceFees.list.itemC }} />
                </ul>
                <p dangerouslySetInnerHTML={{ __html: dict.serviceFees.p3_2 }} />
                <p>{dict.serviceFees.p3_3}</p>
                <p dangerouslySetInnerHTML={{ __html: dict.serviceFees.p3_4 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.serviceFees.p3_5 }} />

                <h2 id="intellectual-property">{dict.intellectualProperty.title}</h2>
                <p dangerouslySetInnerHTML={{ __html: dict.intellectualProperty.p4_1 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.intellectualProperty.p4_2 }} />
                
                <h2 id="third-party-links">{dict.thirdPartyLinks.title}</h2>
                <p>{dict.thirdPartyLinks.p1}</p>
                
                <h2 id="limitation-of-liability">{dict.limitationOfLiability.title}</h2>
                <p dangerouslySetInnerHTML={{ __html: dict.limitationOfLiability.p6_1 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.limitationOfLiability.p6_2 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.limitationOfLiability.p6_3 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.limitationOfLiability.p6_4 }} />
                
                <h2 id="indemnification">{dict.indemnification.title}</h2>
                <p>{dict.indemnification.p1}</p>

                <h2 id="termination-law">{dict.terminationLaw.title}</h2>
                <p dangerouslySetInnerHTML={{ __html: dict.terminationLaw.p8_1 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.terminationLaw.p8_2.replace('{jurisdictionDistrict}', jurisdictionDistrict) }} />
                <p dangerouslySetInnerHTML={{ __html: dict.terminationLaw.p8_3 }} />

                <h2 id="contact">{dict.contact.title}</h2>
                <p dangerouslySetInnerHTML={{ __html: dict.contact.p9_1 }} />
                <p>
                    <a href={`mailto:${supportEmail}`} className="text-cyan-600 hover:text-cyan-700">{supportEmail}</a>
                </p>
                <p dangerouslySetInnerHTML={{ __html: dict.contact.p9_2 }} />
            </article>
            </div>
        </div>
        </>
    );
};

export default TermsOfServiceClient;
--- End of Content for TermsOfServiceClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\terms-of-service\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/legal/terms-of-service/page.tsx
import React from 'react';
import { getDictionary } from '@/lib/dictionaries';
import { Locale } from '@/../i18n-config';
import TermsOfServiceClient from './TermsOfServiceClient';

// Server Component
export default async function TermsOfServicePage({
  params: { locale },
}: {
  params: { locale: Locale };
}) {
  const dictionary = await getDictionary(locale);

  return (
    <TermsOfServiceClient
      dict={dictionary.auth.legal.termsOfService}
      locale={locale}
    />
  );
}
--- End of Content for page.tsx ---

--- End of Content for legal_contents.txt ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\accessibility-statement
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\accessibility-statement\AccessibilityStatementClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/legal/accessibility-statement/AccessibilityStatementClient.tsx
'use client';

import React from 'react';
import Head from 'next/head';
import {
  Accessibility,
  CheckCircle,
  Type,
  Contrast,
  Eye,
  Hand,
  Speech,
  MousePointer,
  Sparkles,
} from 'lucide-react';
import { AccessibilityStatementDict } from '@/types/dictionaries/auth';

// Helper component for creating feature list items
const FeatureItem: React.FC<{
  icon: React.ElementType;
  title: string;
  description: string;
}> = ({ icon: Icon, title, description }) => (
  <li className="flex items-start gap-4">
    <div className="flex-shrink-0 mt-1 p-2 bg-cyan-100 rounded-full">
      <Icon className="w-5 h-5 text-cyan-700" />
    </div>
    <div>
      <h3 className="font-semibold text-gray-800">{title}</h3>
      <p className="text-gray-600 text-sm">{description}</p>
    </div>
  </li>
);

interface AccessibilityStatementClientProps {
  dict: AccessibilityStatementDict;
  locale: string;
}

const AccessibilityStatementClient: React.FC<AccessibilityStatementClientProps> = ({ dict, locale }) => {
  const brandName = 'NeshamaTech';
  const companyNameLegal = `ג'ואיש מאצ'פוינט בע"מ`; // This can also be moved to dict if needed
  const lastUpdatedDate = '28 באוגוסט 2025';
  const accessibilityCoordinatorName = 'איתן אנגלרד';
  const accessibilityCoordinatorEmail = 'eytanenglard@gmail.com';

  const pageTitle = dict.pageTitle.replace('{brandName}', brandName);
  const pageDescription = dict.pageDescription.replace('{brandName}', brandName);

  return (
    <>
      <Head>
        <title>{pageTitle}</title>
        <meta name="description" content={pageDescription} />
        <meta property="og:title" content={pageTitle} />
        <meta property="og:description" content={pageDescription} />
      </Head>
      <div className="bg-gradient-to-br from-cyan-50 via-white to-pink-50 min-h-screen py-12 px-4 sm:px-6 lg:px-8">
        <div className="container mx-auto max-w-4xl bg-white shadow-xl rounded-2xl p-8 sm:p-12 border border-gray-200/50">
          <header className="mb-10 text-center border-b pb-6 border-gray-200">
            <div className="inline-block p-4 bg-gradient-to-r from-cyan-100 to-pink-100 rounded-2xl mb-4">
              <Accessibility className="w-10 h-10 text-cyan-700" />
            </div>
            <h1 className="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-600 to-pink-600">
              {dict.mainTitle}
            </h1>
            <p className="mt-3 text-lg text-gray-600">
              {dict.siteName.replace('{brandName}', brandName)}
            </p>
            <p className="mt-2 text-sm text-gray-500">
              {dict.lastUpdated.replace('{lastUpdatedDate}', lastUpdatedDate)}
            </p>
          </header>

          <article
            className="prose prose-lg max-w-none text-gray-700 leading-relaxed"
            dir={locale === 'he' ? 'rtl' : 'ltr'}
          >
            <h2 id="commitment">{dict.commitment.title}</h2>
            <p dangerouslySetInnerHTML={{ __html: dict.commitment.p1.replace('{companyNameLegal}', companyNameLegal).replace('{brandName}', brandName) }} />
            <p>{dict.commitment.p2}</p>
            
            <h2 id="level">{dict.level.title}</h2>
            <ul>
                <li dangerouslySetInnerHTML={{ __html: dict.level.item1 }} />
                <li dangerouslySetInnerHTML={{ __html: dict.level.item2 }} />
            </ul>

            <h2 id="features">{dict.features.title}</h2>
            <p>{dict.features.p1}</p>

            <h3 className="flex items-center gap-3">
              <Sparkles className="text-blue-600" />
              {dict.features.dedicatedToolbarTitle}
            </h3>
            <p>{dict.features.p2}</p>
            <ul className="space-y-4 not-prose list-none p-0">
                <FeatureItem icon={Type} title={dict.features.fontAdjustment.title} description={dict.features.fontAdjustment.description} />
                <FeatureItem icon={Contrast} title={dict.features.contrastModes.title} description={dict.features.contrastModes.description} />
                <FeatureItem icon={Eye} title={dict.features.readableFont.title} description={dict.features.readableFont.description} />
                <FeatureItem icon={MousePointer} title={dict.features.largeCursor.title} description={dict.features.largeCursor.description} />
                <FeatureItem icon={Speech} title={dict.features.textToSpeech.title} description={dict.features.textToSpeech.description} />
                <FeatureItem icon={Hand} title={dict.features.reduceMotion.title} description={dict.features.reduceMotion.description} />
            </ul>
            
            <h3 className="flex items-center gap-3 mt-8">
              <CheckCircle className="text-emerald-600" />
              {dict.features.additionalAdjustmentsTitle}
            </h3>
            <ul>
              <li dangerouslySetInnerHTML={{ __html: dict.features.keyboardNav }} />
              <li dangerouslySetInnerHTML={{ __html: dict.features.screenReader }} />
              <li dangerouslySetInnerHTML={{ __html: dict.features.altText }} />
              <li dangerouslySetInnerHTML={{ __html: dict.features.accessibleForms }} />
              <li dangerouslySetInnerHTML={{ __html: dict.features.noFlashing }} />
            </ul>

            <h2 id="limitations">{dict.limitations.title}</h2>
            <p>{dict.limitations.p1}</p>
            <p>{dict.limitations.p2}</p>

            <h2 id="contact">{dict.contact.title}</h2>
            <p>{dict.contact.p1}</p>
            <ul>
                <li dangerouslySetInnerHTML={{ __html: dict.contact.name.replace('{accessibilityCoordinatorName}', accessibilityCoordinatorName) }} />
                <li>{dict.contact.email} <a href={`mailto:${accessibilityCoordinatorEmail}`} className="text-cyan-600 hover:text-cyan-700">{accessibilityCoordinatorEmail}</a></li>
            </ul>
            <p>{dict.contact.p2}</p>
            <p dangerouslySetInnerHTML={{ __html: dict.contact.p3.replace('{lastUpdatedDate}', lastUpdatedDate) }} />
          </article>
        </div>
      </div>
    </>
  );
};

export default AccessibilityStatementClient;
--- End of Content for AccessibilityStatementClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\accessibility-statement\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/legal/accessibility-statement/page.tsx
import React from 'react';
import { getDictionary } from '@/lib/dictionaries';
import { Locale } from '@/../i18n-config';
import AccessibilityStatementClient from './AccessibilityStatementClient';

// ▼▼▼ כאן השינוי ▼▼▼
type AccessibilityStatementPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function AccessibilityStatementPage({ params }: AccessibilityStatementPageProps) {
  const { locale } = await params; // הוספת await
  const dictionary = await getDictionary(locale);

  return (
    <AccessibilityStatementClient
      dict={dictionary.auth.legal.accessibilityStatement}
      locale={locale}
    />
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\privacy-policy
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\privacy-policy\PrivacyPolicyClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/legal/privacy-policy/PrivacyPolicyClient.tsx
'use client';

import React from 'react';
import Head from 'next/head';
import { PrivacyPolicyDict } from '@/types/dictionaries/auth';

interface PrivacyPolicyClientProps {
  dict: PrivacyPolicyDict;
  locale: string;
}

const PrivacyPolicyClient: React.FC<PrivacyPolicyClientProps> = ({ dict, locale }) => {
  const brandName = `נשמה טק (NeshamaTech)`;
  const companyNameLegal = `ג'ואיש מאצ'פוינט בע"מ`;
  const companyNumber = '517172631';
  const lastUpdatedDate = '11 באוגוסט 2025';
  const companyEmail = 'neshamatech.jsmatch@gmail.com';
  const siteUrl = 'https://www.jewishmatchpoint.com';
  const companyRegisteredAddress = 'גולומב 7, רעננה, ישראל';

  const pageTitle = dict.pageTitle.replace('{brandName}', brandName);
  const pageDescription = dict.pageDescription.replace('{brandName}', brandName);

  return (
    <>
      <Head>
        <title>{pageTitle}</title>
        <meta name="description" content={pageDescription} />
        <meta property="og:title" content={pageTitle} />
        <meta property="og:description" content={pageDescription} />
        <meta property="og:url" content={`${siteUrl}/legal/privacy-policy`} />
        <meta name="twitter:card" content="summary_large_image" />
      </Head>
      <div className="bg-gradient-to-br from-cyan-50 via-white to-pink-50 min-h-screen py-12 px-4 sm:px-6 lg:px-8">
        <div className="container mx-auto max-w-4xl bg-white shadow-xl rounded-lg p-8 sm:p-12">
          <header className="mb-10 text-center border-b pb-6 border-gray-200">
            <h1 className="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 to-pink-500">
              {dict.mainTitle}
            </h1>
            <p className="mt-2 text-sm text-gray-500">
              {dict.lastUpdated.replace('{lastUpdatedDate}', lastUpdatedDate)}
            </p>
          </header>

          <article
            className="prose prose-lg max-w-none text-gray-700 leading-relaxed"
            dir={locale === 'he' ? 'rtl' : 'ltr'}
          >
            <p><strong>{dict.introduction.title}</strong></p>
            <p>{dict.introduction.p1.replace('{companyNameLegal}', companyNameLegal).replace('{companyNumber}', companyNumber)}</p>
            <p>{dict.introduction.p2}</p>
            <p>{dict.introduction.p3}</p>
            
            <h2 id="consent">{dict.consent.title}</h2>
            <p>{dict.consent.p1}</p>
            <p>{dict.consent.p2}</p>
            <p>{dict.consent.p3.replace('{companyNameLegal}', companyNameLegal).replace('{companyNumber}', companyNumber).replace('{companyRegisteredAddress}', companyRegisteredAddress)}</p>
            <p dangerouslySetInnerHTML={{ __html: dict.consent.p4 }} />

            <h2 id="collected-info">{dict.collectedInfo.title}</h2>
            <p>{dict.collectedInfo.p1}</p>
            <p><strong>{dict.collectedInfo.subTitle1}</strong></p>
            <ul>
                <li>{dict.collectedInfo.list1.item1}</li>
                <li>
                    {dict.collectedInfo.list1.item2.title}
                    <ul>
                        <li>{dict.collectedInfo.list1.item2.subItem1}</li>
                        <li>{dict.collectedInfo.list1.item2.subItem2}</li>
                        <li>{dict.collectedInfo.list1.item2.subItem3}</li>
                    </ul>
                </li>
                <li>{dict.collectedInfo.list1.item3}</li>
                <li>{dict.collectedInfo.list1.item4}</li>
                <li>{dict.collectedInfo.list1.item5}</li>
                <li>{dict.collectedInfo.list1.item6}</li>
            </ul>

            <p><strong>{dict.collectedInfo.subTitle2}</strong></p>
            <p>{dict.collectedInfo.p2}</p>

            <p><strong>{dict.collectedInfo.subTitle3}</strong></p>
            <p><strong>{dict.collectedInfo.p3_1}</strong></p>
            <p>{dict.collectedInfo.p3_2}</p>
            <p>{dict.collectedInfo.p3_3}</p>
            <p>{dict.collectedInfo.p3_4}</p>
            <p dangerouslySetInnerHTML={{ __html: dict.collectedInfo.p3_5 }} />
            <p dangerouslySetInnerHTML={{ __html: dict.collectedInfo.p3_6 }} />
            <p>{dict.collectedInfo.p3_7}</p>

            <p><strong>{dict.collectedInfo.subTitle4}</strong></p>
            <ul>
                <li>{dict.collectedInfo.list2.item1}</li>
                <li>{dict.collectedInfo.list2.item2}</li>
            </ul>

            <h2 id="how-we-use">{dict.howWeUse.title}</h2>
            <p>{dict.howWeUse.p1}</p>
            <ul>
                {Object.values(dict.howWeUse.list).map((item, index) => (
                    <li key={index}>{item}</li>
                ))}
            </ul>

            <h2 id="sharing-info">{dict.sharingInfo.title}</h2>
            <p>{dict.sharingInfo.p1}</p>
            <ul>
                {Object.values(dict.sharingInfo.list).map((item, index) => (
                    <li key={index}>{item}</li>
                ))}
            </ul>
            
            <h2 id="security">{dict.security.title}</h2>
            <p>{dict.security.p1}</p>
            
            <h2 id="retention">{dict.retention.title}</h2>
            <p>{dict.retention.p1}</p>
            
            <h2 id="your-rights">{dict.yourRights.title}</h2>
            <p>{dict.yourRights.p1}</p>
            
            <h2 id="cross-border">{dict.crossBorder.title}</h2>
            <p>{dict.crossBorder.p1}</p>
            
            <h2 id="minors">{dict.minors.title}</h2>
            <p>{dict.minors.p1}</p>
            
            <h2 id="changes">{dict.changes.title}</h2>
            <p>{dict.changes.p1}</p>
            
            <h2 id="contact">{dict.contact.title}</h2>
            <p>{dict.contact.p1}</p>
            <p dangerouslySetInnerHTML={{ __html: dict.contact.companyName.replace('{companyNameLegal}', companyNameLegal).replace('{companyNumber}', companyNumber) }} />
            <p>{dict.contact.email} <a href={`mailto:${companyEmail}`} className="text-cyan-600 hover:text-cyan-700">{companyEmail}</a></p>
            <p dangerouslySetInnerHTML={{ __html: dict.contact.address.replace('{companyRegisteredAddress}', companyRegisteredAddress) }} />
          </article>
        </div>
      </div>
    </>
  );
};

export default PrivacyPolicyClient;
--- End of Content for PrivacyPolicyClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\privacy-policy\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/legal/privacy-policy/page.tsx
import React, { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import { Locale } from '@/../i18n-config';
import PrivacyPolicyClient from './PrivacyPolicyClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

type PrivacyPolicyPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function PrivacyPolicyPage({
  params,
}: PrivacyPolicyPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <Suspense
      fallback={<StandardizedLoadingSpinner text="טוען מדיניות פרטיות..." />}
    >
      <PrivacyPolicyClient
        dict={dictionary.auth.legal.privacyPolicy}
        locale={locale}
      />
    </Suspense>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\terms-of-service
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\terms-of-service\TermsOfServiceClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/legal/terms-of-service/TermsOfServiceClient.tsx
'use client';

import React from 'react';
import Head from 'next/head';
import { TermsOfServiceDict } from '@/types/dictionaries/auth';

interface TermsOfServiceClientProps {
  dict: TermsOfServiceDict;
  locale: string;
}

const TermsOfServiceClient: React.FC<TermsOfServiceClientProps> = ({ dict, locale }) => {
    const brandName = 'NeshamaTech';
    const companyNameLegal = `ג'ואיש מאצ'פוינט בע"מ`;
    const companyNumber = '517172631';
    const lastUpdatedDate = '11 באוגוסט 2025';
    const supportEmail = 'neshamatech.jsmatch@gmail.com';
    const siteUrl = 'https://www.jewishmatchpoint.com';
    const privacyPolicyUrl = '/legal/privacy-policy';
    const jurisdictionDistrict = 'תל-אביב-יפו';
    
    const pageTitle = dict.pageTitle.replace('{brandName}', brandName);
    const pageDescription = dict.pageDescription.replace('{brandName}', brandName);

    return (
        <>
        <Head>
            <title>{pageTitle}</title>
            <meta name="description" content={pageDescription} />
            <meta property="og:title" content={pageTitle} />
            <meta property="og:description" content={pageDescription} />
            <meta property="og:url" content={`${siteUrl}/legal/terms-of-service`} />
            <meta name="twitter:card" content="summary_large_image" />
        </Head>
        <div className="bg-gradient-to-br from-cyan-50 via-white to-pink-50 min-h-screen py-12 px-4 sm:px-6 lg:px-8">
            <div className="container mx-auto max-w-4xl bg-white shadow-xl rounded-lg p-8 sm:p-12">
            <header className="mb-10 text-center border-b pb-6 border-gray-200">
                <h1 className="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 to-pink-500">
                {dict.mainTitle}
                </h1>
                <p className="mt-3 text-lg text-gray-600">
                {dict.subTitle.replace('{brandName}', brandName).replace('{companyNameLegal}', companyNameLegal)}
                </p>
                <p className="mt-2 text-sm text-gray-500">
                {dict.lastUpdated.replace('{lastUpdatedDate}', lastUpdatedDate)}
                </p>
            </header>

            <article
                className="prose prose-lg max-w-none text-gray-700 leading-relaxed"
                dir={locale === 'he' ? 'rtl' : 'ltr'}
            >
                <h2 id="intro">{dict.introduction.title}</h2>
                <p dangerouslySetInnerHTML={{ __html: dict.introduction.p1_1.replace('{companyNameLegal}', companyNameLegal).replace('{companyNumber}', companyNumber) }} />
                <p dangerouslySetInnerHTML={{ __html: dict.introduction.p1_2.replace('{privacyPolicyUrl}', privacyPolicyUrl) }} />
                <p dangerouslySetInnerHTML={{ __html: dict.introduction.p1_3 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.introduction.p1_4 }} />
                <ul>
                    <li dangerouslySetInnerHTML={{ __html: dict.introduction.list.itemA }} />
                    <li dangerouslySetInnerHTML={{ __html: dict.introduction.list.itemB }} />
                    <li dangerouslySetInnerHTML={{ __html: dict.introduction.list.itemC }} />
                </ul>
                <p dangerouslySetInnerHTML={{ __html: dict.introduction.p1_5 }} />
                
                <h2 id="user-account">{dict.userAccount.title}</h2>
                <p dangerouslySetInnerHTML={{ __html: dict.userAccount.p2_1 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.userAccount.p2_2 }} />
                <ul>
                    {Object.values(dict.userAccount.list).map((item, index) => (
                        <li key={index} dangerouslySetInnerHTML={{ __html: item }} />
                    ))}
                </ul>
                <p dangerouslySetInnerHTML={{ __html: dict.userAccount.p2_3 }} />

                <h2 id="service-fees">{dict.serviceFees.title}</h2>
                <p dangerouslySetInnerHTML={{ __html: dict.serviceFees.p3_1 }} />
                <ul>
                    <li dangerouslySetInnerHTML={{ __html: dict.serviceFees.list.itemA }} />
                    <li dangerouslySetInnerHTML={{ __html: dict.serviceFees.list.itemB }} />
                    <li dangerouslySetInnerHTML={{ __html: dict.serviceFees.list.itemC }} />
                </ul>
                <p dangerouslySetInnerHTML={{ __html: dict.serviceFees.p3_2 }} />
                <p>{dict.serviceFees.p3_3}</p>
                <p dangerouslySetInnerHTML={{ __html: dict.serviceFees.p3_4 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.serviceFees.p3_5 }} />

                <h2 id="intellectual-property">{dict.intellectualProperty.title}</h2>
                <p dangerouslySetInnerHTML={{ __html: dict.intellectualProperty.p4_1 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.intellectualProperty.p4_2 }} />
                
                <h2 id="third-party-links">{dict.thirdPartyLinks.title}</h2>
                <p>{dict.thirdPartyLinks.p1}</p>
                
                <h2 id="limitation-of-liability">{dict.limitationOfLiability.title}</h2>
                <p dangerouslySetInnerHTML={{ __html: dict.limitationOfLiability.p6_1 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.limitationOfLiability.p6_2 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.limitationOfLiability.p6_3 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.limitationOfLiability.p6_4 }} />
                
                <h2 id="indemnification">{dict.indemnification.title}</h2>
                <p>{dict.indemnification.p1}</p>

                <h2 id="termination-law">{dict.terminationLaw.title}</h2>
                <p dangerouslySetInnerHTML={{ __html: dict.terminationLaw.p8_1 }} />
                <p dangerouslySetInnerHTML={{ __html: dict.terminationLaw.p8_2.replace('{jurisdictionDistrict}', jurisdictionDistrict) }} />
                <p dangerouslySetInnerHTML={{ __html: dict.terminationLaw.p8_3 }} />

                <h2 id="contact">{dict.contact.title}</h2>
                <p dangerouslySetInnerHTML={{ __html: dict.contact.p9_1 }} />
                <p>
                    <a href={`mailto:${supportEmail}`} className="text-cyan-600 hover:text-cyan-700">{supportEmail}</a>
                </p>
                <p dangerouslySetInnerHTML={{ __html: dict.contact.p9_2 }} />
            </article>
            </div>
        </div>
        </>
    );
};

export default TermsOfServiceClient;
--- End of Content for TermsOfServiceClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\legal\terms-of-service\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/legal/terms-of-service/page.tsx
import React, { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import { Locale } from '@/../i18n-config';
import TermsOfServiceClient from './TermsOfServiceClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

type TermsOfServicePageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function TermsOfServicePage({
  params,
}: TermsOfServicePageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <Suspense
      fallback={<StandardizedLoadingSpinner text="טוען תנאי שימוש..." />}
    >
      <TermsOfServiceClient
        dict={dictionary.auth.legal.termsOfService}
        locale={locale}
      />
    </Suspense>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\questionnaire
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\questionnaire\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/questionnaire/page.tsx
import { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import { Locale } from '../../../../i18n-config';
import QuestionnairePageClient from '@/components/questionnaire/QuestionnairePageClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

function Loading() {
  return (
    <StandardizedLoadingSpinner
      text="טוען את השאלון..."
      subtext="מכינים את השאלות עבורך"
    />
  );
}

type PageProps = {
  params: Promise<{ locale: Locale }>;
  searchParams: Promise<{ [key: string]: string | string[] | undefined }>;
};

export default async function Page({ params, searchParams }: PageProps) {
  const [{ locale }, resolvedSearchParams] = await Promise.all([
    params,
    searchParams,
  ]);

  const dictionary = await getDictionary(locale);

  console.log(
    `\n✅ [LOG | /questionnaire/page.tsx SERVER SIDE] Received searchParams:`,
    resolvedSearchParams,
    `\n`
  );

  return (
    <Suspense fallback={<Loading />}>
      <QuestionnairePageClient
        dict={dictionary.questionnaire}
        locale={locale}
      />
    </Suspense>
  );
}
--- End of Content for page.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\questionnaire\questionnaire_contents.txt
--------------------------------------------------------------------------------
Content:
################################################################################
# Directory Content Map For: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\questionnaire
# Generated on: 2025-11-15 22:20:32
################################################################################

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\questionnaire
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\questionnaire\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/questionnaire/page.tsx
import { Suspense } from 'react';
import { Loader2 } from 'lucide-react';
import { getDictionary } from '@/lib/dictionaries';
import { Locale } from '../../../../i18n-config';
import QuestionnairePageClient from '@/components/questionnaire/QuestionnairePageClient';

function Loading() {
  return (
    <div className="flex h-screen w-full items-center justify-center bg-slate-50">
      <Loader2 className="h-10 w-10 animate-spin text-blue-500" />
      <p className="ml-4 rtl:mr-4 text-lg text-gray-700">טוען שאלון...</p>
    </div>
  );
}

// ▼▼▼ כאן השינוי ▼▼▼
type PageProps = {
  params: Promise<{ locale: Locale }>;
  // גם searchParams הוא עכשיו Promise
  searchParams: Promise<{ [key: string]: string | string[] | undefined }>;
};

export default async function Page({ params, searchParams }: PageProps) {
  // ממתינים לשני ה-Promises במקביל לביצועים טובים יותר
  const [{ locale }, resolvedSearchParams] = await Promise.all([
    params,
    searchParams,
  ]);
  
  const dictionary = await getDictionary(locale);

  console.log(
    `\n✅ [LOG | /questionnaire/page.tsx SERVER SIDE] Received searchParams:`,
    resolvedSearchParams, // משתמשים במשתנה החדש שחיכה ל-Promise
    `\n`
  );

  return (
    <Suspense fallback={<Loading />}>
      <QuestionnairePageClient
        dict={dictionary.questionnaire}
        locale={locale}
      />
    </Suspense>
  );
}
--- End of Content for page.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\questionnaire\questionnaire_contents.txt
--------------------------------------------------------------------------------
[This is the output log file itself. Content not included.]

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\questionnaire\complete
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\questionnaire\complete\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/questionnaire/complete/page.tsx
import QuestionnaireComplete from '@/components/questionnaire/QuestionnaireComplete';
import { getDictionary } from '@/lib/dictionaries';
import { Locale } from '../../../../../i18n-config';

// ▼▼▼ כאן השינוי ▼▼▼
type PageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function Page({ params }: PageProps) {
  const { locale } = await params; // הוספת await ושינוי הגישה ל-locale
  const dictionary = await getDictionary(locale);

  return (
    <QuestionnaireComplete
      dict={dictionary.questionnaire.questionnaireCompletePage}
    />
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\questionnaire\restore
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\questionnaire\restore\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/questionnaire/restore/page.tsx
import { Suspense } from 'react';
import { Loader2 } from 'lucide-react';
import { getDictionary } from '@/lib/dictionaries';
import { Locale } from '../../../../../i18n-config';
import QuestionnaireRestore from '@/components/questionnaire/QuestionnaireRestore';

function Loading() {
  return (
    <div className="flex h-screen w-full items-center justify-center">
      <Loader2 className="h-10 w-10 animate-spin text-cyan-600" />
    </div>
  );
}

// ▼▼▼ כאן השינוי ▼▼▼
type RestorePageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function RestorePage({ params }: RestorePageProps) {
  const { locale } = await params; // הוספת await
  const dictionary = await getDictionary(locale);

  return (
    <Suspense fallback={<Loading />}>
      <QuestionnaireRestore
        dict={dictionary.questionnaire.questionnaireRestore}
      />
    </Suspense>
  );
}
--- End of Content for page.tsx ---

--- End of Content for questionnaire_contents.txt ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\questionnaire\complete
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\questionnaire\complete\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/questionnaire/complete/page.tsx
import QuestionnaireComplete from '@/components/questionnaire/QuestionnaireComplete';
import { getDictionary } from '@/lib/dictionaries';
import { Locale } from '../../../../../i18n-config';

// ▼▼▼ כאן השינוי ▼▼▼
type PageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function Page({ params }: PageProps) {
  const { locale } = await params; // הוספת await ושינוי הגישה ל-locale
  const dictionary = await getDictionary(locale);

  return (
    <QuestionnaireComplete
      dict={dictionary.questionnaire.questionnaireCompletePage}
    />
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\questionnaire\restore
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\questionnaire\restore\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/questionnaire/restore/page.tsx
import { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import { Locale } from '../../../../../i18n-config';
import QuestionnaireRestore from '@/components/questionnaire/QuestionnaireRestore';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

function Loading() {
  return (
    <StandardizedLoadingSpinner
      text="משחזר שאלון..."
      subtext="אנא המתן בזמן שאנו טוענים את הנתונים שלך"
    />
  );
}

type RestorePageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function RestorePage({ params }: RestorePageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <Suspense fallback={<Loading />}>
      <QuestionnaireRestore
        dict={dictionary.questionnaire.questionnaireRestore}
      />
    </Suspense>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\referral
================================================================================

(This directory contains subdirectories but no files directly. See subdirectories below.)

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\referral\dashboard
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\referral\dashboard\dashboard_contents.txt
--------------------------------------------------------------------------------
Content:
################################################################################
# Directory Content Map For: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\referral\dashboard
# Generated on: 2025-12-16 09:48:54
# Filter: Only content of code files (.bat, .c, .cfg, .conf, .cpp, .cs, .css, .go, .h, .html, .ini, .java, .js, .json, .jsx, .kt, .less, .md, .php, .py, .rb, .rs, .scss, .sh, .sql, .swift, .ts, .tsx, .txt, .xml, .yaml, .yml) is included.
################################################################################

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\referral\dashboard
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\referral\dashboard\dashboard_contents.txt
--------------------------------------------------------------------------------
[This is the output log file itself. Content not included.]

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\referral\dashboard\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/referral/dashboard/page.tsx
// דשבורד מפנה - קמפיין חנוכה "מוסיפים אור בחנוכה"

'use client';
import Link from 'next/link';
import { useSearchParams, useRouter } from 'next/navigation';

import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import Image from 'next/image';
import {
  Copy,
  Check,
  Share2,
  Trophy,
  Users,
  MousePointer,
  UserCheck,
  Clock,
  ChevronRight,
  Loader2,
  AlertCircle,
  Crown,
  X,
  MessageCircle,
  Forward,
  Sparkles,
  Flame,
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

// ================== Hanukkah Config ==================
const HANUKKAH_CONFIG = {
  startDate: new Date('2024-12-25'), // כ"ה כסלו - נר ראשון
  endDate: new Date('2025-01-02'), // סוף חנוכה
  currentCandle: 1, // נר ראשון
};

// חישוב איזה נר היום
const getCurrentCandle = (): number => {
  const today = new Date();
  const start = HANUKKAH_CONFIG.startDate;
  const diffTime = today.getTime() - start.getTime();
  const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
  return Math.min(Math.max(diffDays + 1, 1), 8);
};

// ================== Hanukkiah SVG Component ==================
interface HanukkiahProps {
  litCandles: number;
  className?: string;
}

const Hanukkiah: React.FC<HanukkiahProps> = ({
  litCandles,
  className = '',
}) => {
  const candlePositions = [
    { x: 25, height: 35 }, // נר 1 (שמאל קיצוני)
    { x: 55, height: 35 }, // נר 2
    { x: 85, height: 35 }, // נר 3
    { x: 115, height: 35 }, // נר 4
    { x: 175, height: 50 }, // שמש (מוגבה) - אמצע
    { x: 205, height: 35 }, // נר 5
    { x: 235, height: 35 }, // נר 6
    { x: 265, height: 35 }, // נר 7
    { x: 295, height: 35 }, // נר 8 (ימין קיצוני)
  ];

  // סדר ההדלקה: שמש (4) תמיד דולק, ואז מימין לשמאל
  const getLitStatus = (index: number): boolean => {
    if (index === 4) return true; // שמש תמיד דולק
    if (index > 4) {
      // נרות מימין לשמש (5,6,7,8 -> נר 1,2,3,4)
      const candleNumber = index - 4;
      return candleNumber <= litCandles;
    } else {
      // נרות משמאל לשמש (0,1,2,3 -> נר 8,7,6,5)
      const candleNumber = 8 - index;
      return candleNumber <= litCandles;
    }
  };

  return (
    <svg
      viewBox="0 0 320 120"
      className={className}
      xmlns="http://www.w3.org/2000/svg"
    >
      {/* בסיס החנוכייה */}
      <defs>
        <linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stopColor="#F6E05E" />
          <stop offset="50%" stopColor="#D69E2E" />
          <stop offset="100%" stopColor="#B7791F" />
        </linearGradient>
        <linearGradient id="flameGradient" x1="0%" y1="100%" x2="0%" y2="0%">
          <stop offset="0%" stopColor="#F6AD55" />
          <stop offset="50%" stopColor="#ED8936" />
          <stop offset="100%" stopColor="#FBBF24" />
        </linearGradient>
        <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="3" result="coloredBlur" />
          <feMerge>
            <feMergeNode in="coloredBlur" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>
      </defs>

      {/* בסיס */}
      <rect
        x="60"
        y="100"
        width="200"
        height="8"
        rx="2"
        fill="url(#goldGradient)"
      />
      <rect
        x="150"
        y="85"
        width="20"
        height="20"
        rx="2"
        fill="url(#goldGradient)"
      />

      {/* נרות */}
      {candlePositions.map((pos, index) => {
        const isLit = getLitStatus(index);
        const isShamash = index === 4;
        const baseY = isShamash ? 35 : 50;

        return (
          <g key={index}>
            {/* גוף הנר */}
            <rect
              x={pos.x - 4}
              y={baseY}
              width="8"
              height={pos.height}
              rx="2"
              fill={isShamash ? '#FBD38D' : '#E2E8F0'}
              stroke="url(#goldGradient)"
              strokeWidth="1"
            />

            {/* פתילה */}
            <line
              x1={pos.x}
              y1={baseY}
              x2={pos.x}
              y2={baseY - 5}
              stroke="#4A5568"
              strokeWidth="1"
            />

            {/* להבה */}
            {isLit && (
              <g filter="url(#glow)">
                <motion.ellipse
                  cx={pos.x}
                  cy={baseY - 12}
                  rx="5"
                  ry="10"
                  fill="url(#flameGradient)"
                  initial={{ scaleY: 0.8, opacity: 0.8 }}
                  animate={{
                    scaleY: [0.8, 1, 0.9, 1, 0.8],
                    opacity: [0.8, 1, 0.9, 1, 0.8],
                  }}
                  transition={{
                    duration: 1.5,
                    repeat: Infinity,
                    ease: 'easeInOut',
                  }}
                />
                <motion.ellipse
                  cx={pos.x}
                  cy={baseY - 14}
                  rx="2"
                  ry="5"
                  fill="#FEF3C7"
                  initial={{ scaleY: 0.9 }}
                  animate={{
                    scaleY: [0.9, 1.1, 0.9],
                  }}
                  transition={{
                    duration: 1,
                    repeat: Infinity,
                    ease: 'easeInOut',
                  }}
                />
              </g>
            )}
          </g>
        );
      })}

      {/* עמודי החנוכייה */}
      <rect x="157" y="50" width="6" height="35" fill="url(#goldGradient)" />
      {[25, 55, 85, 115, 205, 235, 265, 295].map((x, i) => (
        <g key={`stand-${i}`}>
          <line
            x1={x}
            y1="85"
            x2={x}
            y2="100"
            stroke="url(#goldGradient)"
            strokeWidth="3"
          />
          <line
            x1={x}
            y1="85"
            x2="160"
            y2="85"
            stroke="url(#goldGradient)"
            strokeWidth="2"
          />
        </g>
      ))}
    </svg>
  );
};

// ================== Types ==================
interface ReferrerStats {
  code: string;
  name: string;
  tier: 'AMBASSADOR' | 'COMMUNITY';
  clickCount: number;
  verifiedCount: number;
  rank?: number;
  prizesEarned: Array<{
    prize: string;
    prizeValue?: number;
    threshold: number;
    awardedAt: string;
  }>;
}

interface ReferralsData {
  total: number;
  byStatus: Record<string, number>;
  recent: Array<{ status: string; createdAt: string }>;
}

interface CampaignData {
  name: string;
  endsAt: string;
  daysRemaining: number;
  isActive: boolean;
  totalReferrers?: number;
}

interface LeaderboardEntry {
  rank: number;
  code: string;
  name: string;
  verifiedCount: number;
  isCurrentUser: boolean;
}

// ================== Stats Card Component (Hanukkah Theme) ==================
interface StatCardProps {
  title: string;
  value: number;
  icon: React.ReactNode;
  color: 'blue' | 'gold' | 'amber' | 'indigo';
  subtitle?: string;
}

const StatCard: React.FC<StatCardProps> = ({
  title,
  value,
  icon,
  color,
  subtitle,
}) => {
  const colorClasses = {
    blue: 'from-blue-900/20 to-blue-800/10 border-blue-400/30 text-blue-300',
    gold: 'from-amber-500/20 to-yellow-500/10 border-amber-400/30 text-amber-300',
    amber:
      'from-orange-500/20 to-amber-500/10 border-orange-400/30 text-orange-300',
    indigo:
      'from-indigo-500/20 to-purple-500/10 border-indigo-400/30 text-indigo-300',
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      className={`bg-gradient-to-br ${colorClasses[color]} border rounded-2xl p-5 backdrop-blur-sm`}
    >
      <div className="flex items-center justify-between mb-3">
        <span className="text-sm text-blue-100/80">{title}</span>
        <div className={colorClasses[color].split(' ').pop()}>{icon}</div>
      </div>
      <div className="text-3xl font-bold text-white">
        {value.toLocaleString()}
      </div>
      {subtitle && (
        <div className="text-xs text-blue-200/60 mt-1">{subtitle}</div>
      )}
    </motion.div>
  );
};

// ================== WhatsApp Share Modal Component (Hanukkah Theme) ==================
interface WhatsAppShareModalProps {
  isOpen: boolean;
  onClose: () => void;
  shareUrl: string;
  referrerName: string;
}

const WhatsAppShareModal: React.FC<WhatsAppShareModalProps> = ({
  isOpen,
  onClose,
  shareUrl,
  referrerName,
}) => {
  const [copiedMessage, setCopiedMessage] = useState(false);
  const [copiedLink, setCopiedLink] = useState(false);

  // הודעת השיתוף המותאמת לחנוכה
  const shareMessage = `חג חנוכה שמח! 🕎✨

בחנוכה הזה אני רוצה להמליץ לך על משהו מיוחד - NeshamaTech, מערכת שידוכים שפועלת אחרת לגמרי מאפליקציות ההיכרויות.

🕯️ מה מיוחד פה?
• שדכנים אמיתיים מחפשים בשבילך - בלי סווייפים אינסופיים
• דיסקרטיות מלאה - הפרטים שלך לא חשופים
• התאמות על בסיס ערכים והשקפת עולם

💫 כמו נס פך השמן - לפעמים דבר קטן יכול להוביל לדבר גדול!

הנה הקישור להרשמה:
${shareUrl}

חג אורים שמח! 🕎`;

  const copyMessage = async () => {
    try {
      await navigator.clipboard.writeText(shareMessage);
      setCopiedMessage(true);
      setTimeout(() => setCopiedMessage(false), 2500);
    } catch (err) {
      console.error('Failed to copy message:', err);
    }
  };

  const copyLink = async () => {
    try {
      await navigator.clipboard.writeText(shareUrl);
      setCopiedLink(true);
      setTimeout(() => setCopiedLink(false), 2500);
    } catch (err) {
      console.error('Failed to copy link:', err);
    }
  };

  const openWhatsAppDirect = () => {
    const text = encodeURIComponent(shareMessage);
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

    if (isMobile) {
      window.location.href = `whatsapp://send?text=${text}`;
    } else {
      window.open(`https://wa.me/?text=${text}`, '_blank');
    }
  };

  if (!isOpen) return null;

  return (
    <AnimatePresence>
      {isOpen && (
        <>
          {/* Backdrop */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={onClose}
            className="fixed inset-0 bg-blue-950/70 backdrop-blur-sm z-50"
          />

          {/* Modal */}
          <motion.div
            initial={{ opacity: 0, scale: 0.9, y: 20 }}
            animate={{ opacity: 1, scale: 1, y: 0 }}
            exit={{ opacity: 0, scale: 0.9, y: 20 }}
            transition={{ type: 'spring', damping: 25, stiffness: 300 }}
            className="fixed inset-x-4 top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-lg z-50 max-h-[80vh] overflow-y-auto"
          >
            <div className="bg-gradient-to-b from-blue-900 to-blue-950 rounded-3xl shadow-2xl overflow-hidden border border-amber-400/30">
              {/* Header */}
              <div className="bg-gradient-to-r from-amber-500 via-yellow-500 to-amber-500 px-6 py-4 relative">
                <button
                  onClick={onClose}
                  className="absolute left-4 top-4 text-amber-900/80 hover:text-amber-900 transition-colors"
                >
                  <X className="w-5 h-5" />
                </button>
                <div className="text-center text-amber-900">
                  <div className="flex items-center justify-center gap-2 mb-1">
                    <span className="text-2xl">🕎</span>
                    <h3 className="text-xl font-bold">שתפו את האור</h3>
                    <span className="text-2xl">🕎</span>
                  </div>
                  <p className="text-sm text-amber-800">
                    הזמינו חברים להצטרף בחנוכה
                  </p>
                </div>
              </div>

              {/* Content */}
              <div className="p-6 space-y-5">
                {/* Message Preview */}
                <div className="relative">
                  <div className="text-sm font-medium text-amber-300 mb-2 flex items-center gap-2">
                    <Sparkles className="w-4 h-4 text-amber-400" />
                    ההודעה שתשלח:
                  </div>
                  <div
                    className="bg-blue-950/50 rounded-2xl p-4 text-sm text-blue-100 leading-relaxed max-h-48 overflow-y-auto border border-blue-800/50"
                    dir="rtl"
                  >
                    <div className="whitespace-pre-wrap">{shareMessage}</div>
                  </div>
                </div>

                {/* Action Buttons */}
                <div className="space-y-3">
                  {/* Copy Message Button */}
                  <Button
                    onClick={copyMessage}
                    variant="outline"
                    className={`w-full h-12 text-base transition-all duration-300 border-blue-700 ${
                      copiedMessage
                        ? 'bg-amber-500/20 border-amber-400 text-amber-300'
                        : 'bg-blue-900/50 text-blue-100 hover:bg-blue-800/50'
                    }`}
                  >
                    {copiedMessage ? (
                      <>
                        <Check className="ml-2 w-5 h-5" />
                        ההודעה הועתקה!
                      </>
                    ) : (
                      <>
                        <Copy className="ml-2 w-5 h-5" />
                        העתקת ההודעה
                      </>
                    )}
                  </Button>

                  {/* Copy Link Only Button */}
                  <Button
                    onClick={copyLink}
                    variant="outline"
                    className={`w-full h-12 text-base transition-all duration-300 border-blue-700 ${
                      copiedLink
                        ? 'bg-amber-500/20 border-amber-400 text-amber-300'
                        : 'bg-blue-900/50 text-blue-100 hover:bg-blue-800/50'
                    }`}
                  >
                    {copiedLink ? (
                      <>
                        <Check className="ml-2 w-5 h-5" />
                        הקישור הועתק!
                      </>
                    ) : (
                      <>
                        <Copy className="ml-2 w-5 h-5" />
                        העתקת הקישור בלבד
                      </>
                    )}
                  </Button>

                  {/* Divider */}
                  <div className="relative py-2">
                    <div className="absolute inset-0 flex items-center">
                      <div className="w-full border-t border-blue-800"></div>
                    </div>
                    <div className="relative flex justify-center">
                      <span className="bg-blue-900 px-3 text-sm text-blue-400">
                        או
                      </span>
                    </div>
                  </div>

                  {/* Open WhatsApp Button */}
                  <Button
                    onClick={openWhatsAppDirect}
                    className="w-full h-14 text-lg bg-[#25D366] hover:bg-[#20bd5a] text-white shadow-lg shadow-green-900/30 hover:shadow-xl transition-all duration-300"
                  >
                    <Forward className="ml-2 w-5 h-5" />
                    פתיחת וואטסאפ ושליחה לחבר
                  </Button>
                </div>

                {/* Tip */}
                <div className="bg-gradient-to-r from-amber-500/10 to-orange-500/10 rounded-xl p-3 border border-amber-500/20">
                  <div className="flex items-start gap-2">
                    <span className="text-lg">🕯️</span>
                    <p className="text-xs text-amber-200 leading-relaxed">
                      <span className="font-bold">טיפ:</span> כמו שמוסיפים נר כל
                      יום - כל חבר שמצטרף מוסיף אור לקהילה!
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </motion.div>
        </>
      )}
    </AnimatePresence>
  );
};

// ================== Share Card Component (Hanukkah Theme) ==================
interface ShareCardProps {
  code: string;
  shareUrl: string;
  referrerName: string;
}

const ShareCard: React.FC<ShareCardProps> = ({
  code,
  shareUrl,
  referrerName,
}) => {
  const [copied, setCopied] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);

  const copyToClipboard = async () => {
    await navigator.clipboard.writeText(shareUrl);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  return (
    <>
      <Card className="border-amber-400/30 bg-gradient-to-br from-blue-900/80 to-blue-950/80 backdrop-blur-sm">
        <CardHeader className="pb-3">
          <CardTitle className="text-lg flex items-center gap-2 text-amber-300">
            <Share2 className="w-5 h-5 text-amber-400" />
            הקישור שלכם
          </CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="text-center">
            <div className="text-sm text-blue-200/70 mb-1">
              הקוד האישי שלכם:
            </div>
            <div className="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-yellow-500">
              {code}
            </div>
          </div>
          <div className="flex gap-2">
            <Input
              value={shareUrl}
              readOnly
              className="font-mono text-sm bg-blue-950/50 border-blue-700 text-blue-100"
              dir="ltr"
            />
            <Button
              onClick={copyToClipboard}
              variant="outline"
              size="icon"
              className={`transition-all duration-300 border-blue-700 ${copied ? 'bg-amber-500/20 text-amber-300 border-amber-400' : 'bg-blue-900/50 text-blue-200'}`}
            >
              {copied ? (
                <Check className="w-4 h-4" />
              ) : (
                <Copy className="w-4 h-4" />
              )}
            </Button>
          </div>
          <Button
            onClick={() => setIsModalOpen(true)}
            className="w-full h-12 bg-gradient-to-r from-amber-500 to-yellow-500 hover:from-amber-400 hover:to-yellow-400 text-amber-900 font-semibold text-base shadow-lg shadow-amber-500/20 hover:shadow-xl transition-all duration-300"
          >
            <Flame className="ml-2 w-5 h-5" />
            שתפו את האור 🕎
          </Button>
        </CardContent>
      </Card>

      {/* WhatsApp Share Modal */}
      <WhatsAppShareModal
        isOpen={isModalOpen}
        onClose={() => setIsModalOpen(false)}
        shareUrl={shareUrl}
        referrerName={referrerName}
      />
    </>
  );
};

// ================== Winner Prize Card (Hanukkah Theme) ==================
interface WinnerPrizeCardProps {
  rank: number;
  totalReferrers: number;
}

const WinnerPrizeCard: React.FC<WinnerPrizeCardProps> = ({
  rank,
  totalReferrers,
}) => {
  const isLeading = rank === 1;
  const currentCandle = getCurrentCandle();

  return (
    <Card className="border-amber-400/30 bg-gradient-to-br from-blue-900/80 to-blue-950/80 backdrop-blur-sm">
      <CardHeader className="pb-3">
        <CardTitle className="text-lg flex items-center gap-2 text-amber-300">
          <Crown className="w-5 h-5 text-amber-400" />
          הפרס הגדול
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* Hanukkiah Display */}
        <div className="bg-blue-950/50 rounded-2xl p-4 border border-blue-800/30">
          <Hanukkiah litCandles={currentCandle} className="w-full h-auto" />
          <div className="text-center mt-2">
            <span className="text-amber-300 text-sm">
              נר {currentCandle} של חנוכה
            </span>
          </div>
        </div>

        <div className="text-center">
          <div className="text-sm text-blue-200/70 mb-2">
            🍽️ שובר לארוחה זוגית
          </div>
          <div className="text-xs text-blue-300/60">למנצח/ת הקמפיין</div>
        </div>

        <div
          className={`rounded-xl p-4 text-center ${isLeading ? 'bg-gradient-to-r from-amber-500 to-yellow-500 text-amber-900' : 'bg-blue-950/50 border border-blue-800/30'}`}
        >
          {isLeading ? (
            <>
              <div className="text-2xl mb-1">🏆</div>
              <div className="font-bold">את/ה מובילים!</div>
              <div className="text-sm opacity-90">
                המשיכו להאיר כדי לזכות בפרס
              </div>
            </>
          ) : (
            <>
              <div className="text-3xl font-bold text-amber-300">#{rank}</div>
              <div className="text-sm text-blue-200/70">
                מתוך {totalReferrers} משתתפים
              </div>
              <div className="text-xs text-amber-400 font-medium mt-1">
                הוסיפו עוד אור כדי לעלות בדירוג! 🕯️
              </div>
            </>
          )}
        </div>

        <div className="bg-blue-950/50 backdrop-blur-sm rounded-xl p-3 text-center border border-blue-800/30">
          <div className="text-xs text-blue-200/70">
            <span className="font-bold text-amber-400">💡 טיפ:</span> מי שמביא
            הכי הרבה חברים מאומתים עד סוף חנוכה - מנצח!
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

// ================== Leaderboard Component (Hanukkah Theme) ==================
interface LeaderboardProps {
  entries: LeaderboardEntry[];
  currentUserCode: string;
  currentUserRank?: number;
}

const Leaderboard: React.FC<LeaderboardProps> = ({
  entries,
  currentUserCode,
  currentUserRank,
}) => {
  return (
    <Card className="border-amber-400/30 bg-gradient-to-br from-blue-900/80 to-blue-950/80 backdrop-blur-sm">
      <CardHeader className="pb-3">
        <CardTitle className="text-lg flex items-center gap-2 text-amber-300">
          <Trophy className="w-5 h-5 text-amber-400" />
          טבלת מאירי האור 🕎
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="space-y-2">
          {entries.slice(0, 10).map((entry) => (
            <div
              key={entry.code}
              className={`flex items-center justify-between p-3 rounded-xl transition-colors ${
                entry.isCurrentUser
                  ? 'bg-amber-500/20 border border-amber-400/30'
                  : 'bg-blue-950/50 hover:bg-blue-900/50 border border-blue-800/30'
              }`}
            >
              <div className="flex items-center gap-3">
                <div
                  className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${
                    entry.rank === 1
                      ? 'bg-gradient-to-r from-amber-400 to-yellow-500 text-amber-900'
                      : entry.rank === 2
                        ? 'bg-gradient-to-r from-gray-300 to-gray-400 text-gray-700'
                        : entry.rank === 3
                          ? 'bg-gradient-to-r from-amber-600 to-amber-700 text-white'
                          : 'bg-blue-800 text-blue-200'
                  }`}
                >
                  {entry.rank}
                </div>
                <div>
                  <div className="font-medium text-blue-100">
                    {entry.name}
                    {entry.isCurrentUser && (
                      <span className="text-xs text-amber-400 mr-1">(אתם)</span>
                    )}
                  </div>
                  <div className="text-xs text-blue-400/60">{entry.code}</div>
                </div>
              </div>
              <div className="text-left">
                <div className="font-bold text-amber-300">
                  {entry.verifiedCount}
                </div>
                <div className="text-xs text-blue-300/60">נרות 🕯️</div>
              </div>
            </div>
          ))}
        </div>
        {currentUserRank && currentUserRank > 10 && (
          <div className="mt-4 pt-4 border-t border-blue-800/30">
            <div className="text-center text-sm text-blue-200/70">
              המיקום שלכם:{' '}
              <span className="font-bold text-amber-400">
                #{currentUserRank}
              </span>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
};

// ================== Campaign Timer Component (Hanukkah Theme) ==================
interface CampaignTimerProps {
  campaign: CampaignData;
}

const CampaignTimer: React.FC<CampaignTimerProps> = ({ campaign }) => {
  const currentCandle = getCurrentCandle();

  if (!campaign.isActive) {
    return (
      <div className="bg-blue-900/50 rounded-xl p-4 text-center border border-blue-800/30">
        <div className="text-blue-200">הקמפיין הסתיים</div>
      </div>
    );
  }

  return (
    <Card className="border-amber-400/30 bg-gradient-to-br from-blue-900/80 to-blue-950/80 backdrop-blur-sm">
      <CardContent className="pt-6">
        <div className="flex items-center justify-center gap-2 text-amber-300 mb-2">
          <Clock className="w-5 h-5" />
          <span className="font-medium">נרות שנותרו להדליק</span>
        </div>
        <div className="text-center">
          <div className="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-yellow-500">
            {8 - currentCandle}
          </div>
          <div className="text-sm text-blue-200/70 mt-1">מתוך 8 נרות</div>
        </div>
        <div className="flex justify-center gap-1 mt-4">
          {[1, 2, 3, 4, 5, 6, 7, 8].map((candle) => (
            <motion.div
              key={candle}
              className={`w-3 h-8 rounded-full ${
                candle <= currentCandle
                  ? 'bg-gradient-to-t from-amber-500 to-yellow-400'
                  : 'bg-blue-800/50'
              }`}
              initial={candle <= currentCandle ? { scale: 0.8 } : {}}
              animate={
                candle <= currentCandle
                  ? {
                      scale: [0.8, 1.1, 1],
                      boxShadow: [
                        '0 0 0px rgba(251, 191, 36, 0)',
                        '0 0 10px rgba(251, 191, 36, 0.5)',
                        '0 0 5px rgba(251, 191, 36, 0.3)',
                      ],
                    }
                  : {}
              }
              transition={{ duration: 0.5, delay: candle * 0.1 }}
            />
          ))}
        </div>
        <div className="text-xs text-center text-blue-300/60 mt-4">
          הקמפיין מסתיים בסוף החנוכה 🕎
        </div>
      </CardContent>
    </Card>
  );
};

// ================== Main Dashboard Component ==================
export default function ReferralDashboard() {
  const router = useRouter();
  const searchParams = useSearchParams();
  const code = searchParams.get('code');

  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [stats, setStats] = useState<ReferrerStats | null>(null);
  const [referrals, setReferrals] = useState<ReferralsData | null>(null);
  const [campaign, setCampaign] = useState<CampaignData | null>(null);
  const [leaderboard, setLeaderboard] = useState<LeaderboardEntry[]>([]);

  const baseUrl = typeof window !== 'undefined' ? window.location.origin : '';
  const shareUrl = code ? `${baseUrl}/r/${code}` : '';
  const currentCandle = getCurrentCandle();

  useEffect(() => {
    if (!code) {
      setError('לא סופק קוד מפנה');
      setIsLoading(false);
      return;
    }

    const fetchData = async () => {
      try {
        const statsRes = await fetch(`/api/referral/stats?code=${code}`);
        const statsData = await statsRes.json();

        if (!statsData.success) {
          throw new Error(statsData.error || 'שגיאה בטעינת נתונים');
        }

        setStats(statsData.stats);
        setReferrals(statsData.referrals);
        setCampaign(statsData.campaign);

        const leaderboardRes = await fetch(
          `/api/referral/leaderboard?myCode=${code}`
        );
        const leaderboardData = await leaderboardRes.json();

        if (leaderboardData.success) {
          setLeaderboard(leaderboardData.leaderboard || []);
        }
      } catch (err) {
        setError(err instanceof Error ? err.message : 'שגיאה בטעינת נתונים');
      } finally {
        setIsLoading(false);
      }
    };

    fetchData();
  }, [code]);

  if (isLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-950 via-blue-900 to-indigo-950">
        <div className="text-center">
          <motion.div
            animate={{ rotate: 360 }}
            transition={{ duration: 2, repeat: Infinity, ease: 'linear' }}
          >
            <Loader2 className="w-10 h-10 text-amber-400 mx-auto mb-4" />
          </motion.div>
          <div className="text-blue-200">טוען נתונים...</div>
        </div>
      </div>
    );
  }

  if (error || !stats) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-950 via-blue-900 to-indigo-950">
        <div className="text-center max-w-md mx-auto px-4">
          <AlertCircle className="w-12 h-12 text-red-400 mx-auto mb-4" />
          <h1 className="text-xl font-bold text-white mb-2">שגיאה</h1>
          <p className="text-blue-200 mb-4">{error || 'לא נמצאו נתונים'}</p>
          <Button
            onClick={() => router.push('/he/friends')}
            variant="outline"
            className="border-blue-700 text-blue-200 hover:bg-blue-800"
          >
            חזרה לעמוד ההרשמה
          </Button>
        </div>
      </div>
    );
  }

  return (
    <main
      className="min-h-screen bg-gradient-to-br from-blue-950 via-blue-900 to-indigo-950 py-8 relative overflow-hidden"
      dir="rtl"
    >
      {/* Background Stars/Sparkles Effect */}
      <div className="absolute inset-0 overflow-hidden pointer-events-none">
        {[...Array(20)].map((_, i) => (
          <motion.div
            key={i}
            className="absolute w-1 h-1 bg-amber-300/30 rounded-full"
            style={{
              top: `${Math.random() * 100}%`,
              left: `${Math.random() * 100}%`,
            }}
            animate={{
              opacity: [0.2, 0.8, 0.2],
              scale: [1, 1.5, 1],
            }}
            transition={{
              duration: 2 + Math.random() * 2,
              repeat: Infinity,
              delay: Math.random() * 2,
            }}
          />
        ))}
      </div>

      <div className="container mx-auto px-4 max-w-5xl relative z-10">
        {/* Header */}
        <motion.div
          initial={{ opacity: 0, y: -20 }}
          animate={{ opacity: 1, y: 0 }}
          className="text-center mb-8"
        >
          <div className="flex items-center justify-center gap-2 mb-4">
            <Image src="/logo.png" alt="NeshamaTech" width={40} height={40} />
            <span className="font-bold text-xl text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-yellow-500">
              NeshamaTech
            </span>
          </div>

          {/* Hanukkah Banner */}
          <motion.div
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            className="bg-gradient-to-r from-amber-500/20 via-yellow-500/20 to-amber-500/20 rounded-2xl p-4 mb-6 border border-amber-400/30"
          >
            <div className="text-2xl mb-1">🕎 מוסיפים אור בחנוכה 🕎</div>
            <div className="text-sm text-amber-200/80">
              נר {currentCandle} של חנוכה
            </div>
          </motion.div>

          <h1 className="text-2xl md:text-3xl font-bold text-white mb-2">
            היי {stats.name}! 👋
          </h1>
          <p className="text-blue-200/80">
            הנה הסטטיסטיקות שלכם בקמפיין החנוכה
          </p>
        </motion.div>

        {/* Stats Grid */}
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
          <StatCard
            title="לחיצות"
            value={stats.clickCount}
            icon={<MousePointer className="w-5 h-5" />}
            color="blue"
            subtitle="לחצו על הקישור"
          />
          <StatCard
            title="נרשמו"
            value={referrals?.byStatus?.REGISTERED || 0}
            icon={<Users className="w-5 h-5" />}
            color="gold"
            subtitle="השלימו הרשמה"
          />
          <StatCard
            title="מאומתים"
            value={stats.verifiedCount}
            icon={<UserCheck className="w-5 h-5" />}
            color="amber"
            subtitle="נרות שהדלקתם 🕯️"
          />
          <StatCard
            title="דירוג"
            value={stats.rank || 0}
            icon={<Trophy className="w-5 h-5" />}
            color="indigo"
            subtitle="מתוך כל המשתתפים"
          />
        </div>

        {/* Main Content Grid */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {/* Left Column */}
          <div className="space-y-6">
            <ShareCard
              code={stats.code}
              shareUrl={shareUrl}
              referrerName={stats.name}
            />
            {campaign && <CampaignTimer campaign={campaign} />}
          </div>

          {/* Right Column - Winner Prize Card */}
          <div className="space-y-6">
            <WinnerPrizeCard
              rank={stats.rank || 999}
              totalReferrers={
                campaign?.totalReferrers || leaderboard.length || 1
              }
            />
          </div>
        </div>

        {/* Leaderboard */}
        {leaderboard.length > 0 && (
          <div className="mt-8">
            <Leaderboard
              entries={leaderboard}
              currentUserCode={stats.code}
              currentUserRank={stats.rank}
            />
          </div>
        )}

        {/* Back Link */}
        <div className="mt-8 text-center">
          <Link
            href="/he/friends"
            className="inline-flex items-center gap-1 text-amber-400 hover:text-amber-300 text-sm transition-colors"
          >
            <ChevronRight className="w-4 h-4" />
            חזרה לעמוד הקמפיין
          </Link>
        </div>

        {/* Footer Message */}
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 0.5 }}
          className="mt-8 text-center text-blue-300/60 text-sm"
        >
          חג אורים שמח! ✨
        </motion.div>
      </div>
    </main>
  );
}
--- End of Content for page.tsx ---

--- End of Content for dashboard_contents.txt ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\referral\dashboard\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/referral/dashboard/page.tsx
// דשבורד מפנה - קמפיין חנוכה "מוסיפים אור בחנוכה"

'use client';
import Link from 'next/link';
import { useSearchParams, useRouter } from 'next/navigation';

import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import Image from 'next/image';
import {
  Copy,
  Check,
  Share2,
  Trophy,
  Users,
  MousePointer,
  UserCheck,
  Clock,
  ChevronRight,
  Loader2,
  AlertCircle,
  Crown,
  X,
  MessageCircle,
  Forward,
  Sparkles,
  Flame,
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

// ================== Hanukkah Config ==================
const HANUKKAH_CONFIG = {
  startDate: new Date('2024-12-25'), // כ"ה כסלו - נר ראשון
  endDate: new Date('2025-01-02'), // סוף חנוכה
  currentCandle: 1, // נר ראשון
};

// חישוב איזה נר היום
const getCurrentCandle = (): number => {
  const today = new Date();
  const start = HANUKKAH_CONFIG.startDate;
  const diffTime = today.getTime() - start.getTime();
  const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
  return Math.min(Math.max(diffDays + 1, 1), 8);
};

// ================== Hanukkiah SVG Component ==================
interface HanukkiahProps {
  litCandles: number;
  className?: string;
}

const Hanukkiah: React.FC<HanukkiahProps> = ({
  litCandles,
  className = '',
}) => {
  const candlePositions = [
    { x: 25, height: 35 }, // נר 1 (שמאל קיצוני)
    { x: 55, height: 35 }, // נר 2
    { x: 85, height: 35 }, // נר 3
    { x: 115, height: 35 }, // נר 4
    { x: 175, height: 50 }, // שמש (מוגבה) - אמצע
    { x: 205, height: 35 }, // נר 5
    { x: 235, height: 35 }, // נר 6
    { x: 265, height: 35 }, // נר 7
    { x: 295, height: 35 }, // נר 8 (ימין קיצוני)
  ];

  // סדר ההדלקה: שמש (4) תמיד דולק, ואז מימין לשמאל
  const getLitStatus = (index: number): boolean => {
    if (index === 4) return true; // שמש תמיד דולק
    if (index > 4) {
      // נרות מימין לשמש (5,6,7,8 -> נר 1,2,3,4)
      const candleNumber = index - 4;
      return candleNumber <= litCandles;
    } else {
      // נרות משמאל לשמש (0,1,2,3 -> נר 8,7,6,5)
      const candleNumber = 8 - index;
      return candleNumber <= litCandles;
    }
  };

  return (
    <svg
      viewBox="0 0 320 120"
      className={className}
      xmlns="http://www.w3.org/2000/svg"
    >
      {/* בסיס החנוכייה */}
      <defs>
        <linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stopColor="#F6E05E" />
          <stop offset="50%" stopColor="#D69E2E" />
          <stop offset="100%" stopColor="#B7791F" />
        </linearGradient>
        <linearGradient id="flameGradient" x1="0%" y1="100%" x2="0%" y2="0%">
          <stop offset="0%" stopColor="#F6AD55" />
          <stop offset="50%" stopColor="#ED8936" />
          <stop offset="100%" stopColor="#FBBF24" />
        </linearGradient>
        <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="3" result="coloredBlur" />
          <feMerge>
            <feMergeNode in="coloredBlur" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>
      </defs>

      {/* בסיס */}
      <rect
        x="60"
        y="100"
        width="200"
        height="8"
        rx="2"
        fill="url(#goldGradient)"
      />
      <rect
        x="150"
        y="85"
        width="20"
        height="20"
        rx="2"
        fill="url(#goldGradient)"
      />

      {/* נרות */}
      {candlePositions.map((pos, index) => {
        const isLit = getLitStatus(index);
        const isShamash = index === 4;
        const baseY = isShamash ? 35 : 50;

        return (
          <g key={index}>
            {/* גוף הנר */}
            <rect
              x={pos.x - 4}
              y={baseY}
              width="8"
              height={pos.height}
              rx="2"
              fill={isShamash ? '#FBD38D' : '#E2E8F0'}
              stroke="url(#goldGradient)"
              strokeWidth="1"
            />

            {/* פתילה */}
            <line
              x1={pos.x}
              y1={baseY}
              x2={pos.x}
              y2={baseY - 5}
              stroke="#4A5568"
              strokeWidth="1"
            />

            {/* להבה */}
            {isLit && (
              <g filter="url(#glow)">
                <motion.ellipse
                  cx={pos.x}
                  cy={baseY - 12}
                  rx="5"
                  ry="10"
                  fill="url(#flameGradient)"
                  initial={{ scaleY: 0.8, opacity: 0.8 }}
                  animate={{
                    scaleY: [0.8, 1, 0.9, 1, 0.8],
                    opacity: [0.8, 1, 0.9, 1, 0.8],
                  }}
                  transition={{
                    duration: 1.5,
                    repeat: Infinity,
                    ease: 'easeInOut',
                  }}
                />
                <motion.ellipse
                  cx={pos.x}
                  cy={baseY - 14}
                  rx="2"
                  ry="5"
                  fill="#FEF3C7"
                  initial={{ scaleY: 0.9 }}
                  animate={{
                    scaleY: [0.9, 1.1, 0.9],
                  }}
                  transition={{
                    duration: 1,
                    repeat: Infinity,
                    ease: 'easeInOut',
                  }}
                />
              </g>
            )}
          </g>
        );
      })}

      {/* עמודי החנוכייה */}
      <rect x="157" y="50" width="6" height="35" fill="url(#goldGradient)" />
      {[25, 55, 85, 115, 205, 235, 265, 295].map((x, i) => (
        <g key={`stand-${i}`}>
          <line
            x1={x}
            y1="85"
            x2={x}
            y2="100"
            stroke="url(#goldGradient)"
            strokeWidth="3"
          />
          <line
            x1={x}
            y1="85"
            x2="160"
            y2="85"
            stroke="url(#goldGradient)"
            strokeWidth="2"
          />
        </g>
      ))}
    </svg>
  );
};

// ================== Types ==================
interface ReferrerStats {
  code: string;
  name: string;
  tier: 'AMBASSADOR' | 'COMMUNITY';
  clickCount: number;
  verifiedCount: number;
  rank?: number;
  prizesEarned: Array<{
    prize: string;
    prizeValue?: number;
    threshold: number;
    awardedAt: string;
  }>;
}

interface ReferralsData {
  total: number;
  byStatus: Record<string, number>;
  recent: Array<{ status: string; createdAt: string }>;
}

interface CampaignData {
  name: string;
  endsAt: string;
  daysRemaining: number;
  isActive: boolean;
  totalReferrers?: number;
}

interface LeaderboardEntry {
  rank: number;
  code: string;
  name: string;
  verifiedCount: number;
  isCurrentUser: boolean;
}

// ================== Stats Card Component (Hanukkah Theme) ==================
interface StatCardProps {
  title: string;
  value: number;
  icon: React.ReactNode;
  color: 'blue' | 'gold' | 'amber' | 'indigo';
  subtitle?: string;
}

const StatCard: React.FC<StatCardProps> = ({
  title,
  value,
  icon,
  color,
  subtitle,
}) => {
  const colorClasses = {
    blue: 'from-blue-900/20 to-blue-800/10 border-blue-400/30 text-blue-300',
    gold: 'from-amber-500/20 to-yellow-500/10 border-amber-400/30 text-amber-300',
    amber:
      'from-orange-500/20 to-amber-500/10 border-orange-400/30 text-orange-300',
    indigo:
      'from-indigo-500/20 to-purple-500/10 border-indigo-400/30 text-indigo-300',
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      className={`bg-gradient-to-br ${colorClasses[color]} border rounded-2xl p-5 backdrop-blur-sm`}
    >
      <div className="flex items-center justify-between mb-3">
        <span className="text-sm text-blue-100/80">{title}</span>
        <div className={colorClasses[color].split(' ').pop()}>{icon}</div>
      </div>
      <div className="text-3xl font-bold text-white">
        {value.toLocaleString()}
      </div>
      {subtitle && (
        <div className="text-xs text-blue-200/60 mt-1">{subtitle}</div>
      )}
    </motion.div>
  );
};

// ================== WhatsApp Share Modal Component (Hanukkah Theme) ==================
interface WhatsAppShareModalProps {
  isOpen: boolean;
  onClose: () => void;
  shareUrl: string;
  referrerName: string;
}

const WhatsAppShareModal: React.FC<WhatsAppShareModalProps> = ({
  isOpen,
  onClose,
  shareUrl,
  referrerName,
}) => {
  const [copiedMessage, setCopiedMessage] = useState(false);
  const [copiedLink, setCopiedLink] = useState(false);

  // הודעת השיתוף המותאמת לחנוכה
  const shareMessage = `חג חנוכה שמח! 🕎✨

בחנוכה הזה אני רוצה להמליץ לך על משהו מיוחד - NeshamaTech, מערכת שידוכים שפועלת אחרת לגמרי מאפליקציות ההיכרויות.

🕯️ מה מיוחד פה?
• שדכנים אמיתיים מחפשים בשבילך - בלי סווייפים אינסופיים
• דיסקרטיות מלאה - הפרטים שלך לא חשופים
• התאמות על בסיס ערכים והשקפת עולם

💫 כמו נס פך השמן - לפעמים דבר קטן יכול להוביל לדבר גדול!

הנה הקישור להרשמה:
${shareUrl}

חג אורים שמח! 🕎`;

  const copyMessage = async () => {
    try {
      await navigator.clipboard.writeText(shareMessage);
      setCopiedMessage(true);
      setTimeout(() => setCopiedMessage(false), 2500);
    } catch (err) {
      console.error('Failed to copy message:', err);
    }
  };

  const copyLink = async () => {
    try {
      await navigator.clipboard.writeText(shareUrl);
      setCopiedLink(true);
      setTimeout(() => setCopiedLink(false), 2500);
    } catch (err) {
      console.error('Failed to copy link:', err);
    }
  };

  const openWhatsAppDirect = () => {
    const text = encodeURIComponent(shareMessage);
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

    if (isMobile) {
      window.location.href = `whatsapp://send?text=${text}`;
    } else {
      window.open(`https://wa.me/?text=${text}`, '_blank');
    }
  };

  if (!isOpen) return null;

  return (
    <AnimatePresence>
      {isOpen && (
        <>
          {/* Backdrop */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={onClose}
            className="fixed inset-0 bg-blue-950/70 backdrop-blur-sm z-50"
          />

          {/* Modal */}
          <motion.div
            initial={{ opacity: 0, scale: 0.9, y: 20 }}
            animate={{ opacity: 1, scale: 1, y: 0 }}
            exit={{ opacity: 0, scale: 0.9, y: 20 }}
            transition={{ type: 'spring', damping: 25, stiffness: 300 }}
            className="fixed inset-x-4 top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-lg z-50 max-h-[80vh] overflow-y-auto"
          >
            <div className="bg-gradient-to-b from-blue-900 to-blue-950 rounded-3xl shadow-2xl overflow-hidden border border-amber-400/30">
              {/* Header */}
              <div className="bg-gradient-to-r from-amber-500 via-yellow-500 to-amber-500 px-6 py-4 relative">
                <button
                  onClick={onClose}
                  className="absolute left-4 top-4 text-amber-900/80 hover:text-amber-900 transition-colors"
                >
                  <X className="w-5 h-5" />
                </button>
                <div className="text-center text-amber-900">
                  <div className="flex items-center justify-center gap-2 mb-1">
                    <span className="text-2xl">🕎</span>
                    <h3 className="text-xl font-bold">שתפו את האור</h3>
                    <span className="text-2xl">🕎</span>
                  </div>
                  <p className="text-sm text-amber-800">
                    הזמינו חברים להצטרף בחנוכה
                  </p>
                </div>
              </div>

              {/* Content */}
              <div className="p-6 space-y-5">
                {/* Message Preview */}
                <div className="relative">
                  <div className="text-sm font-medium text-amber-300 mb-2 flex items-center gap-2">
                    <Sparkles className="w-4 h-4 text-amber-400" />
                    ההודעה שתשלח:
                  </div>
                  <div
                    className="bg-blue-950/50 rounded-2xl p-4 text-sm text-blue-100 leading-relaxed max-h-48 overflow-y-auto border border-blue-800/50"
                    dir="rtl"
                  >
                    <div className="whitespace-pre-wrap">{shareMessage}</div>
                  </div>
                </div>

                {/* Action Buttons */}
                <div className="space-y-3">
                  {/* Copy Message Button */}
                  <Button
                    onClick={copyMessage}
                    variant="outline"
                    className={`w-full h-12 text-base transition-all duration-300 border-blue-700 ${
                      copiedMessage
                        ? 'bg-amber-500/20 border-amber-400 text-amber-300'
                        : 'bg-blue-900/50 text-blue-100 hover:bg-blue-800/50'
                    }`}
                  >
                    {copiedMessage ? (
                      <>
                        <Check className="ml-2 w-5 h-5" />
                        ההודעה הועתקה!
                      </>
                    ) : (
                      <>
                        <Copy className="ml-2 w-5 h-5" />
                        העתקת ההודעה
                      </>
                    )}
                  </Button>

                  {/* Copy Link Only Button */}
                  <Button
                    onClick={copyLink}
                    variant="outline"
                    className={`w-full h-12 text-base transition-all duration-300 border-blue-700 ${
                      copiedLink
                        ? 'bg-amber-500/20 border-amber-400 text-amber-300'
                        : 'bg-blue-900/50 text-blue-100 hover:bg-blue-800/50'
                    }`}
                  >
                    {copiedLink ? (
                      <>
                        <Check className="ml-2 w-5 h-5" />
                        הקישור הועתק!
                      </>
                    ) : (
                      <>
                        <Copy className="ml-2 w-5 h-5" />
                        העתקת הקישור בלבד
                      </>
                    )}
                  </Button>

                  {/* Divider */}
                  <div className="relative py-2">
                    <div className="absolute inset-0 flex items-center">
                      <div className="w-full border-t border-blue-800"></div>
                    </div>
                    <div className="relative flex justify-center">
                      <span className="bg-blue-900 px-3 text-sm text-blue-400">
                        או
                      </span>
                    </div>
                  </div>

                  {/* Open WhatsApp Button */}
                  <Button
                    onClick={openWhatsAppDirect}
                    className="w-full h-14 text-lg bg-[#25D366] hover:bg-[#20bd5a] text-white shadow-lg shadow-green-900/30 hover:shadow-xl transition-all duration-300"
                  >
                    <Forward className="ml-2 w-5 h-5" />
                    פתיחת וואטסאפ ושליחה לחבר
                  </Button>
                </div>

                {/* Tip */}
                <div className="bg-gradient-to-r from-amber-500/10 to-orange-500/10 rounded-xl p-3 border border-amber-500/20">
                  <div className="flex items-start gap-2">
                    <span className="text-lg">🕯️</span>
                    <p className="text-xs text-amber-200 leading-relaxed">
                      <span className="font-bold">טיפ:</span> כמו שמוסיפים נר כל
                      יום - כל חבר שמצטרף מוסיף אור לקהילה!
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </motion.div>
        </>
      )}
    </AnimatePresence>
  );
};

// ================== Share Card Component (Hanukkah Theme) ==================
interface ShareCardProps {
  code: string;
  shareUrl: string;
  referrerName: string;
}

const ShareCard: React.FC<ShareCardProps> = ({
  code,
  shareUrl,
  referrerName,
}) => {
  const [copied, setCopied] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);

  const copyToClipboard = async () => {
    await navigator.clipboard.writeText(shareUrl);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  return (
    <>
      <Card className="border-amber-400/30 bg-gradient-to-br from-blue-900/80 to-blue-950/80 backdrop-blur-sm">
        <CardHeader className="pb-3">
          <CardTitle className="text-lg flex items-center gap-2 text-amber-300">
            <Share2 className="w-5 h-5 text-amber-400" />
            הקישור שלכם
          </CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="text-center">
            <div className="text-sm text-blue-200/70 mb-1">
              הקוד האישי שלכם:
            </div>
            <div className="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-yellow-500">
              {code}
            </div>
          </div>
          <div className="flex gap-2">
            <Input
              value={shareUrl}
              readOnly
              className="font-mono text-sm bg-blue-950/50 border-blue-700 text-blue-100"
              dir="ltr"
            />
            <Button
              onClick={copyToClipboard}
              variant="outline"
              size="icon"
              className={`transition-all duration-300 border-blue-700 ${copied ? 'bg-amber-500/20 text-amber-300 border-amber-400' : 'bg-blue-900/50 text-blue-200'}`}
            >
              {copied ? (
                <Check className="w-4 h-4" />
              ) : (
                <Copy className="w-4 h-4" />
              )}
            </Button>
          </div>
          <Button
            onClick={() => setIsModalOpen(true)}
            className="w-full h-12 bg-gradient-to-r from-amber-500 to-yellow-500 hover:from-amber-400 hover:to-yellow-400 text-amber-900 font-semibold text-base shadow-lg shadow-amber-500/20 hover:shadow-xl transition-all duration-300"
          >
            <Flame className="ml-2 w-5 h-5" />
            שתפו את האור 🕎
          </Button>
        </CardContent>
      </Card>

      {/* WhatsApp Share Modal */}
      <WhatsAppShareModal
        isOpen={isModalOpen}
        onClose={() => setIsModalOpen(false)}
        shareUrl={shareUrl}
        referrerName={referrerName}
      />
    </>
  );
};

// ================== Winner Prize Card (Hanukkah Theme) ==================
interface WinnerPrizeCardProps {
  rank: number;
  totalReferrers: number;
}

const WinnerPrizeCard: React.FC<WinnerPrizeCardProps> = ({
  rank,
  totalReferrers,
}) => {
  const isLeading = rank === 1;
  const currentCandle = getCurrentCandle();

  return (
    <Card className="border-amber-400/30 bg-gradient-to-br from-blue-900/80 to-blue-950/80 backdrop-blur-sm">
      <CardHeader className="pb-3">
        <CardTitle className="text-lg flex items-center gap-2 text-amber-300">
          <Crown className="w-5 h-5 text-amber-400" />
          הפרס הגדול
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* Hanukkiah Display */}
        <div className="bg-blue-950/50 rounded-2xl p-4 border border-blue-800/30">
          <Hanukkiah litCandles={currentCandle} className="w-full h-auto" />
          <div className="text-center mt-2">
            <span className="text-amber-300 text-sm">
              נר {currentCandle} של חנוכה
            </span>
          </div>
        </div>

        <div className="text-center">
          <div className="text-sm text-blue-200/70 mb-2">
            🍽️ שובר לארוחה זוגית
          </div>
          <div className="text-xs text-blue-300/60">למנצח/ת הקמפיין</div>
        </div>

        <div
          className={`rounded-xl p-4 text-center ${isLeading ? 'bg-gradient-to-r from-amber-500 to-yellow-500 text-amber-900' : 'bg-blue-950/50 border border-blue-800/30'}`}
        >
          {isLeading ? (
            <>
              <div className="text-2xl mb-1">🏆</div>
              <div className="font-bold">את/ה מובילים!</div>
              <div className="text-sm opacity-90">
                המשיכו להאיר כדי לזכות בפרס
              </div>
            </>
          ) : (
            <>
              <div className="text-3xl font-bold text-amber-300">#{rank}</div>
              <div className="text-sm text-blue-200/70">
                מתוך {totalReferrers} משתתפים
              </div>
              <div className="text-xs text-amber-400 font-medium mt-1">
                הוסיפו עוד אור כדי לעלות בדירוג! 🕯️
              </div>
            </>
          )}
        </div>

        <div className="bg-blue-950/50 backdrop-blur-sm rounded-xl p-3 text-center border border-blue-800/30">
          <div className="text-xs text-blue-200/70">
            <span className="font-bold text-amber-400">💡 טיפ:</span> מי שמביא
            הכי הרבה חברים מאומתים עד סוף חנוכה - מנצח!
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

// ================== Leaderboard Component (Hanukkah Theme) ==================
interface LeaderboardProps {
  entries: LeaderboardEntry[];
  currentUserCode: string;
  currentUserRank?: number;
}

const Leaderboard: React.FC<LeaderboardProps> = ({
  entries,
  currentUserCode,
  currentUserRank,
}) => {
  return (
    <Card className="border-amber-400/30 bg-gradient-to-br from-blue-900/80 to-blue-950/80 backdrop-blur-sm">
      <CardHeader className="pb-3">
        <CardTitle className="text-lg flex items-center gap-2 text-amber-300">
          <Trophy className="w-5 h-5 text-amber-400" />
          טבלת מאירי האור 🕎
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="space-y-2">
          {entries.slice(0, 10).map((entry) => (
            <div
              key={entry.code}
              className={`flex items-center justify-between p-3 rounded-xl transition-colors ${
                entry.isCurrentUser
                  ? 'bg-amber-500/20 border border-amber-400/30'
                  : 'bg-blue-950/50 hover:bg-blue-900/50 border border-blue-800/30'
              }`}
            >
              <div className="flex items-center gap-3">
                <div
                  className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${
                    entry.rank === 1
                      ? 'bg-gradient-to-r from-amber-400 to-yellow-500 text-amber-900'
                      : entry.rank === 2
                        ? 'bg-gradient-to-r from-gray-300 to-gray-400 text-gray-700'
                        : entry.rank === 3
                          ? 'bg-gradient-to-r from-amber-600 to-amber-700 text-white'
                          : 'bg-blue-800 text-blue-200'
                  }`}
                >
                  {entry.rank}
                </div>
                <div>
                  <div className="font-medium text-blue-100">
                    {entry.name}
                    {entry.isCurrentUser && (
                      <span className="text-xs text-amber-400 mr-1">(אתם)</span>
                    )}
                  </div>
                  <div className="text-xs text-blue-400/60">{entry.code}</div>
                </div>
              </div>
              <div className="text-left">
                <div className="font-bold text-amber-300">
                  {entry.verifiedCount}
                </div>
                <div className="text-xs text-blue-300/60">נרות 🕯️</div>
              </div>
            </div>
          ))}
        </div>
        {currentUserRank && currentUserRank > 10 && (
          <div className="mt-4 pt-4 border-t border-blue-800/30">
            <div className="text-center text-sm text-blue-200/70">
              המיקום שלכם:{' '}
              <span className="font-bold text-amber-400">
                #{currentUserRank}
              </span>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
};

// ================== Campaign Timer Component (Hanukkah Theme) ==================
interface CampaignTimerProps {
  campaign: CampaignData;
}

const CampaignTimer: React.FC<CampaignTimerProps> = ({ campaign }) => {
  const currentCandle = getCurrentCandle();

  if (!campaign.isActive) {
    return (
      <div className="bg-blue-900/50 rounded-xl p-4 text-center border border-blue-800/30">
        <div className="text-blue-200">הקמפיין הסתיים</div>
      </div>
    );
  }

  return (
    <Card className="border-amber-400/30 bg-gradient-to-br from-blue-900/80 to-blue-950/80 backdrop-blur-sm">
      <CardContent className="pt-6">
        <div className="flex items-center justify-center gap-2 text-amber-300 mb-2">
          <Clock className="w-5 h-5" />
          <span className="font-medium">נרות שנותרו להדליק</span>
        </div>
        <div className="text-center">
          <div className="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-yellow-500">
            {8 - currentCandle}
          </div>
          <div className="text-sm text-blue-200/70 mt-1">מתוך 8 נרות</div>
        </div>
        <div className="flex justify-center gap-1 mt-4">
          {[1, 2, 3, 4, 5, 6, 7, 8].map((candle) => (
            <motion.div
              key={candle}
              className={`w-3 h-8 rounded-full ${
                candle <= currentCandle
                  ? 'bg-gradient-to-t from-amber-500 to-yellow-400'
                  : 'bg-blue-800/50'
              }`}
              initial={candle <= currentCandle ? { scale: 0.8 } : {}}
              animate={
                candle <= currentCandle
                  ? {
                      scale: [0.8, 1.1, 1],
                      boxShadow: [
                        '0 0 0px rgba(251, 191, 36, 0)',
                        '0 0 10px rgba(251, 191, 36, 0.5)',
                        '0 0 5px rgba(251, 191, 36, 0.3)',
                      ],
                    }
                  : {}
              }
              transition={{ duration: 0.5, delay: candle * 0.1 }}
            />
          ))}
        </div>
        <div className="text-xs text-center text-blue-300/60 mt-4">
          הקמפיין מסתיים בסוף החנוכה 🕎
        </div>
      </CardContent>
    </Card>
  );
};

// ================== Main Dashboard Component ==================
export default function ReferralDashboard() {
  const router = useRouter();
  const searchParams = useSearchParams();
  const code = searchParams.get('code');

  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [stats, setStats] = useState<ReferrerStats | null>(null);
  const [referrals, setReferrals] = useState<ReferralsData | null>(null);
  const [campaign, setCampaign] = useState<CampaignData | null>(null);
  const [leaderboard, setLeaderboard] = useState<LeaderboardEntry[]>([]);

  const baseUrl = typeof window !== 'undefined' ? window.location.origin : '';
  const shareUrl = code ? `${baseUrl}/r/${code}` : '';
  const currentCandle = getCurrentCandle();

  useEffect(() => {
    if (!code) {
      setError('לא סופק קוד מפנה');
      setIsLoading(false);
      return;
    }

    const fetchData = async () => {
      try {
        const statsRes = await fetch(`/api/referral/stats?code=${code}`);
        const statsData = await statsRes.json();

        if (!statsData.success) {
          throw new Error(statsData.error || 'שגיאה בטעינת נתונים');
        }

        setStats(statsData.stats);
        setReferrals(statsData.referrals);
        setCampaign(statsData.campaign);

        const leaderboardRes = await fetch(
          `/api/referral/leaderboard?myCode=${code}`
        );
        const leaderboardData = await leaderboardRes.json();

        if (leaderboardData.success) {
          setLeaderboard(leaderboardData.leaderboard || []);
        }
      } catch (err) {
        setError(err instanceof Error ? err.message : 'שגיאה בטעינת נתונים');
      } finally {
        setIsLoading(false);
      }
    };

    fetchData();
  }, [code]);

  if (isLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-950 via-blue-900 to-indigo-950">
        <div className="text-center">
          <motion.div
            animate={{ rotate: 360 }}
            transition={{ duration: 2, repeat: Infinity, ease: 'linear' }}
          >
            <Loader2 className="w-10 h-10 text-amber-400 mx-auto mb-4" />
          </motion.div>
          <div className="text-blue-200">טוען נתונים...</div>
        </div>
      </div>
    );
  }

  if (error || !stats) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-950 via-blue-900 to-indigo-950">
        <div className="text-center max-w-md mx-auto px-4">
          <AlertCircle className="w-12 h-12 text-red-400 mx-auto mb-4" />
          <h1 className="text-xl font-bold text-white mb-2">שגיאה</h1>
          <p className="text-blue-200 mb-4">{error || 'לא נמצאו נתונים'}</p>
          <Button
            onClick={() => router.push('/he/friends')}
            variant="outline"
            className="border-blue-700 text-blue-200 hover:bg-blue-800"
          >
            חזרה לעמוד ההרשמה
          </Button>
        </div>
      </div>
    );
  }

  return (
    <main
      className="min-h-screen bg-gradient-to-br from-blue-950 via-blue-900 to-indigo-950 py-8 relative overflow-hidden"
      dir="rtl"
    >
      {/* Background Stars/Sparkles Effect */}
      <div className="absolute inset-0 overflow-hidden pointer-events-none">
        {[...Array(20)].map((_, i) => (
          <motion.div
            key={i}
            className="absolute w-1 h-1 bg-amber-300/30 rounded-full"
            style={{
              top: `${Math.random() * 100}%`,
              left: `${Math.random() * 100}%`,
            }}
            animate={{
              opacity: [0.2, 0.8, 0.2],
              scale: [1, 1.5, 1],
            }}
            transition={{
              duration: 2 + Math.random() * 2,
              repeat: Infinity,
              delay: Math.random() * 2,
            }}
          />
        ))}
      </div>

      <div className="container mx-auto px-4 max-w-5xl relative z-10">
        {/* Header */}
        <motion.div
          initial={{ opacity: 0, y: -20 }}
          animate={{ opacity: 1, y: 0 }}
          className="text-center mb-8"
        >
          <div className="flex items-center justify-center gap-2 mb-4">
            <Image src="/logo.png" alt="NeshamaTech" width={40} height={40} />
            <span className="font-bold text-xl text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-yellow-500">
              NeshamaTech
            </span>
          </div>

          {/* Hanukkah Banner */}
          <motion.div
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            className="bg-gradient-to-r from-amber-500/20 via-yellow-500/20 to-amber-500/20 rounded-2xl p-4 mb-6 border border-amber-400/30"
          >
            <div className="text-2xl mb-1">🕎 מוסיפים אור בחנוכה 🕎</div>
            <div className="text-sm text-amber-200/80">
              נר {currentCandle} של חנוכה
            </div>
          </motion.div>

          <h1 className="text-2xl md:text-3xl font-bold text-white mb-2">
            היי {stats.name}! 👋
          </h1>
          <p className="text-blue-200/80">
            הנה הסטטיסטיקות שלכם בקמפיין החנוכה
          </p>
        </motion.div>

        {/* Stats Grid */}
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
          <StatCard
            title="לחיצות"
            value={stats.clickCount}
            icon={<MousePointer className="w-5 h-5" />}
            color="blue"
            subtitle="לחצו על הקישור"
          />
          <StatCard
            title="נרשמו"
            value={referrals?.byStatus?.REGISTERED || 0}
            icon={<Users className="w-5 h-5" />}
            color="gold"
            subtitle="השלימו הרשמה"
          />
          <StatCard
            title="מאומתים"
            value={stats.verifiedCount}
            icon={<UserCheck className="w-5 h-5" />}
            color="amber"
            subtitle="נרות שהדלקתם 🕯️"
          />
          <StatCard
            title="דירוג"
            value={stats.rank || 0}
            icon={<Trophy className="w-5 h-5" />}
            color="indigo"
            subtitle="מתוך כל המשתתפים"
          />
        </div>

        {/* Main Content Grid */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {/* Left Column */}
          <div className="space-y-6">
            <ShareCard
              code={stats.code}
              shareUrl={shareUrl}
              referrerName={stats.name}
            />
            {campaign && <CampaignTimer campaign={campaign} />}
          </div>

          {/* Right Column - Winner Prize Card */}
          <div className="space-y-6">
            <WinnerPrizeCard
              rank={stats.rank || 999}
              totalReferrers={
                campaign?.totalReferrers || leaderboard.length || 1
              }
            />
          </div>
        </div>

        {/* Leaderboard */}
        {leaderboard.length > 0 && (
          <div className="mt-8">
            <Leaderboard
              entries={leaderboard}
              currentUserCode={stats.code}
              currentUserRank={stats.rank}
            />
          </div>
        )}

        {/* Back Link */}
        <div className="mt-8 text-center">
          <Link
            href="/he/friends"
            className="inline-flex items-center gap-1 text-amber-400 hover:text-amber-300 text-sm transition-colors"
          >
            <ChevronRight className="w-4 h-4" />
            חזרה לעמוד הקמפיין
          </Link>
        </div>

        {/* Footer Message */}
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 0.5 }}
          className="mt-8 text-center text-blue-300/60 text-sm"
        >
          חג אורים שמח! ✨
        </motion.div>
      </div>
    </main>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\test-spinner
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\test-spinner\page.tsx
--------------------------------------------------------------------------------
Content:
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

export default function TestSpinnerPage() {
  return (
    // מציג את הספינר בתצורה המלאה שלו
    <StandardizedLoadingSpinner 
      text="טוען את המערכת..." 
      subtext="מכינים עבורך את ההתאמות הטובות ביותר" 
    />
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\testimonial
================================================================================

(This directory contains subdirectories but no files directly. See subdirectories below.)

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\testimonial\[token]
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\testimonial\[token]\TestimonialSubmissionForm.tsx
--------------------------------------------------------------------------------
Content:
'use client';

import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Checkbox } from '@/components/ui/checkbox';
import { Loader2 } from 'lucide-react';
import { toast } from 'sonner';

interface FormProps {
  token: string;
  userName: string;
}

export function TestimonialSubmissionForm({ token, userName }: FormProps) {
  const [formData, setFormData] = useState({
    authorName: '',
    relationship: '',
    content: '',
    authorPhone: '',
    isPhoneVisibleToMatch: false,
  });
  const [isLoading, setIsLoading] = useState(false);
  const [isSubmitted, setIsSubmitted] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);

    try {
      // ======================= התיקון מתחיל כאן =======================

      // 1. נבנה את המטען (payload) שישלח לשרת.
      // הוא יכיל את כל פרטי הטופס, ובנוסף את הטוקן.
      const payload = {
        ...formData,
        token: token,
      };

      // 2. נשנה את כתובת ה-API לכתובת הנכונה שיצרנו ליצירת המלצות.
      const response = await fetch(`/api/profile/testimonials`, {
        // <-- שינוי הנתיב
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload), // <-- שליחת המטען המלא
      });

      // ======================= התיקון מסתיים כאן =======================

      const result = await response.json();

      if (!response.ok) {
        throw new Error(result.message || 'שגיאה בשליחת ההמלצה.');
      }

      toast.success('ההמלצה נשלחה בהצלחה!');
      setIsSubmitted(true);
    } catch (error) {
      const errorMessage =
        error instanceof Error ? error.message : 'אירעה שגיאה לא צפויה.';
      toast.error(errorMessage);
    } finally {
      setIsLoading(false);
    }
  };

  const handleChange = (
    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>
  ) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
  };

  if (isSubmitted) {
    return (
      <div className="text-center p-8 bg-white rounded-lg shadow-md">
        <h2 className="text-xl font-bold text-green-600">תודה רבה!</h2>
        <p className="mt-2 text-gray-700">
          ההמלצה שלך נשלחה ל{userName} ותעזור לו/לה המון במסע. מעריכים את זה
          מאוד!
        </p>
      </div>
    );
  }

  return (
    <form
      onSubmit={handleSubmit}
      className="p-8 bg-white rounded-lg shadow-md space-y-6"
    >
      <div className="space-y-2">
        <Label htmlFor="authorName">שמך המלא</Label>
        <Input
          id="authorName"
          name="authorName"
          value={formData.authorName}
          onChange={handleChange}
          required
          placeholder="לדוגמה: יוסי כהן"
        />
      </div>
      <div className="space-y-2">
        <Label htmlFor="relationship">הקשר שלכם</Label>
        <Input
          id="relationship"
          name="relationship"
          value={formData.relationship}
          onChange={handleChange}
          required
          placeholder="לדוגמה: חבר מהצבא, שותפה לדירה"
        />
      </div>
      <div className="space-y-2">
        <Label htmlFor="content">ההמלצה שלך</Label>
        <Textarea
          id="content"
          name="content"
          value={formData.content}
          onChange={handleChange}
          required
          minLength={50}
          rows={5}
          placeholder={`ספר/י קצת על ${userName}, על התכונות הבולטות שלו/ה, וכל מה שחשוב שהצד השני יכיר...`}
        />
      </div>
      <div className="space-y-2">
        <Label htmlFor="authorPhone">מספר טלפון (אופציונלי)</Label>
        <Input
          id="authorPhone"
          name="authorPhone"
          type="tel"
          value={formData.authorPhone}
          onChange={handleChange}
          placeholder="למקרה שירצו לשמוע ממך עוד"
        />
      </div>
      <div className="flex items-start space-x-2 rtl:space-x-reverse rounded-md border p-4">
        <Checkbox
          id="isPhoneVisibleToMatch"
          checked={formData.isPhoneVisibleToMatch}
          onCheckedChange={(checked) =>
            setFormData((prev) => ({
              ...prev,
              isPhoneVisibleToMatch: !!checked,
            }))
          }
          disabled={!formData.authorPhone}
        />
        <div className="grid gap-1.5 leading-none">
          <label
            htmlFor="isPhoneVisibleToMatch"
            className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
          >
            אני מאשר/ת שמספר הטלפון שלי יישמר ויוצג למועמדים רלוונטיים שאושרו על
            ידי צוות NeshamaTech.
          </label>
          <p className="text-xs text-muted-foreground">
            זוהי הזדמנות נהדרת לתת המלצה אישית וחמה.
          </p>
        </div>
      </div>
      <Button type="submit" className="w-full" disabled={isLoading}>
        {isLoading ? <Loader2 className="mr-2 h-4 w-4 animate-spin" /> : null}
        {isLoading ? 'שולח...' : 'שלח המלצה'}
      </Button>
    </form>
  );
}
--- End of Content for TestimonialSubmissionForm.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\testimonial\[token]\[token]_contents.txt
--------------------------------------------------------------------------------
Content:
################################################################################
# Directory Content Map For: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\testimonial\[token]
# Generated on: 2025-10-26 16:22:25
################################################################################

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\testimonial\[token]
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\testimonial\[token]\TestimonialSubmissionForm.tsx
--------------------------------------------------------------------------------
Content:
'use client';

import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Checkbox } from '@/components/ui/checkbox';
import { Loader2 } from 'lucide-react';
import { toast } from 'sonner';

interface FormProps {
  token: string;
  userName: string;
}

export function TestimonialSubmissionForm({ token, userName }: FormProps) {
  const [formData, setFormData] = useState({
    authorName: '',
    relationship: '',
    content: '',
    authorPhone: '',
    isPhoneVisibleToMatch: false,
  });
  const [isLoading, setIsLoading] = useState(false);
  const [isSubmitted, setIsSubmitted] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);

    try {
      // ======================= התיקון מתחיל כאן =======================

      // 1. נבנה את המטען (payload) שישלח לשרת.
      // הוא יכיל את כל פרטי הטופס, ובנוסף את הטוקן.
      const payload = {
        ...formData,
        token: token,
      };

      // 2. נשנה את כתובת ה-API לכתובת הנכונה שיצרנו ליצירת המלצות.
      const response = await fetch(`/api/profile/testimonials`, {
        // <-- שינוי הנתיב
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload), // <-- שליחת המטען המלא
      });

      // ======================= התיקון מסתיים כאן =======================

      const result = await response.json();

      if (!response.ok) {
        throw new Error(result.message || 'שגיאה בשליחת ההמלצה.');
      }

      toast.success('ההמלצה נשלחה בהצלחה!');
      setIsSubmitted(true);
    } catch (error) {
      const errorMessage =
        error instanceof Error ? error.message : 'אירעה שגיאה לא צפויה.';
      toast.error(errorMessage);
    } finally {
      setIsLoading(false);
    }
  };

  const handleChange = (
    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>
  ) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
  };

  if (isSubmitted) {
    return (
      <div className="text-center p-8 bg-white rounded-lg shadow-md">
        <h2 className="text-xl font-bold text-green-600">תודה רבה!</h2>
        <p className="mt-2 text-gray-700">
          ההמלצה שלך נשלחה ל{userName} ותעזור לו/לה המון במסע. מעריכים את זה
          מאוד!
        </p>
      </div>
    );
  }

  return (
    <form
      onSubmit={handleSubmit}
      className="p-8 bg-white rounded-lg shadow-md space-y-6"
    >
      <div className="space-y-2">
        <Label htmlFor="authorName">שמך המלא</Label>
        <Input
          id="authorName"
          name="authorName"
          value={formData.authorName}
          onChange={handleChange}
          required
          placeholder="לדוגמה: יוסי כהן"
        />
      </div>
      <div className="space-y-2">
        <Label htmlFor="relationship">הקשר שלכם</Label>
        <Input
          id="relationship"
          name="relationship"
          value={formData.relationship}
          onChange={handleChange}
          required
          placeholder="לדוגמה: חבר מהצבא, שותפה לדירה"
        />
      </div>
      <div className="space-y-2">
        <Label htmlFor="content">ההמלצה שלך</Label>
        <Textarea
          id="content"
          name="content"
          value={formData.content}
          onChange={handleChange}
          required
          minLength={50}
          rows={5}
          placeholder={`ספר/י קצת על ${userName}, על התכונות הבולטות שלו/ה, וכל מה שחשוב שהצד השני יכיר...`}
        />
      </div>
      <div className="space-y-2">
        <Label htmlFor="authorPhone">מספר טלפון (אופציונלי)</Label>
        <Input
          id="authorPhone"
          name="authorPhone"
          type="tel"
          value={formData.authorPhone}
          onChange={handleChange}
          placeholder="למקרה שירצו לשמוע ממך עוד"
        />
      </div>
      <div className="flex items-start space-x-2 rtl:space-x-reverse rounded-md border p-4">
        <Checkbox
          id="isPhoneVisibleToMatch"
          checked={formData.isPhoneVisibleToMatch}
          onCheckedChange={(checked) =>
            setFormData((prev) => ({
              ...prev,
              isPhoneVisibleToMatch: !!checked,
            }))
          }
          disabled={!formData.authorPhone}
        />
        <div className="grid gap-1.5 leading-none">
          <label
            htmlFor="isPhoneVisibleToMatch"
            className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
          >
            אני מאשר/ת שמספר הטלפון שלי יישמר ויוצג למועמדים רלוונטיים שאושרו על
            ידי צוות NeshamaTech.
          </label>
          <p className="text-xs text-muted-foreground">
            זוהי הזדמנות נהדרת לתת המלצה אישית וחמה.
          </p>
        </div>
      </div>
      <Button type="submit" className="w-full" disabled={isLoading}>
        {isLoading ? <Loader2 className="mr-2 h-4 w-4 animate-spin" /> : null}
        {isLoading ? 'שולח...' : 'שלח המלצה'}
      </Button>
    </form>
  );
}
--- End of Content for TestimonialSubmissionForm.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\testimonial\[token]\[token]_contents.txt
--------------------------------------------------------------------------------
[This is the output log file itself. Content not included.]

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\testimonial\[token]\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/testimonial/[token]/page.tsx
import { TestimonialSubmissionForm } from './TestimonialSubmissionForm';
import prisma from '@/lib/prisma';
import { notFound } from 'next/navigation';

interface PageProps {
  params: { token: string };
}

// --- פונקציית אימות הטוקן (Token Validation) - גרסה חדשה ---
async function validateToken(
  token: string
): Promise<{ profileId: string; userName: string } | null> {
  try {
    // Search for a request that matches the token, is still PENDING, and has NOT expired.
    const request = await prisma.testimonialRequest.findUnique({
      where: {
        token: token,
        status: 'PENDING', // Must be unused
        expiresAt: {
          gt: new Date(), // Must not be expired
        },
      },
      // Include related user data to get the name
      include: {
        profile: {
          select: {
            user: {
              select: { firstName: true, lastName: true },
            },
          },
        },
      },
    });

    // If no such request exists, the link is invalid
    if (!request || !request.profile.user) {
      return null;
    }

    const { user } = request.profile;
    return {
      profileId: request.profileId,
      userName: `${user.firstName} ${user.lastName}`,
    };
  } catch (error) {
    console.error('Token validation failed:', error);
    return null;
  }
}

// --- רכיב העמוד (Page Component) - נשאר כמעט זהה ---
export default async function TestimonialPage({ params }: PageProps) {
  const validationResult = await validateToken(params.token);

  if (!validationResult) {
    return notFound();
  }

  const { userName } = validationResult; // We don't need profileId here

  return (
    <main className="flex items-center justify-center min-h-screen bg-gray-50 p-4">
      <div className="w-full max-w-lg">
        <div className="text-center mb-6">
          <h1 className="text-2xl font-bold text-gray-800">
            המלצה חמה על {userName}
          </h1>
          <p className="text-gray-600 mt-2">
            תודה רבה שהקדשת מזמנך! המילים החמות שלך יכולות לעשות את כל ההבדל.
          </p>
        </div>
        {/* Pass the token to the form for submission */}
        <TestimonialSubmissionForm token={params.token} userName={userName} />
      </div>
    </main>
  );
}
--- End of Content for page.tsx ---

--- End of Content for [token]_contents.txt ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\testimonial\[token]\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/testimonial/[token]/page.tsx
import { TestimonialSubmissionForm } from './TestimonialSubmissionForm';
import prisma from '@/lib/prisma';
import { notFound } from 'next/navigation';
import { Locale } from '../../../../../i18n-config'; // ייבוא חסר

// ▼▼▼ כאן השינוי ▼▼▼
interface PageProps {
  params: Promise<{ token: string; locale: Locale }>; // הוספת locale והפיכה ל-Promise
}

async function validateToken(
  token: string
): Promise<{ profileId: string; userName: string } | null> {
  try {
    const request = await prisma.testimonialRequest.findUnique({
      where: {
        token: token,
        status: 'PENDING',
        expiresAt: {
          gt: new Date(),
        },
      },
      include: {
        profile: {
          select: {
            user: {
              select: { firstName: true, lastName: true },
            },
          },
        },
      },
    });

    if (!request || !request.profile.user) {
      return null;
    }

    const { user } = request.profile;
    return {
      profileId: request.profileId,
      userName: `${user.firstName} ${user.lastName}`,
    };
  } catch (error) {
    console.error('Token validation failed:', error);
    return null;
  }
}

export default async function TestimonialPage({ params }: PageProps) {
  const { token } = await params; // הוספת await
  const validationResult = await validateToken(token);

  if (!validationResult) {
    return notFound();
  }

  const { userName } = validationResult;

  return (
    <main className="flex items-center justify-center min-h-screen bg-gray-50 p-4">
      <div className="w-full max-w-lg">
        <div className="text-center mb-6">
          <h1 className="text-2xl font-bold text-gray-800">
            המלצה חמה על {userName}
          </h1>
          <p className="text-gray-600 mt-2">
            תודה רבה שהקדשת מזמנך! המילים החמות שלך יכולות לעשות את כל ההבדל.
          </p>
        </div>
        <TestimonialSubmissionForm token={token} userName={userName} />
      </div>
    </main>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\unsubscribe
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\unsubscribe\UnsubscribeClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/unsubscribe/UnsubscribeClient.tsx
'use client';

import { useEffect, useState } from 'react';
import { useSearchParams } from 'next/navigation';
import { CheckCircle, AlertTriangle, Home } from 'lucide-react';
import { Button } from '@/components/ui/button';
import Link from 'next/link';
import type { UnsubscribePageDict } from '@/types/dictionaries/auth';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

type Status = 'verifying' | 'success' | 'error';

interface UnsubscribeClientProps {
  dict: UnsubscribePageDict;
}

export default function UnsubscribeClient({ dict }: UnsubscribeClientProps) {
  const searchParams = useSearchParams();
  const [status, setStatus] = useState<Status>('verifying');
  const [message, setMessage] = useState(dict.verifying);

  useEffect(() => {
    const token = searchParams.get('token');

    if (!token) {
      setStatus('error');
      setMessage(dict.errorInvalidLink);
      return;
    }

    const unsubscribeUser = async () => {
      try {
        const response = await fetch('/api/user/unsubscribe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token }),
        });

        const result = await response.json();

        if (!response.ok || !result.success) {
          throw new Error(result.error || dict.errorMessageDefault);
        }

        setStatus('success');
        setMessage(dict.successMessage);
      } catch (err) {
        setStatus('error');
        setMessage(
          err instanceof Error ? err.message : dict.errorMessageDefault
        );
      }
    };

    unsubscribeUser();
  }, [searchParams, dict]);

  if (status === 'verifying') {
    return (
      <StandardizedLoadingSpinner
        text={dict.verifying}
        className="w-full max-w-md bg-white rounded-xl shadow-xl p-8"
      />
    );
  }

  const renderIcon = () => {
    switch (status) {
      case 'success':
        return <CheckCircle className="h-12 w-12 text-green-600" />;
      case 'error':
        return <AlertTriangle className="h-12 w-12 text-red-600" />;
      default:
        return null;
    }
  };

  return (
    <div className="w-full max-w-md bg-white rounded-xl shadow-xl p-8 text-center space-y-6">
      <div className="flex justify-center">{renderIcon()}</div>
      <h1 className="text-2xl font-bold text-gray-800">
        {status === 'success' && dict.successTitle}
        {status === 'error' && dict.errorTitle}
      </h1>
      <p className="text-gray-600">{message}</p>
      <Button asChild>
        <Link href="/">
          <Home className="mr-2 h-4 w-4" />
          {dict.backToHomeButton}
        </Link>
      </Button>
    </div>
  );
}
--- End of Content for UnsubscribeClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\unsubscribe\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/unsubscribe/page.tsx
import { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../i18n-config';
import UnsubscribeClient from './UnsubscribeClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

function Loading() {
  return <StandardizedLoadingSpinner text="טוען..." />;
}

type UnsubscribePageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function UnsubscribePage({
  params,
}: UnsubscribePageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <div className="min-h-screen flex items-center justify-center p-4">
      <Suspense fallback={<Loading />}>
        <UnsubscribeClient dict={dictionary.auth.unsubscribePage} />
      </Suspense>
    </div>
  );
}
--- End of Content for page.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\unsubscribe\unsubscribe_contents.txt
--------------------------------------------------------------------------------
Content:
################################################################################
# Directory Content Map For: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\unsubscribe
# Generated on: 2025-10-28 13:40:04
################################################################################

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\unsubscribe
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\unsubscribe\UnsubscribeClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/unsubscribe/UnsubscribeClient.tsx
'use client';

import { useEffect, useState } from 'react';
import { useSearchParams } from 'next/navigation';
import { Loader2, CheckCircle, AlertTriangle, Home } from 'lucide-react';
import { Button } from '@/components/ui/button';
import Link from 'next/link';
import type { UnsubscribePageDict } from '@/types/dictionaries/auth'; // Adjust path as needed

type Status = 'verifying' | 'success' | 'error';

interface UnsubscribeClientProps {
    dict: UnsubscribePageDict;
}

export default function UnsubscribeClient({ dict }: UnsubscribeClientProps) {
    const searchParams = useSearchParams();
    const [status, setStatus] = useState<Status>('verifying');
    const [message, setMessage] = useState(dict.verifying);

    useEffect(() => {
        const token = searchParams.get('token');

        if (!token) {
            setStatus('error');
            setMessage(dict.errorInvalidLink);
            return;
        }

        const unsubscribeUser = async () => {
            try {
                const response = await fetch('/api/user/unsubscribe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token }),
                });

                const result = await response.json();

                if (!response.ok || !result.success) {
                    throw new Error(result.error || dict.errorMessageDefault);
                }

                setStatus('success');
                setMessage(dict.successMessage);
            } catch (err) {
                setStatus('error');
                setMessage(err instanceof Error ? err.message : dict.errorMessageDefault);
            }
        };

        unsubscribeUser();
    }, [searchParams, dict]);

    const renderIcon = () => {
        switch (status) {
            case 'verifying': return <Loader2 className="h-12 w-12 animate-spin text-cyan-600" />;
            case 'success': return <CheckCircle className="h-12 w-12 text-green-600" />;
            case 'error': return <AlertTriangle className="h-12 w-12 text-red-600" />;
        }
    };

    return (
        <div className="w-full max-w-md bg-white rounded-xl shadow-xl p-8 text-center space-y-6">
            <div>{renderIcon()}</div>
            <h1 className="text-2xl font-bold text-gray-800">
                {status === 'verifying' && dict.verifying}
                {status === 'success' && dict.successTitle}
                {status === 'error' && dict.errorTitle}
            </h1>
            <p className="text-gray-600">{message}</p>
            {(status === 'success' || status === 'error') && (
                <Button asChild>
                    <Link href="/">
                        <Home className="mr-2 h-4 w-4" />
                        {dict.backToHomeButton}
                    </Link>
                </Button>
            )}
        </div>
    );
};
--- End of Content for UnsubscribeClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\unsubscribe\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/unsubscribe/page.tsx

import { Suspense } from 'react';
import { Loader2 } from 'lucide-react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../i18n-config';
import UnsubscribeClient from './UnsubscribeClient'; // We'll create this next

function Loading() {
    return <Loader2 className="h-8 w-8 animate-spin" />;
}

type UnsubscribePageProps = {
    params: { locale: Locale };
};

export default async function UnsubscribePage({ params }: UnsubscribePageProps) {
    const { locale } = params;
    const dictionary = await getDictionary(locale);
    
    return (
        <div className="min-h-screen flex items-center justify-center bg-gray-50 p-4">
            <Suspense fallback={<Loading />}>
                <UnsubscribeClient dict={dictionary.auth.unsubscribePage} />
            </Suspense>
        </div>
    );
}
--- End of Content for page.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\unsubscribe\unsubscribe_contents.txt
--------------------------------------------------------------------------------
[This is the output log file itself. Content not included.]

--- End of Content for unsubscribe_contents.txt ---

