################################################################################
# Directory Content Map For: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth
# Generated on: 2025-12-21 02:07:08
# Filter: Only content of code files (.bat, .c, .cfg, .conf, .cpp, .cs, .css, .go, .h, .html, .ini, .java, .js, .json, .jsx, .kt, .less, .md, .php, .py, .rb, .rs, .scss, .sh, .sql, .swift, .ts, .tsx, .txt, .xml, .yaml, .yml) is included.
################################################################################

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\auth_contents.txt
--------------------------------------------------------------------------------
[This is the output log file itself. Content not included.]

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\error
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\error\AuthErrorClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/error/AuthErrorClient.tsx
'use client';

import { useSearchParams, useRouter } from "next/navigation";
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { AlertTriangle } from "lucide-react";
import type { AuthErrorDict } from '@/types/dictionaries/auth';

interface AuthErrorClientProps {
    dict: AuthErrorDict;
}

export default function AuthErrorClient({ dict }: AuthErrorClientProps) {
  const searchParams = useSearchParams();
  const router = useRouter();
  const error = searchParams.get("error");

  const getErrorMessage = (error: string | null) => {
    switch (error) {
      case "CredentialsSignin":
        return dict.errors.CredentialsSignin;
      case "OAuthAccountNotLinked":
        return dict.errors.OAuthAccountNotLinked;
      default:
        return dict.errors.Default;
    }
  };

  return (
    <Card className="w-full max-w-md">
      <CardHeader className="text-center">
        <AlertTriangle className="mx-auto h-12 w-12 text-red-500" />
        <CardTitle className="text-2xl font-bold text-red-600 mt-4">
          {dict.title}
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-4 text-center">
        <p className="text-gray-600">{getErrorMessage(error)}</p>
        <Button onClick={() => router.push("/auth/signin")} className="w-full">
          {dict.backButton}
        </Button>
      </CardContent>
    </Card>
  );
}
--- End of Content for AuthErrorClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\error\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/error/page.tsx
import { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import AuthErrorClient from './AuthErrorClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

function Loading() {
  return <StandardizedLoadingSpinner />;
}

type ErrorPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function ErrorPage({ params }: ErrorPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    // הוסר bg-gray-50
    <div className="min-h-screen flex items-center justify-center p-4">
      <Suspense fallback={<Loading />}>
        <AuthErrorClient dict={dictionary.auth.errorPage} />
      </Suspense>
    </div>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\forgot-password
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\forgot-password\ForgotPasswordClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/forgot-password/ForgotPasswordClient.tsx
'use client';

import { useState, FormEvent } from 'react';
import { useRouter } from 'next/navigation';
import { motion, AnimatePresence } from 'framer-motion';
import Link from 'next/link';
import {
  Mail,
  Loader2,
  AlertCircle,
  ArrowLeft,
  ArrowRight,
  Send,
  KeyRound,
  Sparkles,
  CheckCircle2,
} from 'lucide-react';

import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import type { ForgotPasswordDict } from '@/types/dictionaries/auth';

// ============================================================================
// TYPE DEFINITIONS
// ============================================================================

interface ForgotPasswordClientProps {
  dict: ForgotPasswordDict;
  locale: 'he' | 'en';
}

// ============================================================================
// ANIMATION VARIANTS
// ============================================================================

const containerVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.1,
      delayChildren: 0.2,
    },
  },
};

const itemVariants = {
  hidden: { opacity: 0, y: 20 },
  visible: {
    opacity: 1,
    y: 0,
    transition: { duration: 0.5, ease: 'easeOut' },
  },
};

// ============================================================================
// BACKGROUND COMPONENT (Teal/Orange Theme)
// ============================================================================

const DynamicBackground: React.FC = () => (
  <div className="fixed inset-0 overflow-hidden pointer-events-none -z-10">
    {/* Floating Gradients */}
    <motion.div
      className="absolute top-10 left-10 w-96 h-96 bg-gradient-to-br from-teal-400/20 to-emerald-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, -30, 0],
        x: [0, 20, 0],
        scale: [1, 1.1, 1],
      }}
      transition={{
        duration: 15,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
    />
    <motion.div
      className="absolute top-40 right-20 w-80 h-80 bg-gradient-to-br from-orange-400/20 to-amber-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 40, 0],
        x: [0, -30, 0],
        scale: [1, 1.15, 1],
      }}
      transition={{
        duration: 18,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 1,
      }}
    />
    <motion.div
      className="absolute bottom-32 left-1/4 w-72 h-72 bg-gradient-to-br from-rose-400/15 to-orange-500/15 rounded-full blur-3xl"
      animate={{
        y: [0, -25, 0],
        x: [0, 15, 0],
        scale: [1, 1.08, 1],
      }}
      transition={{
        duration: 20,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 2,
      }}
    />

    {/* Dot Pattern (Teal) */}
    <div className="absolute inset-0 opacity-[0.03] bg-[radial-gradient(#0d9488_1px,transparent_1px)] [background-size:24px_24px]" />

    {/* SVG Decorative Wave (Teal -> Orange) */}
    <svg
      className="absolute inset-0 w-full h-full"
      viewBox="0 0 1000 1000"
      xmlns="http://www.w3.org/2000/svg"
      preserveAspectRatio="none"
    >
      <defs>
        <linearGradient id="waveGrad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stopColor="#0d9488" stopOpacity="0.08" />
          <stop offset="100%" stopColor="#f97316" stopOpacity="0.04" />
        </linearGradient>
      </defs>
      <motion.path
        d="M0,200 C300,100 700,300 1000,200 L1000,0 L0,0 Z"
        fill="url(#waveGrad)"
        initial={{ opacity: 0.6 }}
        animate={{ opacity: [0.6, 0.9, 0.6] }}
        transition={{ duration: 8, repeat: Infinity, ease: 'easeInOut' }}
      />
    </svg>
  </div>
);

// ============================================================================
// MAIN COMPONENT
// ============================================================================

export default function ForgotPasswordClient({
  dict,
  locale,
}: ForgotPasswordClientProps) {
  const router = useRouter();
  const [email, setEmail] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [success, setSuccess] = useState(false);

  const isRTL = locale === 'he';

  const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    setIsLoading(true);
    setError(null);

    if (!email) {
      setError(dict.errors.missingEmail);
      setIsLoading(false);
      return;
    }

    try {
      const response = await fetch(
        `/api/auth/request-password-reset?locale=${locale}`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email }),
        }
      );

      const data = await response.json();

      if (!response.ok || !data.success) {
        throw new Error(data.error || dict.errors.default);
      }

      // Show success message before redirect
      setSuccess(true);

      // Redirect after showing success
      setTimeout(() => {
        router.push(
          `/${locale}/auth/reset-password?email=${encodeURIComponent(email)}`
        );
      }, 1500);
    } catch (err) {
      setError(err instanceof Error ? err.message : dict.errors.default);
      setIsLoading(false);
    }
  };

  return (
    <>
      <DynamicBackground />

      <div className="min-h-screen flex flex-col items-center justify-center p-4 sm:p-8 relative z-10">
        {/* Back to Sign In Link */}
        <motion.div
          initial={{ opacity: 0, x: isRTL ? 20 : -20 }}
          animate={{ opacity: 1, x: 0 }}
          transition={{ duration: 0.5 }}
          className={`absolute top-6 ${isRTL ? 'right-6' : 'left-6'}`}
        >
          <Link
            href={`/${locale}/auth/signin`}
            className="group flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors duration-300"
          >
            {isRTL ? (
              <ArrowRight className="w-4 h-4 group-hover:translate-x-1 transition-transform" />
            ) : (
              <ArrowLeft className="w-4 h-4 group-hover:-translate-x-1 transition-transform" />
            )}
            <span className="text-sm font-medium">
              {locale === 'he' ? 'חזרה להתחברות' : 'Back to Sign In'}
            </span>
          </Link>
        </motion.div>

        {/* Hero Section */}
        <motion.div
          variants={containerVariants}
          initial="hidden"
          animate="visible"
          className="mb-8 text-center"
        >
          <motion.div variants={itemVariants} className="mb-4">
            {/* Key Icon Background: Teal -> Orange */}
            <div className="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-teal-400 to-orange-500 rounded-2xl shadow-lg mb-6">
              <motion.div
                animate={{
                  rotate: [0, -10, 10, -10, 0],
                  scale: [1, 1.1, 1],
                }}
                transition={{
                  duration: 3,
                  repeat: Infinity,
                  ease: 'easeInOut',
                }}
              >
                <KeyRound className="w-10 h-10 text-white" />
              </motion.div>
            </div>
          </motion.div>

          <motion.h1
            variants={itemVariants}
            className="text-3xl md:text-4xl font-bold mb-3"
          >
            {/* Title Gradient: Teal -> Orange -> Amber */}
            <span className="text-transparent bg-clip-text bg-gradient-to-r from-teal-500 via-orange-500 to-amber-500 animate-gradient-slow">
              {dict.title}
            </span>
          </motion.h1>

          <motion.p
            variants={itemVariants}
            className="text-gray-600 text-base md:text-lg max-w-md mx-auto px-4"
          >
            {dict.subtitle}
          </motion.p>

          {/* Decorative Line (Teal -> Orange) */}
          <motion.div variants={itemVariants} className="relative mt-6">
            <div className="w-20 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400 rounded-full mx-auto" />
          </motion.div>
        </motion.div>

        {/* Main Card */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.3 }}
          className="w-full max-w-md"
        >
          <div className="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/60 overflow-hidden relative">
            {/* Top Gradient Line */}
            <div className="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400" />

            {/* Decorative Elements */}
            <div className="absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-teal-400/10 to-transparent rounded-full transform translate-x-20 -translate-y-20 pointer-events-none" />
            <div className="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-br from-orange-400/10 to-transparent rounded-full transform -translate-x-16 translate-y-16 pointer-events-none" />

            <div className="relative z-10 p-6 sm:p-8">
              {/* Success State */}
              <AnimatePresence mode="wait">
                {success ? (
                  <motion.div
                    key="success"
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    exit={{ opacity: 0, scale: 0.9 }}
                    className="text-center py-8"
                  >
                    {/* Success Icon (Green is usually good to keep for success, or switch to Teal) */}
                    <motion.div
                      initial={{ scale: 0 }}
                      animate={{ scale: 1 }}
                      transition={{
                        delay: 0.2,
                        type: 'spring',
                        stiffness: 200,
                      }}
                      className="inline-flex items-center justify-center w-20 h-20 bg-emerald-100 rounded-full mb-6"
                    >
                      <CheckCircle2 className="w-10 h-10 text-emerald-600" />
                    </motion.div>

                    <motion.h2
                      initial={{ opacity: 0, y: 10 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 0.3 }}
                      className="text-2xl font-bold text-gray-800 mb-3"
                    >
                      {locale === 'he' ? 'נשלח בהצלחה!' : 'Email Sent!'}
                    </motion.h2>

                    <motion.p
                      initial={{ opacity: 0, y: 10 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 0.4 }}
                      className="text-gray-600 mb-6"
                    >
                      {locale === 'he'
                        ? 'מעביר אותך לדף איפוס הסיסמה...'
                        : 'Redirecting to reset password...'}
                    </motion.p>

                    <motion.div
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      transition={{ delay: 0.5 }}
                    >
                      {/* Loader -> Teal */}
                      <Loader2 className="w-6 h-6 animate-spin text-teal-500 mx-auto" />
                    </motion.div>
                  </motion.div>
                ) : (
                  <motion.div
                    key="form"
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    exit={{ opacity: 0 }}
                  >
                    {/* Info Box -> Teal/Orange mix */}
                    <motion.div
                      initial={{ opacity: 0, y: -10 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 0.2 }}
                      className="mb-6 p-4 bg-gradient-to-r from-teal-50 to-orange-50 rounded-2xl border border-teal-100"
                    >
                      <div className="flex items-start gap-3">
                        <div className="p-2 bg-white rounded-lg flex-shrink-0">
                          {/* Sparkles -> Teal */}
                          <Sparkles className="w-5 h-5 text-teal-500" />
                        </div>
                        <p className="text-sm text-gray-700 leading-relaxed pt-1">
                          {locale === 'he'
                            ? 'נשלח לך קישור לאיפוס הסיסמה למייל שרשמת'
                            : "We'll send you a link to reset your password"}
                        </p>
                      </div>
                    </motion.div>

                    {/* Error Alert */}
                    <AnimatePresence>
                      {error && (
                        <motion.div
                          initial={{ opacity: 0, y: -10, height: 0 }}
                          animate={{ opacity: 1, y: 0, height: 'auto' }}
                          exit={{ opacity: 0, y: -10, height: 0 }}
                          className="mb-6"
                        >
                          <Alert variant="destructive" className="border-2">
                            <div className="flex items-start gap-3">
                              <div className="p-2 bg-red-100 rounded-lg flex-shrink-0">
                                <AlertCircle className="h-5 w-5 text-red-600" />
                              </div>
                              <div className="flex-1">
                                <AlertTitle className="font-bold mb-1">
                                  {dict.errors.title}
                                </AlertTitle>
                                <AlertDescription className="text-sm">
                                  {error}
                                </AlertDescription>
                              </div>
                            </div>
                          </Alert>
                        </motion.div>
                      )}
                    </AnimatePresence>

                    {/* Form */}
                    <form onSubmit={handleSubmit} className="space-y-6">
                      {/* Email Field */}
                      <div className="space-y-2">
                        <label
                          htmlFor="email-forgot"
                          className="block text-sm font-semibold text-gray-700"
                        >
                          {dict.emailLabel}
                        </label>
                        <div className="relative group">
                          <div
                            className={`absolute ${isRTL ? 'right-3' : 'left-3'} top-1/2 transform -translate-y-1/2 transition-colors ${
                              email ? 'text-teal-500' : 'text-gray-400'
                            }`}
                          >
                            <Mail className="h-5 w-5" />
                          </div>
                          <Input
                            type="email"
                            id="email-forgot"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            placeholder={dict.emailPlaceholder}
                            required
                            // Input Focus -> Teal
                            className={`w-full ${isRTL ? 'pr-11 pl-4' : 'pl-11 pr-4'} py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-teal-200 focus:border-teal-400 focus:outline-none transition-all bg-white/50 backdrop-blur-sm hover:border-gray-300 text-gray-800 placeholder:text-gray-400`}
                            disabled={isLoading}
                            dir={isRTL ? 'rtl' : 'ltr'}
                          />
                        </div>
                      </div>

                      {/* Submit Button -> Teal/Orange/Amber */}
                      <Button
                        type="submit"
                        disabled={isLoading}
                        className="w-full py-4 bg-gradient-to-r from-teal-500 via-orange-500 to-amber-500 hover:from-teal-600 hover:via-orange-600 hover:to-amber-600 shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center gap-2 rounded-xl text-base font-semibold group relative overflow-hidden"
                      >
                        {/* Shine effect */}
                        <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000" />

                        {isLoading ? (
                          <>
                            <Loader2 className="h-5 w-5 animate-spin" />
                            <span>{dict.submitButtonLoading}</span>
                          </>
                        ) : (
                          <>
                            <Send className="w-5 h-5" />
                            <span>{dict.submitButton}</span>
                          </>
                        )}
                      </Button>
                    </form>

                    {/* Back Link */}
                    <div className="mt-8 text-center">
                      <p className="text-gray-600 text-sm">
                        {locale === 'he'
                          ? 'זכרת את הסיסמה?'
                          : 'Remember your password?'}{' '}
                        <Link
                          href={`/${locale}/auth/signin`}
                          className="text-teal-600 font-semibold hover:text-teal-700 hover:underline transition-colors inline-flex items-center gap-1"
                        >
                          {dict.backToSignInLink}
                          {isRTL ? (
                            <ArrowLeft className="w-3 h-3" />
                          ) : (
                            <ArrowRight className="w-3 h-3" />
                          )}
                        </Link>
                      </p>
                    </div>
                  </motion.div>
                )}
              </AnimatePresence>
            </div>

            {/* Bottom Shine Effect -> Teal/Orange */}
            <div className="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400 opacity-50" />
          </div>
        </motion.div>

        {/* Help Text */}
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 0.8, duration: 0.5 }}
          className="mt-8 text-center max-w-md"
        >
          <p className="text-xs text-gray-500">
            {locale === 'he'
              ? 'לא קיבלת מייל? בדוק את תיקיית הספאם או נסה שוב'
              : "Didn't receive an email? Check your spam folder or try again"}
          </p>
        </motion.div>
      </div>

      {/* Animations CSS */}
      <style>{`
        @keyframes gradient-slow {
          0%,
          100% {
            background-position: 0% 50%;
          }
          50% {
            background-position: 100% 50%;
          }
        }
        .animate-gradient-slow {
          background-size: 200% 200%;
          animation: gradient-slow 6s ease infinite;
        }
      `}</style>
    </>
  );
}
--- End of Content for ForgotPasswordClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\forgot-password\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/forgot-password/page.tsx
import Link from 'next/link';
import { ArrowLeft } from 'lucide-react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import ForgotPasswordClient from './ForgotPasswordClient';

// ▼▼▼ כאן השינוי ▼▼▼
type ForgotPasswordPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function ForgotPasswordPage({ params }: ForgotPasswordPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-cyan-50 via-white to-pink-50 p-4 sm:p-8">
      <Link
        href="/"
        className="absolute top-4 left-4 rtl:right-4 rtl:left-auto text-gray-600 hover:text-gray-800 transition-colors flex items-center gap-1 text-sm z-20"
      >
        <ArrowLeft
          className={`h-4 w-4 ${locale === 'he' ? 'transform rotate-180' : ''}`}
        />{' '}
        חזרה לדף הבית
      </Link>
      <ForgotPasswordClient
        dict={dictionary.auth.forgotPassword}
        locale={locale}
      />
    </div>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\register
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\register\RegisterClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/register/RegisterClient.tsx
'use client';

import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

import React, { useEffect, useState } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { useSession } from 'next-auth/react';
import {
  RegistrationProvider,
  useRegistration,
} from '@/components/auth/RegistrationContext';
import Link from 'next/link';
import { motion, AnimatePresence } from 'framer-motion';
import { Info, Sparkles, Heart, Shield } from 'lucide-react';

// Import step components
import WelcomeStep from '@/components/auth/steps/WelcomeStep';
import BasicInfoStep from '@/components/auth/steps/BasicInfoStep';
import EmailVerificationCodeStep from '@/components/auth/steps/EmailVerificationCodeStep';
import PersonalDetailsStep from '@/components/auth/steps/PersonalDetailsStep';
import CompleteStep from '@/components/auth/steps/CompleteStep';
import ProgressBar from '@/components/auth/ProgressBar';

import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import type { User as SessionUserType } from '@/types/next-auth';
import type { RegisterStepsDict } from '@/types/dictionaries/auth';

// ============================================================================
// TYPE DEFINITIONS
// ============================================================================

interface RegisterClientProps {
  dict: RegisterStepsDict;
  locale: 'he' | 'en';
}

// ============================================================================
// ANIMATION VARIANTS
// ============================================================================

const pageTransition = {
  initial: { opacity: 0, y: 20 },
  animate: { opacity: 1, y: 0 },
  exit: { opacity: 0, y: -20 },
  transition: { duration: 0.4, ease: 'easeOut' },
};

const containerVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.1,
      delayChildren: 0.2,
    },
  },
};

const itemVariants = {
  hidden: { opacity: 0, y: 20 },
  visible: {
    opacity: 1,
    y: 0,
    transition: { duration: 0.5, ease: 'easeOut' },
  },
};

// ============================================================================
// BACKGROUND COMPONENT (Teal/Orange Theme)
// ============================================================================

const DynamicBackground: React.FC = () => (
  <div className="fixed inset-0 overflow-hidden pointer-events-none -z-10">
    {/* Floating Gradients */}
    <motion.div
      className="absolute top-10 left-10 w-96 h-96 bg-gradient-to-br from-teal-400/20 to-emerald-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, -30, 0],
        x: [0, 20, 0],
        scale: [1, 1.1, 1],
      }}
      transition={{
        duration: 15,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
    />
    <motion.div
      className="absolute top-40 right-20 w-80 h-80 bg-gradient-to-br from-orange-400/20 to-amber-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 40, 0],
        x: [0, -30, 0],
        scale: [1, 1.15, 1],
      }}
      transition={{
        duration: 18,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 1,
      }}
    />
    <motion.div
      className="absolute bottom-32 left-1/4 w-72 h-72 bg-gradient-to-br from-rose-400/15 to-orange-500/15 rounded-full blur-3xl"
      animate={{
        y: [0, -25, 0],
        x: [0, 15, 0],
        scale: [1, 1.08, 1],
      }}
      transition={{
        duration: 20,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 2,
      }}
    />
    <motion.div
      className="absolute bottom-20 right-10 w-64 h-64 bg-gradient-to-br from-teal-400/20 to-cyan-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 35, 0],
        scale: [1, 1.12, 1],
      }}
      transition={{
        duration: 16,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 0.5,
      }}
    />

    {/* Dot Pattern (Teal Accent) */}
    <div className="absolute inset-0 opacity-[0.03] bg-[radial-gradient(#0d9488_1px,transparent_1px)] [background-size:24px_24px]" />

    {/* SVG Decorative Waves (Teal -> Orange) */}
    <svg
      className="absolute inset-0 w-full h-full"
      viewBox="0 0 1000 1000"
      xmlns="http://www.w3.org/2000/svg"
      preserveAspectRatio="none"
    >
      <defs>
        <linearGradient id="waveGrad1" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stopColor="#0d9488" stopOpacity="0.08" />{' '}
          {/* Teal */}
          <stop offset="100%" stopColor="#f97316" stopOpacity="0.04" />{' '}
          {/* Orange */}
        </linearGradient>
        <linearGradient id="waveGrad2" x1="100%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stopColor="#f59e0b" stopOpacity="0.06" />{' '}
          {/* Amber */}
          <stop offset="100%" stopColor="#14b8a6" stopOpacity="0.03" />{' '}
          {/* Teal */}
        </linearGradient>
      </defs>
      <motion.path
        d="M0,200 C300,100 700,300 1000,200 L1000,0 L0,0 Z"
        fill="url(#waveGrad1)"
        initial={{ opacity: 0.6 }}
        animate={{ opacity: [0.6, 0.9, 0.6] }}
        transition={{ duration: 8, repeat: Infinity, ease: 'easeInOut' }}
      />
      <motion.path
        d="M0,800 C300,700 700,900 1000,800 L1000,1000 L0,1000 Z"
        fill="url(#waveGrad2)"
        initial={{ opacity: 0.6 }}
        animate={{ opacity: [0.6, 0.8, 0.6] }}
        transition={{
          duration: 10,
          repeat: Infinity,
          ease: 'easeInOut',
          delay: 2,
        }}
      />
    </svg>
  </div>
);

// ============================================================================
// HERO SECTION
// ============================================================================

interface HeroSectionProps {
  title: string;
  subtitle: string;
  locale: 'he' | 'en';
}

const HeroSection: React.FC<HeroSectionProps> = ({
  title,
  subtitle,
  locale,
}) => {
  const isRTL = locale === 'he';

  return (
    <motion.div
      variants={containerVariants}
      initial="hidden"
      animate="visible"
      className="mb-8 text-center"
    >
      <motion.div variants={itemVariants} className="mb-4">
        <div className="inline-flex items-center gap-3 bg-white/80 backdrop-blur-sm rounded-full px-6 py-3 shadow-lg border border-white/60 mb-6">
          <motion.div
            animate={{ rotate: [0, 10, -10, 0] }}
            transition={{ duration: 2, repeat: Infinity, ease: 'easeInOut' }}
          >
            {/* Sparkles - Teal (Tech) */}
            <Sparkles className="w-5 h-5 text-teal-500" />
          </motion.div>
          <span className="text-sm font-medium text-gray-700">
            {locale === 'he' ? 'הצעד הראשון למסע שלכם' : 'Your First Step'}
          </span>
          {/* Heart - Orange (Human) */}
          <Heart className="w-5 h-5 text-orange-500" />
        </div>
      </motion.div>

      <motion.h1
        variants={itemVariants}
        className="text-3xl md:text-4xl lg:text-5xl font-bold mb-4"
      >
        {/* Main Gradient Text */}
        <span className="text-transparent bg-clip-text bg-gradient-to-r from-teal-500 via-orange-500 to-amber-500 animate-gradient-slow">
          {title}
        </span>
      </motion.h1>

      <motion.p
        variants={itemVariants}
        className="text-gray-600 text-base md:text-lg max-w-2xl mx-auto leading-relaxed px-4"
        style={{
          direction: isRTL ? 'rtl' : 'ltr',
          textAlign: 'center',
        }}
      >
        {subtitle}
      </motion.p>

      {/* Decorative Line (Teal -> Orange) */}
      <motion.div variants={itemVariants} className="relative mt-6">
        <div className="w-24 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400 rounded-full mx-auto" />
        <motion.div
          className="absolute top-0 left-1/2 -translate-x-1/2 w-2 h-2 bg-white rounded-full border-2 border-orange-400"
          animate={{ scale: [1, 1.3, 1] }}
          transition={{ duration: 2, repeat: Infinity, ease: 'easeInOut' }}
        />
      </motion.div>
    </motion.div>
  );
};

// ============================================================================
// MAIN REGISTRATION STEPS CONTENT
// ============================================================================

const RegisterStepsContent: React.FC<{
  dict: RegisterStepsDict;
  locale: 'he' | 'en';
}> = ({ dict, locale }) => {
  const {
    data: registrationContextData,
    initializeFromSession,
    resetForm,
    goToStep,
  } = useRegistration();
  const router = useRouter();
  const { data: session, status: sessionStatus } = useSession();
  const searchParams = useSearchParams();

  const [showIncompleteProfileMessage, setShowIncompleteProfileMessage] =
    useState(false);
  const [initializationAttempted, setInitializationAttempted] = useState(false);

  const isRTL = locale === 'he';

  // Handle incomplete profile message
  useEffect(() => {
    const reasonParam = searchParams.get('reason');
    if (
      (reasonParam === 'complete_profile' || reasonParam === 'verify_phone') &&
      !registrationContextData.isCompletingProfile
    ) {
      setShowIncompleteProfileMessage(true);
    } else {
      setShowIncompleteProfileMessage(false);
    }
  }, [searchParams, registrationContextData.isCompletingProfile]);

  // Initialize from session
  useEffect(() => {
    if (sessionStatus === 'loading') return;

    if (sessionStatus === 'authenticated' && session?.user) {
      const user = session.user as SessionUserType;
      if (
        user.isProfileComplete &&
        user.isPhoneVerified &&
        user.termsAndPrivacyAcceptedAt
      ) {
        if (
          typeof window !== 'undefined' &&
          window.location.pathname !== `/${locale}/profile`
        ) {
          router.push(`/${locale}/profile`);
        }
        return;
      }

      const needsSetup =
        !user.termsAndPrivacyAcceptedAt ||
        !user.isProfileComplete ||
        !user.isPhoneVerified;
      if (
        needsSetup &&
        (!initializationAttempted ||
          (registrationContextData.step === 0 &&
            !registrationContextData.isVerifyingEmailCode))
      ) {
        initializeFromSession(user);
        setInitializationAttempted(true);
      }
    }
  }, [
    sessionStatus,
    session,
    router,
    registrationContextData,
    initializeFromSession,
    resetForm,
    goToStep,
    initializationAttempted,
    searchParams,
    locale,
  ]);

  // Render appropriate step
  const renderStep = (): React.ReactNode => {
    if (sessionStatus === 'loading') {
      return (
        <StandardizedLoadingSpinner
          text={locale === 'he' ? 'טוען...' : 'Loading...'}
          className="min-h-[400px]"
        />
      );
    }

    if (
      registrationContextData.isVerifyingEmailCode &&
      !registrationContextData.isCompletingProfile
    ) {
      return (
        <EmailVerificationCodeStep
          dict={dict.steps.emailVerification}
          locale={locale}
        />
      );
    }

    if (registrationContextData.isCompletingProfile) {
      switch (registrationContextData.step) {
        case 2:
          return (
            <PersonalDetailsStep
              personalDetailsDict={dict.steps.personalDetails}
              optionalInfoDict={dict.steps.optionalInfo}
              consentDict={dict.consentCheckbox}
              validationDict={dict.validationErrors} // הוספה כאן: העברת המילון החדש
              locale={locale}
            />
          );
        case 4:
          return <CompleteStep dict={dict.steps.complete} />;
        default:
          resetForm();
          return <WelcomeStep dict={dict.steps.welcome} locale={locale} />;
      }
    }

    switch (registrationContextData.step) {
      case 0:
        return <WelcomeStep dict={dict.steps.welcome} locale={locale} />;
      case 1:
        return (
          <BasicInfoStep
            dict={dict.steps.basicInfo}
            consentDict={dict.consentCheckbox}
            validationDict={dict.validationErrors} // הוספה כאן: העברת המילון החדש
            locale={locale}
          />
        );
      default:
        resetForm();
        return <WelcomeStep dict={dict.steps.welcome} locale={locale} />;
    }
  };

  // Determine page title and progress
  let pageTitle = dict.headers.registerTitle;
  let stepDescription = dict.headers.welcomeDescription;
  let currentProgressBarStep = 0;
  let totalProgressBarSteps = 3;
  let showProgressBar = false;

  if (
    registrationContextData.isVerifyingEmailCode &&
    !registrationContextData.isCompletingProfile
  ) {
    // Flow A: Account Creation -> Email Verify
    pageTitle = dict.headers.verifyEmailTitle;
    stepDescription = dict.headers.verifyEmailDescription.replace(
      '{{email}}',
      registrationContextData.emailForVerification || ''
    );
    showProgressBar = true;
    currentProgressBarStep = 2; // Step 2 of 2
    totalProgressBarSteps = 2;
  } else if (registrationContextData.isCompletingProfile) {
    // Flow B: Profile Completion (Google / Post-Email)
    pageTitle = dict.headers.completeProfileTitle;
    totalProgressBarSteps = 2; // Fixed: Now it's 2 steps (Details + Phone)

    if (registrationContextData.step === 2) {
      // Step 1: Personal Details
      stepDescription = session?.user?.termsAndPrivacyAcceptedAt
        ? dict.headers.personalDetailsConsentedDescription
        : dict.headers.personalDetailsDescription;
      currentProgressBarStep = 1; // Step 1 of 2
      showProgressBar = true;
    } else if (registrationContextData.step === 4) {
      // Transition state
      stepDescription = session?.user?.isPhoneVerified
        ? dict.headers.completionReadyDescription
        : dict.headers.completionPhoneVerificationDescription;
      showProgressBar = false;
    } else {
      stepDescription = dict.headers.loadingProfileDescription;
      showProgressBar = false;
    }
  } else {
    // Initial Register Flow
    if (registrationContextData.step === 1) {
      pageTitle = dict.headers.registerTitle;
      stepDescription = dict.headers.accountCreationDescription;
      currentProgressBarStep = 1; // Step 1 of 2 (Account Creation)
      totalProgressBarSteps = 2;
      showProgressBar = true;
    }
  }

  const isWideStep =
    registrationContextData.isCompletingProfile &&
    registrationContextData.step === 2;

  return (
    <>
      <DynamicBackground />

      <div className="min-h-screen flex flex-col items-center justify-center p-4 sm:p-8 relative z-10">
        {/* Hero Section */}
        <HeroSection
          title={pageTitle}
          subtitle={stepDescription}
          locale={locale}
        />

        {/* Incomplete Profile Alert */}
        <AnimatePresence>
          {showIncompleteProfileMessage && (
            <motion.div
              initial={{ opacity: 0, y: -20, scale: 0.95 }}
              animate={{ opacity: 1, y: 0, scale: 1 }}
              exit={{ opacity: 0, y: -20, scale: 0.95 }}
              transition={{ duration: 0.3 }}
              className="w-full max-w-md md:max-w-2xl mb-6 mx-auto"
            >
              <Alert className="bg-gradient-to-r from-amber-50 to-orange-50 border-2 border-amber-200 shadow-lg">
                <div className="flex items-start gap-3">
                  <div className="p-2 bg-amber-100 rounded-lg">
                    <Info className="h-5 w-5 text-amber-600" />
                  </div>
                  <div className="flex-1">
                    <AlertTitle className="font-bold text-amber-900 mb-1">
                      {dict.incompleteProfileAlert.title}
                    </AlertTitle>
                    <AlertDescription className="text-sm text-amber-800 leading-relaxed">
                      {searchParams.get('reason') === 'verify_phone'
                        ? dict.incompleteProfileAlert.verifyPhoneDescription
                        : dict.incompleteProfileAlert.description}
                    </AlertDescription>
                  </div>
                </div>
              </Alert>
            </motion.div>
          )}
        </AnimatePresence>

        {/* Progress Bar */}
        <AnimatePresence>
          {showProgressBar && (
            <motion.div
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -10 }}
              transition={{ duration: 0.4 }}
              className="w-full max-w-md md:max-w-2xl mb-6 mx-auto"
            >
              <ProgressBar
                currentStep={currentProgressBarStep}
                totalSteps={totalProgressBarSteps}
                stepLabel={dict.progressBar.stepLabel}
                locale={locale}
              />
            </motion.div>
          )}
        </AnimatePresence>

        {/* Main Card Container */}
        <motion.div
          {...pageTransition}
          className="w-full max-w-md md:max-w-2xl relative"
        >
          <div className="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/60 overflow-hidden relative">
            {/* Decorative Elements - POINTER EVENTS NONE */}
            <div className="absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-teal-400/10 to-transparent rounded-full transform translate-x-20 -translate-y-20 pointer-events-none" />
            <div className="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-br from-orange-400/10 to-transparent rounded-full transform -translate-x-16 translate-y-16 pointer-events-none" />

            {/* Content - Z-10 RELATIVE */}
            <div className="relative z-10 p-6 sm:p-8 md:p-12">
              <AnimatePresence mode="wait">
                <motion.div
                  key={registrationContextData.step}
                  initial={{ opacity: 0, x: isRTL ? -20 : 20 }}
                  animate={{ opacity: 1, x: 0 }}
                  exit={{ opacity: 0, x: isRTL ? 20 : -20 }}
                  transition={{ duration: 0.3 }}
                  className={isWideStep ? 'w-full' : 'max-w-md mx-auto'}
                >
                  {renderStep()}
                </motion.div>
              </AnimatePresence>
            </div>

            {/* Bottom Shine Effect (Teal -> Orange) */}
            <div className="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400 opacity-50 pointer-events-none" />
          </div>
        </motion.div>

        {/* Support Link */}
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 0.5, duration: 0.5 }}
          className="mt-8 text-center"
        >
          <p className="text-sm text-gray-500">
            {dict.contactSupport}{' '}
            <Link
              href={`/${locale}/contact`}
              className="text-teal-600 hover:text-teal-700 font-medium hover:underline transition-colors inline-flex items-center gap-1"
            >
              {dict.contactSupportLink}
              <Shield className="w-3 h-3" />
            </Link>
          </p>
        </motion.div>
      </div>

      {/* Animations CSS */}
      <style>{`
        @keyframes gradient-slow {
          0%,
          100% {
            background-position: 0% 50%;
          }
          50% {
            background-position: 100% 50%;
          }
        }
        .animate-gradient-slow {
          background-size: 200% 200%;
          animation: gradient-slow 6s ease infinite;
        }
      `}</style>
    </>
  );
};

// ============================================================================
// MAIN EXPORT WITH PROVIDER
// ============================================================================

export default function RegisterClient({ dict, locale }: RegisterClientProps) {
  return (
    <RegistrationProvider>
      <RegisterStepsContent dict={dict} locale={locale} />
    </RegistrationProvider>
  );
}
--- End of Content for RegisterClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\register\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/register/page.tsx
import { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import RegisterClient from './RegisterClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

// עדכון רכיב הטעינה
function Loading() {
  return <StandardizedLoadingSpinner />;
}

type RegisterPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function RegisterPage({ params }: RegisterPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <Suspense fallback={<Loading />}>
      <RegisterClient
        dict={dictionary.auth.register}
        locale={locale}
      />
    </Suspense>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\reset-password
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\reset-password\ResetPasswordClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/reset-password/ResetPasswordClient.tsx
'use client';

import { useState, FormEvent, useEffect } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import {
  Lock,
  KeySquare,
  Loader2,
  AlertCircle,
  CheckCircle,
  Eye,
  EyeOff,
  Mail,
} from 'lucide-react';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import Link from 'next/link';
import type { ResetPasswordDict } from '@/types/dictionaries/auth';

interface ResetPasswordClientProps {
  dict: ResetPasswordDict;
  locale: 'he' | 'en'; // הוסף
}

const validatePassword = (
  value: string,
  validationMessage: string
): string | null => {
  const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/;
  if (!passwordRegex.test(value)) {
    return validationMessage;
  }
  return null;
};

export default function ResetPasswordClient({
  dict,
  locale,
}: ResetPasswordClientProps) {
  const router = useRouter();
  const searchParams = useSearchParams();

  const [email, setEmail] = useState('');
  const [otp, setOtp] = useState('');
  const [newPassword, setNewPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [passwordError, setPasswordError] = useState<string | null>(null);
  const [successMessage, setSuccessMessage] = useState<string | null>(null);
  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);

  useEffect(() => {
    const emailFromQuery = searchParams.get('email');
    if (emailFromQuery) setEmail(emailFromQuery);
  }, [searchParams]);

  const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    setIsLoading(true);
    setError(null);
    setPasswordError(null);

    if (!email) {
      setError(dict.errors.missingEmail);
      setIsLoading(false);
      return;
    }
    if (!otp || otp.length !== 6 || !/^\d+$/.test(otp)) {
      setError(dict.errors.invalidOtp);
      setIsLoading(false);
      return;
    }
    const passValidationError = validatePassword(
      newPassword,
      dict.passwordValidation.length
    );
    if (passValidationError) {
      setPasswordError(passValidationError);
      setIsLoading(false);
      return;
    }
    if (newPassword !== confirmPassword) {
      setError(dict.errors.passwordsMismatch);
      setIsLoading(false);
      return;
    }

    try {
      const response = await fetch(
        `/api/auth/reset-password?locale=${locale}`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, otp, newPassword }),
        }
      );
      const data = await response.json();
      if (!response.ok) throw new Error(data.error || dict.errors.default);

      setSuccessMessage(dict.successMessage);
      setTimeout(() => router.push('/auth/signin?reset=success'), 3000);
    } catch (err) {
      setError(err instanceof Error ? err.message : dict.errors.default);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="w-full max-w-md bg-white rounded-xl shadow-xl overflow-hidden relative">
      <div className="absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-cyan-500 to-pink-500"></div>
      <div className="p-6 sm:p-8">
        <div className="text-center mb-6">
          <h1 className="text-2xl font-bold text-gray-800 mb-2">
            {dict.title}
          </h1>
          <p className="text-gray-600 text-sm">{dict.subtitle}</p>
        </div>

        {error && (
          <Alert variant="destructive" className="mb-4" role="alert">
            <AlertCircle className="h-4 w-4" />
            <AlertTitle>שגיאה</AlertTitle>
            <AlertDescription>{error}</AlertDescription>
          </Alert>
        )}
        {passwordError && !error && (
          <Alert variant="destructive" className="mb-4" role="alert">
            <AlertCircle className="h-4 w-4" />
            <AlertTitle>שגיאת סיסמה</AlertTitle>
            <AlertDescription>{passwordError}</AlertDescription>
          </Alert>
        )}
        {successMessage && (
          <Alert className="mb-4 bg-green-50">
            <CheckCircle className="h-4 w-4 text-green-600" />
            <AlertTitle>הצלחה!</AlertTitle>
            <AlertDescription>
              {successMessage} {dict.successRedirect}
            </AlertDescription>
          </Alert>
        )}

        {!successMessage && (
          <form onSubmit={handleSubmit} className="space-y-5">
            <div className="space-y-1">
              <label
                htmlFor="email-reset"
                className="block text-sm font-medium text-gray-700"
              >
                {dict.emailLabel} <span className="text-red-500">*</span>
              </label>
              <div className="relative">
                <Mail className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5" />
                <Input
                  type="email"
                  id="email-reset"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  placeholder={dict.emailPlaceholder}
                  required
                  disabled={isLoading || !!searchParams.get('email')}
                />
              </div>
            </div>
            <div className="space-y-1">
              <label
                htmlFor="otp-reset"
                className="block text-sm font-medium text-gray-700"
              >
                {dict.otpLabel} <span className="text-red-500">*</span>
              </label>
              <div className="relative">
                <KeySquare className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5" />
                <Input
                  type="text"
                  id="otp-reset"
                  value={otp}
                  onChange={(e) =>
                    setOtp(e.target.value.replace(/[^0-9]/g, '').slice(0, 6))
                  }
                  placeholder={dict.otpPlaceholder}
                  maxLength={6}
                  required
                  disabled={isLoading}
                  inputMode="numeric"
                />
              </div>
            </div>
            <div className="space-y-1">
              <label
                htmlFor="new-password-reset"
                className="block text-sm font-medium text-gray-700"
              >
                {dict.newPasswordLabel} <span className="text-red-500">*</span>
              </label>
              <div className="relative">
                <Lock className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5" />
                <Input
                  type={showPassword ? 'text' : 'password'}
                  id="new-password-reset"
                  value={newPassword}
                  onChange={(e) => setNewPassword(e.target.value)}
                  onBlur={(e) =>
                    setPasswordError(
                      validatePassword(
                        e.target.value,
                        dict.passwordValidation.length
                      )
                    )
                  }
                  placeholder={dict.newPasswordPlaceholder}
                  required
                  disabled={isLoading}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute left-3 top-1/2 -translate-y-1/2"
                  aria-label={
                    showPassword ? dict.hidePasswordAria : dict.showPasswordAria
                  }
                >
                  {showPassword ? (
                    <EyeOff className="h-5 w-5" />
                  ) : (
                    <Eye className="h-5 w-5" />
                  )}
                </button>
              </div>
              {!passwordError && (
                <p className="mt-1 text-xs text-gray-500">
                  {dict.passwordHint}
                </p>
              )}
            </div>
            <div className="space-y-1">
              <label
                htmlFor="confirm-password-reset"
                className="block text-sm font-medium text-gray-700"
              >
                {dict.confirmPasswordLabel}{' '}
                <span className="text-red-500">*</span>
              </label>
              <div className="relative">
                <Lock className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5" />
                <Input
                  type={showConfirmPassword ? 'text' : 'password'}
                  id="confirm-password-reset"
                  value={confirmPassword}
                  onChange={(e) => setConfirmPassword(e.target.value)}
                  placeholder={dict.confirmPasswordPlaceholder}
                  required
                  disabled={isLoading}
                />
                <button
                  type="button"
                  onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                  className="absolute left-3 top-1/2 -translate-y-1/2"
                  aria-label={
                    showConfirmPassword
                      ? dict.hidePasswordAria
                      : dict.showPasswordAria
                  }
                >
                  {showConfirmPassword ? (
                    <EyeOff className="h-5 w-5" />
                  ) : (
                    <Eye className="h-5 w-5" />
                  )}
                </button>
              </div>
            </div>
            <Button
              type="submit"
              disabled={
                isLoading ||
                !!passwordError ||
                !otp ||
                !newPassword ||
                !confirmPassword ||
                newPassword !== confirmPassword
              }
              className="w-full"
            >
              {isLoading ? (
                <>
                  <Loader2 className="h-5 w-5 animate-spin mr-2" />
                  <span>{dict.submitButtonLoading}</span>
                </>
              ) : (
                dict.submitButton
              )}
            </Button>
          </form>
        )}

        <div className="mt-6 text-center">
          <Link
            href="/auth/signin"
            className="text-sm text-cyan-600 hover:text-cyan-700 hover:underline"
          >
            {dict.backToSignInLink}
          </Link>
        </div>
      </div>
    </div>
  );
}
--- End of Content for ResetPasswordClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\reset-password\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/reset-password/page.tsx
import { Suspense } from 'react';
import Link from 'next/link';
import { ArrowLeft } from 'lucide-react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import ResetPasswordClient from './ResetPasswordClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

// עדכון רכיב הטעינה
function Loading() {
  return <StandardizedLoadingSpinner />;
}

type ResetPasswordPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function ResetPasswordPage({ params }: ResetPasswordPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-cyan-50 via-white to-pink-50 p-4 sm:p-8">
      <Link
        href="/"
        className="absolute top-4 left-4 rtl:right-4 rtl:left-auto text-gray-600 hover:text-gray-800 transition-colors flex items-center gap-1 text-sm z-20"
      >
        <ArrowLeft
          className={`h-4 w-4 ${locale === 'he' ? 'transform rotate-180' : ''}`}
        />{' '}
        חזרה לדף הבית
      </Link>
      <Suspense fallback={<Loading />}>
        <ResetPasswordClient
          dict={dictionary.auth.resetPassword}
          locale={locale}
        />
      </Suspense>
    </div>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\setup-account
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\setup-account\SetupAccountClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/setup-account/SetupAccountClient.tsx
'use client';

import React, { useState, useEffect } from 'react';
import { useSearchParams } from 'next/navigation';
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
  CardDescription,
  CardFooter,
} from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { toast } from 'sonner';
import { Loader2, KeyRound } from 'lucide-react';
import type { SetupAccountDict } from '@/types/dictionaries/auth';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

interface SetupAccountClientProps {
  dict: SetupAccountDict;
}

export default function SetupAccountClient({ dict }: SetupAccountClientProps) {
  const searchParams = useSearchParams();
  const [token, setToken] = useState<string | null>(null);
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState('');
  const [success, setSuccess] = useState(false);

  useEffect(() => {
    const tokenFromUrl = searchParams.get('token');
    if (tokenFromUrl) {
      setToken(tokenFromUrl);
    } else {
      setError(dict.errors.linkInvalid);
    }
  }, [searchParams, dict.errors.linkInvalid]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    if (password.length < 8) {
      setError(dict.errors.passwordLength);
      return;
    }
    if (password !== confirmPassword) {
      setError(dict.errors.passwordsMismatch);
      return;
    }

    setIsLoading(true);

    try {
      const response = await fetch('/api/auth/complete-setup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token, password }),
      });
      const result = await response.json();
      if (!response.ok) throw new Error(result.error || dict.errors.default);

      setSuccess(true);
      toast.success(dict.success.title);

      setTimeout(() => {
        window.location.assign('/profile');
      }, 1500);
    } catch (err) {
      setError(err instanceof Error ? err.message : dict.errors.unexpected);
      setIsLoading(false);
    }
  };

  if (success) {
    return (
      <div className="w-full max-w-md mx-auto">
        <StandardizedLoadingSpinner
          text={dict.success.title}
          subtext={dict.success.description}
          className="bg-white rounded-xl shadow-lg p-8"
        />
      </div>
    );
  }

  return (
    <Card className="w-full max-w-md mx-auto">
      <CardHeader>
        <CardTitle>{dict.title}</CardTitle>
        <CardDescription>{dict.description}</CardDescription>
      </CardHeader>
      <CardContent>
        {!token ? (
          <div className="text-red-500 text-center p-4 bg-red-50 rounded-md">
            {error}
          </div>
        ) : (
          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <Label htmlFor="password">{dict.newPasswordLabel}</Label>
              <Input
                id="password"
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
              />
              <p className="text-xs text-muted-foreground mt-1">
                {dict.passwordHint}
              </p>
            </div>
            <div>
              <Label htmlFor="confirmPassword">
                {dict.confirmPasswordLabel}
              </Label>
              <Input
                id="confirmPassword"
                type="password"
                value={confirmPassword}
                onChange={(e) => setConfirmPassword(e.target.value)}
                required
              />
            </div>
            {error && (
              <p className="text-sm font-medium text-destructive">{error}</p>
            )}
            <CardFooter className="p-0 pt-4">
              <Button type="submit" className="w-full" disabled={isLoading}>
                {isLoading ? (
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                ) : (
                  <KeyRound className="mr-2 h-4 w-4" />
                )}
                {isLoading ? dict.submitButtonLoading : dict.submitButton}
              </Button>
            </CardFooter>
          </form>
        )}
      </CardContent>
    </Card>
  );
}
--- End of Content for SetupAccountClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\setup-account\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/setup-account/page.tsx
import { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import SetupAccountClient from './SetupAccountClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

function Loading() {
  return <StandardizedLoadingSpinner />;
}

type SetupAccountPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function SetupAccountPage({ params }: SetupAccountPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    // הסרתי את bg-gray-100 לטובת הגרדיאנט המובנה או נקי
    <div className="flex items-center justify-center min-h-screen p-4">
      <Suspense fallback={<Loading />}>
        <SetupAccountClient dict={dictionary.auth.setupAccount} />
      </Suspense>
    </div>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\signin
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\signin\SignInClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/signin/SignInClient.tsx
'use client';

import { useState, useEffect, FormEvent } from 'react';
import { useSearchParams, useRouter } from 'next/navigation';
import { useSession, signIn } from 'next-auth/react';
import { motion, AnimatePresence } from 'framer-motion';
import Link from 'next/link';
import {
  Mail,
  Lock,
  AlertCircle,
  Loader2,
  ArrowLeft,
  ArrowRight,
  Sparkles,
  Heart,
  Shield,
  Eye,
  EyeOff,
} from 'lucide-react';

import { Button } from '@/components/ui/button';
import { Label } from '@/components/ui/label';
import type { SignInDict } from '@/types/dictionaries/auth';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

// ============================================================================
// TYPE DEFINITIONS
// ============================================================================

interface SignInClientProps {
  dict: SignInDict;
  locale: 'he' | 'en';
}

// ============================================================================
// ANIMATION VARIANTS
// ============================================================================

const containerVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.1,
      delayChildren: 0.2,
    },
  },
};

const itemVariants = {
  hidden: { opacity: 0, y: 20 },
  visible: {
    opacity: 1,
    y: 0,
    transition: { duration: 0.5, ease: 'easeOut' },
  },
};

// ============================================================================
// BACKGROUND COMPONENT
// ============================================================================

const DynamicBackground: React.FC = () => (
  <div className="fixed inset-0 overflow-hidden pointer-events-none -z-10">
    {/* Floating Gradients */}
    <motion.div
      className="absolute top-10 left-10 w-96 h-96 bg-gradient-to-br from-teal-400/20 to-emerald-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, -30, 0],
        x: [0, 20, 0],
        scale: [1, 1.1, 1],
      }}
      transition={{
        duration: 15,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
    />
    <motion.div
      className="absolute top-40 right-20 w-80 h-80 bg-gradient-to-br from-orange-400/20 to-amber-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 40, 0],
        x: [0, -30, 0],
        scale: [1, 1.15, 1],
      }}
      transition={{
        duration: 18,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 1,
      }}
    />
    <motion.div
      className="absolute bottom-32 left-1/4 w-72 h-72 bg-gradient-to-br from-rose-400/15 to-orange-500/15 rounded-full blur-3xl"
      animate={{
        y: [0, -25, 0],
        x: [0, 15, 0],
        scale: [1, 1.08, 1],
      }}
      transition={{
        duration: 20,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 2,
      }}
    />
    <motion.div
      className="absolute bottom-20 right-10 w-64 h-64 bg-gradient-to-br from-teal-400/20 to-cyan-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 35, 0],
        scale: [1, 1.12, 1],
      }}
      transition={{
        duration: 16,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 0.5,
      }}
    />

    {/* Dot Pattern */}
    <div className="absolute inset-0 opacity-[0.03] bg-[radial-gradient(#0d9488_1px,transparent_1px)] [background-size:24px_24px]" />

    {/* SVG Decorative Waves */}
    <svg
      className="absolute inset-0 w-full h-full"
      viewBox="0 0 1000 1000"
      xmlns="http://www.w3.org/2000/svg"
      preserveAspectRatio="none"
    >
      <defs>
        <linearGradient id="waveGrad1" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stopColor="#0d9488" stopOpacity="0.08" />
          <stop offset="100%" stopColor="#f97316" stopOpacity="0.04" />
        </linearGradient>
      </defs>
      <motion.path
        d="M0,200 C300,100 700,300 1000,200 L1000,0 L0,0 Z"
        fill="url(#waveGrad1)"
        initial={{ opacity: 0.6 }}
        animate={{ opacity: [0.6, 0.9, 0.6] }}
        transition={{ duration: 8, repeat: Infinity, ease: 'easeInOut' }}
      />
    </svg>
  </div>
);

// ============================================================================
// MAIN SIGNIN COMPONENT
// ============================================================================

export default function SignInClient({ dict, locale }: SignInClientProps) {
  const router = useRouter();
  const searchParams = useSearchParams();
  const { data: session, status } = useSession();

  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  const [error, setError] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [isGoogleLoading, setIsGoogleLoading] = useState(false);
  const [shouldShake, setShouldShake] = useState(false);

  const isRTL = locale === 'he';

  // Handle authenticated redirect
  useEffect(() => {
    if (status === 'authenticated') {
      const redirectUrl = session?.redirectUrl || `/${locale}/profile`;
      router.push(redirectUrl);
    }
  }, [status, session, router, locale]);

  // Handle URL error parameters
  useEffect(() => {
    const errorMessage = searchParams.get('error');
    if (errorMessage) {
      switch (errorMessage) {
        case 'CredentialsSignin':
          setError(dict.errors.credentialsSignin);
          break;
        case 'OAuthAccountNotLinked':
          setError(dict.errors.oauthAccountNotLinked);
          break;
        default:
          setError(dict.errors.default.replace('{errorMessage}', errorMessage));
      }
      setShouldShake(true);
      setTimeout(() => setShouldShake(false), 500);
    }
  }, [searchParams, dict.errors]);

  const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    setError('');
    setIsLoading(true);

    if (!email || !password) {
      setError(dict.errors.missingFields);
      setShouldShake(true);
      setTimeout(() => setShouldShake(false), 500);
      setIsLoading(false);
      return;
    }

    const result = await signIn('credentials', {
      email: email.toLowerCase(),
      password,
      redirect: false,
    });

    if (result?.error) {
      setError(dict.errors.credentialsSignin);
      setShouldShake(true);
      setTimeout(() => setShouldShake(false), 500);
    }

    setIsLoading(false);
  };

  const handleGoogleSignIn = async () => {
    setIsGoogleLoading(true);
    setError('');
    await signIn('google', undefined, { hl: locale });
  };

  // Show loading state
  if (status === 'loading' || status === 'authenticated') {
    const loadingText =
      status === 'authenticated' ? dict.loader.success : dict.loader.loading;
    const subText =
      status === 'authenticated'
        ? dict.loader.redirecting
        : dict.loader.checking;

    return (
      <>
        <DynamicBackground />
        <StandardizedLoadingSpinner text={loadingText} subtext={subText} />
      </>
    );
  }

  // Main sign-in form
  return (
    <>
      <DynamicBackground />

      <div className="min-h-screen flex flex-col items-center justify-center p-4 sm:p-8 relative z-10">
        {/* Hero Section */}
        <motion.div
          variants={containerVariants}
          initial="hidden"
          animate="visible"
          className="mb-8 text-center"
        >
          <motion.div variants={itemVariants} className="mb-4">
            <div className="inline-flex items-center gap-3 bg-white/80 backdrop-blur-sm rounded-full px-6 py-3 shadow-lg border border-white/60 mb-6">
              <motion.div
                animate={{ rotate: [0, 10, -10, 0] }}
                transition={{
                  duration: 2,
                  repeat: Infinity,
                  ease: 'easeInOut',
                }}
              >
                {/* Heart -> Orange */}
                <Heart className="w-5 h-5 text-orange-500" />
              </motion.div>
              <span className="text-sm font-medium text-gray-700">
                {locale === 'he' ? 'ברוכים השבים' : 'Welcome Back'}
              </span>
              {/* Sparkles -> Teal */}
              <Sparkles className="w-5 h-5 text-teal-500" />
            </div>
          </motion.div>

          <motion.h1
            variants={itemVariants}
            className="text-3xl md:text-4xl font-bold mb-3"
          >
            {/* Title Gradient -> Teal-Orange-Amber */}
            <span className="text-transparent bg-clip-text bg-gradient-to-r from-teal-500 via-orange-500 to-amber-500 animate-gradient-slow">
              {dict.title}
            </span>
          </motion.h1>

          <motion.p
            variants={itemVariants}
            className="text-gray-600 text-base md:text-lg max-w-md mx-auto"
          >
            {dict.subtitle}
          </motion.p>

          {/* Decorative Line (Teal -> Orange) */}
          <motion.div variants={itemVariants} className="relative mt-6">
            <div className="w-20 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400 rounded-full mx-auto" />
          </motion.div>
        </motion.div>

        {/* Main Card */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={
            shouldShake
              ? { opacity: 1, y: 0, x: [-10, 10, -10, 10, 0] }
              : { opacity: 1, y: 0 }
          }
          transition={
            shouldShake ? { duration: 0.5 } : { duration: 0.5, delay: 0.3 }
          }
          className="w-full max-w-md"
        >
          <div className="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/60 overflow-hidden relative">
            {/* Top Gradient Line (Teal -> Orange) */}
            <div className="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400 pointer-events-none" />

            {/* Decorative Elements */}
            <div className="absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-teal-400/10 to-transparent rounded-full transform translate-x-20 -translate-y-20 pointer-events-none" />
            <div className="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-br from-orange-400/10 to-transparent rounded-full transform -translate-x-16 translate-y-16 pointer-events-none" />

            <div className="relative z-10 p-6 sm:p-8">
              {/* Error Alert */}
              <AnimatePresence>
                {error && (
                  <motion.div
                    initial={{ opacity: 0, y: -10, height: 0 }}
                    animate={{ opacity: 1, y: 0, height: 'auto' }}
                    exit={{ opacity: 0, y: -10, height: 0 }}
                    className="mb-6"
                  >
                    <div
                      role="alert"
                      className="p-4 bg-red-50 border-2 border-red-200 rounded-2xl flex items-start gap-3 shadow-sm"
                    >
                      <div className="p-2 bg-red-100 rounded-lg flex-shrink-0">
                        <AlertCircle className="h-5 w-5 text-red-600" />
                      </div>
                      <div className="flex-1">
                        <p className="text-red-800 text-sm font-medium leading-relaxed">
                          {error}
                        </p>
                      </div>
                    </div>
                  </motion.div>
                )}
              </AnimatePresence>

              {/* Sign In Form */}
              <form onSubmit={handleSubmit} className="space-y-5 mb-6">
                {/* Email Field */}
                <div className="space-y-2">
                  <Label
                    htmlFor="email"
                    className="block text-sm font-semibold text-gray-700"
                  >
                    {dict.emailLabel}
                  </Label>
                  <div className="relative group">
                    <div
                      className={`absolute ${isRTL ? 'right-3' : 'left-3'} top-1/2 transform -translate-y-1/2 transition-colors ${
                        email ? 'text-teal-500' : 'text-gray-400'
                      }`}
                    >
                      <Mail className="h-5 w-5" />
                    </div>
                    <input
                      type="email"
                      id="email"
                      name="email"
                      autoComplete="email"
                      value={email}
                      onChange={(e) => setEmail(e.target.value)}
                      // Focus Colors: Teal
                      className={`w-full ${isRTL ? 'pr-11 pl-4' : 'pl-11 pr-4'} py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-teal-200 focus:border-teal-400 focus:outline-none transition-colors bg-white/50 backdrop-blur-sm hover:border-gray-300 text-gray-800 placeholder:text-gray-400 relative z-10 touch-manipulation`}
                      placeholder={dict.emailPlaceholder}
                      required
                      disabled={isLoading || isGoogleLoading}
                      dir={isRTL ? 'rtl' : 'ltr'}
                    />
                  </div>
                </div>

                {/* Password Field */}
                <div className="space-y-2">
                  <div className="flex items-center justify-between">
                    <Label
                      htmlFor="password"
                      className="block text-sm font-semibold text-gray-700"
                    >
                      {dict.passwordLabel}
                    </Label>
                  </div>
                  <div className="relative group">
                    <div
                      className={`absolute ${isRTL ? 'right-3' : 'left-3'} top-1/2 transform -translate-y-1/2 transition-colors ${
                        password ? 'text-teal-500' : 'text-gray-400'
                      }`}
                    >
                      <Lock className="h-5 w-5" />
                    </div>
                    <input
                      type={showPassword ? 'text' : 'password'}
                      id="password"
                      name="password"
                      autoComplete="current-password"
                      value={password}
                      onChange={(e) => setPassword(e.target.value)}
                      // Focus Colors: Teal
                      className={`w-full ${isRTL ? 'pr-11 pl-12' : 'pl-11 pr-12'} py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-teal-200 focus:border-teal-400 focus:outline-none transition-colors bg-white/50 backdrop-blur-sm hover:border-gray-300 text-gray-800 placeholder:text-gray-400 relative z-10 touch-manipulation`}
                      placeholder={dict.passwordPlaceholder}
                      required
                      disabled={isLoading || isGoogleLoading}
                      dir={isRTL ? 'rtl' : 'ltr'}
                    />
                    <button
                      type="button"
                      onClick={() => setShowPassword(!showPassword)}
                      className={`absolute ${isRTL ? 'left-3' : 'right-3'} top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors z-20 touch-manipulation p-1`}
                      tabIndex={-1}
                    >
                      {showPassword ? (
                        <EyeOff className="h-5 w-5" />
                      ) : (
                        <Eye className="h-5 w-5" />
                      )}
                    </button>
                  </div>
                  <div
                    className={`flex ${isRTL ? 'justify-start' : 'justify-end'}`}
                  >
                    <Link
                      href={`/${locale}/auth/forgot-password`}
                      // Link Color: Teal
                      className="text-sm text-teal-600 hover:text-teal-700 hover:underline font-medium transition-colors relative z-20 touch-manipulation"
                    >
                      {dict.forgotPasswordLink}
                    </Link>
                  </div>
                </div>

                {/* Submit Button (Teal -> Orange -> Amber) */}
                <Button
                  type="submit"
                  disabled={isLoading || isGoogleLoading}
                  className="w-full relative z-20 py-4 bg-gradient-to-r from-teal-500 via-orange-500 to-amber-500 hover:from-teal-600 hover:via-orange-600 hover:to-amber-600 shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center gap-2 rounded-xl text-base font-semibold group overflow-hidden touch-manipulation active:scale-[0.98]"
                >
                  {/* Shine effect */}
                  <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000 pointer-events-none" />

                  {isLoading ? (
                    <>
                      <Loader2 className="h-5 w-5 animate-spin" />
                      <span>{dict.submitButtonLoading}</span>
                    </>
                  ) : (
                    <>
                      <span>{dict.submitButton}</span>
                      {isRTL ? (
                        <ArrowLeft className="w-5 h-5 group-hover:-translate-x-1 transition-transform" />
                      ) : (
                        <ArrowRight className="w-5 h-5 group-hover:translate-x-1 transition-transform" />
                      )}
                    </>
                  )}
                </Button>
              </form>

              {/* Divider */}
              <div className="relative mb-6">
                <div className="absolute inset-0 flex items-center">
                  <div className="w-full border-t-2 border-gray-200" />
                </div>
                <div className="relative flex justify-center">
                  <span className="px-4 bg-white/80 text-sm font-medium text-gray-500">
                    {dict.orDivider}
                  </span>
                </div>
              </div>

              {/* Google Sign In Button */}
              <Button
                type="button"
                onClick={handleGoogleSignIn}
                disabled={isLoading || isGoogleLoading}
                variant="outline"
                className="w-full relative z-20 border-2 border-gray-200 hover:border-gray-300 hover:bg-gray-50 py-4 rounded-xl flex items-center justify-center gap-3 group transition-all duration-200 bg-white/50 backdrop-blur-sm touch-manipulation active:scale-[0.98]"
              >
                {isGoogleLoading ? (
                  <>
                    <Loader2 className="animate-spin h-5 w-5" />
                    <span className="font-medium">
                      {dict.googleButtonLoading}
                    </span>
                  </>
                ) : (
                  <>
                    <svg
                      className="h-5 w-5 flex-shrink-0"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                    >
                      <path
                        d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                        fill="#4285F4"
                      />
                      <path
                        d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                        fill="#34A853"
                      />
                      <path
                        d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                        fill="#FBBC05"
                      />
                      <path
                        d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                        fill="#EA4335"
                      />
                    </svg>
                    <span className="text-gray-700 font-medium group-hover:text-gray-900 transition-colors">
                      {dict.googleButton}
                    </span>
                  </>
                )}
              </Button>

              {/* Sign Up Link */}
              <div className="mt-8 text-center">
                <p className="text-gray-600 text-sm">
                  {dict.noAccountPrompt}{' '}
                  <Link
                    href={`/${locale}/auth/register`}
                    // Link Color: Teal
                    className="text-teal-600 font-semibold hover:text-teal-700 hover:underline transition-colors inline-flex items-center gap-1 relative z-20 touch-manipulation"
                  >
                    {dict.signUpLink}
                    {isRTL ? (
                      <ArrowLeft className="w-3 h-3" />
                    ) : (
                      <ArrowRight className="w-3 h-3" />
                    )}
                  </Link>
                </p>
              </div>
            </div>

            {/* Bottom Shine Effect (Teal -> Orange) */}
            <div className="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-teal-400 via-orange-400 to-amber-400 opacity-50 pointer-events-none" />
          </div>
        </motion.div>

        {/* Trust Badge */}
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 0.8, duration: 0.5 }}
          className="mt-8 flex items-center gap-2 text-sm text-gray-500"
        >
          {/* Shield -> Teal */}
          <Shield className="w-4 h-4 text-teal-500" />
          <span>
            {locale === 'he'
              ? 'המידע שלך מוגן ומאובטח'
              : 'Your data is protected and secure'}
          </span>
        </motion.div>
      </div>

      {/* Animations CSS */}
      <style>{`
        @keyframes gradient-slow {
          0%,
          100% {
            background-position: 0% 50%;
          }
          50% {
            background-position: 100% 50%;
          }
        }
        .animate-gradient-slow {
          background-size: 200% 200%;
          animation: gradient-slow 6s ease infinite;
        }
      `}</style>
    </>
  );
}
--- End of Content for SignInClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\signin\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/signin/page.tsx
import { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import SignInClient from './SignInClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

// עדכון רכיב הטעינה
function Loading() {
  return <StandardizedLoadingSpinner />;
}

type SignInPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function SignInPage({ params }: SignInPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-cyan-50 via-white to-pink-50 p-4">
      <Suspense fallback={<Loading />}>
        <SignInClient dict={dictionary.auth.signIn} locale={locale} />
      </Suspense>
    </div>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\update-phone
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\update-phone\UpdatePhoneClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/update-phone/UpdatePhoneClient.tsx
'use client';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

import { useState, useCallback, FormEvent } from 'react';
import { useRouter } from 'next/navigation';
import { useSession } from 'next-auth/react';
import { Button } from '@/components/ui/button';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { AlertCircle, Loader2 } from 'lucide-react';
import Link from 'next/link';
import type { UpdatePhoneDict } from '@/types/dictionaries/auth';

// ======================= ייבואים חדשים =======================
import PhoneNumberInput from '@/components/auth/PhoneNumberInput';
import { isPossiblePhoneNumber } from 'react-phone-number-input';
// =============================================================

interface UpdatePhoneClientProps {
  dict: UpdatePhoneDict;
  // הוספת locale לממשק כדי שנוכל לקבל אותו
  locale: 'he' | 'en';
}

const UpdatePhoneClient = ({ dict, locale }: UpdatePhoneClientProps) => {
  const router = useRouter();
  const { status: sessionStatus } = useSession();
  const [newPhone, setNewPhone] = useState<string | undefined>('');
  const [error, setError] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);

  const handleSubmit = useCallback(
    async (e: FormEvent) => {
      e.preventDefault();
      setError(null);

      // ======================= ולידציה מעודכנת =======================
      if (!newPhone || !isPossiblePhoneNumber(newPhone)) {
        setError(dict.errors.invalidFormat);
        return;
      }
      // ===============================================================

      setIsLoading(true);
      try {
        const response = await fetch('/api/auth/update-and-resend-code', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ newPhone }),
        });
        const result = await response.json();
        if (!response.ok) {
          throw new Error(result.error || dict.errors.updateFailed);
        }
        // הניווט הוא יחסי ולכן אין צורך ב-locale כאן
        router.push('/auth/verify-phone');
      } catch (err: unknown) {
        if (err instanceof Error) {
          setError(err.message);
        } else {
          setError(dict.errors.unexpected);
        }
      } finally {
        setIsLoading(false);
      }
    },
    [newPhone, router, dict]
  );

   if (sessionStatus === 'loading') {
    // החלפת ה-div הישן
    return <StandardizedLoadingSpinner text={dict.loaderText} />;
  }

  if (sessionStatus === 'unauthenticated') {
    router.push('/auth/signin?callbackUrl=/auth/update-phone');
    return null;
  }

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-cyan-50 via-white to-pink-50 p-4">
      <div className="w-full max-w-sm bg-white rounded-xl shadow-xl p-6 sm:p-8 space-y-6">
        <div className="text-center">
          <h1 className="text-2xl font-bold text-gray-800">{dict.title}</h1>
          <p
            className="text-gray-600 mt-2 text-sm sm:text-base"
            dangerouslySetInnerHTML={{
              __html: dict.description.replace(/\n/g, '<br />'),
            }}
          />
        </div>

        {error && (
          <Alert variant="destructive">
            <AlertCircle className="h-4 w-4" />
            <AlertTitle>{dict.errors.title}</AlertTitle>
            <AlertDescription>{error}</AlertDescription>
          </Alert>
        )}

        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1 text-right">
              {dict.newPhoneLabel}
            </label>
            {/* ======================= החלפת שדה הקלט הישן ======================= */}
            <PhoneNumberInput
              value={newPhone}
              onChange={setNewPhone}
              disabled={isLoading}
              locale={locale}
            />
            {/* ====================================================================== */}
          </div>
          <Button
            type="submit"
            disabled={isLoading || !newPhone}
            className="w-full"
          >
            {isLoading ? (
              <Loader2 className="animate-spin h-5 w-5" />
            ) : (
              dict.submitButton
            )}
          </Button>
        </form>

        <div className="text-center mt-4">
          <Link
            href="/auth/verify-phone"
            className="text-sm text-cyan-600 hover:underline"
          >
            {dict.backToVerificationLink}
          </Link>
        </div>
      </div>
    </div>
  );
};

export default UpdatePhoneClient;
--- End of Content for UpdatePhoneClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\update-phone\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/update-phone/page.tsx
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import UpdatePhoneClient from './UpdatePhoneClient';

// ▼▼▼ כאן השינוי ▼▼▼
type UpdatePhonePageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function UpdatePhonePage({ params }: UpdatePhonePageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <UpdatePhoneClient dict={dictionary.auth.updatePhone} locale={locale} />
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\verify-email
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\verify-email\VerifyEmailClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/verify-email/VerifyEmailClient.tsx
'use client';

import { useState, useEffect, useRef } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { useSession } from 'next-auth/react';
import { motion, AnimatePresence } from 'framer-motion';
import {
  Loader2,
  AlertCircle,
  CheckCircle,
  Mail,
  ArrowRight,
  ArrowLeft,
  Sparkles,
  Send,
  Shield,
  Clock,
  RefreshCw,
} from 'lucide-react';

import { Button } from '@/components/ui/button';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import type { VerifyEmailDict } from '@/types/dictionaries/auth';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

// ============================================================================
// TYPE DEFINITIONS
// ============================================================================

interface VerificationState {
  status: 'pending' | 'verifying' | 'success' | 'error';
  message: string;
}

interface VerifyEmailClientProps {
  dict: VerifyEmailDict;
  locale: 'he' | 'en';
}

// ============================================================================
// ANIMATION VARIANTS
// ============================================================================

const containerVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.1,
      delayChildren: 0.2,
    },
  },
};

const itemVariants = {
  hidden: { opacity: 0, y: 20 },
  visible: {
    opacity: 1,
    y: 0,
    transition: { duration: 0.5, ease: 'easeOut' },
  },
};

const cardVariants = {
  hidden: { opacity: 0, scale: 0.95, y: 30 },
  visible: {
    opacity: 1,
    scale: 1,
    y: 0,
    transition: { duration: 0.6, ease: [0.25, 0.46, 0.45, 0.94] },
  },
};

// ============================================================================
// DYNAMIC BACKGROUND COMPONENT
// ============================================================================

const DynamicBackground: React.FC = () => (
  <div className="fixed inset-0 overflow-hidden pointer-events-none -z-10">
    {/* Floating Gradients */}
    <motion.div
      className="absolute top-10 left-10 w-96 h-96 bg-gradient-to-br from-teal-400/20 to-emerald-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, -30, 0],
        x: [0, 20, 0],
        scale: [1, 1.1, 1],
      }}
      transition={{
        duration: 15,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
    />
    <motion.div
      className="absolute top-40 right-20 w-80 h-80 bg-gradient-to-br from-orange-400/20 to-amber-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 40, 0],
        x: [0, -30, 0],
        scale: [1, 1.15, 1],
      }}
      transition={{
        duration: 18,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 1,
      }}
    />
    <motion.div
      className="absolute bottom-32 left-1/4 w-72 h-72 bg-gradient-to-br from-rose-400/15 to-orange-500/15 rounded-full blur-3xl"
      animate={{
        y: [0, -25, 0],
        x: [0, 15, 0],
        scale: [1, 1.08, 1],
      }}
      transition={{
        duration: 20,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 2,
      }}
    />
    <motion.div
      className="absolute bottom-20 right-10 w-64 h-64 bg-gradient-to-br from-teal-400/20 to-cyan-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 20, 0],
        x: [0, -10, 0],
        scale: [1, 1.12, 1],
      }}
      transition={{
        duration: 16,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 0.5,
      }}
    />

    {/* Decorative Dots Pattern (Teal) */}
    <div className="absolute inset-0 opacity-5 bg-[radial-gradient(#0d9488_1px,transparent_1px)] [background-size:30px_30px]"></div>

    {/* SVG Decorative Paths (Teal -> Orange) */}
    <svg
      className="absolute inset-0 w-full h-full"
      viewBox="0 0 1200 800"
      xmlns="http://www.w3.org/2000/svg"
    >
      <defs>
        <linearGradient
          id="decorativeGradient"
          x1="0%"
          y1="0%"
          x2="100%"
          y2="100%"
        >
          <stop offset="0%" stopColor="#0d9488" stopOpacity="0.08" />
          <stop offset="50%" stopColor="#f97316" stopOpacity="0.06" />
          <stop offset="100%" stopColor="#14b8a6" stopOpacity="0.08" />
        </linearGradient>
      </defs>
      <motion.path
        d="M0,100 C300,50 600,150 1200,100 L1200,0 L0,0 Z"
        fill="url(#decorativeGradient)"
        initial={{ opacity: 0.8 }}
        animate={{ opacity: [0.8, 1, 0.8] }}
        transition={{ duration: 4, repeat: Infinity, ease: 'easeInOut' }}
      />
      <motion.path
        d="M0,700 C400,650 800,750 1200,700 L1200,800 L0,800 Z"
        fill="url(#decorativeGradient)"
        initial={{ opacity: 0.8 }}
        animate={{ opacity: [0.8, 1, 0.8] }}
        transition={{
          duration: 4,
          repeat: Infinity,
          ease: 'easeInOut',
          delay: 2,
        }}
      />
    </svg>
  </div>
);

// ============================================================================
// ANIMATED ICON COMPONENTS
// ============================================================================

const AnimatedMailIcon: React.FC = () => (
  <motion.div
    className="relative inline-flex items-center justify-center w-24 h-24 mb-6"
    initial={{ scale: 0, rotate: -180 }}
    animate={{ scale: 1, rotate: 0 }}
    transition={{ duration: 0.6, ease: 'easeOut' }}
  >
    <motion.div
      // Gradient: Teal -> Emerald
      className="absolute inset-0 rounded-full bg-gradient-to-br from-teal-400/20 to-emerald-500/20"
      animate={{
        scale: [1, 1.2, 1],
        opacity: [0.5, 0.8, 0.5],
      }}
      transition={{
        duration: 2,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
    />
    {/* Inner Gradient: Teal -> Emerald */}
    <div className="relative w-20 h-20 rounded-2xl bg-gradient-to-br from-teal-400 to-emerald-500 flex items-center justify-center shadow-lg">
      <Mail className="w-10 h-10 text-white" />
    </div>
  </motion.div>
);

const AnimatedSuccessIcon: React.FC = () => (
  <motion.div
    className="relative inline-flex items-center justify-center w-24 h-24 mb-6"
    initial={{ scale: 0 }}
    animate={{ scale: 1 }}
    transition={{ duration: 0.5, ease: 'backOut' }}
  >
    <motion.div
      // Gradient: Green -> Emerald (Success state stays green/emerald, fits palette)
      className="absolute inset-0 rounded-full bg-gradient-to-br from-green-400/30 to-emerald-500/30"
      animate={{
        scale: [1, 1.3, 1],
        opacity: [0.5, 0, 0.5],
      }}
      transition={{
        duration: 1.5,
        repeat: Infinity,
        ease: 'easeOut',
      }}
    />
    <div className="relative w-20 h-20 rounded-full bg-gradient-to-br from-green-400 to-emerald-500 flex items-center justify-center shadow-lg">
      <motion.div
        initial={{ scale: 0 }}
        animate={{ scale: 1 }}
        transition={{ delay: 0.2, duration: 0.3 }}
      >
        <CheckCircle className="w-10 h-10 text-white" />
      </motion.div>
    </div>
  </motion.div>
);

const AnimatedErrorIcon: React.FC = () => (
  <motion.div
    className="relative inline-flex items-center justify-center w-24 h-24 mb-6"
    initial={{ scale: 0, rotate: 180 }}
    animate={{ scale: 1, rotate: 0 }}
    transition={{ duration: 0.5, ease: 'easeOut' }}
  >
    <motion.div
      // Gradient: Red -> Rose (Fits 'Rose' from palette)
      className="absolute inset-0 rounded-full bg-gradient-to-br from-red-400/30 to-rose-500/30"
      animate={{
        scale: [1, 1.2, 1],
      }}
      transition={{
        duration: 2,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
    />
    <div className="relative w-20 h-20 rounded-full bg-gradient-to-br from-red-400 to-rose-500 flex items-center justify-center shadow-lg">
      <AlertCircle className="w-10 h-10 text-white" />
    </div>
  </motion.div>
);

// ============================================================================
// MAIN COMPONENT
// ============================================================================

export default function VerifyEmailClient({
  dict,
  locale,
}: VerifyEmailClientProps) {
  const router = useRouter();
  const searchParams = useSearchParams();
  const { data: session } = useSession();
  const verificationApiCallMadeRef = useRef(false);
  const isRTL = locale === 'he';

  const [verification, setVerification] = useState<VerificationState>({
    status: 'pending',
    message: '',
  });
  const [isResending, setIsResending] = useState(false);
  const [infoMessage, setInfoMessage] = useState<string | null>(null);

  useEffect(() => {
    if (verificationApiCallMadeRef.current) return;
    verificationApiCallMadeRef.current = true;

    const token = searchParams.get('token');
    const email = searchParams.get('email');

    if (!token) {
      if (email) {
        setInfoMessage(dict.pendingMessage);
      } else {
        setVerification({
          status: 'error',
          message: dict.errors.linkInvalid,
        });
      }
      return;
    }

    verifyToken(token);
  }, [searchParams, dict]);

  const verifyToken = async (token: string) => {
    setVerification({ status: 'verifying', message: '' });

    if (
      session?.user?.email &&
      searchParams.get('email') &&
      session.user.email !== searchParams.get('email')
    ) {
      setVerification({
        status: 'error',
        message: dict.errors.sessionMismatch,
      });
      return;
    }

    try {
      const response = await fetch('/api/auth/verify', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token: token, type: 'EMAIL' }),
      });
      const data = await response.json();
      if (!response.ok) throw new Error(data.error);

      setVerification({ status: 'success', message: dict.successMessage });
      setTimeout(() => router.push(`/${locale}/auth/signin`), 2000);
    } catch (error) {
      let errorMessage = dict.errors.default;
      if (error instanceof Error) {
        if (error.message.includes('הטוקן כבר נוצל'))
          errorMessage = dict.errors.tokenUsed;
        else if (error.message.includes('תוקף הטוקן פג'))
          errorMessage = dict.errors.tokenExpired;
        else errorMessage = error.message;
      }
      setVerification({ status: 'error', message: errorMessage });
    }
  };

  const handleResendVerification = async () => {
    const email = searchParams.get('email');
    if (!email) {
      setVerification({ status: 'error', message: dict.errors.noEmail });
      return;
    }
    setIsResending(true);
    setVerification({ status: 'pending', message: '' });
    try {
      const response = await fetch('/api/auth/resend-verification', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: email, type: 'EMAIL' }),
      });
      const data = await response.json();
      if (!response.ok) throw new Error(data.error || dict.errors.resendFailed);
      setInfoMessage(dict.alerts.resendSuccess);
    } catch (error) {
      setVerification({
        status: 'error',
        message:
          error instanceof Error ? error.message : dict.errors.resendFailed,
      });
    } finally {
      setIsResending(false);
    }
  };

  const emailParam = searchParams.get('email');

  return (
    <div className="min-h-screen flex flex-col items-center justify-center p-4 relative">
      <DynamicBackground />

      <motion.div
        variants={containerVariants}
        initial="hidden"
        animate="visible"
        className="w-full max-w-lg relative z-10"
      >
        {/* Header Section */}
        <motion.div variants={itemVariants} className="text-center mb-8">
          <motion.div
            className="inline-flex items-center gap-3 bg-white/80 backdrop-blur-sm rounded-full px-6 py-3 shadow-lg border border-white/60 mb-6"
            whileHover={{ scale: 1.05 }}
            transition={{ duration: 0.3 }}
          >
            {/* Shield: Teal */}
            <Shield className="w-6 h-6 text-teal-500" />
            <span className="text-teal-700 font-semibold text-lg">
              {dict.title}
            </span>
          </motion.div>
        </motion.div>

        {/* Main Card */}
        <motion.div
          variants={cardVariants}
          className="relative overflow-hidden rounded-3xl bg-white/70 backdrop-blur-xl shadow-2xl border border-white/60 p-8 md:p-12"
        >
          {/* Decorative Elements (Teal/Orange) */}
          <div className="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-teal-400/20 to-transparent rounded-full transform translate-x-16 -translate-y-16 blur-2xl" />
          <div className="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-br from-orange-400/20 to-transparent rounded-full transform -translate-x-16 translate-y-16 blur-2xl" />
          <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-gradient-to-br from-amber-400/5 to-transparent rounded-full blur-3xl" />

          <div className="relative z-10">
            <AnimatePresence mode="wait">
              {/* Pending State */}
              {verification.status === 'pending' && (
                <motion.div
                  key="pending"
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, y: -20 }}
                  transition={{ duration: 0.4 }}
                  className="text-center space-y-6"
                >
                  <AnimatedMailIcon />

                  <div className="space-y-3">
                    <h2 className="text-3xl font-bold text-gray-800">
                      {dict.title}
                    </h2>

                    {infoMessage && (
                      <motion.div
                        initial={{ opacity: 0, scale: 0.95 }}
                        animate={{ opacity: 1, scale: 1 }}
                        transition={{ duration: 0.3 }}
                      >
                        {/* Info Alert: Teal/Blue */}
                        <Alert className="border-teal-200 bg-teal-50">
                          <Sparkles className="h-5 w-5 text-teal-600" />
                          <AlertDescription className="text-teal-700">
                            {infoMessage}
                          </AlertDescription>
                        </Alert>
                      </motion.div>
                    )}

                    {emailParam && (
                      <div className="space-y-4 pt-4">
                        {/* Email Box: Teal Light */}
                        <div className="bg-gradient-to-r from-teal-50 to-emerald-50 rounded-2xl p-6 border border-teal-100">
                          <p className="text-gray-600 text-sm mb-2">
                            {dict.emailSentTo}
                          </p>
                          <p className="text-xl font-bold text-gray-800 break-all">
                            {emailParam}
                          </p>
                        </div>

                        <p className="text-gray-600 leading-relaxed">
                          {dict.checkYourInbox}
                        </p>

                        <motion.div
                          whileHover={{ scale: 1.02 }}
                          whileTap={{ scale: 0.98 }}
                        >
                          {/* Resend Button: Teal -> Orange */}
                          <Button
                            onClick={handleResendVerification}
                            disabled={isResending}
                            className="w-full py-6 text-lg font-semibold rounded-xl bg-gradient-to-r from-teal-500 via-orange-500 to-amber-500 hover:from-teal-600 hover:via-orange-600 hover:to-amber-600 text-white shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 relative overflow-hidden group"
                          >
                            {isResending ? (
                              <div className="flex items-center justify-center gap-3">
                                <Loader2 className="animate-spin h-5 w-5" />
                                <span>{dict.resendButtonLoading}</span>
                              </div>
                            ) : (
                              <div className="flex items-center justify-center gap-3">
                                <RefreshCw className="h-5 w-5" />
                                <span>{dict.resendButton}</span>
                                <Send className="h-5 w-5" />
                              </div>
                            )}
                            <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent group-hover:translate-x-full transition-transform duration-1000" />
                          </Button>
                        </motion.div>
                      </div>
                    )}
                  </div>
                </motion.div>
              )}

              {/* Verifying State - Updated with StandardizedLoadingSpinner */}
              {verification.status === 'verifying' && (
                <motion.div
                  key="verifying"
                  initial={{ opacity: 0, scale: 0.9 }}
                  animate={{ opacity: 1, scale: 1 }}
                  exit={{ opacity: 0, scale: 0.9 }}
                  transition={{ duration: 0.4 }}
                  className="w-full"
                >
                  <StandardizedLoadingSpinner
                    text={dict.verifyingMessage}
                    subtext={
                      isRTL
                        ? 'מאמתים את הפרטים שלך...'
                        : 'Verifying your details...'
                    }
                    className="min-h-[250px]"
                  />
                </motion.div>
              )}

              {/* Success State */}
              {verification.status === 'success' && (
                <motion.div
                  key="success"
                  initial={{ opacity: 0, scale: 0.9 }}
                  animate={{ opacity: 1, scale: 1 }}
                  exit={{ opacity: 0, scale: 0.9 }}
                  transition={{ duration: 0.4 }}
                  className="text-center space-y-6"
                >
                  <AnimatedSuccessIcon />

                  <div className="space-y-4">
                    <h2 className="text-2xl md:text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-teal-600 to-emerald-600">
                      {verification.message}
                    </h2>

                    <div className="bg-gradient-to-r from-teal-50 to-emerald-50 rounded-2xl p-6 border border-teal-100">
                      <div className="flex items-center justify-center gap-3">
                        <Clock className="w-5 h-5 text-teal-600" />
                        <p className="text-gray-700">{dict.successRedirect}</p>
                      </div>
                      <motion.div
                        className="mt-4"
                        animate={{ rotate: 360 }}
                        transition={{
                          duration: 2,
                          repeat: Infinity,
                          ease: 'linear',
                        }}
                      >
                        <Loader2 className="h-6 w-6 mx-auto text-teal-600" />
                      </motion.div>
                    </div>
                  </div>
                </motion.div>
              )}

              {/* Error State */}
              {verification.status === 'error' && (
                <motion.div
                  key="error"
                  initial={{ opacity: 0, scale: 0.9 }}
                  animate={{ opacity: 1, scale: 1 }}
                  exit={{ opacity: 0, scale: 0.9 }}
                  transition={{ duration: 0.4 }}
                  className="text-center space-y-6"
                >
                  <AnimatedErrorIcon />

                  <div className="space-y-4">
                    <h2 className="text-2xl font-bold text-red-600">
                      {dict.errorMessage}
                    </h2>

                    <Alert
                      variant="destructive"
                      className="border-red-200 bg-red-50"
                    >
                      <AlertCircle className="h-5 w-5" />
                      <AlertTitle className="font-semibold">
                        {dict.errors.title || 'שגיאה'}
                      </AlertTitle>
                      <AlertDescription>
                        {verification.message}
                      </AlertDescription>
                    </Alert>

                    <motion.div
                      whileHover={{ scale: 1.02 }}
                      whileTap={{ scale: 0.98 }}
                      className="pt-4"
                    >
                      {/* Back Button: Gray/Teal */}
                      <Button
                        onClick={() => router.push(`/${locale}/auth/signin`)}
                        className="w-full py-6 text-lg font-semibold rounded-xl bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white shadow-lg hover:shadow-xl transition-all duration-300"
                      >
                        <div className="flex items-center justify-center gap-3">
                          {isRTL ? (
                            <ArrowRight className="h-5 w-5" />
                          ) : (
                            <ArrowLeft className="h-5 w-5" />
                          )}
                          <span>{dict.backToSignInButton}</span>
                        </div>
                      </Button>
                    </motion.div>
                  </div>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </motion.div>

        {/* Bottom Decoration */}
        <motion.div variants={itemVariants} className="mt-8 text-center">
          <div className="inline-flex items-center gap-2 text-sm text-gray-500">
            <Shield className="h-4 w-4" />
            <span>מוגן באמצעות הצפנת SSL</span>
          </div>
        </motion.div>
      </motion.div>
    </div>
  );
}
--- End of Content for VerifyEmailClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\verify-email\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/verify-email/page.tsx
import { Suspense } from 'react';
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import VerifyEmailClient from './VerifyEmailClient';
import StandardizedLoadingSpinner from '@/components/questionnaire/common/StandardizedLoadingSpinner';

// עדכון רכיב הטעינה
function Loading() {
  return <StandardizedLoadingSpinner />;
}

type VerifyEmailPageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function VerifyEmailPage({
  params,
}: VerifyEmailPageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    // הסרתי את ה-bg-gray-50 הישן כי הספינר החדש כבר כולל רקע יפה
    <div className="flex items-center justify-center min-h-screen">
      <Suspense fallback={<Loading />}>
        <VerifyEmailClient dict={dictionary.auth.verifyEmail} locale={locale} />
      </Suspense>
    </div>
  );
}
--- End of Content for page.tsx ---

================================================================================
Directory: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\verify-phone
================================================================================

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\verify-phone\VerifyPhoneClient.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/verify-phone/VerifyPhoneClient.tsx
'use client';

import { useState, useCallback, useRef, useEffect, FormEvent } from 'react';
import { useSession } from 'next-auth/react';
import { useRouter } from 'next/navigation';
import { motion, AnimatePresence } from 'framer-motion';
import Link from 'next/link';
import {
  Loader2,
  AlertCircle,
  CheckCircle,
  MessageSquare,
  ArrowRight,
  ArrowLeft,
  Sparkles,
  Shield,
  Clock,
  RefreshCw,
} from 'lucide-react';

import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
// Import ProgressBar
import ProgressBar from '@/components/auth/ProgressBar';
import type { VerifyPhoneDict } from '@/types/dictionaries/auth';

// ============================================================================
// TYPE DEFINITIONS
// ============================================================================

interface VerifyPhoneClientProps {
  dict: VerifyPhoneDict;
  locale: 'he' | 'en';
}

const OTP_LENGTH = 6;
const RESEND_COOLDOWN = 60;

// ============================================================================
// ANIMATION VARIANTS
// ============================================================================

const containerVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.1,
      delayChildren: 0.2,
    },
  },
};

const itemVariants = {
  hidden: { opacity: 0, y: 20 },
  visible: {
    opacity: 1,
    y: 0,
    transition: { duration: 0.5, ease: 'easeOut' },
  },
};

const cardVariants = {
  hidden: { opacity: 0, scale: 0.95, y: 30 },
  visible: {
    opacity: 1,
    scale: 1,
    y: 0,
    transition: { duration: 0.6, ease: [0.25, 0.46, 0.45, 0.94] },
  },
};

// ============================================================================
// DYNAMIC BACKGROUND COMPONENT (Teal/Orange Theme)
// ============================================================================

const DynamicBackground: React.FC = () => (
  <div className="fixed inset-0 overflow-hidden pointer-events-none -z-10">
    {/* Floating Gradients */}
    <motion.div
      className="absolute top-10 left-10 w-96 h-96 bg-gradient-to-br from-teal-400/20 to-emerald-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, -30, 0],
        x: [0, 20, 0],
        scale: [1, 1.1, 1],
      }}
      transition={{
        duration: 15,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
    />
    <motion.div
      className="absolute top-40 right-20 w-80 h-80 bg-gradient-to-br from-orange-400/20 to-amber-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 40, 0],
        x: [0, -30, 0],
        scale: [1, 1.15, 1],
      }}
      transition={{
        duration: 18,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 1,
      }}
    />
    <motion.div
      className="absolute bottom-32 left-1/4 w-72 h-72 bg-gradient-to-br from-rose-400/15 to-orange-500/15 rounded-full blur-3xl"
      animate={{
        y: [0, -25, 0],
        x: [0, 15, 0],
        scale: [1, 1.08, 1],
      }}
      transition={{
        duration: 20,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 2,
      }}
    />
    <motion.div
      className="absolute bottom-20 right-10 w-64 h-64 bg-gradient-to-br from-teal-400/20 to-cyan-500/20 rounded-full blur-3xl"
      animate={{
        y: [0, 20, 0],
        x: [0, -10, 0],
        scale: [1, 1.12, 1],
      }}
      transition={{
        duration: 16,
        repeat: Infinity,
        ease: 'easeInOut',
        delay: 0.5,
      }}
    />

    {/* Decorative Dots Pattern (Teal) */}
    <div className="absolute inset-0 opacity-5 bg-[radial-gradient(#0d9488_1px,transparent_1px)] [background-size:30px_30px]"></div>

    {/* SVG Decorative Paths (Teal -> Orange) */}
    <svg
      className="absolute inset-0 w-full h-full"
      viewBox="0 0 1200 800"
      xmlns="http://www.w3.org/2000/svg"
    >
      <defs>
        <linearGradient
          id="decorativeGradient"
          x1="0%"
          y1="0%"
          x2="100%"
          y2="100%"
        >
          <stop offset="0%" stopColor="#0d9488" stopOpacity="0.08" />
          <stop offset="50%" stopColor="#f97316" stopOpacity="0.06" />
          <stop offset="100%" stopColor="#14b8a6" stopOpacity="0.08" />
        </linearGradient>
      </defs>
      <motion.path
        d="M0,100 C300,50 600,150 1200,100 L1200,0 L0,0 Z"
        fill="url(#decorativeGradient)"
        initial={{ opacity: 0.8 }}
        animate={{ opacity: [0.8, 1, 0.8] }}
        transition={{ duration: 4, repeat: Infinity, ease: 'easeInOut' }}
      />
      <motion.path
        d="M0,700 C400,650 800,750 1200,700 L1200,800 L0,800 Z"
        fill="url(#decorativeGradient)"
        initial={{ opacity: 0.8 }}
        animate={{ opacity: [0.8, 1, 0.8] }}
        transition={{
          duration: 4,
          repeat: Infinity,
          ease: 'easeInOut',
          delay: 2,
        }}
      />
    </svg>
  </div>
);

// ============================================================================
// CIRCULAR TIMER COMPONENT
// ============================================================================

interface CircularTimerProps {
  seconds: number;
  maxSeconds: number;
}

const CircularTimer: React.FC<CircularTimerProps> = ({
  seconds,
  maxSeconds,
}) => {
  const progress = (seconds / maxSeconds) * 100;
  const circumference = 2 * Math.PI * 20;
  const strokeDashoffset = circumference - (progress / 100) * circumference;

  return (
    <div className="relative inline-flex items-center justify-center w-10 h-10">
      <svg className="w-10 h-10 transform -rotate-90">
        <circle
          cx="20"
          cy="20"
          r="18"
          stroke="currentColor"
          strokeWidth="2"
          fill="none"
          className="text-gray-200"
        />
        <motion.circle
          cx="20"
          cy="20"
          r="18"
          stroke="currentColor"
          strokeWidth="2"
          fill="none"
          strokeDasharray={circumference}
          strokeDashoffset={strokeDashoffset}
          strokeLinecap="round"
          // Color updated to Teal
          className="text-teal-500"
          initial={{ strokeDashoffset: circumference }}
          animate={{ strokeDashoffset }}
          transition={{ duration: 0.3, ease: 'linear' }}
        />
      </svg>
      <span className="absolute text-xs font-semibold text-gray-600">
        {seconds}
      </span>
    </div>
  );
};

// ============================================================================
// MAIN COMPONENT
// ============================================================================

const VerifyPhoneClient: React.FC<VerifyPhoneClientProps> = ({
  dict,
  locale,
}) => {
  const { data: session, update: updateSession } = useSession();
  const router = useRouter();
  const isRTL = locale === 'he';

  // Debug logging
  useEffect(() => {
    console.log('[VerifyPhoneClient] Component mounted');
    console.log('[VerifyPhoneClient] Session data:', session);
    console.log('[VerifyPhoneClient] User phone:', session?.user?.phone);
  }, [session]);

  // State
  const [code, setCode] = useState<string[]>(Array(OTP_LENGTH).fill(''));
  const [isLoading, setIsLoading] = useState(false);
  const [isResending, setIsResending] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [successMessage, setSuccessMessage] = useState<string | null>(null);
  const [infoMessage, setInfoMessage] = useState<string | null>(null);
  const [resendTimer, setResendTimer] = useState(0);
  const [focusedIndex, setFocusedIndex] = useState<number | null>(null);

  const inputRefs = useRef<(HTMLInputElement | null)[]>([]);
  const resendTimerRef = useRef<NodeJS.Timeout | null>(null);

  const resendDisabled = resendTimer > 0;

  // Timer Management
  const startResendTimer = useCallback(() => {
    setResendTimer(RESEND_COOLDOWN);
    if (resendTimerRef.current) {
      clearInterval(resendTimerRef.current);
    }
    resendTimerRef.current = setInterval(() => {
      setResendTimer((prev) => {
        if (prev <= 1) {
          if (resendTimerRef.current) {
            clearInterval(resendTimerRef.current);
            resendTimerRef.current = null;
          }
          return 0;
        }
        return prev - 1;
      });
    }, 1000);
  }, []);
  useEffect(() => {
    if (session?.user) {
      const user = session.user as any;
      // אם המשתמש כבר מאומת טלפונית, אין לו מה לחפש פה
      if (user.isPhoneVerified) {
        router.push(`/${locale}/profile`);
      }
    }
  }, [session, router, locale]);
  useEffect(() => {
    startResendTimer();
    return () => {
      if (resendTimerRef.current) {
        clearInterval(resendTimerRef.current);
      }
    };
  }, [startResendTimer]);

  // Input Handling
  const handleInputChange = useCallback(
    (index: number, value: string) => {
      if (!/^\d*$/.test(value)) return;
      const newCode = [...code];
      newCode[index] = value.slice(0, 1);
      setCode(newCode);
      setError(null);

      if (value && index < OTP_LENGTH - 1) {
        inputRefs.current[index + 1]?.focus();
      }
    },
    [code]
  );

  const handleKeyDown = useCallback(
    (index: number, e: React.KeyboardEvent<HTMLInputElement>) => {
      if (e.key === 'Backspace' && !code[index] && index > 0) {
        inputRefs.current[index - 1]?.focus();
      }
      if (e.key === 'ArrowLeft' && index > 0) {
        inputRefs.current[index - 1]?.focus();
      }
      if (e.key === 'ArrowRight' && index < OTP_LENGTH - 1) {
        inputRefs.current[index + 1]?.focus();
      }
    },
    [code]
  );

  // Verify Code
  const handleVerifyCode = useCallback(
    async (e: FormEvent<HTMLFormElement>) => {
      e.preventDefault();
      setError(null);
      setInfoMessage(null);

      const fullCode = code.join('');
      if (fullCode.length !== OTP_LENGTH) {
        setError(dict.errors.incompleteCode);
        return;
      }

      setIsLoading(true);

      try {
        const response = await fetch(
          `/api/auth/verify-phone-code?locale=${locale}`,
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ code: fullCode }),
          }
        );

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || dict.errors.default);
        }

        setSuccessMessage(dict.success.verifying);

        const updatedSession = await updateSession();

        if (updatedSession?.user?.isPhoneVerified) {
          router.push(`/${locale}/profile`);
        } else {
          setError('Failed to update session. Please try logging in again.');
          setIsLoading(false);
        }
      } catch (err: unknown) {
        setError(err instanceof Error ? err.message : dict.errors.unexpected);
        setIsLoading(false);
      }
    },
    [code, updateSession, dict, locale, router]
  );

  // Resend Code
  const handleResendCode = useCallback(async () => {
    if (resendDisabled || isResending) return;
    setError(null);
    setInfoMessage(null);
    setIsResending(true);

    try {
      const response = await fetch(
        `/api/auth/resend-phone-code?locale=${locale}`,
        {
          method: 'POST',
        }
      );
      if (!response.ok) throw new Error((await response.json()).error);
      setInfoMessage(dict.info.resent);
      startResendTimer();
    } catch (err: unknown) {
      setError(err instanceof Error ? err.message : dict.errors.unexpected);
    } finally {
      setIsResending(false);
    }
  }, [isResending, resendDisabled, startResendTimer, dict, locale]);

  // Get Hidden Phone
  const getHiddenPhone = () => {
    const phone = session?.user?.phone;
    if (!phone || phone.length < 4) {
      return dict.yourPhoneNumber;
    }
    const hiddenPhone = `${phone.substring(0, 3)}••••${phone.substring(phone.length - 3)}`;
    return hiddenPhone;
  };

  // --- Helper to safely render text with dynamic OTP length ---
  const renderWithGradientNumber = (text: string) => {
    // If the JSON contains the placeholder, we split and insert the styled number
    if (text.includes('{{OTP_LENGTH}}')) {
      const parts = text.split('{{OTP_LENGTH}}');
      return (
        <>
          {parts[0]}
          {/* Number Accent: Teal -> Pink (retained for contrast) or Teal -> Orange */}
          <span className="text-transparent bg-clip-text bg-gradient-to-r from-teal-600 to-orange-600">
            {OTP_LENGTH}
          </span>
          {parts[1]}
        </>
      );
    }
    // Fallback: Return text as is (avoids double number bug)
    return text;
  };

  const disableForm = isLoading || !!successMessage;
  const disableResend = isResending || resendDisabled || !!successMessage;
  const isCodeComplete = code.every((digit) => digit !== '');

  return (
    <div className="min-h-screen flex flex-col items-center justify-center p-4 relative">
      <DynamicBackground />

      <motion.div
        variants={containerVariants}
        initial="hidden"
        animate="visible"
        className="w-full max-w-lg relative z-10"
      >
        {/* Header Section */}
        <motion.div variants={itemVariants} className="text-center mb-8">
          {/* --- Progress Bar Added Here --- */}
          <div className="w-full max-w-xs mx-auto mb-6">
            <ProgressBar
              currentStep={2}
              totalSteps={2}
              stepLabel={locale === 'he' ? 'שלב {{step}}' : 'Step {{step}}'}
              locale={locale}
            />
          </div>
          {/* ------------------------------- */}

          <motion.div
            className="inline-flex items-center gap-3 bg-white/80 backdrop-blur-sm rounded-full px-6 py-3 shadow-lg border border-white/60 mb-6"
            whileHover={{ scale: 1.05 }}
            transition={{ duration: 0.3 }}
          >
            {/* Shield: Teal */}
            <Shield className="w-6 h-6 text-teal-500" />
            <span className="text-teal-700 font-semibold text-lg">
              {dict.title}
            </span>
          </motion.div>

          {/* Fixed Header Logic */}
          <h1 className="text-3xl md:text-4xl font-bold text-gray-800 mb-4">
            {renderWithGradientNumber(dict.description)}
          </h1>
        </motion.div>

        {/* Main Card */}
        <motion.div
          variants={cardVariants}
          className="relative overflow-hidden rounded-3xl bg-white/70 backdrop-blur-xl shadow-2xl border border-white/60 p-8 md:p-10"
        >
          {/* Decorative Elements (Teal/Orange) */}
          <div className="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-teal-400/20 to-transparent rounded-full transform translate-x-16 -translate-y-16 blur-2xl" />
          <div className="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-br from-orange-400/20 to-transparent rounded-full transform -translate-x-16 translate-y-16 blur-2xl" />
          <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-gradient-to-br from-amber-400/5 to-transparent rounded-full blur-3xl" />

          <div className="relative z-10 space-y-8">
            {/* WhatsApp/Phone Icon & Phone Number */}
            <div className="text-center space-y-3">
              <div className="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-teal-400 to-emerald-600 shadow-lg mb-2">
                <MessageSquare className="w-8 h-8 text-white" />
              </div>
              {/* Fixed Code Sent To Logic */}
              <p className="text-gray-600 text-sm md:text-base">
                {renderWithGradientNumber(dict.codeSentTo)}
              </p>
              <p className="text-xl font-bold text-gray-800">
                {getHiddenPhone()}
              </p>
              <p className="text-gray-500 text-sm">{dict.enterCodePrompt}</p>
            </div>

            {/* Alerts */}
            <AnimatePresence mode="wait">
              {error && (
                <motion.div
                  initial={{ opacity: 0, y: -10, scale: 0.95 }}
                  animate={{ opacity: 1, y: 0, scale: 1 }}
                  exit={{ opacity: 0, y: -10, scale: 0.95 }}
                  transition={{ duration: 0.3 }}
                >
                  <Alert
                    variant="destructive"
                    className="border-red-200 bg-red-50"
                  >
                    <AlertCircle className="h-5 w-5" />
                    <AlertTitle className="font-semibold">
                      {dict.errors.title}
                    </AlertTitle>
                    <AlertDescription>{error}</AlertDescription>
                  </Alert>
                </motion.div>
              )}

              {successMessage && (
                <motion.div
                  initial={{ opacity: 0, y: -10, scale: 0.95 }}
                  animate={{ opacity: 1, y: 0, scale: 1 }}
                  exit={{ opacity: 0, y: -10, scale: 0.95 }}
                  transition={{ duration: 0.3 }}
                >
                  <Alert className="border-emerald-200 bg-emerald-50">
                    <motion.div
                      animate={{ scale: [1, 1.2, 1] }}
                      transition={{
                        duration: 0.6,
                        repeat: Infinity,
                        repeatDelay: 1,
                      }}
                    >
                      <CheckCircle className="h-5 w-5 text-emerald-600" />
                    </motion.div>
                    <AlertTitle className="font-semibold text-emerald-800">
                      {dict.success.title}
                    </AlertTitle>
                    <AlertDescription className="text-emerald-700">
                      {successMessage}
                    </AlertDescription>
                  </Alert>
                </motion.div>
              )}

              {infoMessage && (
                <motion.div
                  initial={{ opacity: 0, y: -10, scale: 0.95 }}
                  animate={{ opacity: 1, y: 0, scale: 1 }}
                  exit={{ opacity: 0, y: -10, scale: 0.95 }}
                  transition={{ duration: 0.3 }}
                >
                  {/* Info: Teal */}
                  <Alert className="border-teal-200 bg-teal-50">
                    <Sparkles className="h-5 w-5 text-teal-600" />
                    <AlertTitle className="font-semibold text-teal-800">
                      {dict.info.title}
                    </AlertTitle>
                    <AlertDescription className="text-teal-700">
                      {infoMessage}
                    </AlertDescription>
                  </Alert>
                </motion.div>
              )}
            </AnimatePresence>

            {/* OTP Input Form */}
            <form onSubmit={handleVerifyCode} className="space-y-8">
              {/* Code Input Boxes */}
              <div className="flex justify-center gap-2 md:gap-3" dir="ltr">
                {code.map((digit, index) => (
                  <motion.div
                    key={index}
                    initial={{ opacity: 0, scale: 0.8 }}
                    animate={{ opacity: 1, scale: 1 }}
                    transition={{ duration: 0.3, delay: index * 0.05 }}
                    whileHover={{ scale: 1.05 }}
                  >
                    <Input
                      ref={(el: HTMLInputElement | null) => {
                        inputRefs.current[index] = el;
                      }}
                      type="text"
                      inputMode="numeric"
                      maxLength={1}
                      value={digit}
                      onChange={(e) => handleInputChange(index, e.target.value)}
                      onKeyDown={(e) => handleKeyDown(index, e)}
                      onFocus={() => setFocusedIndex(index)}
                      onBlur={() => setFocusedIndex(null)}
                      disabled={disableForm}
                      required
                      aria-label={dict.digitAriaLabel.replace(
                        '{{index}}',
                        (index + 1).toString()
                      )}
                      // Updated Focus and Filled Colors (Teal/Emerald)
                      className={`
                        w-12 h-14 md:w-14 md:h-16 
                        text-center text-2xl md:text-3xl font-bold 
                        border-2 rounded-xl
                        transition-all duration-300
                        shadow-md
                        ${
                          focusedIndex === index
                            ? 'border-teal-500 ring-4 ring-teal-200 scale-105 bg-white'
                            : digit
                              ? 'border-teal-400 bg-teal-50'
                              : 'border-gray-300 bg-white/50'
                        }
                        ${disableForm ? 'opacity-50 cursor-not-allowed' : 'hover:border-teal-400'}
                      `}
                    />
                  </motion.div>
                ))}
              </div>

              {/* Progress Indicator (Teal -> Orange) */}
              <div className="flex justify-center items-center gap-2">
                {code.map((digit, index) => (
                  <motion.div
                    key={index}
                    className={`h-1.5 rounded-full transition-all duration-300 ${
                      digit
                        ? 'bg-gradient-to-r from-teal-500 to-orange-500 w-8'
                        : 'bg-gray-200 w-4'
                    }`}
                    animate={{
                      scale: digit ? [1, 1.2, 1] : 1,
                    }}
                    transition={{ duration: 0.3 }}
                  />
                ))}
              </div>

              {/* Verify Button (Main Gradient) */}
              <motion.div
                whileHover={{ scale: disableForm ? 1 : 1.02 }}
                whileTap={{ scale: disableForm ? 1 : 0.98 }}
              >
                <Button
                  type="submit"
                  disabled={disableForm || !isCodeComplete}
                  className="w-full py-6 text-lg font-bold rounded-xl bg-gradient-to-r from-teal-500 via-orange-500 to-amber-500 hover:from-teal-600 hover:via-orange-600 hover:to-amber-600 text-white shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed relative overflow-hidden group"
                >
                  {isLoading ? (
                    <div className="flex items-center justify-center gap-3">
                      <Loader2 className="animate-spin h-6 w-6" />
                      <span>{dict.verifyingButton}</span>
                    </div>
                  ) : (
                    <div className="flex items-center justify-center gap-3">
                      <CheckCircle className="h-6 w-6" />
                      <span>{dict.verifyButton}</span>
                      {isRTL ? (
                        <ArrowLeft className="h-5 w-5 group-hover:-translate-x-1 transition-transform" />
                      ) : (
                        <ArrowRight className="h-5 w-5 group-hover:translate-x-1 transition-transform" />
                      )}
                    </div>
                  )}
                  {/* Shine effect */}
                  <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent group-hover:translate-x-full transition-transform duration-1000" />
                </Button>
              </motion.div>
            </form>

            {/* Resend Section */}
            <div className="space-y-4 pt-6 border-t border-gray-200">
              <div className="text-center">
                <p className="text-sm text-gray-600 mb-3">
                  {dict.resend.prompt}
                </p>
                <motion.div
                  whileHover={{ scale: disableResend ? 1 : 1.05 }}
                  whileTap={{ scale: disableResend ? 1 : 0.95 }}
                >
                  <Button
                    type="button"
                    variant="outline"
                    onClick={handleResendCode}
                    disabled={disableResend}
                    className={`
                      px-6 py-3 rounded-full border-2 font-semibold
                      transition-all duration-300
                      ${
                        disableResend
                          ? 'border-gray-300 text-gray-400 cursor-not-allowed'
                          : 'border-teal-500 text-teal-600 hover:bg-teal-50 hover:border-teal-600'
                      }
                    `}
                  >
                    {isResending ? (
                      <div className="flex items-center gap-2">
                        <Loader2 className="animate-spin h-4 w-4" />
                        <span>{dict.resend.buttonLoading}</span>
                      </div>
                    ) : resendDisabled ? (
                      <div className="flex items-center gap-3">
                        <CircularTimer
                          seconds={resendTimer}
                          maxSeconds={RESEND_COOLDOWN}
                        />
                        <span>
                          {dict.resend.timer.replace(
                            '{{timer}}',
                            resendTimer.toString()
                          )}
                        </span>
                      </div>
                    ) : (
                      <div className="flex items-center gap-2">
                        <RefreshCw className="h-4 w-4" />
                        <span>{dict.resend.button}</span>
                      </div>
                    )}
                  </Button>
                </motion.div>
              </div>

              {/* Wrong Number Link */}
              <div className="text-center">
                <Link
                  href={`/${locale}/auth/update-phone`}
                  className={`
                    text-sm font-medium inline-flex items-center gap-2
                    transition-all duration-300
                    ${
                      disableForm
                        ? 'text-gray-400 pointer-events-none'
                        : 'text-teal-600 hover:text-teal-700 hover:gap-3'
                    }
                  `}
                >
                  <Clock className="h-4 w-4" />
                  <span>{dict.wrongNumberLink}</span>
                </Link>
              </div>
            </div>

            {/* Back to Sign In */}
            <div className="text-center pt-4 border-t border-gray-200">
              <Link
                href={`/${locale}/auth/signin`}
                className={`
                  text-xs text-gray-500 hover:text-gray-700 
                  transition-colors duration-300
                  inline-flex items-center gap-2
                  ${disableForm ? 'pointer-events-none opacity-50' : ''}
                `}
              >
                {isRTL ? (
                  <ArrowRight className="h-3 w-3" />
                ) : (
                  <ArrowLeft className="h-3 w-3" />
                )}
                <span>{dict.backToSignInLink}</span>
              </Link>
            </div>
          </div>
        </motion.div>

        {/* Bottom Decoration */}
        <motion.div variants={itemVariants} className="mt-8 text-center">
          <div className="inline-flex items-center gap-2 text-sm text-gray-500">
            <Shield className="h-4 w-4" />
            <span>מוגן באמצעות הצפנת SSL</span>
          </div>
        </motion.div>
      </motion.div>

      {/* Custom Styles */}
      <style>{`
        @keyframes shimmer {
          0% {
            background-position: -1000px 0;
          }
          100% {
            background-position: 1000px 0;
          }
        }
      `}</style>
    </div>
  );
};

export default VerifyPhoneClient;
--- End of Content for VerifyPhoneClient.tsx ---

--------------------------------------------------------------------------------
File: C:\Users\eytan\Desktop\NeshamaTech\shidduch-system\src\app\[locale]\auth\verify-phone\page.tsx
--------------------------------------------------------------------------------
Content:
// src/app/[locale]/auth/verify-phone/page.tsx
import { getDictionary } from '@/lib/dictionaries';
import type { Locale } from '../../../../../i18n-config';
import VerifyPhoneClient from './VerifyPhoneClient';

// ▼▼▼ כאן השינוי ▼▼▼
type VerifyPhonePageProps = {
  params: Promise<{ locale: Locale }>;
};

export default async function VerifyPhonePage({ params }: VerifyPhonePageProps) {
  const { locale } = await params;
  const dictionary = await getDictionary(locale);

  return (
    <VerifyPhoneClient
      dict={dictionary.auth.verifyPhone}
      locale={locale}
    />
  );
}
--- End of Content for page.tsx ---

